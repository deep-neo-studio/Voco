var Gy=Object.defineProperty;var pm=o=>{throw TypeError(o)};var $y=(o,t,e)=>t in o?Gy(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var Dt=(o,t,e)=>$y(o,typeof t!="symbol"?t+"":t,e),Tf=(o,t,e)=>t.has(o)||pm("Cannot "+e);var h=(o,t,e)=>(Tf(o,t,"read from private field"),e?e.call(o):t.get(o)),x=(o,t,e)=>t.has(o)?pm("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),_=(o,t,e,i)=>(Tf(o,t,"write to private field"),i?i.call(o,e):t.set(o,e),e),C=(o,t,e)=>(Tf(o,t,"access private method"),e);var Ai=(o,t,e,i)=>({set _(n){_(o,t,n,e)},get _(){return h(o,t,i)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var kh={};kh.d=(o,t)=>{for(var e in t)kh.o(t,e)&&!kh.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:t[e]})};kh.o=(o,t)=>Object.prototype.hasOwnProperty.call(o,t);var It=globalThis.pdfjsLib={};kh.d(It,{AbortException:()=>Qr,AnnotationEditorLayer:()=>ag,AnnotationEditorParamsType:()=>Vt,AnnotationEditorType:()=>Nt,AnnotationEditorUIManager:()=>go,AnnotationLayer:()=>j2,AnnotationMode:()=>vr,ColorPicker:()=>yd,DOMSVGFactory:()=>Ng,DrawLayer:()=>hg,FeatureTest:()=>Di,GlobalWorkerOptions:()=>nr,ImageKind:()=>Pc,InvalidPDFException:()=>Jf,MissingPDFException:()=>Oh,OPS:()=>Pn,OutputScale:()=>ep,PDFDataRangeTransport:()=>_0,PDFDateString:()=>Rg,PDFWorker:()=>Wo,PasswordResponses:()=>Zy,PermissionFlag:()=>Ky,PixelsPerInch:()=>Jr,RenderingCancelledException:()=>Dg,TextLayer:()=>Fh,TouchManager:()=>vd,UnexpectedResponseException:()=>pd,Util:()=>Et,VerbosityLevel:()=>of,XfaLayer:()=>E0,build:()=>A2,createValidAbsoluteUrl:()=>ew,fetchData:()=>cf,getDocument:()=>f2,getFilenameFromUrl:()=>uw,getPdfFilenameFromUrl:()=>cw,getXfaPageViewport:()=>dw,isDataScheme:()=>df,isPdfFile:()=>kg,noContextMenu:()=>Kn,normalizeUnicode:()=>ow,setLayerDimensions:()=>po,shadow:()=>Ht,stopEvent:()=>an,version:()=>_2});const bi=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),wv=[1,0,0,1,0,0],Qf=[.001,0,0,.001,0,0],Xy=1e7,Df=1.35,sn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},vr={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Yy="pdfjs_internal_editor_",Nt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Vt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},Ky={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ui={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Pc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ze={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},sh={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},of={ERRORS:0,WARNINGS:1,INFOS:5},Pn={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},Zy={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let lf=of.WARNINGS;function Qy(o){Number.isInteger(o)&&(lf=o)}function Jy(){return lf}function hf(o){lf>=of.INFOS&&console.log(`Info: ${o}`)}function Ot(o){lf>=of.WARNINGS&&console.log(`Warning: ${o}`)}function le(o){throw new Error(o)}function Ne(o,t){o||le(t)}function tw(o){switch(o==null?void 0:o.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function ew(o,t=null,e=null){if(!o)return null;try{if(e&&typeof o=="string"){if(e.addDefaultProtocol&&o.startsWith("www.")){const n=o.match(/\./g);(n==null?void 0:n.length)>=2&&(o=`http://${o}`)}if(e.tryConvertEncoding)try{o=aw(o)}catch{}}const i=t?new URL(o,t):new URL(o);if(tw(i))return i}catch{}return null}function Ht(o,t,e,i=!1){return Object.defineProperty(o,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}const ea=function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t}();class gm extends ea{constructor(t,e){super(t,"PasswordException"),this.code=e}}class kf extends ea{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Jf extends ea{constructor(t){super(t,"InvalidPDFException")}}class Oh extends ea{constructor(t){super(t,"MissingPDFException")}}class pd extends ea{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}}class iw extends ea{constructor(t){super(t,"FormatError")}}class Qr extends ea{constructor(t){super(t,"AbortException")}}function _v(o){(typeof o!="object"||(o==null?void 0:o.length)===void 0)&&le("Invalid argument for bytesToString");const t=o.length,e=8192;if(t<e)return String.fromCharCode.apply(null,o);const i=[];for(let n=0;n<t;n+=e){const s=Math.min(n+e,t),r=o.subarray(n,s);i.push(String.fromCharCode.apply(null,r))}return i.join("")}function uf(o){typeof o!="string"&&le("Invalid argument for stringToBytes");const t=o.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=o.charCodeAt(i)&255;return e}function nw(o){return String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255)}function Cg(o){const t=Object.create(null);for(const[e,i]of o)t[e]=i;return t}function sw(){const o=new Uint8Array(4);return o[0]=1,new Uint32Array(o.buffer,0,1)[0]===1}function rw(){try{return new Function(""),!0}catch{return!1}}class Di{static get isLittleEndian(){return Ht(this,"isLittleEndian",sw())}static get isEvalSupported(){return Ht(this,"isEvalSupported",rw())}static get isOffscreenCanvasSupported(){return Ht(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Ht(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?Ht(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):Ht(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var t,e;return Ht(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const Rf=Array.from(Array(256).keys(),o=>o.toString(16).padStart(2,"0"));var ar,Nc,tp;class Et{static makeHexColor(t,e,i){return`#${Rf[t]}${Rf[e]}${Rf[i]}`}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){const i=t[0]*e[0]+t[1]*e[2]+e[4],n=t[0]*e[1]+t[1]*e[3]+e[5];return[i,n]}static applyInverseTransform(t,e){const i=e[0]*e[3]-e[1]*e[2],n=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,s=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i;return[n,s]}static getAxialAlignedBoundingBox(t,e){const i=this.applyTransform(t,e),n=this.applyTransform(t.slice(2,4),e),s=this.applyTransform([t[0],t[3]],e),r=this.applyTransform([t[2],t[1]],e);return[Math.min(i[0],n[0],s[0],r[0]),Math.min(i[1],n[1],s[1],r[1]),Math.max(i[0],n[0],s[0],r[0]),Math.max(i[1],n[1],s[1],r[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],n=t[0]*e[1]+t[1]*e[3],s=t[2]*e[0]+t[3]*e[2],r=t[2]*e[1]+t[3]*e[3],a=(i+r)/2,l=Math.sqrt((i+r)**2-4*(i*r-s*n))/2,u=a+l||1,c=a-l||1;return[Math.sqrt(u),Math.sqrt(c)]}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),n=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>n)return null;const s=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return s>r?null:[i,s,n,r]}static bezierBoundingBox(t,e,i,n,s,r,a,l,u){return u?(u[0]=Math.min(u[0],t,a),u[1]=Math.min(u[1],e,l),u[2]=Math.max(u[2],t,a),u[3]=Math.max(u[3],e,l)):u=[Math.min(t,a),Math.min(e,l),Math.max(t,a),Math.max(e,l)],C(this,ar,tp).call(this,t,i,s,a,e,n,r,l,3*(-t+3*(i-s)+a),6*(t-2*i+s),3*(i-t),u),C(this,ar,tp).call(this,t,i,s,a,e,n,r,l,3*(-e+3*(n-r)+l),6*(e-2*n+r),3*(n-e),u),u}}ar=new WeakSet,Nc=function(t,e,i,n,s,r,a,l,u,c){if(u<=0||u>=1)return;const d=1-u,f=u*u,p=f*u,b=d*(d*(d*t+3*u*e)+3*f*i)+p*n,y=d*(d*(d*s+3*u*r)+3*f*a)+p*l;c[0]=Math.min(c[0],b),c[1]=Math.min(c[1],y),c[2]=Math.max(c[2],b),c[3]=Math.max(c[3],y)},tp=function(t,e,i,n,s,r,a,l,u,c,d,f){if(Math.abs(u)<1e-12){Math.abs(c)>=1e-12&&C(this,ar,Nc).call(this,t,e,i,n,s,r,a,l,-d/c,f);return}const p=c**2-4*d*u;if(p<0)return;const b=Math.sqrt(p),y=2*u;C(this,ar,Nc).call(this,t,e,i,n,s,r,a,l,(-c+b)/y,f),C(this,ar,Nc).call(this,t,e,i,n,s,r,a,l,(-c-b)/y,f)},x(Et,ar);function aw(o){return decodeURIComponent(escape(o))}let If=null,mm=null;function ow(o){return If||(If=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,mm=new Map([["ﬅ","ſt"]])),o.replaceAll(If,(t,e,i)=>e?e.normalize("NFKC"):mm.get(i))}function lw(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const o=new Uint8Array(32);return crypto.getRandomValues(o),_v(o)}const Tg="pdfjs_internal_id_";function hw(o){return Uint8Array.prototype.toBase64?o.toBase64():btoa(_v(o))}typeof Promise.try!="function"&&(Promise.try=function(o,...t){return new Promise(e=>{e(o(...t))})});const Ts="http://www.w3.org/2000/svg",oa=class oa{};Dt(oa,"CSS",96),Dt(oa,"PDF",72),Dt(oa,"PDF_TO_CSS_UNITS",oa.CSS/oa.PDF);let Jr=oa;async function cf(o,t="text"){if(fh(o,document.baseURI)){const e=await fetch(o);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{const n=new XMLHttpRequest;n.open("GET",o,!0),n.responseType=t,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(n.status===200||n.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(n.response);return}e(n.responseText);return}i(new Error(n.statusText))}},n.send(null)})}class mc{constructor({viewBox:t,userUnit:e,scale:i,rotation:n,offsetX:s=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=i,this.rotation=n,this.offsetX=s,this.offsetY=r,i*=e;const l=(t[2]+t[0])/2,u=(t[3]+t[1])/2;let c,d,f,p;switch(n%=360,n<0&&(n+=360),n){case 180:c=-1,d=0,f=0,p=1;break;case 90:c=0,d=1,f=1,p=0;break;case 270:c=0,d=-1,f=-1,p=0;break;case 0:c=1,d=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(f=-f,p=-p);let b,y,g,m;c===0?(b=Math.abs(u-t[1])*i+s,y=Math.abs(l-t[0])*i+r,g=(t[3]-t[1])*i,m=(t[2]-t[0])*i):(b=Math.abs(l-t[0])*i+s,y=Math.abs(u-t[1])*i+r,g=(t[2]-t[0])*i,m=(t[3]-t[1])*i),this.transform=[c*i,d*i,f*i,p*i,b-c*i*l-f*i*u,y-d*i*l-p*i*u],this.width=g,this.height=m}get rawDims(){const{userUnit:t,viewBox:e}=this,i=e.map(n=>n*t);return Ht(this,"rawDims",{pageWidth:i[2]-i[0],pageHeight:i[3]-i[1],pageX:i[0],pageY:i[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:n=this.offsetY,dontFlip:s=!1}={}){return new mc({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:n,dontFlip:s})}convertToViewportPoint(t,e){return Et.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=Et.applyTransform([t[0],t[1]],this.transform),i=Et.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){return Et.applyInverseTransform([t,e],this.transform)}}class Dg extends ea{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function df(o){const t=o.length;let e=0;for(;e<t&&o[e].trim()==="";)e++;return o.substring(e,e+5).toLowerCase()==="data:"}function kg(o){return typeof o=="string"&&/\.pdf$/i.test(o)}function uw(o){return[o]=o.split(/[#?]/,1),o.substring(o.lastIndexOf("/")+1)}function cw(o,t="document.pdf"){if(typeof o!="string")return t;if(df(o))return Ot('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,n=e.exec(o);let s=i.exec(n[1])||i.exec(n[2])||i.exec(n[3]);if(s&&(s=s[0],s.includes("%")))try{s=i.exec(decodeURIComponent(s))[0]}catch{}return s||t}class vm{constructor(){Dt(this,"started",Object.create(null));Dt(this,"times",[])}time(t){t in this.started&&Ot(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||Ot(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:i}of this.times)e=Math.max(i.length,e);for(const{name:i,start:n,end:s}of this.times)t.push(`${i.padEnd(e)} ${s-n}ms
`);return t.join("")}}function fh(o,t){try{const{protocol:e}=t?new URL(o,t):new URL(o);return e==="http:"||e==="https:"}catch{return!1}}function Kn(o){o.preventDefault()}function an(o){o.preventDefault(),o.stopPropagation()}var Vh;class Rg{static toDateObject(t){if(!t||typeof t!="string")return null;h(this,Vh)||_(this,Vh,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=h(this,Vh).exec(t);if(!e)return null;const i=parseInt(e[1],10);let n=parseInt(e[2],10);n=n>=1&&n<=12?n-1:0;let s=parseInt(e[3],10);s=s>=1&&s<=31?s:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const u=e[7]||"Z";let c=parseInt(e[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(e[9],10)||0;return d=d>=0&&d<=59?d:0,u==="-"?(r+=c,a+=d):u==="+"&&(r-=c,a-=d),new Date(Date.UTC(i,n,s,r,a,l))}}Vh=new WeakMap,x(Rg,Vh);function dw(o,{scale:t=1,rotation:e=0}){const{width:i,height:n}=o.attributes.style,s=[0,0,parseInt(i),parseInt(n)];return new mc({viewBox:s,userUnit:1,scale:t,rotation:e})}function Ig(o){if(o.startsWith("#")){const t=parseInt(o.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return o.startsWith("rgb(")?o.slice(4,-1).split(",").map(t=>parseInt(t)):o.startsWith("rgba(")?o.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(Ot(`Not a valid color format: "${o}"`),[0,0,0])}function fw(o){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const e of o.keys()){t.style.color=e;const i=window.getComputedStyle(t).color;o.set(e,Ig(i))}t.remove()}function me(o){const{a:t,b:e,c:i,d:n,e:s,f:r}=o.getTransform();return[t,e,i,n,s,r]}function Qn(o){const{a:t,b:e,c:i,d:n,e:s,f:r}=o.getTransform().invertSelf();return[t,e,i,n,s,r]}function po(o,t,e=!1,i=!0){if(t instanceof mc){const{pageWidth:n,pageHeight:s}=t.rawDims,{style:r}=o,a=Di.isCSSRoundSupported,l=`var(--scale-factor) * ${n}px`,u=`var(--scale-factor) * ${s}px`,c=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,d=a?`round(down, ${u}, var(--scale-round-y, 1px))`:`calc(${u})`;!e||t.rotation%180===0?(r.width=c,r.height=d):(r.width=d,r.height=c)}i&&o.setAttribute("data-main-rotation",t.rotation)}class ep{constructor(){const t=window.devicePixelRatio||1;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var br,ha,On,ua,Gh,$h,Hd,Av,ki,Ev,xv,Oc,Sv,np;const Rs=class Rs{constructor(t){x(this,ki);x(this,br,null);x(this,ha,null);x(this,On);x(this,ua,null);x(this,Gh,null);_(this,On,t),h(Rs,$h)||_(Rs,$h,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const t=_(this,br,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=h(this,On)._uiManager._signal;t.addEventListener("contextmenu",Kn,{signal:e}),t.addEventListener("pointerdown",C(Rs,Hd,Av),{signal:e});const i=_(this,ua,document.createElement("div"));i.className="buttons",t.append(i);const n=h(this,On).toolbarPosition;if(n){const{style:s}=t,r=h(this,On)._uiManager.direction==="ltr"?1-n[0]:n[0];s.insetInlineEnd=`${100*r}%`,s.top=`calc(${100*n[1]}% + var(--editor-toolbar-vert-offset))`}return C(this,ki,Sv).call(this),t}get div(){return h(this,br)}hide(){var t;h(this,br).classList.add("hidden"),(t=h(this,ha))==null||t.hideDropdown()}show(){var t;h(this,br).classList.remove("hidden"),(t=h(this,Gh))==null||t.shown()}async addAltText(t){const e=await t.render();C(this,ki,Oc).call(this,e),h(this,ua).prepend(e,h(this,ki,np)),_(this,Gh,t)}addColorPicker(t){_(this,ha,t);const e=t.renderButton();C(this,ki,Oc).call(this,e),h(this,ua).prepend(e,h(this,ki,np))}remove(){var t;h(this,br).remove(),(t=h(this,ha))==null||t.destroy(),_(this,ha,null)}};br=new WeakMap,ha=new WeakMap,On=new WeakMap,ua=new WeakMap,Gh=new WeakMap,$h=new WeakMap,Hd=new WeakSet,Av=function(t){t.stopPropagation()},ki=new WeakSet,Ev=function(t){h(this,On)._focusEventsAllowed=!1,an(t)},xv=function(t){h(this,On)._focusEventsAllowed=!0,an(t)},Oc=function(t){const e=h(this,On)._uiManager._signal;t.addEventListener("focusin",C(this,ki,Ev).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",C(this,ki,xv).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Kn,{signal:e})},Sv=function(){const{editorType:t,_uiManager:e}=h(this,On),i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",h(Rs,$h)[t]),C(this,ki,Oc).call(this,i),i.addEventListener("click",n=>{e.delete()},{signal:e._signal}),h(this,ua).append(i)},np=function(){const t=document.createElement("div");return t.className="divider",t},x(Rs,Hd),x(Rs,$h,null);let ip=Rs;var Xh,ca,da,ta,Cv,Tv,Dv;class pw{constructor(t){x(this,ta);x(this,Xh,null);x(this,ca,null);x(this,da);_(this,da,t)}show(t,e,i){const[n,s]=C(this,ta,Tv).call(this,e,i),{style:r}=h(this,ca)||_(this,ca,C(this,ta,Cv).call(this));t.append(h(this,ca)),r.insetInlineEnd=`${100*n}%`,r.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){h(this,ca).remove()}}Xh=new WeakMap,ca=new WeakMap,da=new WeakMap,ta=new WeakSet,Cv=function(){const t=_(this,ca,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",Kn,{signal:h(this,da)._signal});const e=_(this,Xh,document.createElement("div"));return e.className="buttons",t.append(e),C(this,ta,Dv).call(this),t},Tv=function(t,e){let i=0,n=0;for(const s of t){const r=s.y+s.height;if(r<i)continue;const a=s.x+(e?s.width:0);if(r>i){n=a,i=r;continue}e?a>n&&(n=a):a<n&&(n=a)}return[e?1-n:n,i]},Dv=function(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=h(this,da)._signal;t.addEventListener("contextmenu",Kn,{signal:i}),t.addEventListener("click",()=>{h(this,da).highlightSelection("floating_button")},{signal:i}),h(this,Xh).append(t)};function gd(o,t,e){for(const i of e)t.addEventListener(i,o[i].bind(o))}var jd;class gw{constructor(){x(this,jd,0)}get id(){return`${Yy}${Ai(this,jd)._++}`}}jd=new WeakMap;var Vo,Yh,fi,Go,Fc;const rm=class rm{constructor(){x(this,Go);x(this,Vo,lw());x(this,Yh,0);x(this,fi,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),n=new Image;n.src=t;const s=n.decode().then(()=>(i.drawImage(n,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return Ht(this,"_isSVGFittingCanvas",s)}async getFromFile(t){const{lastModified:e,name:i,size:n,type:s}=t;return C(this,Go,Fc).call(this,`${e}_${i}_${n}_${s}`,t)}async getFromUrl(t){return C(this,Go,Fc).call(this,t,t)}async getFromBlob(t,e){const i=await e;return C(this,Go,Fc).call(this,t,i)}async getFromId(t){h(this,fi)||_(this,fi,new Map);const e=h(this,fi).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)}getFromCanvas(t,e){h(this,fi)||_(this,fi,new Map);let i=h(this,fi).get(t);if(i!=null&&i.bitmap)return i.refCounter+=1,i;const n=new OffscreenCanvas(e.width,e.height);return n.getContext("2d").drawImage(e,0,0),i={bitmap:n.transferToImageBitmap(),id:`image_${h(this,Vo)}_${Ai(this,Yh)._++}`,refCounter:1,isSvg:!1},h(this,fi).set(t,i),h(this,fi).set(i.id,i),i}getSvgUrl(t){const e=h(this,fi).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var n;h(this,fi)||_(this,fi,new Map);const e=h(this,fi).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:i}=e;if(!e.url&&!e.file){const s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=s.convertToBlob()}(n=i.close)==null||n.call(i),e.bitmap=null}isValidId(t){return t.startsWith(`image_${h(this,Vo)}_`)}};Vo=new WeakMap,Yh=new WeakMap,fi=new WeakMap,Go=new WeakSet,Fc=async function(t,e){h(this,fi)||_(this,fi,new Map);let i=h(this,fi).get(t);if(i===null)return null;if(i!=null&&i.bitmap)return i.refCounter+=1,i;try{i||(i={bitmap:null,id:`image_${h(this,Vo)}_${Ai(this,Yh)._++}`,refCounter:0,isSvg:!1});let n;if(typeof e=="string"?(i.url=e,n=await cf(e,"blob")):e instanceof File?n=i.file=e:e instanceof Blob&&(n=e),n.type==="image/svg+xml"){const s=rm._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((u,c)=>{a.onload=()=>{i.bitmap=a,i.isSvg=!0,u()},r.onload=async()=>{const d=i.svgUrl=r.result;a.src=await s?`${d}#svgView(preserveAspectRatio(none))`:d},a.onerror=r.onerror=c});r.readAsDataURL(n),await l}else i.bitmap=await createImageBitmap(n);i.refCounter=1}catch(n){Ot(n),i=null}return h(this,fi).set(t,i),i&&h(this,fi).set(i.id,i),i};let sp=rm;var De,yr,Kh,be;class mw{constructor(t=128){x(this,De,[]);x(this,yr,!1);x(this,Kh);x(this,be,-1);_(this,Kh,t)}add({cmd:t,undo:e,post:i,mustExec:n,type:s=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(n&&t(),h(this,yr))return;const l={cmd:t,undo:e,post:i,type:s};if(h(this,be)===-1){h(this,De).length>0&&(h(this,De).length=0),_(this,be,0),h(this,De).push(l);return}if(r&&h(this,De)[h(this,be)].type===s){a&&(l.undo=h(this,De)[h(this,be)].undo),h(this,De)[h(this,be)]=l;return}const u=h(this,be)+1;u===h(this,Kh)?h(this,De).splice(0,1):(_(this,be,u),u<h(this,De).length&&h(this,De).splice(u)),h(this,De).push(l)}undo(){if(h(this,be)===-1)return;_(this,yr,!0);const{undo:t,post:e}=h(this,De)[h(this,be)];t(),e==null||e(),_(this,yr,!1),_(this,be,h(this,be)-1)}redo(){if(h(this,be)<h(this,De).length-1){_(this,be,h(this,be)+1),_(this,yr,!0);const{cmd:t,post:e}=h(this,De)[h(this,be)];t(),e==null||e(),_(this,yr,!1)}}hasSomethingToUndo(){return h(this,be)!==-1}hasSomethingToRedo(){return h(this,be)<h(this,De).length-1}cleanType(t){if(h(this,be)!==-1){for(let e=h(this,be);e>=0;e--)if(h(this,De)[e].type!==t){h(this,De).splice(e+1,h(this,be)-e),_(this,be,e);return}h(this,De).length=0,_(this,be,-1)}}destroy(){_(this,De,null)}}De=new WeakMap,yr=new WeakMap,Kh=new WeakMap,be=new WeakMap;var Wd,kv;class vc{constructor(t){x(this,Wd);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Di.platform;for(const[i,n,s={}]of t)for(const r of i){const a=r.startsWith("mac+");e&&a?(this.callbacks.set(r.slice(4),{callback:n,options:s}),this.allKeys.add(r.split("+").at(-1))):!e&&!a&&(this.callbacks.set(r,{callback:n,options:s}),this.allKeys.add(r.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const i=this.callbacks.get(C(this,Wd,kv).call(this,e));if(!i)return;const{callback:n,options:{bubbles:s=!1,args:r=[],checker:a=null}}=i;a&&!a(t,e)||(n.bind(t,...r,e)(),s||an(e))}}Wd=new WeakSet,kv=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e};const qd=class qd{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return fw(t),Ht(this,"_colors",t)}convert(t){const e=Ig(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[i,n]of this._colors)if(n.every((s,r)=>s===e[r]))return qd._colorsMapping.get(i);return e}getHexCode(t){const e=this._colors.get(t);return e?Et.makeHexColor(...e):t}};Dt(qd,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let rp=qd;var $o,Vi,He,ti,Xo,Ls,Yo,dn,wr,fa,Ko,pa,is,Fn,ga,Zh,Qh,Zo,Jh,ns,_r,Qo,Ar,ss,Vd,Er,tu,xr,ma,eu,iu,Ge,ie,Ps,va,nu,su,Sr,rs,Ns,ru,fn,ht,Mc,ap,Rv,Iv,Bc,Lv,Pv,Nv,op,Ov,lp,hp,Fv,Ei,Ds,Mv,Bv,up,zv,ph,cp;const Uo=class Uo{constructor(t,e,i,n,s,r,a,l,u,c,d,f,p){x(this,ht);x(this,$o,new AbortController);x(this,Vi,null);x(this,He,new Map);x(this,ti,new Map);x(this,Xo,null);x(this,Ls,null);x(this,Yo,null);x(this,dn,new mw);x(this,wr,null);x(this,fa,null);x(this,Ko,0);x(this,pa,new Set);x(this,is,null);x(this,Fn,null);x(this,ga,new Set);Dt(this,"_editorUndoBar",null);x(this,Zh,!1);x(this,Qh,!1);x(this,Zo,!1);x(this,Jh,null);x(this,ns,null);x(this,_r,null);x(this,Qo,null);x(this,Ar,!1);x(this,ss,null);x(this,Vd,new gw);x(this,Er,!1);x(this,tu,!1);x(this,xr,null);x(this,ma,null);x(this,eu,null);x(this,iu,null);x(this,Ge,Nt.NONE);x(this,ie,new Set);x(this,Ps,null);x(this,va,null);x(this,nu,null);x(this,su,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});x(this,Sr,[0,0]);x(this,rs,null);x(this,Ns,null);x(this,ru,null);x(this,fn,null);const b=this._signal=h(this,$o).signal;_(this,Ns,t),_(this,ru,e),_(this,Xo,i),this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:b}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),n._on("setpreference",this.onSetPreference.bind(this),{signal:b}),n._on("switchannotationeditorparams",y=>this.updateParams(y.type,y.value),{signal:b}),C(this,ht,Lv).call(this),C(this,ht,Fv).call(this),C(this,ht,op).call(this),_(this,Ls,s.annotationStorage),_(this,Jh,s.filterFactory),_(this,va,r),_(this,Qo,a||null),_(this,Zh,l),_(this,Qh,u),_(this,Zo,c),_(this,iu,d||null),this.viewParameters={realScale:Jr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=p!==!1}static get _keyboardManager(){const t=Uo.prototype,e=r=>h(r,Ns).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),i=(r,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},n=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return Ht(this,"_keyboardManager",new vc([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&h(r,Ns).contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&h(r,Ns).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}]]))}destroy(){var t,e,i,n,s;(t=h(this,fn))==null||t.resolve(),_(this,fn,null),(e=h(this,$o))==null||e.abort(),_(this,$o,null),this._signal=null;for(const r of h(this,ti).values())r.destroy();h(this,ti).clear(),h(this,He).clear(),h(this,ga).clear(),_(this,Vi,null),h(this,ie).clear(),h(this,dn).destroy(),(i=h(this,Xo))==null||i.destroy(),(n=h(this,ss))==null||n.hide(),_(this,ss,null),h(this,ns)&&(clearTimeout(h(this,ns)),_(this,ns,null)),h(this,rs)&&(clearTimeout(h(this,rs)),_(this,rs,null)),(s=this._editorUndoBar)==null||s.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return h(this,iu)}get useNewAltTextFlow(){return h(this,Qh)}get useNewAltTextWhenAddingImage(){return h(this,Zo)}get hcmFilter(){return Ht(this,"hcmFilter",h(this,va)?h(this,Jh).addHCMFilter(h(this,va).foreground,h(this,va).background):"none")}get direction(){return Ht(this,"direction",getComputedStyle(h(this,Ns)).direction)}get highlightColors(){return Ht(this,"highlightColors",h(this,Qo)?new Map(h(this,Qo).split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return Ht(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),_(this,fa,t)}setMainHighlightColorPicker(t){_(this,eu,t)}editAltText(t,e=!1){var i;(i=h(this,Xo))==null||i.editAltText(this,t,e)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":_(this,Zo,e);break}}onPageChanging({pageNumber:t}){_(this,Ko,t-1)}focusMainContainer(){h(this,Ns).focus()}findParent(t,e){for(const i of h(this,ti).values()){const{x:n,y:s,width:r,height:a}=i.div.getBoundingClientRect();if(t>=n&&t<=n+r&&e>=s&&e<=s+a)return i}return null}disableUserSelect(t=!1){h(this,ru).classList.toggle("noUserSelect",t)}addShouldRescale(t){h(this,ga).add(t)}removeShouldRescale(t){h(this,ga).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*Jr.PDF_TO_CSS_UNITS;for(const i of h(this,ga))i.onScaleChanging();(e=h(this,fa))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=e,a=e.toString(),u=C(this,ht,Mc).call(this,e).closest(".textLayer"),c=this.getSelectionBoxes(u);if(!c)return;e.empty();const d=C(this,ht,ap).call(this,u),f=h(this,Ge)===Nt.NONE,p=()=>{d==null||d.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:c,anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r,text:a}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(Nt.HIGHLIGHT,p);return}p()}addToAnnotationStorage(t){!t.isEmpty()&&h(this,Ls)&&!h(this,Ls).has(t.id)&&h(this,Ls).setValue(t.id,t)}blur(){if(this.isShiftKeyDown=!1,h(this,Ar)&&(_(this,Ar,!1),C(this,ht,Bc).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of h(this,ie))if(e.div.contains(t)){_(this,ma,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!h(this,ma))return;const[t,e]=h(this,ma);_(this,ma,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){C(this,ht,op).call(this),C(this,ht,lp).call(this)}removeEditListeners(){C(this,ht,Ov).call(this),C(this,ht,hp).call(this)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const i of h(this,Fn))if(i.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const i of h(this,Fn))if(i.isHandlingMimeForPasting(e.type)){i.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var i;if(t.preventDefault(),(i=h(this,Vi))==null||i.commitOrRemove(),!this.hasSelection)return;const e=[];for(const n of h(this,ie)){const s=n.serialize(!0);s&&e.push(s)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const s of e.items)for(const r of h(this,Fn))if(r.isHandlingMimeForPasting(s.type)){r.paste(s,this.currentLayer);return}let i=e.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(s){Ot(`paste: "${s.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const n=this.currentLayer;try{const s=[];for(const l of i){const u=await n.deserialize(l);if(!u)return;s.push(u)}const r=()=>{for(const l of s)C(this,ht,up).call(this,l);C(this,ht,cp).call(this,s)},a=()=>{for(const l of s)l.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(s){Ot(`paste: "${s.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),h(this,Ge)!==Nt.NONE&&!this.isEditorHandlingKeyboard&&Uo._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,h(this,Ar)&&(_(this,Ar,!1),C(this,ht,Bc).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(C(this,ht,Pv).call(this),C(this,ht,lp).call(this),C(this,ht,Ei).call(this,{isEditing:h(this,Ge)!==Nt.NONE,isEmpty:C(this,ht,ph).call(this),hasSomethingToUndo:h(this,dn).hasSomethingToUndo(),hasSomethingToRedo:h(this,dn).hasSomethingToRedo(),hasSelectedEditor:!1})):(C(this,ht,Nv).call(this),C(this,ht,hp).call(this),C(this,ht,Ei).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!h(this,Fn)){_(this,Fn,t);for(const e of h(this,Fn))C(this,ht,Ds).call(this,e.defaultPropertiesToUpdate)}}getId(){return h(this,Vd).id}get currentLayer(){return h(this,ti).get(h(this,Ko))}getLayer(t){return h(this,ti).get(t)}get currentPageIndex(){return h(this,Ko)}addLayer(t){h(this,ti).set(t.pageIndex,t),h(this,Er)?t.enable():t.disable()}removeLayer(t){h(this,ti).delete(t.pageIndex)}async updateMode(t,e=null,i=!1){var n;if(h(this,Ge)!==t&&!(h(this,fn)&&(await h(this,fn).promise,!h(this,fn)))){if(_(this,fn,Promise.withResolvers()),_(this,Ge,t),t===Nt.NONE){this.setEditingState(!1),C(this,ht,Bv).call(this),(n=this._editorUndoBar)==null||n.hide(),h(this,fn).resolve();return}this.setEditingState(!0),await C(this,ht,Mv).call(this),this.unselectAll();for(const s of h(this,ti).values())s.updateMode(t);if(!e){i&&this.addNewEditorFromKeyboard(),h(this,fn).resolve();return}for(const s of h(this,He).values())s.annotationElementId===e?(this.setSelected(s),s.enterInEditMode()):s.unselect();h(this,fn).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==h(this,Ge)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){var i;if(h(this,Fn)){switch(t){case Vt.CREATE:this.currentLayer.addNewEditor();return;case Vt.HIGHLIGHT_DEFAULT_COLOR:(i=h(this,eu))==null||i.updateColor(e);break;case Vt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(h(this,nu)||_(this,nu,new Map)).set(t,e),this.showAllEditors("highlight",e);break}for(const n of h(this,ie))n.updateParams(t,e);for(const n of h(this,Fn))n.updateDefaultParams(t,e)}}showAllEditors(t,e,i=!1){var s;for(const r of h(this,He).values())r.editorType===t&&r.show(e);(((s=h(this,nu))==null?void 0:s.get(Vt.HIGHLIGHT_SHOW_ALL))??!0)!==e&&C(this,ht,Ds).call(this,[[Vt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(h(this,tu)!==t){_(this,tu,t);for(const e of h(this,ti).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){const e=[];for(const i of h(this,He).values())i.pageIndex===t&&e.push(i);return e}getEditor(t){return h(this,He).get(t)}addEditor(t){h(this,He).set(t.id,t)}removeEditor(t){var e;t.div.contains(document.activeElement)&&(h(this,ns)&&clearTimeout(h(this,ns)),_(this,ns,setTimeout(()=>{this.focusMainContainer(),_(this,ns,null)},0))),h(this,He).delete(t.id),this.unselect(t),(!t.annotationElementId||!h(this,pa).has(t.annotationElementId))&&((e=h(this,Ls))==null||e.remove(t.id))}addDeletedAnnotationElement(t){h(this,pa).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return h(this,pa).has(t)}removeDeletedAnnotationElement(t){h(this,pa).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){h(this,Vi)!==t&&(_(this,Vi,t),t&&C(this,ht,Ds).call(this,t.propertiesToUpdate))}updateUI(t){h(this,ht,zv)===t&&C(this,ht,Ds).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){C(this,ht,Ds).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(h(this,ie).has(t)){h(this,ie).delete(t),t.unselect(),C(this,ht,Ei).call(this,{hasSelectedEditor:this.hasSelection});return}h(this,ie).add(t),t.select(),C(this,ht,Ds).call(this,t.propertiesToUpdate),C(this,ht,Ei).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;(e=h(this,fa))==null||e.commitOrRemove();for(const i of h(this,ie))i!==t&&i.unselect();h(this,ie).clear(),h(this,ie).add(t),t.select(),C(this,ht,Ds).call(this,t.propertiesToUpdate),C(this,ht,Ei).call(this,{hasSelectedEditor:!0})}isSelected(t){return h(this,ie).has(t)}get firstSelectedEditor(){return h(this,ie).values().next().value}unselect(t){t.unselect(),h(this,ie).delete(t),C(this,ht,Ei).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return h(this,ie).size!==0}get isEnterHandled(){return h(this,ie).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;h(this,dn).undo(),C(this,ht,Ei).call(this,{hasSomethingToUndo:h(this,dn).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:C(this,ht,ph).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){h(this,dn).redo(),C(this,ht,Ei).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:h(this,dn).hasSomethingToRedo(),isEmpty:C(this,ht,ph).call(this)})}addCommands(t){h(this,dn).add(t),C(this,ht,Ei).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:C(this,ht,ph).call(this)})}cleanUndoStack(t){h(this,dn).cleanType(t)}delete(){var s;this.commitOrRemove();const t=(s=this.currentLayer)==null?void 0:s.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...h(this,ie)],i=()=>{var r;(r=this._editorUndoBar)==null||r.show(n,e.length===1?e[0].editorType:e.length);for(const a of e)a.remove()},n=()=>{for(const r of e)C(this,ht,up).call(this,r)};this.addCommands({cmd:i,undo:n,mustExec:!0})}commitOrRemove(){var t;(t=h(this,Vi))==null||t.commitOrRemove()}hasSomethingToControl(){return h(this,Vi)||this.hasSelection}selectAll(){for(const t of h(this,ie))t.commit();C(this,ht,cp).call(this,h(this,He).values())}unselectAll(){var t;if(!(h(this,Vi)&&(h(this,Vi).commitOrRemove(),h(this,Ge)!==Nt.NONE))&&!((t=h(this,fa))!=null&&t.commitOrRemove())&&this.hasSelection){for(const e of h(this,ie))e.unselect();h(this,ie).clear(),C(this,ht,Ei).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;h(this,Sr)[0]+=t,h(this,Sr)[1]+=e;const[n,s]=h(this,Sr),r=[...h(this,ie)],a=1e3;h(this,rs)&&clearTimeout(h(this,rs)),_(this,rs,setTimeout(()=>{_(this,rs,null),h(this,Sr)[0]=h(this,Sr)[1]=0,this.addCommands({cmd:()=>{for(const l of r)h(this,He).has(l.id)&&l.translateInPage(n,s)},undo:()=>{for(const l of r)h(this,He).has(l.id)&&l.translateInPage(-n,-s)},mustExec:!1})},a));for(const l of r)l.translateInPage(t,e)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),_(this,is,new Map);for(const t of h(this,ie))h(this,is).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!h(this,is))return!1;this.disableUserSelect(!1);const t=h(this,is);_(this,is,null);let e=!1;for(const[{x:n,y:s,pageIndex:r},a]of t)a.newX=n,a.newY=s,a.newPageIndex=r,e||(e=n!==a.savedX||s!==a.savedY||r!==a.savedPageIndex);if(!e)return!1;const i=(n,s,r,a)=>{if(h(this,He).has(n.id)){const l=h(this,ti).get(a);l?n._setParentAndPosition(l,s,r):(n.pageIndex=a,n.x=s,n.y=r)}};return this.addCommands({cmd:()=>{for(const[n,{newX:s,newY:r,newPageIndex:a}]of t)i(n,s,r,a)},undo:()=>{for(const[n,{savedX:s,savedY:r,savedPageIndex:a}]of t)i(n,s,r,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(h(this,is))for(const i of h(this,is).keys())i.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||h(this,ie).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return h(this,Vi)===t}getActive(){return h(this,Vi)}getMode(){return h(this,Ge)}get imageManager(){return Ht(this,"imageManager",new sp)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let u=0,c=e.rangeCount;u<c;u++)if(!t.contains(e.getRangeAt(u).commonAncestorContainer))return null;const{x:i,y:n,width:s,height:r}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(u,c,d,f)=>({x:(c-n)/r,y:1-(u+d-i)/s,width:f/r,height:d/s});break;case"180":a=(u,c,d,f)=>({x:1-(u+d-i)/s,y:1-(c+f-n)/r,width:d/s,height:f/r});break;case"270":a=(u,c,d,f)=>({x:1-(c+f-n)/r,y:(u-i)/s,width:f/r,height:d/s});break;default:a=(u,c,d,f)=>({x:(u-i)/s,y:(c-n)/r,width:d/s,height:f/r});break}const l=[];for(let u=0,c=e.rangeCount;u<c;u++){const d=e.getRangeAt(u);if(!d.collapsed)for(const{x:f,y:p,width:b,height:y}of d.getClientRects())b===0||y===0||l.push(a(f,p,b,y))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(h(this,Yo)||_(this,Yo,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=h(this,Yo))==null||e.delete(t)}renderAnnotationElement(t){var n;const e=(n=h(this,Yo))==null?void 0:n.get(t.data.id);if(!e)return;const i=h(this,Ls).getRawValue(e);i&&(h(this,Ge)===Nt.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}};$o=new WeakMap,Vi=new WeakMap,He=new WeakMap,ti=new WeakMap,Xo=new WeakMap,Ls=new WeakMap,Yo=new WeakMap,dn=new WeakMap,wr=new WeakMap,fa=new WeakMap,Ko=new WeakMap,pa=new WeakMap,is=new WeakMap,Fn=new WeakMap,ga=new WeakMap,Zh=new WeakMap,Qh=new WeakMap,Zo=new WeakMap,Jh=new WeakMap,ns=new WeakMap,_r=new WeakMap,Qo=new WeakMap,Ar=new WeakMap,ss=new WeakMap,Vd=new WeakMap,Er=new WeakMap,tu=new WeakMap,xr=new WeakMap,ma=new WeakMap,eu=new WeakMap,iu=new WeakMap,Ge=new WeakMap,ie=new WeakMap,Ps=new WeakMap,va=new WeakMap,nu=new WeakMap,su=new WeakMap,Sr=new WeakMap,rs=new WeakMap,Ns=new WeakMap,ru=new WeakMap,fn=new WeakMap,ht=new WeakSet,Mc=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},ap=function(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const i of h(this,ti).values())if(i.hasTextLayer(t))return i;return null},Rv=function(){const t=document.getSelection();if(!t||t.isCollapsed)return;const i=C(this,ht,Mc).call(this,t).closest(".textLayer"),n=this.getSelectionBoxes(i);n&&(h(this,ss)||_(this,ss,new pw(this)),h(this,ss).show(i,n,this.direction==="ltr"))},Iv=function(){var s,r,a;const t=document.getSelection();if(!t||t.isCollapsed){h(this,Ps)&&((s=h(this,ss))==null||s.hide(),_(this,Ps,null),C(this,ht,Ei).call(this,{hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===h(this,Ps))return;const n=C(this,ht,Mc).call(this,t).closest(".textLayer");if(!n){h(this,Ps)&&((r=h(this,ss))==null||r.hide(),_(this,Ps,null),C(this,ht,Ei).call(this,{hasSelectedText:!1}));return}if((a=h(this,ss))==null||a.hide(),_(this,Ps,e),C(this,ht,Ei).call(this,{hasSelectedText:!0}),!(h(this,Ge)!==Nt.HIGHLIGHT&&h(this,Ge)!==Nt.NONE)&&(h(this,Ge)===Nt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),_(this,Ar,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=h(this,Ge)===Nt.HIGHLIGHT?C(this,ht,ap).call(this,n):null;l==null||l.toggleDrawing();const u=new AbortController,c=this.combinedSignal(u),d=f=>{f.type==="pointerup"&&f.button!==0||(u.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&C(this,ht,Bc).call(this,"main_toolbar"))};window.addEventListener("pointerup",d,{signal:c}),window.addEventListener("blur",d,{signal:c})}},Bc=function(t=""){h(this,Ge)===Nt.HIGHLIGHT?this.highlightSelection(t):h(this,Zh)&&C(this,ht,Rv).call(this)},Lv=function(){document.addEventListener("selectionchange",C(this,ht,Iv).bind(this),{signal:this._signal})},Pv=function(){if(h(this,_r))return;_(this,_r,new AbortController);const t=this.combinedSignal(h(this,_r));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},Nv=function(){var t;(t=h(this,_r))==null||t.abort(),_(this,_r,null)},op=function(){if(h(this,xr))return;_(this,xr,new AbortController);const t=this.combinedSignal(h(this,xr));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},Ov=function(){var t;(t=h(this,xr))==null||t.abort(),_(this,xr,null)},lp=function(){if(h(this,wr))return;_(this,wr,new AbortController);const t=this.combinedSignal(h(this,wr));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},hp=function(){var t;(t=h(this,wr))==null||t.abort(),_(this,wr,null)},Fv=function(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},Ei=function(t){Object.entries(t).some(([i,n])=>h(this,su)[i]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(h(this,su),t)}),h(this,Ge)===Nt.HIGHLIGHT&&t.hasSelectedEditor===!1&&C(this,ht,Ds).call(this,[[Vt.HIGHLIGHT_FREE,!0]]))},Ds=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},Mv=async function(){if(!h(this,Er)){_(this,Er,!0);const t=[];for(const e of h(this,ti).values())t.push(e.enable());await Promise.all(t);for(const e of h(this,He).values())e.enable()}},Bv=function(){if(this.unselectAll(),h(this,Er)){_(this,Er,!1);for(const t of h(this,ti).values())t.disable();for(const t of h(this,He).values())t.disable()}},up=function(t){const e=h(this,ti).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},zv=function(){let t=null;for(t of h(this,ie));return t},ph=function(){if(h(this,He).size===0)return!0;if(h(this,He).size===1)for(const t of h(this,He).values())return t.isEmpty();return!1},cp=function(t){for(const e of h(this,ie))e.unselect();h(this,ie).clear();for(const e of t)e.isEmpty()||(h(this,ie).add(e),e.select());C(this,ht,Ei).call(this,{hasSelectedEditor:this.hasSelection})},Dt(Uo,"TRANSLATE_SMALL",1),Dt(Uo,"TRANSLATE_BIG",10);let go=Uo;var $e,as,Mn,Jo,os,Gi,tl,ls,Bi,Os,ba,hs,Cr,Xn,gh,zc;const xi=class xi{constructor(t){x(this,Xn);x(this,$e,null);x(this,as,!1);x(this,Mn,null);x(this,Jo,null);x(this,os,null);x(this,Gi,null);x(this,tl,!1);x(this,ls,null);x(this,Bi,null);x(this,Os,null);x(this,ba,null);x(this,hs,!1);_(this,Bi,t),_(this,hs,t._uiManager.useNewAltTextFlow),h(xi,Cr)||_(xi,Cr,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){xi._l10n??(xi._l10n=t)}async render(){const t=_(this,Mn,document.createElement("button"));t.className="altText",t.tabIndex="0";const e=_(this,Jo,document.createElement("span"));t.append(e),h(this,hs)?(t.classList.add("new"),t.setAttribute("data-l10n-id",h(xi,Cr).missing),e.setAttribute("data-l10n-id",h(xi,Cr)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=h(this,Bi)._uiManager._signal;t.addEventListener("contextmenu",Kn,{signal:i}),t.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:i});const n=s=>{s.preventDefault(),h(this,Bi)._uiManager.editAltText(h(this,Bi)),h(this,hs)&&h(this,Bi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:h(this,Xn,gh)}})};return t.addEventListener("click",n,{capture:!0,signal:i}),t.addEventListener("keydown",s=>{s.target===t&&s.key==="Enter"&&(_(this,tl,!0),n(s))},{signal:i}),await C(this,Xn,zc).call(this),t}finish(){h(this,Mn)&&(h(this,Mn).focus({focusVisible:h(this,tl)}),_(this,tl,!1))}isEmpty(){return h(this,hs)?h(this,$e)===null:!h(this,$e)&&!h(this,as)}hasData(){return h(this,hs)?h(this,$e)!==null||!!h(this,Os):this.isEmpty()}get guessedText(){return h(this,Os)}async setGuessedText(t){h(this,$e)===null&&(_(this,Os,t),_(this,ba,await xi._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),C(this,Xn,zc).call(this))}toggleAltTextBadge(t=!1){var e;if(!h(this,hs)||h(this,$e)){(e=h(this,ls))==null||e.remove(),_(this,ls,null);return}if(!h(this,ls)){const i=_(this,ls,document.createElement("div"));i.className="noAltTextBadge",h(this,Bi).div.append(i)}h(this,ls).classList.toggle("hidden",!t)}serialize(t){let e=h(this,$e);return!t&&h(this,Os)===e&&(e=h(this,ba)),{altText:e,decorative:h(this,as),guessedText:h(this,Os),textWithDisclaimer:h(this,ba)}}get data(){return{altText:h(this,$e),decorative:h(this,as)}}set data({altText:t,decorative:e,guessedText:i,textWithDisclaimer:n,cancel:s=!1}){i&&(_(this,Os,i),_(this,ba,n)),!(h(this,$e)===t&&h(this,as)===e)&&(s||(_(this,$e,t),_(this,as,e)),C(this,Xn,zc).call(this))}toggle(t=!1){h(this,Mn)&&(!t&&h(this,Gi)&&(clearTimeout(h(this,Gi)),_(this,Gi,null)),h(this,Mn).disabled=!t)}shown(){h(this,Bi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:h(this,Xn,gh)}})}destroy(){var t,e;(t=h(this,Mn))==null||t.remove(),_(this,Mn,null),_(this,Jo,null),_(this,os,null),(e=h(this,ls))==null||e.remove(),_(this,ls,null)}};$e=new WeakMap,as=new WeakMap,Mn=new WeakMap,Jo=new WeakMap,os=new WeakMap,Gi=new WeakMap,tl=new WeakMap,ls=new WeakMap,Bi=new WeakMap,Os=new WeakMap,ba=new WeakMap,hs=new WeakMap,Cr=new WeakMap,Xn=new WeakSet,gh=function(){return h(this,$e)&&"added"||h(this,$e)===null&&this.guessedText&&"review"||"missing"},zc=async function(){var n,s,r;const t=h(this,Mn);if(!t)return;if(h(this,hs)){if(t.classList.toggle("done",!!h(this,$e)),t.setAttribute("data-l10n-id",h(xi,Cr)[h(this,Xn,gh)]),(n=h(this,Jo))==null||n.setAttribute("data-l10n-id",h(xi,Cr)[`${h(this,Xn,gh)}-label`]),!h(this,$e)){(s=h(this,os))==null||s.remove();return}}else{if(!h(this,$e)&&!h(this,as)){t.classList.remove("done"),(r=h(this,os))==null||r.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=h(this,os);if(!e){_(this,os,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${h(this,Bi).id}`;const a=100,l=h(this,Bi)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(h(this,Gi)),_(this,Gi,null)},{once:!0}),t.addEventListener("mouseenter",()=>{_(this,Gi,setTimeout(()=>{_(this,Gi,null),h(this,os).classList.add("show"),h(this,Bi)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),t.addEventListener("mouseleave",()=>{var u;h(this,Gi)&&(clearTimeout(h(this,Gi)),_(this,Gi,null)),(u=h(this,os))==null||u.classList.remove("show")},{signal:l})}h(this,as)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=h(this,$e)),e.parentNode||t.append(e);const i=h(this,Bi).getImageForAltText();i==null||i.setAttribute("aria-describedby",e.id)},x(xi,Cr,null),Dt(xi,"_l10n",null);let md=xi;var au,ya,ou,lu,hu,uu,cu,el,Fs,wa,Tr,dr,Uv,Hv,dp;const am=class am{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:i=null,onPinchStart:n=null,onPinching:s=null,onPinchEnd:r=null,signal:a}){x(this,dr);x(this,au);x(this,ya,!1);x(this,ou,null);x(this,lu);x(this,hu);x(this,uu);x(this,cu);x(this,el);x(this,Fs,null);x(this,wa);x(this,Tr,null);_(this,au,t),_(this,ou,i),_(this,lu,e),_(this,hu,n),_(this,uu,s),_(this,cu,r),_(this,wa,new AbortController),_(this,el,AbortSignal.any([a,h(this,wa).signal])),t.addEventListener("touchstart",C(this,dr,Uv).bind(this),{passive:!1,signal:h(this,el)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Ht(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var t;(t=h(this,wa))==null||t.abort(),_(this,wa,null)}};au=new WeakMap,ya=new WeakMap,ou=new WeakMap,lu=new WeakMap,hu=new WeakMap,uu=new WeakMap,cu=new WeakMap,el=new WeakMap,Fs=new WeakMap,wa=new WeakMap,Tr=new WeakMap,dr=new WeakSet,Uv=function(t){var n,s,r;if((n=h(this,lu))!=null&&n.call(this)||t.touches.length<2)return;if(!h(this,Tr)){_(this,Tr,new AbortController);const a=AbortSignal.any([h(this,el),h(this,Tr).signal]),l=h(this,au),u={signal:a,passive:!1};l.addEventListener("touchmove",C(this,dr,Hv).bind(this),u),l.addEventListener("touchend",C(this,dr,dp).bind(this),u),l.addEventListener("touchcancel",C(this,dr,dp).bind(this),u),(s=h(this,hu))==null||s.call(this)}if(an(t),t.touches.length!==2||(r=h(this,ou))!=null&&r.call(this)){_(this,Fs,null);return}let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]),_(this,Fs,{touch0X:e.screenX,touch0Y:e.screenY,touch1X:i.screenX,touch1Y:i.screenY})},Hv=function(t){var R;if(!h(this,Fs)||t.touches.length!==2)return;let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]);const{screenX:n,screenY:s}=e,{screenX:r,screenY:a}=i,l=h(this,Fs),{touch0X:u,touch0Y:c,touch1X:d,touch1Y:f}=l,p=d-u,b=f-c,y=r-n,g=a-s,m=Math.hypot(y,g)||1,w=Math.hypot(p,b)||1;if(!h(this,ya)&&Math.abs(w-m)<=am.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=n,l.touch0Y=s,l.touch1X=r,l.touch1Y=a,t.preventDefault(),!h(this,ya)){_(this,ya,!0);return}const E=[(n+r)/2,(s+a)/2];(R=h(this,uu))==null||R.call(this,E,w,m)},dp=function(t){var e;h(this,Tr).abort(),_(this,Tr,null),(e=h(this,cu))==null||e.call(this),h(this,Fs)&&(t.preventDefault(),_(this,Fs,null),_(this,ya,!1))};let vd=am;var _a,Bn,ce,il,Dr,du,Aa,ei,Ea,Ms,kr,fu,xa,$i,pu,Sa,Bs,us,nl,sl,pn,Ca,gu,Gd,kt,fp,mu,pp,Uc,jv,Wv,gp,Hc,mp,qv,Vv,Gv,vp,$v,bp,Xv,Yv,Kv,yp,mh;const Bt=class Bt{constructor(t){x(this,kt);x(this,_a,null);x(this,Bn,null);x(this,ce,null);x(this,il,!1);x(this,Dr,null);x(this,du,"");x(this,Aa,!1);x(this,ei,null);x(this,Ea,null);x(this,Ms,null);x(this,kr,null);x(this,fu,"");x(this,xa,!1);x(this,$i,null);x(this,pu,!1);x(this,Sa,!1);x(this,Bs,!1);x(this,us,null);x(this,nl,0);x(this,sl,0);x(this,pn,null);x(this,Ca,null);Dt(this,"_editToolbar",null);Dt(this,"_initialOptions",Object.create(null));Dt(this,"_initialData",null);Dt(this,"_isVisible",!0);Dt(this,"_uiManager",null);Dt(this,"_focusEventsAllowed",!0);x(this,gu,!1);x(this,Gd,Bt._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:i,pageHeight:n,pageX:s,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,n],this.pageTranslation=[s,r];const[a,l]=this.parentDimensions;this.x=t.x/a,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=Bt.prototype._resizeWithKeyboard,e=go.TRANSLATE_SMALL,i=go.TRANSLATE_BIG;return Ht(this,"_resizerKeyboardManager",new vc([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],Bt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Ht(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new vw({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(Bt._l10n??(Bt._l10n=t),Bt._l10nResizer||(Bt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Bt._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);Bt._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){le("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return h(this,gu)}set _isDraggable(t){var e;_(this,gu,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=h(this,Gd)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):C(this,kt,mh).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(h(this,xa)?_(this,xa,!1):this.parent.setSelected(this))}focusout(t){var i;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(i=this.parent)!=null&&i.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,n){const[s,r]=this.parentDimensions;[i,n]=this.screenToPageTranslation(i,n),this.x=(t+i)/s,this.y=(e+n)/r,this.fixAndSetPosition()}translate(t,e){C(this,kt,fp).call(this,this.parentDimensions,t,e)}translateInPage(t,e){h(this,$i)||_(this,$i,[this.x,this.y,this.width,this.height]),C(this,kt,fp).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){h(this,$i)||_(this,$i,[this.x,this.y,this.width,this.height]);const{div:i,parentDimensions:[n,s]}=this;if(this.x+=t/n,this.y+=e/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[l,u]=this.getBaseTranslation();r+=l,a+=u;const{style:c}=i;c.left=`${(100*r).toFixed(2)}%`,c.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),i.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!h(this,$i)&&(h(this,$i)[0]!==this.x||h(this,$i)[1]!==this.y)}get _hasBeenResized(){return!!h(this,$i)&&(h(this,$i)[2]!==this.width||h(this,$i)[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:i}=Bt,n=i/t,s=i/e;switch(this.rotation){case 90:return[-n,s];case 180:return[n,s];case 270:return[n,-s];default:return[-n,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[i,n]}=this;let{x:s,y:r,width:a,height:l}=this;if(a*=i,l*=n,s*=i,r*=n,this._mustFixPosition)switch(t){case 0:s=Math.max(0,Math.min(i-a,s)),r=Math.max(0,Math.min(n-l,r));break;case 90:s=Math.max(0,Math.min(i-l,s)),r=Math.min(n,Math.max(a,r));break;case 180:s=Math.min(i,Math.max(a,s)),r=Math.min(n,Math.max(l,r));break;case 270:s=Math.min(i,Math.max(l,s)),r=Math.max(0,Math.min(n-a,r));break}this.x=s/=i,this.y=r/=n;const[u,c]=this.getBaseTranslation();s+=u,r+=c,e.left=`${(100*s).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var i;return C(i=Bt,mu,pp).call(i,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var i;return C(i=Bt,mu,pp).call(i,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(t,e){const[i,n]=this.parentDimensions,{style:s}=this.div;s.width=`${(100*t/i).toFixed(2)}%`,h(this,Aa)||(s.height=`${(100*e/n).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:i}=t,n=i.endsWith("%"),s=!h(this,Aa)&&e.endsWith("%");if(n&&s)return;const[r,a]=this.parentDimensions;n||(t.width=`${(100*parseFloat(i)/r).toFixed(2)}%`),!h(this,Aa)&&!s&&(t.height=`${(100*parseFloat(e)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=h(this,ce))==null||t.finish()}async addEditToolbar(){return this._editToolbar||h(this,Sa)?this._editToolbar:(this._editToolbar=new ip(this),this.div.append(this._editToolbar.render()),h(this,ce)&&await this._editToolbar.addAltText(h(this,ce)),this._editToolbar)}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=h(this,ce))==null||t.destroy())}addContainer(t){var i;const e=(i=this._editToolbar)==null?void 0:i.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){h(this,ce)||(md.initialize(Bt._l10n),_(this,ce,new md(this)),h(this,_a)&&(h(this,ce).data=h(this,_a),_(this,_a,null)),await this.addEditToolbar())}get altTextData(){var t;return(t=h(this,ce))==null?void 0:t.data}set altTextData(t){h(this,ce)&&(h(this,ce).data=t)}get guessedAltText(){var t;return(t=h(this,ce))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=h(this,ce))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=h(this,ce))==null?void 0:e.serialize(t)}hasAltText(){return!!h(this,ce)&&!h(this,ce).isEmpty()}hasAltTextData(){var t;return((t=h(this,ce))==null?void 0:t.hasData())??!1}render(){var s;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=h(this,il)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),C(this,kt,bp).call(this);const[t,e]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),gd(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(h(this,Ca)||_(this,Ca,new vd({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:C(this,kt,qv).bind(this),onPinching:C(this,kt,Vv).bind(this),onPinchEnd:C(this,kt,Gv).bind(this),signal:this._uiManager._signal}))),(s=this._uiManager._editorUndoBar)==null||s.hide(),this.div}pointerdown(t){const{isMac:e}=Di.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(_(this,xa,!0),this._isDraggable){C(this,kt,$v).call(this,t);return}C(this,kt,vp).call(this,t)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){h(this,us)&&clearTimeout(h(this,us)),_(this,us,setTimeout(()=>{var t;_(this,us,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,i=this.rotation){const n=this.parentScale,[s,r]=this.pageDimensions,[a,l]=this.pageTranslation,u=t/n,c=e/n,d=this.x*s,f=this.y*r,p=this.width*s,b=this.height*r;switch(i){case 0:return[d+u+a,r-f-c-b+l,d+u+p+a,r-f-c+l];case 90:return[d+c+a,r-f+u+l,d+c+b+a,r-f+u+p+l];case 180:return[d-u-p+a,r-f+c+l,d-u+a,r-f+c+b+l];case 270:return[d-c-b+a,r-f-u-p+l,d-c+a,r-f-u+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[i,n,s,r]=t,a=s-i,l=r-n;switch(this.rotation){case 0:return[i,e-r,a,l];case 90:return[i,e-n,l,a];case 180:return[s,e-n,a,l];case 270:return[s,e-r,l,a];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){_(this,Sa,!0)}disableEditMode(){_(this,Sa,!1)}isInEditMode(){return h(this,Sa)}shouldGetKeyboardEvents(){return h(this,Bs)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:i,right:n}=this.getClientDimensions(),{innerHeight:s,innerWidth:r}=window;return e<r&&n>0&&t<s&&i>0}rebuild(){C(this,kt,bp).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){le("An editor must be serializable")}static async deserialize(t,e,i){const n=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i});n.rotation=t.rotation,_(n,_a,t.accessibilityData);const[s,r]=n.pageDimensions,[a,l,u,c]=n.getRectInCurrentCoords(t.rect,r);return n.x=a/s,n.y=l/r,n.width=u/s,n.height=c/r,n}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e;if((t=h(this,kr))==null||t.abort(),_(this,kr,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),h(this,us)&&(clearTimeout(h(this,us)),_(this,us,null)),C(this,kt,mh).call(this),this.removeEditToolbar(),h(this,pn)){for(const i of h(this,pn).values())clearTimeout(i);_(this,pn,null)}this.parent=null,(e=h(this,Ca))==null||e.destroy(),_(this,Ca,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(C(this,kt,jv).call(this),h(this,ei).classList.remove("hidden"),gd(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),_(this,Ms,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=h(this,ei).children;if(!h(this,Bn)){_(this,Bn,Array.from(e));const r=C(this,kt,Xv).bind(this),a=C(this,kt,Yv).bind(this),l=this._uiManager._signal;for(const u of h(this,Bn)){const c=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",r,{signal:l}),u.addEventListener("blur",a,{signal:l}),u.addEventListener("focus",C(this,kt,Kv).bind(this,c),{signal:l}),u.setAttribute("data-l10n-id",Bt._l10nResizer[c])}}const i=h(this,Bn)[0];let n=0;for(const r of e){if(r===i)break;n++}const s=(360-this.rotation+this.parentRotation)%360/90*(h(this,Bn).length/4);if(s!==n){if(s<n)for(let a=0;a<n-s;a++)h(this,ei).append(h(this,ei).firstChild);else if(s>n)for(let a=0;a<s-n;a++)h(this,ei).firstChild.before(h(this,ei).lastChild);let r=0;for(const a of e){const u=h(this,Bn)[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",Bt._l10nResizer[u])}}C(this,kt,yp).call(this,0),_(this,Bs,!0),h(this,ei).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){h(this,Bs)&&C(this,kt,mp).call(this,h(this,fu),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){C(this,kt,mh).call(this),this.div.focus()}select(){var t,e,i;if(this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var n,s;(n=this.div)!=null&&n.classList.contains("selectedEditor")&&((s=this._editToolbar)==null||s.show())});return}(e=this._editToolbar)==null||e.show(),(i=h(this,ce))==null||i.toggleAltTextBadge(!1)}unselect(){var t,e,i,n,s;(t=h(this,ei))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(i=this.div)!=null&&i.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(n=this._editToolbar)==null||n.hide(),(s=h(this,ce))==null||s.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return h(this,pu)}set isEditing(t){_(this,pu,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){_(this,Aa,!0);const i=t/e,{style:n}=this.div;n.aspectRatio=i,n.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){h(this,pn)||_(this,pn,new Map);const{action:i}=t;let n=h(this,pn).get(i);n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(t),h(this,pn).delete(i),h(this,pn).size===0&&_(this,pn,null)},Bt._telemetryTimeout),h(this,pn).set(i,n);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),_(this,il,!1)}disable(){this.div&&(this.div.tabIndex=-1),_(this,il,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};_a=new WeakMap,Bn=new WeakMap,ce=new WeakMap,il=new WeakMap,Dr=new WeakMap,du=new WeakMap,Aa=new WeakMap,ei=new WeakMap,Ea=new WeakMap,Ms=new WeakMap,kr=new WeakMap,fu=new WeakMap,xa=new WeakMap,$i=new WeakMap,pu=new WeakMap,Sa=new WeakMap,Bs=new WeakMap,us=new WeakMap,nl=new WeakMap,sl=new WeakMap,pn=new WeakMap,Ca=new WeakMap,gu=new WeakMap,Gd=new WeakMap,kt=new WeakSet,fp=function([t,e],i,n){[i,n]=this.screenToPageTranslation(i,n),this.x+=i/t,this.y+=n/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},mu=new WeakSet,pp=function(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},Uc=function(t){switch(t){case 90:{const[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}},jv=function(){if(h(this,ei))return;_(this,ei,document.createElement("div")),h(this,ei).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const i of t){const n=document.createElement("div");h(this,ei).append(n),n.classList.add("resizer",i),n.setAttribute("data-resizer-name",i),n.addEventListener("pointerdown",C(this,kt,Wv).bind(this,i),{signal:e}),n.addEventListener("contextmenu",Kn,{signal:e}),n.tabIndex=-1}this.div.prepend(h(this,ei))},Wv=function(t,e){var c;e.preventDefault();const{isMac:i}=Di.platform;if(e.button!==0||e.ctrlKey&&i)return;(c=h(this,ce))==null||c.toggle(!1);const n=this._isDraggable;this._isDraggable=!1,_(this,Ea,[e.screenX,e.screenY]);const s=new AbortController,r=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",C(this,kt,mp).bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",an,{passive:!1,signal:r}),window.addEventListener("contextmenu",Kn,{signal:r}),_(this,Ms,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const u=()=>{var d;s.abort(),this.parent.togglePointerEvents(!0),(d=h(this,ce))==null||d.toggle(!0),this._isDraggable=n,this.parent.div.style.cursor=a,this.div.style.cursor=l,C(this,kt,Hc).call(this)};window.addEventListener("pointerup",u,{signal:r}),window.addEventListener("blur",u,{signal:r})},gp=function(t,e,i,n){this.width=i,this.height=n,this.x=t,this.y=e;const[s,r]=this.parentDimensions;this.setDims(s*i,r*n),this.fixAndSetPosition(),this._onResized()},Hc=function(){if(!h(this,Ms))return;const{savedX:t,savedY:e,savedWidth:i,savedHeight:n}=h(this,Ms);_(this,Ms,null);const s=this.x,r=this.y,a=this.width,l=this.height;s===t&&r===e&&a===i&&l===n||this.addCommands({cmd:C(this,kt,gp).bind(this,s,r,a,l),undo:C(this,kt,gp).bind(this,t,e,i,n),mustExec:!0})},mp=function(t,e){const[i,n]=this.parentDimensions,s=this.x,r=this.y,a=this.width,l=this.height,u=Bt.MIN_SIZE/i,c=Bt.MIN_SIZE/n,d=C(this,kt,Uc).call(this,this.rotation),f=(X,K)=>[d[0]*X+d[2]*K,d[1]*X+d[3]*K],p=C(this,kt,Uc).call(this,360-this.rotation),b=(X,K)=>[p[0]*X+p[2]*K,p[1]*X+p[3]*K];let y,g,m=!1,w=!1;switch(t){case"topLeft":m=!0,y=(X,K)=>[0,0],g=(X,K)=>[X,K];break;case"topMiddle":y=(X,K)=>[X/2,0],g=(X,K)=>[X/2,K];break;case"topRight":m=!0,y=(X,K)=>[X,0],g=(X,K)=>[0,K];break;case"middleRight":w=!0,y=(X,K)=>[X,K/2],g=(X,K)=>[0,K/2];break;case"bottomRight":m=!0,y=(X,K)=>[X,K],g=(X,K)=>[0,0];break;case"bottomMiddle":y=(X,K)=>[X/2,K],g=(X,K)=>[X/2,0];break;case"bottomLeft":m=!0,y=(X,K)=>[0,K],g=(X,K)=>[X,0];break;case"middleLeft":w=!0,y=(X,K)=>[0,K/2],g=(X,K)=>[X,K/2];break}const E=y(a,l),R=g(a,l);let A=f(...R);const T=Bt._round(s+A[0]),k=Bt._round(r+A[1]);let P=1,F=1,B,W;if(e.fromKeyboard)({deltaX:B,deltaY:W}=e);else{const{screenX:X,screenY:K}=e,[lt,Ct]=h(this,Ea);[B,W]=this.screenToPageTranslation(X-lt,K-Ct),h(this,Ea)[0]=X,h(this,Ea)[1]=K}if([B,W]=b(B/i,W/n),m){const X=Math.hypot(a,l);P=F=Math.max(Math.min(Math.hypot(R[0]-E[0]-B,R[1]-E[1]-W)/X,1/a,1/l),u/a,c/l)}else w?P=Math.max(u,Math.min(1,Math.abs(R[0]-E[0]-B)))/a:F=Math.max(c,Math.min(1,Math.abs(R[1]-E[1]-W)))/l;const G=Bt._round(a*P),et=Bt._round(l*F);A=f(...g(G,et));const ot=T-A[0],ct=k-A[1];h(this,$i)||_(this,$i,[this.x,this.y,this.width,this.height]),this.width=G,this.height=et,this.x=ot,this.y=ct,this.setDims(i*G,n*et),this.fixAndSetPosition(),this._onResizing()},qv=function(){var t;_(this,Ms,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(t=h(this,ce))==null||t.toggle(!1),this.parent.togglePointerEvents(!1)},Vv=function(t,e,i){let s=.7*(i/e)+1-.7;if(s===1)return;const r=C(this,kt,Uc).call(this,this.rotation),a=(T,k)=>[r[0]*T+r[2]*k,r[1]*T+r[3]*k],[l,u]=this.parentDimensions,c=this.x,d=this.y,f=this.width,p=this.height,b=Bt.MIN_SIZE/l,y=Bt.MIN_SIZE/u;s=Math.max(Math.min(s,1/f,1/p),b/f,y/p);const g=Bt._round(f*s),m=Bt._round(p*s);if(g===f&&m===p)return;h(this,$i)||_(this,$i,[c,d,f,p]);const w=a(f/2,p/2),E=Bt._round(c+w[0]),R=Bt._round(d+w[1]),A=a(g/2,m/2);this.x=E-A[0],this.y=R-A[1],this.width=g,this.height=m,this.setDims(l*g,u*m),this.fixAndSetPosition(),this._onResizing()},Gv=function(){var t;(t=h(this,ce))==null||t.toggle(!0),this.parent.togglePointerEvents(!0),C(this,kt,Hc).call(this)},vp=function(t){const{isMac:e}=Di.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},$v=function(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let i=!1;const n=new AbortController,s=this._uiManager.combinedSignal(n),r={capture:!0,passive:!1,signal:s},a=u=>{n.abort(),_(this,Dr,null),_(this,xa,!1),this._uiManager.endDragSession()||C(this,kt,vp).call(this,u),i&&this._onStopDragging()};e&&(_(this,nl,t.clientX),_(this,sl,t.clientY),_(this,Dr,t.pointerId),_(this,du,t.pointerType),window.addEventListener("pointermove",u=>{i||(i=!0,this._onStartDragging());const{clientX:c,clientY:d,pointerId:f}=u;if(f!==h(this,Dr)){an(u);return}const[p,b]=this.screenToPageTranslation(c-h(this,nl),d-h(this,sl));_(this,nl,c),_(this,sl,d),this._uiManager.dragSelectedEditors(p,b)},r),window.addEventListener("touchmove",an,r),window.addEventListener("pointerdown",u=>{u.pointerType===h(this,du)&&(h(this,Ca)||u.isPrimary)&&a(u),an(u)},r));const l=u=>{if(!h(this,Dr)||h(this,Dr)===u.pointerId){a(u);return}an(u)};window.addEventListener("pointerup",l,{signal:s}),window.addEventListener("blur",l,{signal:s})},bp=function(){if(h(this,kr)||!this.div)return;_(this,kr,new AbortController);const t=this._uiManager.combinedSignal(h(this,kr));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},Xv=function(t){Bt._resizerKeyboardManager.exec(this,t)},Yv=function(t){var e;h(this,Bs)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==h(this,ei)&&C(this,kt,mh).call(this)},Kv=function(t){_(this,fu,h(this,Bs)?t:"")},yp=function(t){if(h(this,Bn))for(const e of h(this,Bn))e.tabIndex=t},mh=function(){_(this,Bs,!1),C(this,kt,yp).call(this,-1),C(this,kt,Hc).call(this)},x(Bt,mu),Dt(Bt,"_l10n",null),Dt(Bt,"_l10nResizer",null),Dt(Bt,"_borderLineWidth",-1),Dt(Bt,"_colorManager",new rp),Dt(Bt,"_zIndex",1),Dt(Bt,"_telemetryTimeout",1e3);let we=Bt;class vw extends we{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const bm=3285377520,un=4294901760,Jn=65535;class Zv{constructor(t){this.h1=t?t&4294967295:bm,this.h2=t?t&4294967295:bm}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let y=0,g=t.length;y<g;y++){const m=t.charCodeAt(y);m<=255?e[i++]=m:(e[i++]=m>>>8,e[i++]=m&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const n=i>>2,s=i-n*4,r=new Uint32Array(e.buffer,0,n);let a=0,l=0,u=this.h1,c=this.h2;const d=3432918353,f=461845907,p=d&Jn,b=f&Jn;for(let y=0;y<n;y++)y&1?(a=r[y],a=a*d&un|a*p&Jn,a=a<<15|a>>>17,a=a*f&un|a*b&Jn,u^=a,u=u<<13|u>>>19,u=u*5+3864292196):(l=r[y],l=l*d&un|l*p&Jn,l=l<<15|l>>>17,l=l*f&un|l*b&Jn,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(a=0,s){case 3:a^=e[n*4+2]<<16;case 2:a^=e[n*4+1]<<8;case 1:a^=e[n*4],a=a*d&un|a*p&Jn,a=a<<15|a>>>17,a=a*f&un|a*b&Jn,n&1?u^=a:c^=a}this.h1=u,this.h2=c}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&un|t*36045&Jn,e=e*4283543511&un|((e<<16|t>>>16)*2950163797&un)>>>16,t^=e>>>1,t=t*444984403&un|t*60499&Jn,e=e*3301882366&un|((e<<16|t>>>16)*3120437893&un)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const wp=Object.freeze({map:null,hash:"",transfer:void 0});var Ta,Da,Xe,$d,Qv;class Lg{constructor(){x(this,$d);x(this,Ta,!1);x(this,Da,null);x(this,Xe,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const i=h(this,Xe).get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return h(this,Xe).get(t)}remove(t){if(h(this,Xe).delete(t),h(this,Xe).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of h(this,Xe).values())if(e instanceof we)return;this.onAnnotationEditor(null)}}setValue(t,e){const i=h(this,Xe).get(t);let n=!1;if(i!==void 0)for(const[s,r]of Object.entries(e))i[s]!==r&&(n=!0,i[s]=r);else n=!0,h(this,Xe).set(t,e);n&&C(this,$d,Qv).call(this),e instanceof we&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return h(this,Xe).has(t)}getAll(){return h(this,Xe).size>0?Cg(h(this,Xe)):null}setAll(t){for(const[e,i]of Object.entries(t))this.setValue(e,i)}get size(){return h(this,Xe).size}resetModified(){h(this,Ta)&&(_(this,Ta,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Jv(this)}get serializable(){if(h(this,Xe).size===0)return wp;const t=new Map,e=new Zv,i=[],n=Object.create(null);let s=!1;for(const[r,a]of h(this,Xe)){const l=a instanceof we?a.serialize(!1,n):a;l&&(t.set(r,l),e.update(`${r}:${JSON.stringify(l)}`),s||(s=!!l.bitmap))}if(s)for(const r of t.values())r.bitmap&&i.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:wp}get editorStats(){let t=null;const e=new Map;for(const i of h(this,Xe).values()){if(!(i instanceof we))continue;const n=i.telemetryFinalData;if(!n)continue;const{type:s}=n;e.has(s)||e.set(s,Object.getPrototypeOf(i).constructor),t||(t=Object.create(null));const r=t[s]||(t[s]=new Map);for(const[a,l]of Object.entries(n)){if(a==="type")continue;let u=r.get(a);u||(u=new Map,r.set(a,u));const c=u.get(l)??0;u.set(l,c+1)}}for(const[i,n]of e)t[i]=n.computeTelemetryFinalData(t[i]);return t}resetModifiedIds(){_(this,Da,null)}get modifiedIds(){if(h(this,Da))return h(this,Da);const t=[];for(const e of h(this,Xe).values())!(e instanceof we)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return _(this,Da,{ids:new Set(t),hash:t.join(",")})}}Ta=new WeakMap,Da=new WeakMap,Xe=new WeakMap,$d=new WeakSet,Qv=function(){h(this,Ta)||(_(this,Ta,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var vu;class Jv extends Lg{constructor(e){super();x(this,vu);const{map:i,hash:n,transfer:s}=e.serializable,r=structuredClone(i,s?{transfer:s}:null);_(this,vu,{map:r,hash:n,transfer:s})}get print(){le("Should not call PrintAnnotationStorage.print")}get serializable(){return h(this,vu)}get modifiedIds(){return Ht(this,"modifiedIds",{ids:new Set,hash:""})}}vu=new WeakMap;var rl;class bw{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){x(this,rl,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),h(this,rl).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(!(!t||h(this,rl).has(t.loadedName))){if(Ne(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:s}=t,r=new FontFace(i,n,s);this.addNativeFontFace(r);try{await r.load(),h(this,rl).add(i),e==null||e(t)}catch{Ot(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}le("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(n){throw Ot(`Failed to load font '${i.family}': '${n}'.`),t.disableFontFace=!0,n}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const n=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,n)})}}get isFontLoadingAPISupported(){var e;const t=!!((e=this._document)!=null&&e.fonts);return Ht(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(bi||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),Ht(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){for(Ne(!n.done,"completeRequest() cannot be called twice."),n.done=!0;i.length>0&&i[0].done;){const s=i.shift();setTimeout(s.callback,0)}}const{loadingRequests:i}=this,n={done:!1,complete:e,callback:t};return i.push(n),n}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Ht(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(R,A){return R.charCodeAt(A)<<24|R.charCodeAt(A+1)<<16|R.charCodeAt(A+2)<<8|R.charCodeAt(A+3)&255}function n(R,A,T,k){const P=R.substring(0,A),F=R.substring(A+T);return P+k+F}let s,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let u=0;function c(R,A){if(++u>30){Ot("Load test font never loaded."),A();return}if(l.font="30px "+R,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){A();return}setTimeout(c.bind(null,R,A))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=n(f,976,d.length,d);const b=16,y=1482184792;let g=i(f,b);for(s=0,r=d.length-3;s<r;s+=4)g=g-y+i(d,s)|0;s<d.length&&(g=g-y+i(d+"XXX",s)|0),f=n(f,b,4,nw(g));const m=`url(data:font/opentype;base64,${btoa(f)});`,w=`@font-face {font-family:"${d}";src:${m}}`;this.insertRule(w);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const R of[t.loadedName,d]){const A=this._document.createElement("span");A.textContent="Hi",A.style.fontFamily=R,E.append(A)}this._document.body.append(E),c(d,()=>{E.remove(),e.complete()})}}rl=new WeakMap;class yw{constructor(t,{disableFontFace:e=!1,fontExtraProperties:i=!1,inspectFont:n=null}){this.compiledGlyphs=Object.create(null);for(const s in t)this[s]=t[s];this.disableFontFace=e===!0,this.fontExtraProperties=i===!0,this._inspectFont=n}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var i;if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${hw(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}return(i=this._inspectFont)==null||i.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const i=this.loadedName+"_path_"+e;let n;try{n=t.get(i)}catch(r){Ot(`getPathGenerator - ignoring character: "${r}".`)}const s=new Path2D(n||"");return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=s}}const Tc={DATA:1,ERROR:2},Pe={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function ym(){}function Fi(o){if(o instanceof Qr||o instanceof Jf||o instanceof Oh||o instanceof gm||o instanceof pd||o instanceof kf)return o;switch(o instanceof Error||typeof o=="object"&&o!==null||le('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),o.name){case"AbortException":return new Qr(o.message);case"InvalidPDFException":return new Jf(o.message);case"MissingPDFException":return new Oh(o.message);case"PasswordException":return new gm(o.message,o.code);case"UnexpectedResponseException":return new pd(o.message,o.status);case"UnknownErrorException":return new kf(o.message,o.details)}return new kf(o.message,o.toString())}var al,En,t0,e0,i0,jc;class vh{constructor(t,e,i){x(this,En);x(this,al,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",C(this,En,t0).bind(this),{signal:h(this,al).signal})}on(t,e){const i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){const n=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[n]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:n,data:e},i)}catch(r){s.reject(r)}return s.promise}sendWithStream(t,e,i,n){const s=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:u=>{const c=Promise.withResolvers();return this.streamControllers[s]={controller:u,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:t,streamId:s,data:e,desiredSize:u.desiredSize},n),c.promise},pull:u=>{const c=Promise.withResolvers();return this.streamControllers[s].pullCall=c,l.postMessage({sourceName:r,targetName:a,stream:Pe.PULL,streamId:s,desiredSize:u.desiredSize}),c.promise},cancel:u=>{Ne(u instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[s].cancelCall=c,this.streamControllers[s].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:Pe.CANCEL,streamId:s,reason:Fi(u)}),c.promise}},i)}destroy(){var t;(t=h(this,al))==null||t.abort(),_(this,al,null)}}al=new WeakMap,En=new WeakSet,t0=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){C(this,En,i0).call(this,t);return}if(t.callback){const i=t.callbackId,n=this.callbackCapabilities[i];if(!n)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===Tc.DATA)n.resolve(t.data);else if(t.callback===Tc.ERROR)n.reject(Fi(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const i=this.sourceName,n=t.sourceName,s=this.comObj;Promise.try(e,t.data).then(function(r){s.postMessage({sourceName:i,targetName:n,callback:Tc.DATA,callbackId:t.callbackId,data:r})},function(r){s.postMessage({sourceName:i,targetName:n,callback:Tc.ERROR,callbackId:t.callbackId,reason:Fi(r)})});return}if(t.streamId){C(this,En,e0).call(this,t);return}e(t.data)},e0=function(t){const e=t.streamId,i=this.sourceName,n=t.sourceName,s=this.comObj,r=this,a=this.actionHandler[t.action],l={enqueue(u,c=1,d){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=c,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:i,targetName:n,stream:Pe.ENQUEUE,streamId:e,chunk:u},d)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:n,stream:Pe.CLOSE,streamId:e}),delete r.streamSinks[e])},error(u){Ne(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:n,stream:Pe.ERROR,streamId:e,reason:Fi(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(a,t.data,l).then(function(){s.postMessage({sourceName:i,targetName:n,stream:Pe.START_COMPLETE,streamId:e,success:!0})},function(u){s.postMessage({sourceName:i,targetName:n,stream:Pe.START_COMPLETE,streamId:e,reason:Fi(u)})})},i0=function(t){const e=t.streamId,i=this.sourceName,n=t.sourceName,s=this.comObj,r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case Pe.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(Fi(t.reason));break;case Pe.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(Fi(t.reason));break;case Pe.PULL:if(!a){s.postMessage({sourceName:i,targetName:n,stream:Pe.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||ym).then(function(){s.postMessage({sourceName:i,targetName:n,stream:Pe.PULL_COMPLETE,streamId:e,success:!0})},function(u){s.postMessage({sourceName:i,targetName:n,stream:Pe.PULL_COMPLETE,streamId:e,reason:Fi(u)})});break;case Pe.ENQUEUE:if(Ne(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case Pe.CLOSE:if(Ne(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),C(this,En,jc).call(this,r,e);break;case Pe.ERROR:Ne(r,"error should have stream controller"),r.controller.error(Fi(t.reason)),C(this,En,jc).call(this,r,e);break;case Pe.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(Fi(t.reason)),C(this,En,jc).call(this,r,e);break;case Pe.CANCEL:if(!a)break;const l=Fi(t.reason);Promise.try(a.onCancel||ym,l).then(function(){s.postMessage({sourceName:i,targetName:n,stream:Pe.CANCEL_COMPLETE,streamId:e,success:!0})},function(u){s.postMessage({sourceName:i,targetName:n,stream:Pe.CANCEL_COMPLETE,streamId:e,reason:Fi(u)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},jc=async function(t,e){var i,n,s;await Promise.allSettled([(i=t.startCall)==null?void 0:i.promise,(n=t.pullCall)==null?void 0:n.promise,(s=t.cancelCall)==null?void 0:s.promise]),delete this.streamControllers[e]};var bu;class n0{constructor({enableHWA:t=!1}){x(this,bu,!1);_(this,bu,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!h(this,bu)})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){le("Abstract method `_createCanvas` called.")}}bu=new WeakMap;class ww extends n0{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}class s0{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){le("Abstract method `_fetch` called.")}}class r0 extends s0{async _fetch(t){const e=await cf(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):uf(e)}}class a0{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,n,s){return"none"}destroy(t=!1){}}var ka,ol,zs,Us,pi,Ra,Ia,gt,ci,bh,ko,Wc,Ro,o0,_p,Io,yh,wh,Ap,_h;class _w extends a0{constructor({docId:e,ownerDocument:i=globalThis.document}){super();x(this,gt);x(this,ka);x(this,ol);x(this,zs);x(this,Us);x(this,pi);x(this,Ra);x(this,Ia,0);_(this,Us,e),_(this,pi,i)}addFilter(e){if(!e)return"none";let i=h(this,gt,ci).get(e);if(i)return i;const[n,s,r]=C(this,gt,Wc).call(this,e),a=e.length===1?n:`${n}${s}${r}`;if(i=h(this,gt,ci).get(a),i)return h(this,gt,ci).set(e,i),i;const l=`g_${h(this,Us)}_transfer_map_${Ai(this,Ia)._++}`,u=C(this,gt,Ro).call(this,l);h(this,gt,ci).set(e,u),h(this,gt,ci).set(a,u);const c=C(this,gt,Io).call(this,l);return C(this,gt,wh).call(this,n,s,r,c),u}addHCMFilter(e,i){var b;const n=`${e}-${i}`,s="base";let r=h(this,gt,bh).get(s);if((r==null?void 0:r.key)===n||(r?((b=r.filter)==null||b.remove(),r.key=n,r.url="none",r.filter=null):(r={key:n,url:"none",filter:null},h(this,gt,bh).set(s,r)),!e||!i))return r.url;const a=C(this,gt,_h).call(this,e);e=Et.makeHexColor(...a);const l=C(this,gt,_h).call(this,i);if(i=Et.makeHexColor(...l),h(this,gt,ko).style.color="",e==="#000000"&&i==="#ffffff"||e===i)return r.url;const u=new Array(256);for(let y=0;y<=255;y++){const g=y/255;u[y]=g<=.03928?g/12.92:((g+.055)/1.055)**2.4}const c=u.join(","),d=`g_${h(this,Us)}_hcm_filter`,f=r.filter=C(this,gt,Io).call(this,d);C(this,gt,wh).call(this,c,c,c,f),C(this,gt,_p).call(this,f);const p=(y,g)=>{const m=a[y]/255,w=l[y]/255,E=new Array(g+1);for(let R=0;R<=g;R++)E[R]=m+R/g*(w-m);return E.join(",")};return C(this,gt,wh).call(this,p(0,5),p(1,5),p(2,5),f),r.url=C(this,gt,Ro).call(this,d),r.url}addAlphaFilter(e){let i=h(this,gt,ci).get(e);if(i)return i;const[n]=C(this,gt,Wc).call(this,[e]),s=`alpha_${n}`;if(i=h(this,gt,ci).get(s),i)return h(this,gt,ci).set(e,i),i;const r=`g_${h(this,Us)}_alpha_map_${Ai(this,Ia)._++}`,a=C(this,gt,Ro).call(this,r);h(this,gt,ci).set(e,a),h(this,gt,ci).set(s,a);const l=C(this,gt,Io).call(this,r);return C(this,gt,Ap).call(this,n,l),a}addLuminosityFilter(e){let i=h(this,gt,ci).get(e||"luminosity");if(i)return i;let n,s;if(e?([n]=C(this,gt,Wc).call(this,[e]),s=`luminosity_${n}`):s="luminosity",i=h(this,gt,ci).get(s),i)return h(this,gt,ci).set(e,i),i;const r=`g_${h(this,Us)}_luminosity_map_${Ai(this,Ia)._++}`,a=C(this,gt,Ro).call(this,r);h(this,gt,ci).set(e,a),h(this,gt,ci).set(s,a);const l=C(this,gt,Io).call(this,r);return C(this,gt,o0).call(this,l),e&&C(this,gt,Ap).call(this,n,l),a}addHighlightHCMFilter(e,i,n,s,r){var w;const a=`${i}-${n}-${s}-${r}`;let l=h(this,gt,bh).get(e);if((l==null?void 0:l.key)===a||(l?((w=l.filter)==null||w.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},h(this,gt,bh).set(e,l)),!i||!n))return l.url;const[u,c]=[i,n].map(C(this,gt,_h).bind(this));let d=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),f=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[p,b]=[s,r].map(C(this,gt,_h).bind(this));f<d&&([d,f,p,b]=[f,d,b,p]),h(this,gt,ko).style.color="";const y=(E,R,A)=>{const T=new Array(256),k=(f-d)/A,P=E/255,F=(R-E)/(255*A);let B=0;for(let W=0;W<=A;W++){const G=Math.round(d+W*k),et=P+W*F;for(let ot=B;ot<=G;ot++)T[ot]=et;B=G+1}for(let W=B;W<256;W++)T[W]=T[B-1];return T.join(",")},g=`g_${h(this,Us)}_hcm_${e}_filter`,m=l.filter=C(this,gt,Io).call(this,g);return C(this,gt,_p).call(this,m),C(this,gt,wh).call(this,y(p[0],b[0],5),y(p[1],b[1],5),y(p[2],b[2],5),m),l.url=C(this,gt,Ro).call(this,g),l.url}destroy(e=!1){var i,n,s,r;e&&((i=h(this,Ra))!=null&&i.size)||((n=h(this,zs))==null||n.parentNode.parentNode.remove(),_(this,zs,null),(s=h(this,ol))==null||s.clear(),_(this,ol,null),(r=h(this,Ra))==null||r.clear(),_(this,Ra,null),_(this,Ia,0))}}ka=new WeakMap,ol=new WeakMap,zs=new WeakMap,Us=new WeakMap,pi=new WeakMap,Ra=new WeakMap,Ia=new WeakMap,gt=new WeakSet,ci=function(){return h(this,ol)||_(this,ol,new Map)},bh=function(){return h(this,Ra)||_(this,Ra,new Map)},ko=function(){if(!h(this,zs)){const e=h(this,pi).createElement("div"),{style:i}=e;i.visibility="hidden",i.contain="strict",i.width=i.height=0,i.position="absolute",i.top=i.left=0,i.zIndex=-1;const n=h(this,pi).createElementNS(Ts,"svg");n.setAttribute("width",0),n.setAttribute("height",0),_(this,zs,h(this,pi).createElementNS(Ts,"defs")),e.append(n),n.append(h(this,zs)),h(this,pi).body.append(e)}return h(this,zs)},Wc=function(e){if(e.length===1){const u=e[0],c=new Array(256);for(let f=0;f<256;f++)c[f]=u[f]/255;const d=c.join(",");return[d,d,d]}const[i,n,s]=e,r=new Array(256),a=new Array(256),l=new Array(256);for(let u=0;u<256;u++)r[u]=i[u]/255,a[u]=n[u]/255,l[u]=s[u]/255;return[r.join(","),a.join(","),l.join(",")]},Ro=function(e){if(h(this,ka)===void 0){_(this,ka,"");const i=h(this,pi).URL;i!==h(this,pi).baseURI&&(df(i)?Ot('#createUrl: ignore "data:"-URL for performance reasons.'):_(this,ka,i.split("#",1)[0]))}return`url(${h(this,ka)}#${e})`},o0=function(e){const i=h(this,pi).createElementNS(Ts,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(i)},_p=function(e){const i=h(this,pi).createElementNS(Ts,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(i)},Io=function(e){const i=h(this,pi).createElementNS(Ts,"filter");return i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("id",e),h(this,gt,ko).append(i),i},yh=function(e,i,n){const s=h(this,pi).createElementNS(Ts,i);s.setAttribute("type","discrete"),s.setAttribute("tableValues",n),e.append(s)},wh=function(e,i,n,s){const r=h(this,pi).createElementNS(Ts,"feComponentTransfer");s.append(r),C(this,gt,yh).call(this,r,"feFuncR",e),C(this,gt,yh).call(this,r,"feFuncG",i),C(this,gt,yh).call(this,r,"feFuncB",n)},Ap=function(e,i){const n=h(this,pi).createElementNS(Ts,"feComponentTransfer");i.append(n),C(this,gt,yh).call(this,n,"feFuncA",e)},_h=function(e){return h(this,gt,ko).style.color=e,Ig(getComputedStyle(h(this,gt,ko)).getPropertyValue("color"))};class l0{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){le("Abstract method `_fetch` called.")}}class h0 extends l0{async _fetch(t){const e=await cf(t,"arraybuffer");return new Uint8Array(e)}}bi&&Ot("Please use the `legacy` build in Node.js environments.");async function u0(o){const e=await process.getBuiltinModule("fs").promises.readFile(o);return new Uint8Array(e)}class Aw extends a0{}class Ew extends n0{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class xw extends s0{async _fetch(t){return u0(t)}}class Sw extends l0{async _fetch(t){return u0(t)}}const vi={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ep(o,t){if(!t)return;const e=t[2]-t[0],i=t[3]-t[1],n=new Path2D;n.rect(t[0],t[1],e,i),o.clip(n)}class Pg{getPattern(){le("Abstract method `getPattern` called.")}}class Cw extends Pg{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,n){let s;if(n===vi.STROKE||n===vi.FILL){const r=e.current.getClippedPathBoundingBox(n,me(t))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,u=e.cachedCanvases.getCanvas("pattern",a,l),c=u.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),i=Et.transform(i,[1,0,0,1,r[0],r[1]]),c.transform(...e.baseTransform),this.matrix&&c.transform(...this.matrix),Ep(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),s=t.createPattern(u.canvas,"no-repeat");const d=new DOMMatrix(i);s.setTransform(d)}else Ep(t,this._bbox),s=this._createGradient(t);return s}}function Lf(o,t,e,i,n,s,r,a){const l=t.coords,u=t.colors,c=o.data,d=o.width*4;let f;l[e+1]>l[i+1]&&(f=e,e=i,i=f,f=s,s=r,r=f),l[i+1]>l[n+1]&&(f=i,i=n,n=f,f=r,r=a,a=f),l[e+1]>l[i+1]&&(f=e,e=i,i=f,f=s,s=r,r=f);const p=(l[e]+t.offsetX)*t.scaleX,b=(l[e+1]+t.offsetY)*t.scaleY,y=(l[i]+t.offsetX)*t.scaleX,g=(l[i+1]+t.offsetY)*t.scaleY,m=(l[n]+t.offsetX)*t.scaleX,w=(l[n+1]+t.offsetY)*t.scaleY;if(b>=w)return;const E=u[s],R=u[s+1],A=u[s+2],T=u[r],k=u[r+1],P=u[r+2],F=u[a],B=u[a+1],W=u[a+2],G=Math.round(b),et=Math.round(w);let ot,ct,X,K,lt,Ct,xt,_t;for(let at=G;at<=et;at++){if(at<g){const St=at<b?0:(b-at)/(b-g);ot=p-(p-y)*St,ct=E-(E-T)*St,X=R-(R-k)*St,K=A-(A-P)*St}else{let St;at>w?St=1:g===w?St=0:St=(g-at)/(g-w),ot=y-(y-m)*St,ct=T-(T-F)*St,X=k-(k-B)*St,K=P-(P-W)*St}let At;at<b?At=0:at>w?At=1:At=(b-at)/(b-w),lt=p-(p-m)*At,Ct=E-(E-F)*At,xt=R-(R-B)*At,_t=A-(A-W)*At;const Rt=Math.round(Math.min(ot,lt)),Wt=Math.round(Math.max(ot,lt));let Ft=d*at+Rt*4;for(let St=Rt;St<=Wt;St++)At=(ot-St)/(ot-lt),At<0?At=0:At>1&&(At=1),c[Ft++]=ct-(ct-Ct)*At|0,c[Ft++]=X-(X-xt)*At|0,c[Ft++]=K-(K-_t)*At|0,c[Ft++]=255}}function Tw(o,t,e){const i=t.coords,n=t.colors;let s,r;switch(t.type){case"lattice":const a=t.verticesPerRow,l=Math.floor(i.length/a)-1,u=a-1;for(s=0;s<l;s++){let c=s*a;for(let d=0;d<u;d++,c++)Lf(o,e,i[c],i[c+1],i[c+a],n[c],n[c+1],n[c+a]),Lf(o,e,i[c+a+1],i[c+1],i[c+a],n[c+a+1],n[c+1],n[c+a])}break;case"triangles":for(s=0,r=i.length;s<r;s+=3)Lf(o,e,i[s],i[s+1],i[s+2],n[s],n[s+1],n[s+2]);break;default:throw new Error("illegal figure")}}class Dw extends Pg{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,i){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-a,c=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(u*t[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(c*t[1]*1.1)),3e3),p=u/d,b=c/f,y={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/p,scaleY:1/b},g=d+2*2,m=f+2*2,w=i.getCanvas("mesh",g,m),E=w.context,R=E.createImageData(d,f);if(e){const T=R.data;for(let k=0,P=T.length;k<P;k+=4)T[k]=e[0],T[k+1]=e[1],T[k+2]=e[2],T[k+3]=255}for(const T of this._figures)Tw(R,T,y);return E.putImageData(R,2,2),{canvas:w.canvas,offsetX:a-2*p,offsetY:l-2*b,scaleX:p,scaleY:b}}getPattern(t,e,i,n){Ep(t,this._bbox);let s;if(n===vi.SHADING)s=Et.singularValueDecompose2dScale(me(t));else if(s=Et.singularValueDecompose2dScale(e.baseTransform),this.matrix){const a=Et.singularValueDecompose2dScale(this.matrix);s=[s[0]*a[0],s[1]*a[1]]}const r=this._createMeshCanvas(s,n===vi.SHADING?null:this._background,e.cachedCanvases);return n!==vi.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class kw extends Pg{getPattern(){return"hotpink"}}function Rw(o){switch(o[0]){case"RadialAxial":return new Cw(o);case"Mesh":return new Dw(o);case"Dummy":return new kw}throw new Error(`Unknown IR type: ${o[0]}`)}const wm={COLORED:1,UNCOLORED:2},Xd=class Xd{constructor(t,e,i,n,s){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.ctx=i,this.canvasGraphicsFactory=n,this.baseTransform=s}createPatternCanvas(t){const{bbox:e,operatorList:i,paintType:n,tilingType:s,color:r,canvasGraphicsFactory:a}=this;let{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),hf("TilingType: "+s);const c=e[0],d=e[1],f=e[2],p=e[3],b=f-c,y=p-d,g=Et.singularValueDecompose2dScale(this.matrix),m=Et.singularValueDecompose2dScale(this.baseTransform),w=g[0]*m[0],E=g[1]*m[1];let R=b,A=y,T=!1,k=!1;const P=Math.ceil(l*w),F=Math.ceil(u*E),B=Math.ceil(b*w),W=Math.ceil(y*E);P>=B?R=l:T=!0,F>=W?A=u:k=!0;const G=this.getSizeAndScale(R,this.ctx.canvas.width,w),et=this.getSizeAndScale(A,this.ctx.canvas.height,E),ot=t.cachedCanvases.getCanvas("pattern",G.size,et.size),ct=ot.context,X=a.createCanvasGraphics(ct);if(X.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(X,n,r),ct.translate(-G.scale*c,-et.scale*d),X.transform(G.scale,0,0,et.scale,0,0),ct.save(),this.clipBbox(X,c,d,f,p),X.baseTransform=me(X.ctx),X.executeOperatorList(i),X.endDrawing(),ct.restore(),T||k){const K=ot.canvas;T&&(R=l),k&&(A=u);const lt=this.getSizeAndScale(R,this.ctx.canvas.width,w),Ct=this.getSizeAndScale(A,this.ctx.canvas.height,E),xt=lt.size,_t=Ct.size,at=t.cachedCanvases.getCanvas("pattern-workaround",xt,_t),At=at.context,Rt=T?Math.floor(b/l):0,Wt=k?Math.floor(y/u):0;for(let Ft=0;Ft<=Rt;Ft++)for(let St=0;St<=Wt;St++)At.drawImage(K,xt*Ft,_t*St,xt,_t,0,0,xt,_t);return{canvas:at.canvas,scaleX:lt.scale,scaleY:Ct.scale,offsetX:c,offsetY:d}}return{canvas:ot.canvas,scaleX:G.scale,scaleY:et.scale,offsetX:c,offsetY:d}}getSizeAndScale(t,e,i){const n=Math.max(Xd.MAX_PATTERN_SIZE,e);let s=Math.ceil(t*i);return s>=n?s=n:i=s/t,{scale:i,size:s}}clipBbox(t,e,i,n,s){const r=n-e,a=s-i;t.ctx.rect(e,i,r,a),t.current.updateRectMinMax(me(t.ctx),[e,i,n,s]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,i){const n=t.ctx,s=t.current;switch(e){case wm.COLORED:const r=this.ctx;n.fillStyle=r.fillStyle,n.strokeStyle=r.strokeStyle,s.fillColor=r.fillStyle,s.strokeColor=r.strokeStyle;break;case wm.UNCOLORED:const a=Et.makeHexColor(i[0],i[1],i[2]);n.fillStyle=a,n.strokeStyle=a,s.fillColor=a,s.strokeColor=a;break;default:throw new iw(`Unsupported paint type: ${e}`)}}getPattern(t,e,i,n){let s=i;n!==vi.SHADING&&(s=Et.transform(s,e.baseTransform),this.matrix&&(s=Et.transform(s,this.matrix)));const r=this.createPatternCanvas(e);let a=new DOMMatrix(s);a=a.translate(r.offsetX,r.offsetY),a=a.scale(1/r.scaleX,1/r.scaleY);const l=t.createPattern(r.canvas,"repeat");return l.setTransform(a),l}};Dt(Xd,"MAX_PATTERN_SIZE",3e3);let xp=Xd;function Iw({src:o,srcPos:t=0,dest:e,width:i,height:n,nonBlackColor:s=4294967295,inverseDecode:r=!1}){const a=Di.isLittleEndian?4278190080:255,[l,u]=r?[s,a]:[a,s],c=i>>3,d=i&7,f=o.length;e=new Uint32Array(e.buffer);let p=0;for(let b=0;b<n;b++){for(const g=t+c;t<g;t++){const m=t<f?o[t]:255;e[p++]=m&128?u:l,e[p++]=m&64?u:l,e[p++]=m&32?u:l,e[p++]=m&16?u:l,e[p++]=m&8?u:l,e[p++]=m&4?u:l,e[p++]=m&2?u:l,e[p++]=m&1?u:l}if(d===0)continue;const y=t<f?o[t++]:255;for(let g=0;g<d;g++)e[p++]=y&1<<7-g?u:l}return{srcPos:t,destPos:p}}const _m=16,Am=100,Lw=15,Em=10,xm=1e3,Hi=16;function Pw(o,t){if(o._removeMirroring)throw new Error("Context is already forwarding operations.");o.__originalSave=o.save,o.__originalRestore=o.restore,o.__originalRotate=o.rotate,o.__originalScale=o.scale,o.__originalTranslate=o.translate,o.__originalTransform=o.transform,o.__originalSetTransform=o.setTransform,o.__originalResetTransform=o.resetTransform,o.__originalClip=o.clip,o.__originalMoveTo=o.moveTo,o.__originalLineTo=o.lineTo,o.__originalBezierCurveTo=o.bezierCurveTo,o.__originalRect=o.rect,o.__originalClosePath=o.closePath,o.__originalBeginPath=o.beginPath,o._removeMirroring=()=>{o.save=o.__originalSave,o.restore=o.__originalRestore,o.rotate=o.__originalRotate,o.scale=o.__originalScale,o.translate=o.__originalTranslate,o.transform=o.__originalTransform,o.setTransform=o.__originalSetTransform,o.resetTransform=o.__originalResetTransform,o.clip=o.__originalClip,o.moveTo=o.__originalMoveTo,o.lineTo=o.__originalLineTo,o.bezierCurveTo=o.__originalBezierCurveTo,o.rect=o.__originalRect,o.closePath=o.__originalClosePath,o.beginPath=o.__originalBeginPath,delete o._removeMirroring},o.save=function(){t.save(),this.__originalSave()},o.restore=function(){t.restore(),this.__originalRestore()},o.translate=function(i,n){t.translate(i,n),this.__originalTranslate(i,n)},o.scale=function(i,n){t.scale(i,n),this.__originalScale(i,n)},o.transform=function(i,n,s,r,a,l){t.transform(i,n,s,r,a,l),this.__originalTransform(i,n,s,r,a,l)},o.setTransform=function(i,n,s,r,a,l){t.setTransform(i,n,s,r,a,l),this.__originalSetTransform(i,n,s,r,a,l)},o.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},o.rotate=function(i){t.rotate(i),this.__originalRotate(i)},o.clip=function(i){t.clip(i),this.__originalClip(i)},o.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},o.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},o.bezierCurveTo=function(e,i,n,s,r,a){t.bezierCurveTo(e,i,n,s,r,a),this.__originalBezierCurveTo(e,i,n,s,r,a)},o.rect=function(e,i,n,s){t.rect(e,i,n,s),this.__originalRect(e,i,n,s)},o.closePath=function(){t.closePath(),this.__originalClosePath()},o.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class Nw{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let n;return this.cache[t]!==void 0?(n=this.cache[t],this.canvasFactory.reset(n,e,i)):(n=this.canvasFactory.create(e,i),this.cache[t]=n),n}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Dc(o,t,e,i,n,s,r,a,l,u){const[c,d,f,p,b,y]=me(o);if(d===0&&f===0){const w=r*c+b,E=Math.round(w),R=a*p+y,A=Math.round(R),T=(r+l)*c+b,k=Math.abs(Math.round(T)-E)||1,P=(a+u)*p+y,F=Math.abs(Math.round(P)-A)||1;return o.setTransform(Math.sign(c),0,0,Math.sign(p),E,A),o.drawImage(t,e,i,n,s,0,0,k,F),o.setTransform(c,d,f,p,b,y),[k,F]}if(c===0&&p===0){const w=a*f+b,E=Math.round(w),R=r*d+y,A=Math.round(R),T=(a+u)*f+b,k=Math.abs(Math.round(T)-E)||1,P=(r+l)*d+y,F=Math.abs(Math.round(P)-A)||1;return o.setTransform(0,Math.sign(d),Math.sign(f),0,E,A),o.drawImage(t,e,i,n,s,0,0,F,k),o.setTransform(c,d,f,p,b,y),[F,k]}o.drawImage(t,e,i,n,s,r,a,l,u);const g=Math.hypot(c,d),m=Math.hypot(f,p);return[g*l,m*u]}function Ow(o){const{width:t,height:e}=o;if(t>xm||e>xm)return null;const i=1e3,n=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),s=t+1;let r=new Uint8Array(s*(e+1)),a,l,u;const c=t+7&-8;let d=new Uint8Array(c*e),f=0;for(const m of o.data){let w=128;for(;w>0;)d[f++]=m&w?0:255,w>>=1}let p=0;for(f=0,d[f]!==0&&(r[0]=1,++p),l=1;l<t;l++)d[f]!==d[f+1]&&(r[l]=d[f]?2:1,++p),f++;for(d[f]!==0&&(r[l]=2,++p),a=1;a<e;a++){f=a*c,u=a*s,d[f-c]!==d[f]&&(r[u]=d[f]?1:8,++p);let m=(d[f]?4:0)+(d[f-c]?8:0);for(l=1;l<t;l++)m=(m>>2)+(d[f+1]?4:0)+(d[f-c+1]?8:0),n[m]&&(r[u+l]=n[m],++p),f++;if(d[f-c]!==d[f]&&(r[u+l]=d[f]?2:4,++p),p>i)return null}for(f=c*(e-1),u=a*s,d[f]!==0&&(r[u]=8,++p),l=1;l<t;l++)d[f]!==d[f+1]&&(r[u+l]=d[f]?4:8,++p),f++;if(d[f]!==0&&(r[u+l]=4,++p),p>i)return null;const b=new Int32Array([0,s,-1,0,-s,0,0,0,1]),y=new Path2D;for(a=0;p&&a<=e;a++){let m=a*s;const w=m+t;for(;m<w&&!r[m];)m++;if(m===w)continue;y.moveTo(m%s,a);const E=m;let R=r[m];do{const A=b[R];do m+=A;while(!r[m]);const T=r[m];T!==5&&T!==10?(R=T,r[m]=0):(R=T&51*R>>4,r[m]&=R>>2|R<<2),y.lineTo(m%s,m/s|0),r[m]||--p}while(E!==m);--a}return d=null,r=null,function(m){m.save(),m.scale(1/t,-1/e),m.translate(0,-e),m.fill(y),m.beginPath(),m.restore()}}class Sm{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=wv,this.textMatrixScale=1,this.fontMatrix=Qf,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ui.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,i){[e,i]=Et.applyTransform([e,i],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(t,e){const i=Et.applyTransform(e,t),n=Et.applyTransform(e.slice(2),t),s=Et.applyTransform([e[0],e[3]],t),r=Et.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,i[0],n[0],s[0],r[0]),this.minY=Math.min(this.minY,i[1],n[1],s[1],r[1]),this.maxX=Math.max(this.maxX,i[0],n[0],s[0],r[0]),this.maxY=Math.max(this.maxY,i[1],n[1],s[1],r[1])}updateScalingPathMinMax(t,e){Et.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,i,n,s,r,a,l,u,c){const d=Et.bezierBoundingBox(e,i,n,s,r,a,l,u,c);c||this.updateRectMinMax(t,d)}getPathBoundingBox(t=vi.FILL,e=null){const i=[this.minX,this.minY,this.maxX,this.maxY];if(t===vi.STROKE){e||le("Stroke bounding box must include transform.");const n=Et.singularValueDecompose2dScale(e),s=n[0]*this.lineWidth/2,r=n[1]*this.lineWidth/2;i[0]-=s,i[1]-=r,i[2]+=s,i[3]+=r}return i}updateClipFromPath(){const t=Et.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=vi.FILL,e=null){return Et.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function Cm(o,t){if(t instanceof ImageData){o.putImageData(t,0,0);return}const e=t.height,i=t.width,n=e%Hi,s=(e-n)/Hi,r=n===0?s:s+1,a=o.createImageData(i,Hi);let l=0,u;const c=t.data,d=a.data;let f,p,b,y;if(t.kind===Pc.GRAYSCALE_1BPP){const g=c.byteLength,m=new Uint32Array(d.buffer,0,d.byteLength>>2),w=m.length,E=i+7>>3,R=4294967295,A=Di.isLittleEndian?4278190080:255;for(f=0;f<r;f++){for(b=f<s?Hi:n,u=0,p=0;p<b;p++){const T=g-l;let k=0;const P=T>E?i:T*8-7,F=P&-8;let B=0,W=0;for(;k<F;k+=8)W=c[l++],m[u++]=W&128?R:A,m[u++]=W&64?R:A,m[u++]=W&32?R:A,m[u++]=W&16?R:A,m[u++]=W&8?R:A,m[u++]=W&4?R:A,m[u++]=W&2?R:A,m[u++]=W&1?R:A;for(;k<P;k++)B===0&&(W=c[l++],B=128),m[u++]=W&B?R:A,B>>=1}for(;u<w;)m[u++]=0;o.putImageData(a,0,f*Hi)}}else if(t.kind===Pc.RGBA_32BPP){for(p=0,y=i*Hi*4,f=0;f<s;f++)d.set(c.subarray(l,l+y)),l+=y,o.putImageData(a,0,p),p+=Hi;f<r&&(y=i*n*4,d.set(c.subarray(l,l+y)),o.putImageData(a,0,p))}else if(t.kind===Pc.RGB_24BPP)for(b=Hi,y=i*b,f=0;f<r;f++){for(f>=s&&(b=n,y=i*b),u=0,p=y;p--;)d[u++]=c[l++],d[u++]=c[l++],d[u++]=c[l++],d[u++]=255;o.putImageData(a,0,f*Hi)}else throw new Error(`bad image kind: ${t.kind}`)}function Tm(o,t){if(t.bitmap){o.drawImage(t.bitmap,0,0);return}const e=t.height,i=t.width,n=e%Hi,s=(e-n)/Hi,r=n===0?s:s+1,a=o.createImageData(i,Hi);let l=0;const u=t.data,c=a.data;for(let d=0;d<r;d++){const f=d<s?Hi:n;({srcPos:l}=Iw({src:u,srcPos:l,dest:c,width:i,height:f,nonBlackColor:0})),o.putImageData(a,0,d*Hi)}}function rh(o,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of e)o[i]!==void 0&&(t[i]=o[i]);o.setLineDash!==void 0&&(t.setLineDash(o.getLineDash()),t.lineDashOffset=o.lineDashOffset)}function kc(o){if(o.strokeStyle=o.fillStyle="#000000",o.fillRule="nonzero",o.globalAlpha=1,o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.miterLimit=10,o.globalCompositeOperation="source-over",o.font="10px sans-serif",o.setLineDash!==void 0&&(o.setLineDash([]),o.lineDashOffset=0),!bi){const{filter:t}=o;t!=="none"&&t!==""&&(o.filter="none")}}function Dm(o,t){if(t)return!0;const e=Et.singularValueDecompose2dScale(o);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*Jr.PDF_TO_CSS_UNITS);return e[0]<=i&&e[1]<=i}const Fw=["butt","round","square"],Mw=["miter","round","bevel"],Bw={},km={};var Zn,Sp,Cp,Tp;const om=class om{constructor(t,e,i,n,s,{optionalContentConfig:r,markedContentStack:a=null},l,u){x(this,Zn);this.ctx=t,this.current=new Sm(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=n,this.filterFactory=s,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new Nw(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:n=null}){const s=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=n||"#ffffff",this.ctx.fillRect(0,0,s,r),this.ctx.fillStyle=a,i){const l=this.cachedCanvases.getCanvas("transparent",s,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...me(this.compositeCtx))}this.ctx.save(),kc(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=me(this.ctx)}executeOperatorList(t,e,i,n){const s=t.argsArray,r=t.fnArray;let a=e||0;const l=s.length;if(l===a)return a;const u=l-a>Em&&typeof i=="function",c=u?Date.now()+Lw:0;let d=0;const f=this.commonObjs,p=this.objs;let b;for(;;){if(n!==void 0&&a===n.nextBreakPoint)return n.breakIt(a,i),a;if(b=r[a],b!==Pn.dependency)this[b].apply(this,s[a]);else for(const y of s[a]){const g=y.startsWith("g_")?f:p;if(!g.has(y))return g.get(y,i),a}if(a++,a===l)return a;if(u&&++d>Em){if(Date.now()>c)return i(),a;d=0}}}endDrawing(){C(this,Zn,Sp).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),C(this,Zn,Cp).call(this)}_scaleImage(t,e){const i=t.width??t.displayWidth,n=t.height??t.displayHeight;let s=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),a=i,l=n,u="prescale1",c,d;for(;s>2&&a>1||r>2&&l>1;){let f=a,p=l;s>2&&a>1&&(f=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),s/=a/f),r>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/p),c=this.cachedCanvases.getCanvas(u,f,p),d=c.context,d.clearRect(0,0,f,p),d.drawImage(t,0,0,a,l,0,0,f,p),t=c.canvas,a=f,l=p,u=u==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:l}}_createMaskCanvas(t){const e=this.ctx,{width:i,height:n}=t,s=this.current.fillColor,r=this.current.patternFill,a=me(e);let l,u,c,d;if((t.bitmap||t.data)&&t.count>1){const P=t.bitmap||t.data.buffer;u=JSON.stringify(r?a:[a.slice(0,4),s]),l=this._cachedBitmapsMap.get(P),l||(l=new Map,this._cachedBitmapsMap.set(P,l));const F=l.get(u);if(F&&!r){const B=Math.round(Math.min(a[0],a[2])+a[4]),W=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:F,offsetX:B,offsetY:W}}c=F}c||(d=this.cachedCanvases.getCanvas("maskCanvas",i,n),Tm(d.context,t));let f=Et.transform(a,[1/i,0,0,-1/n,0,0]);f=Et.transform(f,[1,0,0,1,0,-n]);const[p,b,y,g]=Et.getAxialAlignedBoundingBox([0,0,i,n],f),m=Math.round(y-p)||1,w=Math.round(g-b)||1,E=this.cachedCanvases.getCanvas("fillCanvas",m,w),R=E.context,A=p,T=b;R.translate(-A,-T),R.transform(...f),c||(c=this._scaleImage(d.canvas,Qn(R)),c=c.img,l&&r&&l.set(u,c)),R.imageSmoothingEnabled=Dm(me(R),t.interpolate),Dc(R,c,0,0,c.width,c.height,0,0,i,n),R.globalCompositeOperation="source-in";const k=Et.transform(Qn(R),[1,0,0,1,-A,-T]);return R.fillStyle=r?s.getPattern(e,this,k,vi.FILL):s,R.fillRect(0,0,i,n),l&&!r&&(this.cachedCanvases.delete("fillCanvas"),l.set(u,E.canvas)),{canvas:E.canvas,offsetX:Math.round(A),offsetY:Math.round(T)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=Fw[t]}setLineJoin(t){this.ctx.lineJoin=Mw[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,i]of t)switch(e){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(i,t,e);this.suspendedCtx=this.ctx,this.ctx=n.context;const s=this.ctx;s.setTransform(...me(this.suspendedCtx)),rh(this.suspendedCtx,s),Pw(s,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),rh(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,n){const s=n[0],r=n[1],a=n[2]-s,l=n[3]-r;a===0||l===0||(this.genericComposeSMask(e.context,i,a,l,e.subtype,e.backdrop,e.transferMap,s,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,n,s,r,a,l,u,c,d){let f=t.canvas,p=l-c,b=u-d;if(r){const g=Et.makeHexColor(...r);if(p<0||b<0||p+i>f.width||b+n>f.height){const m=this.cachedCanvases.getCanvas("maskExtension",i,n),w=m.context;w.drawImage(f,-p,-b),w.globalCompositeOperation="destination-atop",w.fillStyle=g,w.fillRect(0,0,i,n),w.globalCompositeOperation="source-over",f=m.canvas,p=b=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const m=new Path2D;m.rect(p,b,i,n),t.clip(m),t.globalCompositeOperation="destination-atop",t.fillStyle=g,t.fillRect(p,b,i,n),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),s==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):s==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const y=new Path2D;y.rect(l,u,i,n),e.clip(y),e.globalCompositeOperation="destination-in",e.drawImage(f,p,b,i,n,l,u,i,n),e.restore()}save(){this.inSMaskMode?(rh(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),rh(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,i,n,s,r){this.ctx.transform(t,e,i,n,s,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i){const n=this.ctx,s=this.current;let r=s.x,a=s.y,l,u;const c=me(n),d=c[0]===0&&c[3]===0||c[1]===0&&c[2]===0,f=d?i.slice(0):null;for(let p=0,b=0,y=t.length;p<y;p++)switch(t[p]|0){case Pn.rectangle:r=e[b++],a=e[b++];const g=e[b++],m=e[b++],w=r+g,E=a+m;n.moveTo(r,a),g===0||m===0?n.lineTo(w,E):(n.lineTo(w,a),n.lineTo(w,E),n.lineTo(r,E)),d||s.updateRectMinMax(c,[r,a,w,E]),n.closePath();break;case Pn.moveTo:r=e[b++],a=e[b++],n.moveTo(r,a),d||s.updatePathMinMax(c,r,a);break;case Pn.lineTo:r=e[b++],a=e[b++],n.lineTo(r,a),d||s.updatePathMinMax(c,r,a);break;case Pn.curveTo:l=r,u=a,r=e[b+4],a=e[b+5],n.bezierCurveTo(e[b],e[b+1],e[b+2],e[b+3],r,a),s.updateCurvePathMinMax(c,l,u,e[b],e[b+1],e[b+2],e[b+3],r,a,f),b+=6;break;case Pn.curveTo2:l=r,u=a,n.bezierCurveTo(r,a,e[b],e[b+1],e[b+2],e[b+3]),s.updateCurvePathMinMax(c,l,u,r,a,e[b],e[b+1],e[b+2],e[b+3],f),r=e[b+2],a=e[b+3],b+=4;break;case Pn.curveTo3:l=r,u=a,r=e[b+2],a=e[b+3],n.bezierCurveTo(e[b],e[b+1],r,a,r,a),s.updateCurvePathMinMax(c,l,u,e[b],e[b+1],r,a,r,a,f),b+=4;break;case Pn.closePath:n.closePath();break}d&&s.updateScalingPathMinMax(c,f),s.setCurrentPoint(r,a)}closePath(){this.ctx.closePath()}stroke(t=!0){const e=this.ctx,i=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&(i!=null&&i.getPattern)?(e.save(),e.strokeStyle=i.getPattern(e,this,Qn(e),vi.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){const e=this.ctx,i=this.current.fillColor,n=this.current.patternFill;let s=!1;n&&(e.save(),e.fillStyle=i.getPattern(e,this,Qn(e),vi.FILL),s=!0);const r=this.current.getClippedPathBoundingBox();this.contentVisible&&r!==null&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),s&&e.restore(),t&&this.consumePath(r)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Bw}eoClip(){this.pendingClip=km}beginText(){this.current.textMatrix=wv,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}const i=new Path2D,n=e.getTransform().invertSelf();for(const{transform:s,x:r,y:a,fontSize:l,path:u}of t)i.addPath(u,new DOMMatrix(s).preMultiplySelf(n).translate(r,a).scale(l,-l));e.clip(i),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var c;const i=this.commonObjs.get(t),n=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(n.fontMatrix=i.fontMatrix||Qf,(n.fontMatrix[0]===0||n.fontMatrix[3]===0)&&Ot("Invalid font matrix for font "+t),e<0?(e=-e,n.fontDirection=-1):n.fontDirection=1,this.current.font=i,this.current.fontSize=e,i.isType3Font)return;const s=i.loadedName||"sans-serif",r=((c=i.systemFontInfo)==null?void 0:c.css)||`"${s}", ${i.fallbackName}`;let a="normal";i.black?a="900":i.bold&&(a="bold");const l=i.italic?"italic":"normal";let u=e;e<_m?u=_m:e>Am&&(u=Am),this.current.fontSizeScale=e/u,this.ctx.font=`${l} ${a} ${u}px ${r}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,i,n,s,r){this.current.textMatrix=[t,e,i,n,s,r],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,i,n,s){const r=this.ctx,a=this.current,l=a.font,u=a.textRenderingMode,c=a.fontSize/a.fontSizeScale,d=u&ui.FILL_STROKE_MASK,f=!!(u&ui.ADD_TO_PATH_FLAG),p=a.patternFill&&!l.missingFile,b=a.patternStroke&&!l.missingFile;let y;if((l.disableFontFace||f||p||b)&&(y=l.getPathGenerator(this.commonObjs,t)),l.disableFontFace||p||b){if(r.save(),r.translate(e,i),r.scale(c,-c),d===ui.FILL||d===ui.FILL_STROKE)if(n){const g=r.getTransform();r.setTransform(...n),r.fill(C(this,Zn,Tp).call(this,y,g,n))}else r.fill(y);if(d===ui.STROKE||d===ui.FILL_STROKE)if(s){const g=r.getTransform();r.setTransform(...s),r.stroke(C(this,Zn,Tp).call(this,y,g,s))}else r.lineWidth/=c,r.stroke(y);r.restore()}else(d===ui.FILL||d===ui.FILL_STROKE)&&r.fillText(t,e,i),(d===ui.STROKE||d===ui.FILL_STROKE)&&r.strokeText(t,e,i);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:me(r),x:e,y:i,fontSize:c,path:y})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let i=!1;for(let n=3;n<e.length;n+=4)if(e[n]>0&&e[n]<255){i=!0;break}return Ht(this,"isFontSubpixelAAEnabled",i)}showText(t){const e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);const n=e.fontSize;if(n===0)return;const s=this.ctx,r=e.fontSizeScale,a=e.charSpacing,l=e.wordSpacing,u=e.fontDirection,c=e.textHScale*u,d=t.length,f=i.vertical,p=f?1:-1,b=i.defaultVMetrics,y=n*e.fontMatrix[0],g=e.textRenderingMode===ui.FILL&&!i.disableFontFace&&!e.patternFill;s.save(),s.transform(...e.textMatrix),s.translate(e.x,e.y+e.textRise),u>0?s.scale(c,-1):s.scale(c,1);let m,w;if(e.patternFill){s.save();const k=e.fillColor.getPattern(s,this,Qn(s),vi.FILL);m=me(s),s.restore(),s.fillStyle=k}if(e.patternStroke){s.save();const k=e.strokeColor.getPattern(s,this,Qn(s),vi.STROKE);w=me(s),s.restore(),s.strokeStyle=k}let E=e.lineWidth;const R=e.textMatrixScale;if(R===0||E===0){const k=e.textRenderingMode&ui.FILL_STROKE_MASK;(k===ui.STROKE||k===ui.FILL_STROKE)&&(E=this.getSinglePixelWidth())}else E/=R;if(r!==1&&(s.scale(r,r),E/=r),s.lineWidth=E,i.isInvalidPDFjsFont){const k=[];let P=0;for(const F of t)k.push(F.unicode),P+=F.width;s.fillText(k.join(""),0,0),e.x+=P*y*c,s.restore(),this.compose();return}let A=0,T;for(T=0;T<d;++T){const k=t[T];if(typeof k=="number"){A+=p*k*n/1e3;continue}let P=!1;const F=(k.isSpace?l:0)+a,B=k.fontChar,W=k.accent;let G,et,ot=k.width;if(f){const X=k.vmetric||b,K=-(k.vmetric?X[1]:ot*.5)*y,lt=X[2]*y;ot=X?-X[0]:ot,G=K/r,et=(A+lt)/r}else G=A/r,et=0;if(i.remeasure&&ot>0){const X=s.measureText(B).width*1e3/n*r;if(ot<X&&this.isFontSubpixelAAEnabled){const K=ot/X;P=!0,s.save(),s.scale(K,1),G/=K}else ot!==X&&(G+=(ot-X)/2e3*n/r)}if(this.contentVisible&&(k.isInFont||i.missingFile)){if(g&&!W)s.fillText(B,G,et);else if(this.paintChar(B,G,et,m,w),W){const X=G+n*W.offset.x/r,K=et-n*W.offset.y/r;this.paintChar(W.fontChar,X,K,m,w)}}const ct=f?ot*y-F*u:ot*y+F*u;A+=ct,P&&s.restore()}f?e.y-=A:e.x+=A*c,s.restore(),this.compose()}showType3Text(t){const e=this.ctx,i=this.current,n=i.font,s=i.fontSize,r=i.fontDirection,a=n.vertical?1:-1,l=i.charSpacing,u=i.wordSpacing,c=i.textHScale*r,d=i.fontMatrix||Qf,f=t.length,p=i.textRenderingMode===ui.INVISIBLE;let b,y,g,m;if(!(p||s===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...i.textMatrix),e.translate(i.x,i.y),e.scale(c,r),b=0;b<f;++b){if(y=t[b],typeof y=="number"){m=a*y*s/1e3,this.ctx.translate(m,0),i.x+=m*c;continue}const w=(y.isSpace?u:0)+l,E=n.charProcOperatorList[y.operatorListId];if(!E){Ot(`Type3 character "${y.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=y,this.save(),e.scale(s,s),e.transform(...d),this.executeOperatorList(E),this.restore()),g=Et.applyTransform([y.width,0],d)[0]*s+w,e.translate(g,0),i.x+=g*c}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,i,n,s,r){this.ctx.rect(i,n,s-i,r-n),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const i=t[1],n=this.baseTransform||me(this.ctx),s={createCanvasGraphics:r=>new om(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new xp(t,i,this.ctx,s,n)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,i){this.ctx.strokeStyle=this.current.strokeColor=Et.makeHexColor(t,e,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,i){this.ctx.fillStyle=this.current.fillColor=Et.makeHexColor(t,e,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=Rw(this.getObject(t)),this.cachedPatterns.set(t,i)),e&&(i.matrix=e),i}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const i=this._getPattern(t);e.fillStyle=i.getPattern(e,this,Qn(e),vi.SHADING);const n=Qn(e);if(n){const{width:s,height:r}=e.canvas,[a,l,u,c]=Et.getAxialAlignedBoundingBox([0,0,s,r],n);this.ctx.fillRect(a,l,u-a,c-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){le("Should not call beginInlineImage")}beginImageData(){le("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=me(this.ctx),e)){const i=e[2]-e[0],n=e[3]-e[1];this.ctx.rect(e[0],e[1],i,n),this.current.updateRectMinMax(me(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||hf("TODO: Support non-isolated groups."),t.knockout&&Ot("Knockout groups not supported.");const i=me(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let n=Et.getAxialAlignedBoundingBox(t.bbox,me(e));const s=[0,0,e.canvas.width,e.canvas.height];n=Et.intersect(n,s)||[0,0,0,0];const r=Math.floor(n[0]),a=Math.floor(n[1]),l=Math.max(Math.ceil(n[2])-r,1),u=Math.max(Math.ceil(n[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,u]);let c="groupAt"+this.groupLevel;t.smask&&(c+="_smask_"+this.smaskCounter++%2);const d=this.cachedCanvases.getCanvas(c,l,u),f=d.context;f.translate(-r,-a),f.transform(...i),t.smask?this.smaskStack.push({canvas:d.canvas,context:f,offsetX:r,offsetY:a,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,a),e.save()),rh(e,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const n=me(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...n);const s=Et.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],n);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(s)}}beginAnnotation(t,e,i,n,s){if(C(this,Zn,Sp).call(this),kc(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const r=e[2]-e[0],a=e[3]-e[1];if(s&&this.annotationCanvasMap){i=i.slice(),i[4]-=e[0],i[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=r,e[3]=a;const[l,u]=Et.singularValueDecompose2dScale(me(this.ctx)),{viewportScale:c}=this,d=Math.ceil(r*this.outputScaleX*c),f=Math.ceil(a*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(d,f);const{canvas:p,context:b}=this.annotationCanvas;this.annotationCanvasMap.set(t,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=b,this.ctx.save(),this.ctx.setTransform(l,0,0,-u,0,a*u),kc(this.ctx)}else kc(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],r,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Sm(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...n)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),C(this,Zn,Cp).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const i=this.ctx,n=this.processingType3;if(n&&(n.compiled===void 0&&(n.compiled=Ow(t)),n.compiled)){n.compiled(i);return}const s=this._createMaskCanvas(t),r=s.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,s.offsetX,s.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i=0,n=0,s,r){if(!this.contentVisible)return;t=this.getObject(t.data,t);const a=this.ctx;a.save();const l=me(a);a.transform(e,i,n,s,0,0);const u=this._createMaskCanvas(t);a.setTransform(1,0,0,1,u.offsetX-l[4],u.offsetY-l[5]);for(let c=0,d=r.length;c<d;c+=2){const f=Et.transform(l,[e,i,n,s,r[c],r[c+1]]),[p,b]=Et.applyTransform([0,0],f);a.drawImage(u.canvas,p,b)}a.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,i=this.current.fillColor,n=this.current.patternFill;for(const s of t){const{data:r,width:a,height:l,transform:u}=s,c=this.cachedCanvases.getCanvas("maskCanvas",a,l),d=c.context;d.save();const f=this.getObject(r,s);Tm(d,f),d.globalCompositeOperation="source-in",d.fillStyle=n?i.getPattern(d,this,Qn(e),vi.FILL):i,d.fillRect(0,0,a,l),d.restore(),e.save(),e.transform(...u),e.scale(1,-1),Dc(e,c.canvas,0,0,a,l,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){Ot("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,i,n){if(!this.contentVisible)return;const s=this.getObject(t);if(!s){Ot("Dependent image isn't ready yet");return}const r=s.width,a=s.height,l=[];for(let u=0,c=n.length;u<c;u+=2)l.push({transform:[e,0,0,i,n[u],n[u+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(s,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:i,height:n}=t,s=this.cachedCanvases.getCanvas("inlineImage",i,n),r=s.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",s.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,i=t.height,n=this.ctx;if(this.save(),!bi){const{filter:a}=n;a!=="none"&&a!==""&&(n.filter="none")}n.scale(1/e,-1/i);let s;if(t.bitmap)s=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)s=t;else{const l=this.cachedCanvases.getCanvas("inlineImage",e,i).context;Cm(l,t),s=this.applyTransferMapsToCanvas(l)}const r=this._scaleImage(s,Qn(n));n.imageSmoothingEnabled=Dm(me(n),t.interpolate),Dc(n,r.img,0,0,r.paintWidth,r.paintHeight,0,-i,e,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const i=this.ctx;let n;if(t.bitmap)n=t.bitmap;else{const s=t.width,r=t.height,l=this.cachedCanvases.getCanvas("inlineImage",s,r).context;Cm(l,t),n=this.applyTransferMapsToCanvas(l)}for(const s of e)i.save(),i.transform(...s.transform),i.scale(1,-1),Dc(i,n,s.x,s.y,s.w,s.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){const e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const i=this.ctx;this.pendingClip&&(e||(this.pendingClip===km?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=me(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),n=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,n)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:i,c:n,d:s}=this.ctx.getTransform();let r,a;if(i===0&&n===0){const l=Math.abs(e),u=Math.abs(s);if(l===u)if(t===0)r=a=1/l;else{const c=l*t;r=a=c<1?1/c:1}else if(t===0)r=1/l,a=1/u;else{const c=l*t,d=u*t;r=c<1?1/c:1,a=d<1?1/d:1}}else{const l=Math.abs(e*s-i*n),u=Math.hypot(e,i),c=Math.hypot(n,s);if(t===0)r=c/l,a=u/l;else{const d=t*l;r=c>d?c/d:1,a=u>d?u/d:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t){const{ctx:e}=this,{lineWidth:i}=this.current,[n,s]=this.getScaleForStroking();if(e.lineWidth=i||1,n===1&&s===1){e.stroke();return}const r=e.getLineDash();if(t&&e.save(),e.scale(n,s),r.length>0){const a=Math.max(n,s);e.setLineDash(r.map(l=>l/a)),e.lineDashOffset/=a}e.stroke(),t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};Zn=new WeakSet,Sp=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Cp=function(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}},Tp=function(t,e,i){const n=new Path2D;return n.addPath(t,new DOMMatrix(i).invertSelf().multiplySelf(e)),n};let jo=om;for(const o in Pn)jo.prototype[o]!==void 0&&(jo.prototype[Pn[o]]=jo.prototype[o]);var yu,wu;class nr{static get workerPort(){return h(this,yu)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");_(this,yu,t)}static get workerSrc(){return h(this,wu)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");_(this,wu,t)}}yu=new WeakMap,wu=new WeakMap,x(nr,yu,null),x(nr,wu,"");var La,_u;class zw{constructor({parsedData:t,rawData:e}){x(this,La);x(this,_u);_(this,La,t),_(this,_u,e)}getRaw(){return h(this,_u)}get(t){return h(this,La).get(t)??null}getAll(){return Cg(h(this,La))}has(t){return h(this,La).has(t)}}La=new WeakMap,_u=new WeakMap;const Lo=Symbol("INTERNAL");var Au,Eu,xu,ll;class Uw{constructor(t,{name:e,intent:i,usage:n,rbGroups:s}){x(this,Au,!1);x(this,Eu,!1);x(this,xu,!1);x(this,ll,!0);_(this,Au,!!(t&sn.DISPLAY)),_(this,Eu,!!(t&sn.PRINT)),this.name=e,this.intent=i,this.usage=n,this.rbGroups=s}get visible(){if(h(this,xu))return h(this,ll);if(!h(this,ll))return!1;const{print:t,view:e}=this.usage;return h(this,Au)?(e==null?void 0:e.viewState)!=="OFF":h(this,Eu)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,i=!1){t!==Lo&&le("Internal method `_setVisible` called."),_(this,xu,i),_(this,ll,e)}}Au=new WeakMap,Eu=new WeakMap,xu=new WeakMap,ll=new WeakMap;var Rr,ne,hl,ul,Su,Dp;class Hw{constructor(t,e=sn.DISPLAY){x(this,Su);x(this,Rr,null);x(this,ne,new Map);x(this,hl,null);x(this,ul,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,_(this,ul,t.order);for(const i of t.groups)h(this,ne).set(i.id,new Uw(e,i));if(t.baseState==="OFF")for(const i of h(this,ne).values())i._setVisible(Lo,!1);for(const i of t.on)h(this,ne).get(i)._setVisible(Lo,!0);for(const i of t.off)h(this,ne).get(i)._setVisible(Lo,!1);_(this,hl,this.getHash())}}isVisible(t){if(h(this,ne).size===0)return!0;if(!t)return hf("Optional content group not defined."),!0;if(t.type==="OCG")return h(this,ne).has(t.id)?h(this,ne).get(t.id).visible:(Ot(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return C(this,Su,Dp).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!h(this,ne).has(e))return Ot(`Optional content group not found: ${e}`),!0;if(h(this,ne).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!h(this,ne).has(e))return Ot(`Optional content group not found: ${e}`),!0;if(!h(this,ne).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!h(this,ne).has(e))return Ot(`Optional content group not found: ${e}`),!0;if(!h(this,ne).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!h(this,ne).has(e))return Ot(`Optional content group not found: ${e}`),!0;if(h(this,ne).get(e).visible)return!1}return!0}return Ot(`Unknown optional content policy ${t.policy}.`),!0}return Ot(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){var s;const n=h(this,ne).get(t);if(!n){Ot(`Optional content group not found: ${t}`);return}if(i&&e&&n.rbGroups.length)for(const r of n.rbGroups)for(const a of r)a!==t&&((s=h(this,ne).get(a))==null||s._setVisible(Lo,!1,!0));n._setVisible(Lo,!!e,!0),_(this,Rr,null)}setOCGState({state:t,preserveRB:e}){let i;for(const n of t){switch(n){case"ON":case"OFF":case"Toggle":i=n;continue}const s=h(this,ne).get(n);if(s)switch(i){case"ON":this.setVisibility(n,!0,e);break;case"OFF":this.setVisibility(n,!1,e);break;case"Toggle":this.setVisibility(n,!s.visible,e);break}}_(this,Rr,null)}get hasInitialVisibility(){return h(this,hl)===null||this.getHash()===h(this,hl)}getOrder(){return h(this,ne).size?h(this,ul)?h(this,ul).slice():[...h(this,ne).keys()]:null}getGroups(){return h(this,ne).size>0?Cg(h(this,ne)):null}getGroup(t){return h(this,ne).get(t)||null}getHash(){if(h(this,Rr)!==null)return h(this,Rr);const t=new Zv;for(const[e,i]of h(this,ne))t.update(`${e}:${i.visible}`);return _(this,Rr,t.hexdigest())}}Rr=new WeakMap,ne=new WeakMap,hl=new WeakMap,ul=new WeakMap,Su=new WeakSet,Dp=function(t){const e=t.length;if(e<2)return!0;const i=t[0];for(let n=1;n<e;n++){const s=t[n];let r;if(Array.isArray(s))r=C(this,Su,Dp).call(this,s);else if(h(this,ne).has(s))r=h(this,ne).get(s).visible;else return Ot(`Optional content group not found: ${s}`),!0;switch(i){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return i==="And"};class jw{constructor(t,{disableRange:e=!1,disableStream:i=!1}){Ne(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:n,initialData:s,progressiveDone:r,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,(s==null?void 0:s.length)>0){const l=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,u)=>{this._onReceiveData({begin:l,chunk:u})}),t.addProgressListener((l,u)=>{this._onProgress({loaded:l,total:u})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const n=this._rangeReaders.some(function(s){return s._begin!==t?!1:(s._enqueue(i),!0)});Ne(n,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,i,n,s;t.total===void 0?(i=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||i.call(e,{loaded:t.loaded}):(s=(n=this._fullRequestReader)==null?void 0:n.onProgress)==null||s.call(n,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Ne(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new Ww(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new qw(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeReaders.slice(0))i.cancel(t);this._pdfDataRangeTransport.abort()}}class Ww{constructor(t,e,i=!1,n=null){this._stream=t,this._done=i||!1,this._filename=kg(n)?n:null,this._queuedChunks=e||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class qw{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Vw(o){let t=!0,e=i("filename\\*","i").exec(o);if(e){e=e[1];let c=a(e);return c=unescape(c),c=l(c),c=u(c),s(c)}if(e=r(o),e){const c=u(e);return s(c)}if(e=i("filename","i").exec(o),e){e=e[1];let c=a(e);return c=u(c),s(c)}function i(c,d){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function n(c,d){if(c){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const f=new TextDecoder(c,{fatal:!0}),p=uf(d);d=f.decode(p),t=!1}catch{}}return d}function s(c){return t&&/[\x80-\xff]/.test(c)&&(c=n("utf-8",c),t&&(c=n("iso-8859-1",c))),c}function r(c){const d=[];let f;const p=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(c))!==null;){let[,y,g,m]=f;if(y=parseInt(y,10),y in d){if(y===0)break;continue}d[y]=[g,m]}const b=[];for(let y=0;y<d.length&&y in d;++y){let[g,m]=d[y];m=a(m),g&&(m=unescape(m),y===0&&(m=l(m))),b.push(m)}return b.join("")}function a(c){if(c.startsWith('"')){const d=c.slice(1).split('\\"');for(let f=0;f<d.length;++f){const p=d[f].indexOf('"');p!==-1&&(d[f]=d[f].slice(0,p),d.length=f+1),d[f]=d[f].replaceAll(/\\(.)/g,"$1")}c=d.join('"')}return c}function l(c){const d=c.indexOf("'");if(d===-1)return c;const f=c.slice(0,d),b=c.slice(d+1).replace(/^[^']*'/,"");return n(f,b)}function u(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,f,p,b){if(p==="q"||p==="Q")return b=b.replaceAll("_"," "),b=b.replaceAll(/=([0-9a-fA-F]{2})/g,function(y,g){return String.fromCharCode(parseInt(g,16))}),n(f,b);try{b=atob(b)}catch{}return n(f,b)})}return""}function c0(o,t){const e=new Headers;if(!o||!t||typeof t!="object")return e;for(const i in t){const n=t[i];n!==void 0&&e.append(i,n)}return e}function ff(o){try{return new URL(o).origin}catch{}return null}function d0({responseHeaders:o,isHttp:t,rangeChunkSize:e,disableRange:i}){const n={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(o.get("Content-Length"),10);return!Number.isInteger(s)||(n.suggestedLength=s,s<=2*e)||i||!t||o.get("Accept-Ranges")!=="bytes"||(o.get("Content-Encoding")||"identity")!=="identity"||(n.allowRangeRequests=!0),n}function f0(o){const t=o.get("Content-Disposition");if(t){let e=Vw(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(kg(e))return e}return null}function pf(o,t){return o===404||o===0&&t.startsWith("file:")?new Oh('Missing PDF "'+t+'".'):new pd(`Unexpected server response (${o}) while retrieving PDF "${t}".`,o)}function p0(o){return o===200||o===206}function g0(o,t,e){return{method:"GET",headers:o,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function m0(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:(Ot(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class Rm{constructor(t){Dt(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=c0(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ne(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Gw(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new $w(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class Gw{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const i=new Headers(t.headers),n=e.url;fetch(n,g0(i,this._withCredentials,this._abortController)).then(s=>{if(t._responseOrigin=ff(s.url),!p0(s.status))throw pf(s.status,n);this._reader=s.body.getReader(),this._headersCapability.resolve();const r=s.headers,{allowRangeRequests:a,suggestedLength:l}=d0({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=f0(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Qr("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:m0(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class $w{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;const n=t.source;this._withCredentials=n.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!n.disableStream,this._abortController=new AbortController;const s=new Headers(t.headers);s.append("Range",`bytes=${e}-${i-1}`);const r=n.url;fetch(r,g0(s,this._withCredentials,this._abortController)).then(a=>{const l=ff(a.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!p0(a.status))throw pf(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:m0(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const Pf=200,Nf=206;function Xw(o){const t=o.response;return typeof t!="string"?t:uf(t).buffer}class Yw{constructor({url:t,httpHeaders:e,withCredentials:i}){Dt(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=c0(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,i=this.currXhrId++,n=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[s,r]of this.headers)e.setRequestHeader(s,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),n.expectedStatus=Nf):n.expectedStatus=Pf,e.responseType="arraybuffer",Ne(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),n.onHeadersReceived=t.onHeadersReceived,n.onDone=t.onDone,n.onError=t.onError,n.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){var n;const i=this.pendingRequests[t];i&&((n=i.onProgress)==null||n.call(i,e))}onStateChange(t,e){const i=this.pendingRequests[t];if(!i)return;const n=i.xhr;if(n.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),n.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],n.status===0&&this.isHttp){i.onError(n.status);return}const s=n.status||Pf;if(!(s===Pf&&i.expectedStatus===Nf)&&s!==i.expectedStatus){i.onError(n.status);return}const a=Xw(n);if(s===Nf){const l=n.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);u?i.onDone({begin:parseInt(u[1],10),chunk:a}):(Ot('Missing or invalid "Content-Range" header.'),i.onError(0))}else a?i.onDone({begin:0,chunk:a}):i.onError(n.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class Kw{constructor(t){this._source=t,this._manager=new Yw(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Ne(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Zw(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const i=new Qw(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class Zw{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=ff(e.responseURL);const i=e.getAllResponseHeaders(),n=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...u]=a.split(": ");return[l,u.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:r}=d0({responseHeaders:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=f0(n),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=pf(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Qw{constructor(t,e,i){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;const t=ff((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??(this._storedError=pf(t,this._url));for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Jw=/^[a-z][a-z0-9\-+.]+:/i;function t2(o){if(Jw.test(o))return new URL(o);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(o))}class e2{constructor(t){this.source=t,this.url=t2(t.url),Ne(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ne(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new i2(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new n2(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class i2{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(n=>{this._contentLength=n.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},n=>{n.code==="ENOENT"&&(n=new Oh(`Missing PDF "${this._url}".`)),this._storedError=n,this._headersCapability.reject(n)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Qr("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class n2{constructor(t,e,i){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const n=t.source;this._isStreamingSupported=!n.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:e,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const s2=1e5,Oi=30,r2=.8;var yv,Ir,zi,Cu,Tu,Pa,Hs,Du,ku,Na,cl,dl,Lr,fl,Ru,pl,Oa,Iu,Lu,Fa,Ma,Pu,Pr,gl,fr,v0,b0,kp,on,qc,Rp,y0,w0;const Ue=class Ue{constructor({textContentSource:t,container:e,viewport:i}){x(this,fr);x(this,Ir,Promise.withResolvers());x(this,zi,null);x(this,Cu,!1);x(this,Tu,!!((yv=globalThis.FontInspector)!=null&&yv.enabled));x(this,Pa,null);x(this,Hs,null);x(this,Du,0);x(this,ku,0);x(this,Na,null);x(this,cl,null);x(this,dl,0);x(this,Lr,0);x(this,fl,Object.create(null));x(this,Ru,[]);x(this,pl,null);x(this,Oa,[]);x(this,Iu,new WeakMap);x(this,Lu,null);var l;if(t instanceof ReadableStream)_(this,pl,t);else if(typeof t=="object")_(this,pl,new ReadableStream({start(u){u.enqueue(t),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');_(this,zi,_(this,cl,e)),_(this,Lr,i.scale*(globalThis.devicePixelRatio||1)),_(this,dl,i.rotation),_(this,Hs,{div:null,properties:null,ctx:null});const{pageWidth:n,pageHeight:s,pageX:r,pageY:a}=i.rawDims;_(this,Lu,[1,0,0,-1,-r,a+s]),_(this,ku,n),_(this,Du,s),C(l=Ue,on,y0).call(l),po(e,i),h(this,Ir).promise.finally(()=>{h(Ue,gl).delete(this),_(this,Hs,null),_(this,fl,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Di.platform;return Ht(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{h(this,Na).read().then(({value:e,done:i})=>{if(i){h(this,Ir).resolve();return}h(this,Pa)??_(this,Pa,e.lang),Object.assign(h(this,fl),e.styles),C(this,fr,v0).call(this,e.items),t()},h(this,Ir).reject)};return _(this,Na,h(this,pl).getReader()),h(Ue,gl).add(this),t(),h(this,Ir).promise}update({viewport:t,onBefore:e=null}){var s;const i=t.scale*(globalThis.devicePixelRatio||1),n=t.rotation;if(n!==h(this,dl)&&(e==null||e(),_(this,dl,n),po(h(this,cl),{rotation:n})),i!==h(this,Lr)){e==null||e(),_(this,Lr,i);const r={div:null,properties:null,ctx:C(s=Ue,on,qc).call(s,h(this,Pa))};for(const a of h(this,Oa))r.properties=h(this,Iu).get(a),r.div=a,C(this,fr,kp).call(this,r)}}cancel(){var e;const t=new Qr("TextLayer task cancelled.");(e=h(this,Na))==null||e.cancel(t).catch(()=>{}),_(this,Na,null),h(this,Ir).reject(t)}get textDivs(){return h(this,Oa)}get textContentItemsStr(){return h(this,Ru)}static cleanup(){if(!(h(this,gl).size>0)){h(this,Fa).clear();for(const{canvas:t}of h(this,Ma).values())t.remove();h(this,Ma).clear()}}};Ir=new WeakMap,zi=new WeakMap,Cu=new WeakMap,Tu=new WeakMap,Pa=new WeakMap,Hs=new WeakMap,Du=new WeakMap,ku=new WeakMap,Na=new WeakMap,cl=new WeakMap,dl=new WeakMap,Lr=new WeakMap,fl=new WeakMap,Ru=new WeakMap,pl=new WeakMap,Oa=new WeakMap,Iu=new WeakMap,Lu=new WeakMap,Fa=new WeakMap,Ma=new WeakMap,Pu=new WeakMap,Pr=new WeakMap,gl=new WeakMap,fr=new WeakSet,v0=function(t){var n,s;if(h(this,Cu))return;(s=h(this,Hs)).ctx??(s.ctx=C(n=Ue,on,qc).call(n,h(this,Pa)));const e=h(this,Oa),i=h(this,Ru);for(const r of t){if(e.length>s2){Ot("Ignoring additional textDivs for performance reasons."),_(this,Cu,!0);return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const a=h(this,zi);_(this,zi,document.createElement("span")),h(this,zi).classList.add("markedContent"),r.id!==null&&h(this,zi).setAttribute("id",`${r.id}`),a.append(h(this,zi))}else r.type==="endMarkedContent"&&_(this,zi,h(this,zi).parentNode);continue}i.push(r.str),C(this,fr,b0).call(this,r)}},b0=function(t){var y;const e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};h(this,Oa).push(e);const n=Et.transform(h(this,Lu),t.transform);let s=Math.atan2(n[1],n[0]);const r=h(this,fl)[t.fontName];r.vertical&&(s+=Math.PI/2);let a=h(this,Tu)&&r.fontSubstitution||r.fontFamily;a=Ue.fontFamilyMap.get(a)||a;const l=Math.hypot(n[2],n[3]),u=l*C(y=Ue,on,w0).call(y,a,h(this,Pa));let c,d;s===0?(c=n[4],d=n[5]-u):(c=n[4]+u*Math.sin(s),d=n[5]-u*Math.cos(s));const f="calc(var(--scale-factor)*",p=e.style;h(this,zi)===h(this,cl)?(p.left=`${(100*c/h(this,ku)).toFixed(2)}%`,p.top=`${(100*d/h(this,Du)).toFixed(2)}%`):(p.left=`${f}${c.toFixed(2)}px)`,p.top=`${f}${d.toFixed(2)}px)`),p.fontSize=`${f}${(h(Ue,Pr)*l).toFixed(2)}px)`,p.fontFamily=a,i.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,h(this,Tu)&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),s!==0&&(i.angle=s*(180/Math.PI));let b=!1;if(t.str.length>1)b=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const g=Math.abs(t.transform[0]),m=Math.abs(t.transform[3]);g!==m&&Math.max(g,m)/Math.min(g,m)>1.5&&(b=!0)}if(b&&(i.canvasWidth=r.vertical?t.height:t.width),h(this,Iu).set(e,i),h(this,Hs).div=e,h(this,Hs).properties=i,C(this,fr,kp).call(this,h(this,Hs)),i.hasText&&h(this,zi).append(e),i.hasEOL){const g=document.createElement("br");g.setAttribute("role","presentation"),h(this,zi).append(g)}},kp=function(t){var a;const{div:e,properties:i,ctx:n}=t,{style:s}=e;let r="";if(h(Ue,Pr)>1&&(r=`scale(${1/h(Ue,Pr)})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:l}=s,{canvasWidth:u,fontSize:c}=i;C(a=Ue,on,Rp).call(a,n,c*h(this,Lr),l);const{width:d}=n.measureText(e.textContent);d>0&&(r=`scaleX(${u*h(this,Lr)/d}) ${r}`)}i.angle!==0&&(r=`rotate(${i.angle}deg) ${r}`),r.length>0&&(s.transform=r)},on=new WeakSet,qc=function(t=null){let e=h(this,Ma).get(t||(t=""));if(!e){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),h(this,Ma).set(t,e),h(this,Pu).set(e,{size:0,family:""})}return e},Rp=function(t,e,i){const n=h(this,Pu).get(t);e===n.size&&i===n.family||(t.font=`${e}px ${i}`,n.size=e,n.family=i)},y0=function(){if(h(this,Pr)!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),_(this,Pr,t.getBoundingClientRect().height),t.remove()},w0=function(t,e){const i=h(this,Fa).get(t);if(i)return i;const n=C(this,on,qc).call(this,e);n.canvas.width=n.canvas.height=Oi,C(this,on,Rp).call(this,n,Oi,t);const s=n.measureText("");let r=s.fontBoundingBoxAscent,a=Math.abs(s.fontBoundingBoxDescent);if(r){const c=r/(r+a);return h(this,Fa).set(t,c),n.canvas.width=n.canvas.height=0,c}n.strokeStyle="red",n.clearRect(0,0,Oi,Oi),n.strokeText("g",0,0);let l=n.getImageData(0,0,Oi,Oi).data;a=0;for(let c=l.length-1-3;c>=0;c-=4)if(l[c]>0){a=Math.ceil(c/4/Oi);break}n.clearRect(0,0,Oi,Oi),n.strokeText("A",0,Oi),l=n.getImageData(0,0,Oi,Oi).data,r=0;for(let c=0,d=l.length;c<d;c+=4)if(l[c]>0){r=Oi-Math.floor(c/4/Oi);break}n.canvas.width=n.canvas.height=0;const u=r?r/(r+a):r2;return h(this,Fa).set(t,u),u},x(Ue,on),x(Ue,Fa,new Map),x(Ue,Ma,new Map),x(Ue,Pu,new WeakMap),x(Ue,Pr,null),x(Ue,gl,new Set);let Fh=Ue;class Mh{static textContent(t){const e=[],i={items:e,styles:Object.create(null)};function n(s){var l;if(!s)return;let r=null;const a=s.name;if(a==="#text")r=s.value;else if(Mh.shouldBuildText(a))(l=s==null?void 0:s.attributes)!=null&&l.textContent?r=s.attributes.textContent:s.value&&(r=s.value);else return;if(r!==null&&e.push({str:r}),!!s.children)for(const u of s.children)n(u)}return n(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const a2=65536,o2=100,l2=5e3,h2=bi?Ew:ww,u2=bi?xw:r0,c2=bi?Aw:_w,d2=bi?Sw:h0;function f2(o={}){typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o});const t=new Ip,{docId:e}=t,i=o.url?p2(o.url):null,n=o.data?g2(o.data):null,s=o.httpHeaders||null,r=o.withCredentials===!0,a=o.password??null,l=o.range instanceof _0?o.range:null,u=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:a2;let c=o.worker instanceof Wo?o.worker:null;const d=o.verbosity,f=typeof o.docBaseUrl=="string"&&!df(o.docBaseUrl)?o.docBaseUrl:null,p=typeof o.cMapUrl=="string"?o.cMapUrl:null,b=o.cMapPacked!==!1,y=o.CMapReaderFactory||u2,g=typeof o.standardFontDataUrl=="string"?o.standardFontDataUrl:null,m=o.StandardFontDataFactory||d2,w=o.stopAtErrors!==!0,E=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,R=o.isEvalSupported!==!1,A=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!bi,T=typeof o.isImageDecoderSupported=="boolean"?o.isImageDecoderSupported:!bi&&(Di.platform.isFirefox||!globalThis.chrome),k=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,P=typeof o.disableFontFace=="boolean"?o.disableFontFace:bi,F=o.fontExtraProperties===!0,B=o.enableXfa===!0,W=o.ownerDocument||globalThis.document,G=o.disableRange===!0,et=o.disableStream===!0,ot=o.disableAutoFetch===!0,ct=o.pdfBug===!0,X=o.CanvasFactory||h2,K=o.FilterFactory||c2,lt=o.enableHWA===!0,Ct=l?l.length:o.length??NaN,xt=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!bi&&!P,_t=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:y===r0&&m===h0&&p&&g&&fh(p,document.baseURI)&&fh(g,document.baseURI),at=null;Qy(d);const At={canvasFactory:new X({ownerDocument:W,enableHWA:lt}),filterFactory:new K({docId:e,ownerDocument:W}),cMapReaderFactory:_t?null:new y({baseUrl:p,isCompressed:b}),standardFontDataFactory:_t?null:new m({baseUrl:g})};if(!c){const Ft={verbosity:d,port:nr.workerPort};c=Ft.port?Wo.fromPort(Ft):new Wo(Ft),t._worker=c}const Rt={docId:e,apiVersion:"4.10.38",data:n,password:a,disableAutoFetch:ot,rangeChunkSize:u,length:Ct,docBaseUrl:f,enableXfa:B,evaluatorOptions:{maxImageSize:E,disableFontFace:P,ignoreErrors:w,isEvalSupported:R,isOffscreenCanvasSupported:A,isImageDecoderSupported:T,canvasMaxAreaInBytes:k,fontExtraProperties:F,useSystemFonts:xt,cMapUrl:_t?p:null,standardFontDataUrl:_t?g:null}},Wt={disableFontFace:P,fontExtraProperties:F,ownerDocument:W,pdfBug:ct,styleElement:at,loadingParams:{disableAutoFetch:ot,enableXfa:B}};return c.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Ft=c.messageHandler.sendWithPromise("GetDocRequest",Rt,n?[n.buffer]:null);let St;if(l)St=new jw(l,{disableRange:G,disableStream:et});else if(!n){if(!i)throw new Error("getDocument - no `url` parameter provided.");let Lt;if(bi)if(fh(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Lt=Rm}else Lt=e2;else Lt=fh(i)?Rm:Kw;St=new Lt({url:i,length:Ct,httpHeaders:s,withCredentials:r,rangeChunkSize:u,disableRange:G,disableStream:et})}return Ft.then(Lt=>{if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const _e=new vh(e,Lt,c.port),de=new y2(_e,t,St,Wt,At);t._transport=de,_e.send("Ready",null)})}).catch(t._capability.reject),t}function p2(o){if(o instanceof URL)return o.href;try{return new URL(o,window.location).href}catch{if(bi&&typeof o=="string")return o}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function g2(o){if(bi&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return uf(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o==null?void 0:o.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Im(o){return typeof o=="object"&&Number.isInteger(o==null?void 0:o.num)&&o.num>=0&&Number.isInteger(o==null?void 0:o.gen)&&o.gen>=0}var Yd;const Kd=class Kd{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Ai(Kd,Yd)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var t,e,i,n;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(s){throw(i=this._worker)!=null&&i.port&&delete this._worker._pendingDestroy,s}this._transport=null,(n=this._worker)==null||n.destroy(),this._worker=null}};Yd=new WeakMap,x(Kd,Yd,0);let Ip=Kd;class _0{constructor(t,e,i=!1,n=null){this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=n,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const i of this._rangeListeners)i(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(const i of this._progressListeners)i(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){le("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class m2{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Ht(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Nr,js,yn,Po,Vc;class v2{constructor(t,e,i,n=!1){x(this,yn);x(this,Nr,null);x(this,js,!1);this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=n?new vm:null,this._pdfBug=n,this.commonObjs=i.commonObjs,this.objs=new A0,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:n=0,dontFlip:s=!1}={}){return new mc({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:n,dontFlip:s})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Ht(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:e,intent:i="display",annotationMode:n=vr.ENABLE,transform:s=null,background:r=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:u=null,printAnnotationStorage:c=null,isEditing:d=!1}){var R,A;(R=this._stats)==null||R.time("Overall");const f=this._transport.getRenderingIntent(i,n,c,d),{renderingIntent:p,cacheKey:b}=f;_(this,js,!1),C(this,yn,Vc).call(this),a||(a=this._transport.getOptionalContentConfig(p));let y=this._intentStates.get(b);y||(y=Object.create(null),this._intentStates.set(b,y)),y.streamReaderCancelTimeout&&(clearTimeout(y.streamReaderCancelTimeout),y.streamReaderCancelTimeout=null);const g=!!(p&sn.PRINT);y.displayReadyCapability||(y.displayReadyCapability=Promise.withResolvers(),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(A=this._stats)==null||A.time("Page Request"),this._pumpOperatorList(f));const m=T=>{var k;y.renderTasks.delete(w),(this._maybeCleanupAfterRender||g)&&_(this,js,!0),C(this,yn,Po).call(this,!g),T?(w.capability.reject(T),this._abortOperatorList({intentState:y,reason:T instanceof Error?T:new Error(T)})):w.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(k=globalThis.Stats)!=null&&k.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},w=new Pp({callback:m,params:{canvasContext:t,viewport:e,transform:s,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!g,pdfBug:this._pdfBug,pageColors:u});(y.renderTasks||(y.renderTasks=new Set)).add(w);const E=w.task;return Promise.all([y.displayReadyCapability.promise,a]).then(([T,k])=>{var P;if(this.destroyed){m();return}if((P=this._stats)==null||P.time("Rendering"),!(k.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");w.initializeGraphics({transparency:T,optionalContentConfig:k}),w.operatorListChanged()}).catch(m),E}getOperatorList({intent:t="display",annotationMode:e=vr.ENABLE,printAnnotationStorage:i=null,isEditing:n=!1}={}){var u;function s(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(t,e,i,n,!0);let a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=s,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(n){return n.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>Mh.textContent(i));const e=this.streamTextContent(t);return new Promise(function(i,n){function s(){r.read().then(function({value:l,done:u}){if(u){i(a);return}a.lang??(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),s()},n)}const r=e.getReader(),a={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),_(this,js,!1),C(this,yn,Vc).call(this),Promise.all(t)}cleanup(t=!1){_(this,js,!0);const e=C(this,yn,Po).call(this,!1);return t&&e&&this._stats&&(this._stats=new vm),e}_startRenderPage(t,e){var n,s;const i=this._intentStates.get(e);i&&((n=this._stats)==null||n.timeEnd("Page Request"),(s=i.displayReadyCapability)==null||s.resolve(t))}_renderPageChunk(t,e){for(let i=0,n=t.length;i<n;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const i of e.renderTasks)i.operatorListChanged();t.lastChunk&&C(this,yn,Po).call(this,!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:n}){const{map:s,transfer:r}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:s,modifiedIds:n},r).getReader(),u=this._intentStates.get(e);u.streamReader=l;const c=()=>{l.read().then(({value:d,done:f})=>{if(f){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,u),c())},d=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const f of u.renderTasks)f.operatorListChanged();C(this,yn,Po).call(this,!0)}if(u.displayReadyCapability)u.displayReadyCapability.reject(d);else if(u.opListReadCapability)u.opListReadCapability.reject(d);else throw d}})};c()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof Dg){let n=o2;e.extraDelay>0&&e.extraDelay<1e3&&(n+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},n);return}}if(t.streamReader.cancel(new Qr(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[n,s]of this._intentStates)if(s===t){this._intentStates.delete(n);break}this.cleanup()}}}get stats(){return this._stats}}Nr=new WeakMap,js=new WeakMap,yn=new WeakSet,Po=function(t=!1){if(C(this,yn,Vc).call(this),!h(this,js)||this.destroyed)return!1;if(t)return _(this,Nr,setTimeout(()=>{_(this,Nr,null),C(this,yn,Po).call(this,!1)},l2)),!1;for(const{renderTasks:e,operatorList:i}of this._intentStates.values())if(e.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),_(this,js,!1),!0},Vc=function(){h(this,Nr)&&(clearTimeout(h(this,Nr)),_(this,Nr,null))};var Ws,Zd;class b2{constructor(){x(this,Ws,new Map);x(this,Zd,Promise.resolve())}postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};h(this,Zd).then(()=>{for(const[n]of h(this,Ws))n.call(this,i)})}addEventListener(t,e,i=null){let n=null;if((i==null?void 0:i.signal)instanceof AbortSignal){const{signal:s}=i;if(s.aborted){Ot("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);n=()=>s.removeEventListener("abort",r),s.addEventListener("abort",r)}h(this,Ws).set(e,n)}removeEventListener(t,e){const i=h(this,Ws).get(e);i==null||i(),h(this,Ws).delete(e)}terminate(){for(const[,t]of h(this,Ws))t==null||t();h(this,Ws).clear()}}Ws=new WeakMap,Zd=new WeakMap;var Qd,Ba,za,ml,Gc,vl,$c;const ge=class ge{constructor({name:t=null,port:e=null,verbosity:i=Jy()}={}){x(this,ml);var n;if(this.name=t,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if((n=h(ge,za))!=null&&n.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(h(ge,za)||_(ge,za,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new vh("main","worker",t),this._messageHandler.on("ready",function(){}),C(this,ml,Gc).call(this)}_initialize(){if(h(ge,Ba)||h(ge,vl,$c)){this._setupFakeWorker();return}let{workerSrc:t}=ge;try{ge._isSameOrigin(window.location.href,t)||(t=ge._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),i=new vh("main","worker",e),n=()=>{s.abort(),i.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},s=new AbortController;e.addEventListener("error",()=>{this._webWorker||n()},{signal:s.signal}),i.on("test",a=>{if(s.abort(),this.destroyed||!a){n();return}this._messageHandler=i,this._port=e,this._webWorker=e,C(this,ml,Gc).call(this)}),i.on("ready",a=>{if(s.abort(),this.destroyed){n();return}try{r()}catch{this._setupFakeWorker()}});const r=()=>{const a=new Uint8Array;i.send("test",a,[a.buffer])};r();return}catch{hf("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){h(ge,Ba)||(Ot("Setting up fake worker."),_(ge,Ba,!0)),ge._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new b2;this._port=e;const i=`fake${Ai(ge,Qd)._++}`,n=new vh(i+"_worker",i,e);t.setup(n,e),this._messageHandler=new vh(i,i+"_worker",e),C(this,ml,Gc).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){var t,e,i;this.destroyed=!0,(t=this._webWorker)==null||t.terminate(),this._webWorker=null,(e=h(ge,za))==null||e.delete(this._port),this._port=null,(i=this._messageHandler)==null||i.destroy(),this._messageHandler=null}static fromPort(t){var i;if(!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const e=(i=h(this,za))==null?void 0:i.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new ge(t)}static get workerSrc(){if(nr.workerSrc)return nr.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Ht(this,"_setupFakeWorkerGlobal",(async()=>h(this,vl,$c)?h(this,vl,$c):(await import(this.workerSrc)).WorkerMessageHandler)())}};Qd=new WeakMap,Ba=new WeakMap,za=new WeakMap,ml=new WeakSet,Gc=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},vl=new WeakSet,$c=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}},x(ge,vl),x(ge,Qd,0),x(ge,Ba,!1),x(ge,za),bi&&(_(ge,Ba,!0),nr.workerSrc||(nr.workerSrc="./pdf.worker.mjs")),ge._isSameOrigin=(t,e)=>{let i;try{if(i=new URL(t),!i.origin||i.origin==="null")return!1}catch{return!1}const n=new URL(e,i);return i.origin===n.origin},ge._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};let Wo=ge;var qs,cs,bl,yl,Vs,Ua,Ah;class y2{constructor(t,e,i,n,s){x(this,Ua);x(this,qs,new Map);x(this,cs,new Map);x(this,bl,new Map);x(this,yl,new Map);x(this,Vs,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new A0,this.fontLoader=new bw({ownerDocument:n.ownerDocument,styleElement:n.styleElement}),this.loadingParams=n.loadingParams,this._params=n,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Ht(this,"annotationStorage",new Lg)}getRenderingIntent(t,e=vr.ENABLE,i=null,n=!1,s=!1){let r=sn.DISPLAY,a=wp;switch(t){case"any":r=sn.ANY;break;case"display":break;case"print":r=sn.PRINT;break;default:Ot(`getRenderingIntent - invalid intent: ${t}`)}const l=r&sn.PRINT&&i instanceof Jv?i:this.annotationStorage;switch(e){case vr.DISABLE:r+=sn.ANNOTATIONS_DISABLE;break;case vr.ENABLE:break;case vr.ENABLE_FORMS:r+=sn.ANNOTATIONS_FORMS;break;case vr.ENABLE_STORAGE:r+=sn.ANNOTATIONS_STORAGE,a=l.serializable;break;default:Ot(`getRenderingIntent - invalid annotationMode: ${e}`)}n&&(r+=sn.IS_EDITING),s&&(r+=sn.OPLIST);const{ids:u,hash:c}=l.modifiedIds,d=[r,a.hash,c];return{renderingIntent:r,cacheKey:d.join("_"),annotationStorageSerializable:a,modifiedIds:u}}destroy(){var i;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(i=h(this,Vs))==null||i.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of h(this,cs).values())t.push(n._destroy());h(this,cs).clear(),h(this,bl).clear(),h(this,yl).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var n,s;this.commonObjs.clear(),this.fontLoader.clear(),h(this,qs).clear(),this.filterFactory.destroy(),Fh.cleanup(),(n=this._networkStream)==null||n.cancelAllRequests(new Qr("Worker was terminated.")),(s=this.messageHandler)==null||s.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,n)=>{Ne(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},n.onPull=()=>{this._fullReader.read().then(function({value:s,done:r}){if(r){n.close();return}Ne(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{n.error(s)})},n.onCancel=s=>{this._fullReader.cancel(s),n.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async i=>{var a;await this._fullReader.headersReady;const{isStreamingSupported:n,isRangeSupported:s,contentLength:r}=this._fullReader;return(!n||!s)&&(this._lastProgress&&((a=e.onProgress)==null||a.call(e,this._lastProgress)),this._fullReader.onProgress=l=>{var u;(u=e.onProgress)==null||u.call(e,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:n,isRangeSupported:s,contentLength:r}}),t.on("GetRangeReader",(i,n)=>{Ne(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(i.begin,i.end);if(!s){n.close();return}n.onPull=()=>{s.read().then(function({value:r,done:a}){if(a){n.close();return}Ne(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{n.error(r)})},n.onCancel=r=>{s.cancel(r),n.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new m2(i,this))}),t.on("DocException",i=>{e._capability.reject(Fi(i))}),t.on("PasswordRequest",i=>{_(this,Vs,Promise.withResolvers());try{if(!e.onPassword)throw Fi(i);const n=s=>{s instanceof Error?h(this,Vs).reject(s):h(this,Vs).resolve({password:s})};e.onPassword(n,i.code)}catch(n){h(this,Vs).reject(n)}return h(this,Vs).promise}),t.on("DataLoaded",i=>{var n;(n=e.onProgress)==null||n.call(e,{loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;h(this,cs).get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,n,s])=>{var r;if(this.destroyed||this.commonObjs.has(i))return null;switch(n){case"Font":const{disableFontFace:a,fontExtraProperties:l,pdfBug:u}=this._params;if("error"in s){const p=s.error;Ot(`Error during font loading: ${p}`),this.commonObjs.resolve(i,p);break}const c=u&&((r=globalThis.FontInspector)!=null&&r.enabled)?(p,b)=>globalThis.FontInspector.fontAdded(p,b):null,d=new yw(s,{disableFontFace:a,fontExtraProperties:l,inspectFont:c});this.fontLoader.bind(d).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!l&&d.data&&(d.data=null),this.commonObjs.resolve(i,d)});break;case"CopyLocalImage":const{imageRef:f}=s;Ne(f,"The imageRef must be defined.");for(const p of h(this,cs).values())for(const[,b]of p.objs)if((b==null?void 0:b.ref)===f)return b.dataLen?(this.commonObjs.resolve(i,structuredClone(b)),b.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,s);break;default:throw new Error(`Got unknown common object type ${n}`)}return null}),t.on("obj",([i,n,s,r])=>{var l;if(this.destroyed)return;const a=h(this,cs).get(n);if(!a.objs.has(i)){if(a._intentStates.size===0){(l=r==null?void 0:r.bitmap)==null||l.close();return}switch(s){case"Image":a.objs.resolve(i,r),(r==null?void 0:r.dataLen)>Xy&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(i,r);break;default:throw new Error(`Got unknown object type ${s}`)}}}),t.on("DocProgress",i=>{var n;this.destroyed||(n=e.onProgress)==null||n.call(e,{loaded:i.loaded,total:i.total})}),t.on("FetchBuiltInCMap",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)}),t.on("FetchStandardFontData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var i;this.annotationStorage.size<=0&&Ot("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:((i=this._fullReader)==null?void 0:i.filename)??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=h(this,bl).get(e);if(i)return i;const n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&h(this,yl).set(s.refStr,t);const r=new v2(e,s,this,this._params.pdfBug);return h(this,cs).set(e,r),r});return h(this,bl).set(e,n),n}getPageIndex(t){return Im(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return C(this,Ua,Ah).call(this,"GetFieldObjects")}hasJSActions(){return C(this,Ua,Ah).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return C(this,Ua,Ah).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return C(this,Ua,Ah).call(this,"GetOptionalContentConfig").then(e=>new Hw(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=h(this,qs).get(t);if(e)return e;const i=this.messageHandler.sendWithPromise(t,null).then(n=>{var s,r;return{info:n[0],metadata:n[1]?new zw(n[1]):null,contentDispositionFilename:((s=this._fullReader)==null?void 0:s.filename)??null,contentLength:((r=this._fullReader)==null?void 0:r.contentLength)??null}});return h(this,qs).set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of h(this,cs).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),h(this,qs).clear(),this.filterFactory.destroy(!0),Fh.cleanup()}}cachedPageNumber(t){if(!Im(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return h(this,yl).get(e)??null}}qs=new WeakMap,cs=new WeakMap,bl=new WeakMap,yl=new WeakMap,Vs=new WeakMap,Ua=new WeakSet,Ah=function(t,e=null){const i=h(this,qs).get(t);if(i)return i;const n=this.messageHandler.sendWithPromise(t,e);return h(this,qs).set(t,n),n};const ah=Symbol("INITIAL_DATA");var Xi,Nu,Lp;class A0{constructor(){x(this,Nu);x(this,Xi,Object.create(null))}get(t,e=null){if(e){const n=C(this,Nu,Lp).call(this,t);return n.promise.then(()=>e(n.data)),null}const i=h(this,Xi)[t];if(!i||i.data===ah)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){const e=h(this,Xi)[t];return!!e&&e.data!==ah}delete(t){const e=h(this,Xi)[t];return!e||e.data===ah?!1:(delete h(this,Xi)[t],!0)}resolve(t,e=null){const i=C(this,Nu,Lp).call(this,t);i.data=e,i.resolve()}clear(){var t;for(const e in h(this,Xi)){const{data:i}=h(this,Xi)[e];(t=i==null?void 0:i.bitmap)==null||t.close()}_(this,Xi,Object.create(null))}*[Symbol.iterator](){for(const t in h(this,Xi)){const{data:e}=h(this,Xi)[t];e!==ah&&(yield[t,e])}}}Xi=new WeakMap,Nu=new WeakSet,Lp=function(t){var e;return(e=h(this,Xi))[t]||(e[t]={...Promise.withResolvers(),data:ah})};var Or;class w2{constructor(t){x(this,Or,null);_(this,Or,t),this.onContinue=null}get promise(){return h(this,Or).capability.promise}cancel(t=0){h(this,Or).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=h(this,Or).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=h(this,Or);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}Or=new WeakMap;var Fr,Ha;const la=class la{constructor({callback:t,params:e,objs:i,commonObjs:n,annotationCanvasMap:s,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:u,useRequestAnimationFrame:c=!1,pdfBug:d=!1,pageColors:f=null}){x(this,Fr,null);this.callback=t,this.params=e,this.objs=i,this.commonObjs=n,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=u,this._pdfBug=d,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new w2(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var a,l;if(this.cancelled)return;if(this._canvas){if(h(la,Ha).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");h(la,Ha).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:n,transform:s,background:r}=this.params;this.gfx=new jo(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:n,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(t=null,e=0){var i;this.running=!1,this.cancelled=!0,(i=this.gfx)==null||i.endDrawing(),h(this,Fr)&&(window.cancelAnimationFrame(h(this,Fr)),_(this,Fr,null)),h(la,Ha).delete(this._canvas),this.callback(t||new Dg(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?_(this,Fr,window.requestAnimationFrame(()=>{_(this,Fr,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),h(la,Ha).delete(this._canvas),this.callback())))}};Fr=new WeakMap,Ha=new WeakMap,x(la,Ha,new WeakSet);let Pp=la;const _2="4.10.38",A2="f9bea397f";function Lm(o){return Math.floor(Math.max(0,Math.min(1,o))*255).toString(16).padStart(2,"0")}function oh(o){return Math.max(0,Math.min(255,255*o))}class Pm{static CMYK_G([t,e,i,n]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+n)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=oh(t),[t,t,t]}static G_HTML([t]){const e=Lm(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(oh)}static RGB_HTML(t){return`#${t.map(Lm).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,n]){return["RGB",1-Math.min(1,t+n),1-Math.min(1,i+n),1-Math.min(1,e+n)]}static CMYK_rgb([t,e,i,n]){return[oh(1-Math.min(1,t+n)),oh(1-Math.min(1,i+n)),oh(1-Math.min(1,e+n))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){const n=1-t,s=1-e,r=1-i,a=Math.min(n,s,r);return["CMYK",n,s,r,a]}}class E2{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),i||(n.setAttribute("width",`${t}px`),n.setAttribute("height",`${e}px`)),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox",`0 0 ${t} ${e}`),n}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){le("Abstract method `_createSVG` called.")}}class Ng extends E2{_createSVG(t){return document.createElementNS(Ts,t)}}class E0{static setupStorage(t,e,i,n,s){const r=n.getValue(e,{value:null});switch(i.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),s==="print")break;t.addEventListener("input",a=>{n.setValue(e,{value:a.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(r.value===i.attributes.xfaOn?t.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&t.removeAttribute("checked"),s==="print")break;t.addEventListener("change",a=>{n.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),s==="print")break;t.addEventListener("input",a=>{n.setValue(e,{value:a.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const a of i.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const l=a.target.options,u=l.selectedIndex===-1?"":l[l.selectedIndex].value;n.setValue(e,{value:u})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:n,linkService:s}){const{attributes:r}=e,a=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${n}`);for(const[l,u]of Object.entries(r))if(u!=null)switch(l){case"class":u.length&&t.setAttribute(l,u.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",u);break;case"style":Object.assign(t.style,u);break;case"textContent":t.textContent=u;break;default:(!a||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,u)}a&&s.addLinkAttributes(t,r.href,r.newWindow),i&&r.dataId&&this.setupStorage(t,r.dataId,e,i)}static render(t){var d,f;const e=t.annotationStorage,i=t.linkService,n=t.xfaHtml,s=t.intent||"display",r=document.createElement(n.name);n.attributes&&this.setAttributes({html:r,element:n,intent:s,linkService:i});const a=s!=="richText",l=t.div;if(l.append(r),t.viewport){const p=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=p}a&&l.setAttribute("class","xfaLayer xfaFont");const u=[];if(n.children.length===0){if(n.value){const p=document.createTextNode(n.value);r.append(p),a&&Mh.shouldBuildText(n.name)&&u.push(p)}return{textDivs:u}}const c=[[n,-1,r]];for(;c.length>0;){const[p,b,y]=c.at(-1);if(b+1===p.children.length){c.pop();continue}const g=p.children[++c.at(-1)[1]];if(g===null)continue;const{name:m}=g;if(m==="#text"){const E=document.createTextNode(g.value);u.push(E),y.append(E);continue}const w=(d=g==null?void 0:g.attributes)!=null&&d.xmlns?document.createElementNS(g.attributes.xmlns,m):document.createElement(m);if(y.append(w),g.attributes&&this.setAttributes({html:w,element:g,storage:e,intent:s,linkService:i}),((f=g.children)==null?void 0:f.length)>0)c.push([g,-1,w]);else if(g.value){const E=document.createTextNode(g.value);a&&Mh.shouldBuildText(m)&&u.push(E),w.append(E)}}for(const p of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:u}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const bc=1e3,x2=9,mo=new WeakSet;function Kr(o){return{width:o[2]-o[0],height:o[3]-o[1]}}class S2{static create(t){switch(t.data.annotationType){case ze.LINK:return new x0(t);case ze.TEXT:return new C2(t);case ze.WIDGET:switch(t.data.fieldType){case"Tx":return new T2(t);case"Btn":return t.data.radioButton?new T0(t):t.data.checkBox?new k2(t):new R2(t);case"Ch":return new I2(t);case"Sig":return new D2(t)}return new yo(t);case ze.POPUP:return new Op(t);case ze.FREETEXT:return new L0(t);case ze.LINE:return new P2(t);case ze.SQUARE:return new N2(t);case ze.CIRCLE:return new O2(t);case ze.POLYLINE:return new P0(t);case ze.CARET:return new M2(t);case ze.INK:return new Og(t);case ze.POLYGON:return new F2(t);case ze.HIGHLIGHT:return new N0(t);case ze.UNDERLINE:return new B2(t);case ze.SQUIGGLY:return new z2(t);case ze.STRIKEOUT:return new U2(t);case ze.STAMP:return new O0(t);case ze.FILEATTACHMENT:return new H2(t);default:return new Ie(t)}}}var ja,wl,_l,Ou,Np;const lm=class lm{constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:n=!1}={}){x(this,Ou);x(this,ja,null);x(this,wl,!1);x(this,_l,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),n&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:i}){return!!(t!=null&&t.str||e!=null&&e.str||i!=null&&i.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return lm._hasPopupData(this.data)}updateEdited(t){var i;if(!this.container)return;h(this,ja)||_(this,ja,{rect:this.data.rect.slice(0)});const{rect:e}=t;e&&C(this,Ou,Np).call(this,e),(i=h(this,_l))==null||i.popup.updateEdited(t)}resetEdited(){var t;h(this,ja)&&(C(this,Ou,Np).call(this,h(this,ja).rect),(t=h(this,_l))==null||t.popup.resetEdited(),_(this,ja,null))}_createContainer(t){const{data:e,parent:{page:i,viewport:n}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",e.id),this instanceof yo||(s.tabIndex=bc);const{style:r}=s;if(r.zIndex=this.parent.zIndex++,e.alternativeText&&(s.title=e.alternativeText),e.noRotate&&s.classList.add("norotate"),!e.rect||this instanceof Op){const{rotation:y}=e;return!e.hasOwnCanvas&&y!==0&&this.setRotation(y,s),s}const{width:a,height:l}=Kr(e.rect);if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const y=e.borderStyle.horizontalCornerRadius,g=e.borderStyle.verticalCornerRadius;if(y>0||g>0){const w=`calc(${y}px * var(--scale-factor)) / calc(${g}px * var(--scale-factor))`;r.borderRadius=w}else if(this instanceof T0){const w=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;r.borderRadius=w}switch(e.borderStyle.style){case sh.SOLID:r.borderStyle="solid";break;case sh.DASHED:r.borderStyle="dashed";break;case sh.BEVELED:Ot("Unimplemented border style: beveled");break;case sh.INSET:Ot("Unimplemented border style: inset");break;case sh.UNDERLINE:r.borderBottomStyle="solid";break}const m=e.borderColor||null;m?(_(this,wl,!0),r.borderColor=Et.makeHexColor(m[0]|0,m[1]|0,m[2]|0)):r.borderWidth=0}const u=Et.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:c,pageHeight:d,pageX:f,pageY:p}=n.rawDims;r.left=`${100*(u[0]-f)/c}%`,r.top=`${100*(u[1]-p)/d}%`;const{rotation:b}=e;return e.hasOwnCanvas||b===0?(r.width=`${100*a/c}%`,r.height=`${100*l/d}%`):this.setRotation(b,s),s}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:n}=this.parent.viewport.rawDims,{width:s,height:r}=Kr(this.data.rect);let a,l;t%180===0?(a=100*s/i,l=100*r/n):(a=100*r/i,l=100*s/n),e.style.width=`${a}%`,e.style.height=`${l}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,i,n)=>{const s=n.detail[e],r=s[0],a=s.slice(1);n.target.style[i]=Pm[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[i]:Pm[`${r}_rgb`](a)})};return Ht(this,"_commonActions",{display:e=>{const{display:i}=e.detail,n=i%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){const i=this._commonActions;for(const n of Object.keys(e.detail)){const s=t[n]||i[n];s==null||s(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const i=this._commonActions;for(const[n,s]of Object.entries(e)){const r=i[n];if(r){const a={detail:{[n]:s},target:t};r(a),delete e[n]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,i,n,s]=this.data.rect.map(y=>Math.fround(y));if(t.length===8){const[y,g,m,w]=t.subarray(2,6);if(n===y&&s===g&&e===m&&i===w)return}const{style:r}=this.container;let a;if(h(this,wl)){const{borderColor:y,borderWidth:g}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${y}" stroke-width="${g}">`],this.container.classList.add("hasBorder")}const l=n-e,u=s-i,{svgFactory:c}=this,d=c.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);const f=c.createElement("defs");d.append(f);const p=c.createElement("clipPath"),b=`clippath_${this.data.id}`;p.setAttribute("id",b),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let y=2,g=t.length;y<g;y+=8){const m=t[y],w=t[y+1],E=t[y+2],R=t[y+3],A=c.createElement("rect"),T=(E-e)/l,k=(s-w)/u,P=(m-E)/l,F=(w-R)/u;A.setAttribute("x",T),A.setAttribute("y",k),A.setAttribute("width",P),A.setAttribute("height",F),p.append(A),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${T}" y="${k}" width="${P}" height="${F}"/>`)}h(this,wl)&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(d),this.container.style.clipPath=`url(#${b})`}_createPopup(){const{data:t}=this,e=_(this,_l,new Op({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(e.render())}render(){le("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const i=[];if(this._fieldObjects){const n=this._fieldObjects[t];if(n)for(const{page:s,id:r,exportValues:a}of n){if(s===-1||r===e)continue;const l=typeof a=="string"?a:null,u=document.querySelector(`[data-element-id="${r}"]`);if(u&&!mo.has(u)){Ot(`_getElementsByName - element not allowed: ${r}`);continue}i.push({id:r,exportValue:l,domElement:u})}return i}for(const n of document.getElementsByName(t)){const{exportValue:s}=n,r=n.getAttribute("data-element-id");r!==e&&mo.has(n)&&i.push({id:r,exportValue:s,domElement:n})}return i}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var i;(i=this.linkService.eventBus)==null||i.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}};ja=new WeakMap,wl=new WeakMap,_l=new WeakMap,Ou=new WeakSet,Np=function(t){const{container:{style:e},data:{rect:i,rotation:n},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:r,pageX:a,pageY:l}}}}=this;i==null||i.splice(0,4,...t);const{width:u,height:c}=Kr(t);e.left=`${100*(t[0]-a)/s}%`,e.top=`${100*(r-t[3]+l)/r}%`,n===0?(e.width=`${100*u/s}%`,e.height=`${100*c/r}%`):this.setRotation(n)};let Ie=lm;var rn,sa,S0,C0;class x0 extends Ie{constructor(e,i=null){super(e,{isRenderable:!0,ignoreBorder:!!(i!=null&&i.ignoreBorder),createQuadrilaterals:!0});x(this,rn);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:i}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let s=!1;return e.url?(i.addLinkAttributes(n,e.url,e.newWindow),s=!0):e.action?(this._bindNamedAction(n,e.action),s=!0):e.attachment?(C(this,rn,S0).call(this,n,e.attachment,e.attachmentDest),s=!0):e.setOCGState?(C(this,rn,C0).call(this,n,e.setOCGState),s=!0):e.dest?(this._bindLink(n,e.dest),s=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),s=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(n,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(n),this.container}_bindLink(e,i){e.href=this.linkService.getDestinationHash(i),e.onclick=()=>(i&&this.linkService.goToDestination(i),!1),(i||i==="")&&C(this,rn,sa).call(this)}_bindNamedAction(e,i){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(i),!1),C(this,rn,sa).call(this)}_bindJSAction(e,i){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(i.actions)){const r=n.get(s);r&&(e[r]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i.id,name:s}}),!1})}e.onclick||(e.onclick=()=>!1),C(this,rn,sa).call(this)}_bindResetFormAction(e,i){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),C(this,rn,sa).call(this),!this._fieldObjects){Ot('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(e.onclick=()=>!1);return}e.onclick=()=>{var d;n==null||n();const{fields:s,refs:r,include:a}=i,l=[];if(s.length!==0||r.length!==0){const f=new Set(r);for(const p of s){const b=this._fieldObjects[p]||[];for(const{id:y}of b)f.add(y)}for(const p of Object.values(this._fieldObjects))for(const b of p)f.has(b.id)===a&&l.push(b)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const u=this.annotationStorage,c=[];for(const f of l){const{id:p}=f;switch(c.push(p),f.type){case"text":{const y=f.defaultValue||"";u.setValue(p,{value:y});break}case"checkbox":case"radiobutton":{const y=f.defaultValue===f.exportValues;u.setValue(p,{value:y});break}case"combobox":case"listbox":{const y=f.defaultValue||"";u.setValue(p,{value:y});break}default:continue}const b=document.querySelector(`[data-element-id="${p}"]`);if(b){if(!mo.has(b)){Ot(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;b.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((d=this.linkService.eventBus)==null||d.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}})),!1}}}rn=new WeakSet,sa=function(){this.container.setAttribute("data-internal-link","")},S0=function(e,i,n=null){e.href=this.linkService.getAnchorUrl(""),i.description&&(e.title=i.description),e.onclick=()=>{var s;return(s=this.downloadManager)==null||s.openOrDownloadData(i.content,i.filename,n),!1},C(this,rn,sa).call(this)},C0=function(e,i){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(i),!1),C(this,rn,sa).call(this)};class C2 extends Ie{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class yo extends Ie{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Di.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,n,s){i.includes("mouse")?t.addEventListener(i,r=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:s(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(i,r=>{var a;if(i==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}s&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:s(r)}}))})}_setEventListeners(t,e,i,n){var s,r,a;for(const[l,u]of i)(u==="Action"||(s=this.data.actions)!=null&&s[u])&&((u==="Focus"||u==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,l,u,n),u==="Focus"&&!((r=this.data.actions)!=null&&r.Blur)?this._setEventListener(t,e,"blur","Blur",null):u==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":Et.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||x2,s=t.style;let r;const a=2,l=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-a),c=Math.round(u/(Df*n))||1,d=u/c;r=Math.min(n,l(d/Df))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(n,l(u/Df))}s.fontSize=`calc(${r}px * var(--scale-factor))`,s.color=Et.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(s.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class T2 extends yo{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,n){const s=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=i),s.setValue(r.id,{[n]:i})}render(){var n,s;const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const r=t.getValue(e,{value:this.data.fieldValue});let a=r.value||"";const l=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let u=r.formattedValue||((n=this.data.textContent)==null?void 0:n.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const c={userValue:a,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=u??a,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",u??a),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),mo.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=bc,this._setRequired(i,this.data.required),l&&(i.maxLength=l),i.addEventListener("input",f=>{t.setValue(e,{value:f.target.value}),this.setPropertyOnSiblings(i,"value",f.target.value,"value"),c.formattedValue=null}),i.addEventListener("resetform",f=>{const p=this.data.defaultFieldValue??"";i.value=c.userValue=p,c.formattedValue=null});let d=f=>{const{formattedValue:p}=c;p!=null&&(f.target.value=p),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",p=>{var y;if(c.focused)return;const{target:b}=p;c.userValue&&(b.value=c.userValue),c.lastCommittedValue=b.value,c.commitKey=1,(y=this.data.actions)!=null&&y.Focus||(c.focused=!0)}),i.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const b={value(y){c.userValue=y.detail.value??"",t.setValue(e,{value:c.userValue.toString()}),y.target.value=c.userValue},formattedValue(y){const{formattedValue:g}=y.detail;c.formattedValue=g,g!=null&&y.target!==document.activeElement&&(y.target.value=g),t.setValue(e,{formattedValue:g})},selRange(y){y.target.setSelectionRange(...y.detail.selRange)},charLimit:y=>{var E;const{charLimit:g}=y.detail,{target:m}=y;if(g===0){m.removeAttribute("maxLength");return}m.setAttribute("maxLength",g);let w=c.userValue;!w||w.length<=g||(w=w.slice(0,g),m.value=c.userValue=w,t.setValue(e,{value:w}),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:1,selStart:m.selectionStart,selEnd:m.selectionEnd}}))}};this._dispatchEventFromSandbox(b,p)}),i.addEventListener("keydown",p=>{var g;c.commitKey=1;let b=-1;if(p.key==="Escape"?b=0:p.key==="Enter"&&!this.data.multiLine?b=2:p.key==="Tab"&&(c.commitKey=3),b===-1)return;const{value:y}=p.target;c.lastCommittedValue!==y&&(c.lastCommittedValue=y,c.userValue=y,(g=this.linkService.eventBus)==null||g.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:y,willCommit:!0,commitKey:b,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const f=d;d=null,i.addEventListener("blur",p=>{var y,g;if(!c.focused||!p.relatedTarget)return;(y=this.data.actions)!=null&&y.Blur||(c.focused=!1);const{value:b}=p.target;c.userValue=b,c.lastCommittedValue!==b&&((g=this.linkService.eventBus)==null||g.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:b,willCommit:!0,commitKey:c.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}})),f(p)}),(s=this.data.actions)!=null&&s.Keystroke&&i.addEventListener("beforeinput",p=>{var A;c.lastCommittedValue=null;const{data:b,target:y}=p,{value:g,selectionStart:m,selectionEnd:w}=y;let E=m,R=w;switch(p.inputType){case"deleteWordBackward":{const T=g.substring(0,m).match(/\w*[^\w]*$/);T&&(E-=T[0].length);break}case"deleteWordForward":{const T=g.substring(m).match(/^[^\w]*\w*/);T&&(R+=T[0].length);break}case"deleteContentBackward":m===w&&(E-=1);break;case"deleteContentForward":m===w&&(R+=1);break}p.preventDefault(),(A=this.linkService.eventBus)==null||A.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:g,change:b||"",willCommit:!1,selStart:E,selEnd:R}})}),this._setEventListeners(i,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(d&&i.addEventListener("blur",d),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/l;i.classList.add("comb"),i.style.letterSpacing=`calc(${p}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class D2 extends yo{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class k2 extends yo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,i=e.id;let n=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof n=="string"&&(n=n!=="Off",t.setValue(i,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return mo.add(s),s.setAttribute("data-element-id",i),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=e.fieldName,n&&s.setAttribute("checked",!0),s.setAttribute("exportValue",e.exportValue),s.tabIndex=bc,s.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const u of this._getElementsByName(a,i)){const c=l&&u.exportValue===e.exportValue;u.domElement&&(u.domElement.checked=c),t.setValue(u.id,{value:c})}t.setValue(i,{value:l})}),s.addEventListener("resetform",r=>{const a=e.defaultFieldValue||"Off";r.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",r=>{const a={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class T0 extends yo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,i=e.id;let n=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof n=="string"&&(n=n!==e.buttonValue,t.setValue(i,{value:n})),n)for(const r of this._getElementsByName(e.fieldName,i))t.setValue(r.id,{value:!1});const s=document.createElement("input");if(mo.add(s),s.setAttribute("data-element-id",i),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=e.fieldName,n&&s.setAttribute("checked",!0),s.tabIndex=bc,s.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const u of this._getElementsByName(a,i))t.setValue(u.id,{value:!1});t.setValue(i,{value:l})}),s.addEventListener("resetform",r=>{const a=e.defaultFieldValue;r.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;s.addEventListener("updatefromsandbox",a=>{const l={value:u=>{const c=r===u.detail.value;for(const d of this._getElementsByName(u.target.name)){const f=c&&d.id===i;d.domElement&&(d.domElement.checked=f),t.setValue(d.id,{value:f})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class R2 extends x0{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}}class I2 extends yo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),n=document.createElement("select");mo.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=bc;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",c=>{const d=this.data.defaultFieldValue;for(const f of n.options)f.selected=f.value===d});for(const c of this.data.options){const d=document.createElement("option");d.textContent=c.displayValue,d.value=c.exportValue,i.value.includes(c.exportValue)&&(d.setAttribute("selected",!0),s=!1),n.append(d)}let r=null;if(s){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),n.prepend(c),r=()=>{c.remove(),n.removeEventListener("input",r),r=null},n.addEventListener("input",r)}const a=c=>{const d=c?"value":"textContent",{options:f,multiple:p}=n;return p?Array.prototype.filter.call(f,b=>b.selected).map(b=>b[d]):f.selectedIndex===-1?null:f[f.selectedIndex][d]};let l=a(!1);const u=c=>{const d=c.target.options;return Array.prototype.map.call(d,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",c=>{const d={value(f){r==null||r();const p=f.detail.value,b=new Set(Array.isArray(p)?p:[p]);for(const y of n.options)y.selected=b.has(y.value);t.setValue(e,{value:a(!0)}),l=a(!1)},multipleSelection(f){n.multiple=!0},remove(f){const p=n.options,b=f.detail.remove;p[b].selected=!1,n.remove(b),p.length>0&&Array.prototype.findIndex.call(p,g=>g.selected)===-1&&(p[0].selected=!0),t.setValue(e,{value:a(!0),items:u(f)}),l=a(!1)},clear(f){for(;n.length!==0;)n.remove(0);t.setValue(e,{value:null,items:[]}),l=a(!1)},insert(f){const{index:p,displayValue:b,exportValue:y}=f.detail.insert,g=n.children[p],m=document.createElement("option");m.textContent=b,m.value=y,g?g.before(m):n.append(m),t.setValue(e,{value:a(!0),items:u(f)}),l=a(!1)},items(f){const{items:p}=f.detail;for(;n.length!==0;)n.remove(0);for(const b of p){const{displayValue:y,exportValue:g}=b,m=document.createElement("option");m.textContent=y,m.value=g,n.append(m)}n.options.length>0&&(n.options[0].selected=!0),t.setValue(e,{value:a(!0),items:u(f)}),l=a(!1)},indices(f){const p=new Set(f.detail.indices);for(const b of f.target.options)b.selected=p.has(b.index);t.setValue(e,{value:a(!0)}),l=a(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(d,c)}),n.addEventListener("input",c=>{var p;const d=a(!0),f=a(!1);t.setValue(e,{value:d}),c.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:f,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):n.addEventListener("input",function(c){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Op extends Ie{constructor(t){const{data:e,elements:i}=t;super(t,{isRenderable:Ie._hasPopupData(e)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new L2({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const i of this.elements)i.popup=t,i.container.ariaHasPopup="dialog",e.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(i=>`${Tg}${i}`).join(",")),this.container}}var Al,Jd,tf,El,Wa,Ee,Gs,xl,Fu,Mu,Sl,$s,zn,Xs,Bu,Ys,zu,qa,Va,ae,Xc,Fp,D0,k0,R0,I0,Yc,Kc,Mp;class L2{constructor({container:t,color:e,elements:i,titleObj:n,modificationDate:s,contentsObj:r,richText:a,parent:l,rect:u,parentRect:c,open:d}){x(this,ae);x(this,Al,C(this,ae,R0).bind(this));x(this,Jd,C(this,ae,Mp).bind(this));x(this,tf,C(this,ae,Kc).bind(this));x(this,El,C(this,ae,Yc).bind(this));x(this,Wa,null);x(this,Ee,null);x(this,Gs,null);x(this,xl,null);x(this,Fu,null);x(this,Mu,null);x(this,Sl,null);x(this,$s,!1);x(this,zn,null);x(this,Xs,null);x(this,Bu,null);x(this,Ys,null);x(this,zu,null);x(this,qa,null);x(this,Va,!1);var f;_(this,Ee,t),_(this,zu,n),_(this,Gs,r),_(this,Ys,a),_(this,Mu,l),_(this,Wa,e),_(this,Bu,u),_(this,Sl,c),_(this,Fu,i),_(this,xl,Rg.toDateObject(s)),this.trigger=i.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",h(this,El)),p.addEventListener("mouseenter",h(this,tf)),p.addEventListener("mouseleave",h(this,Jd)),p.classList.add("popupTriggerArea");for(const p of i)(f=p.container)==null||f.addEventListener("keydown",h(this,Al));h(this,Ee).hidden=!0,d&&C(this,ae,Yc).call(this)}render(){if(h(this,zn))return;const t=_(this,zn,document.createElement("div"));if(t.className="popup",h(this,Wa)){const s=t.style.outlineColor=Et.makeHexColor(...h(this,Wa));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`:t.style.backgroundColor=Et.makeHexColor(...h(this,Wa).map(a=>Math.floor(.7*(255-a)+a)))}const e=document.createElement("span");e.className="header";const i=document.createElement("h1");if(e.append(i),{dir:i.dir,str:i.textContent}=h(this,zu),t.append(e),h(this,xl)){const s=document.createElement("span");s.classList.add("popupDate"),s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:h(this,xl).valueOf()})),e.append(s)}const n=h(this,ae,Xc);if(n)E0.render({xfaHtml:n,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const s=this._formatContents(h(this,Gs));t.append(s)}h(this,Ee).append(t)}_formatContents({str:t,dir:e}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=e;const n=t.split(/(?:\r\n?|\n)/);for(let s=0,r=n.length;s<r;++s){const a=n[s];i.append(document.createTextNode(a)),s<r-1&&i.append(document.createElement("br"))}return i}updateEdited({rect:t,popupContent:e}){var i;h(this,qa)||_(this,qa,{contentsObj:h(this,Gs),richText:h(this,Ys)}),t&&_(this,Xs,null),e&&(_(this,Ys,C(this,ae,k0).call(this,e)),_(this,Gs,null)),(i=h(this,zn))==null||i.remove(),_(this,zn,null)}resetEdited(){var t;h(this,qa)&&({contentsObj:Ai(this,Gs)._,richText:Ai(this,Ys)._}=h(this,qa),_(this,qa,null),(t=h(this,zn))==null||t.remove(),_(this,zn,null),_(this,Xs,null))}forceHide(){_(this,Va,this.isVisible),h(this,Va)&&(h(this,Ee).hidden=!0)}maybeShow(){h(this,Va)&&(h(this,zn)||C(this,ae,Kc).call(this),_(this,Va,!1),h(this,Ee).hidden=!1)}get isVisible(){return h(this,Ee).hidden===!1}}Al=new WeakMap,Jd=new WeakMap,tf=new WeakMap,El=new WeakMap,Wa=new WeakMap,Ee=new WeakMap,Gs=new WeakMap,xl=new WeakMap,Fu=new WeakMap,Mu=new WeakMap,Sl=new WeakMap,$s=new WeakMap,zn=new WeakMap,Xs=new WeakMap,Bu=new WeakMap,Ys=new WeakMap,zu=new WeakMap,qa=new WeakMap,Va=new WeakMap,ae=new WeakSet,Xc=function(){const t=h(this,Ys),e=h(this,Gs);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&h(this,Ys).html||null},Fp=function(){var t,e,i;return((i=(e=(t=h(this,ae,Xc))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:i.fontSize)||0},D0=function(){var t,e,i;return((i=(e=(t=h(this,ae,Xc))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:i.color)||null},k0=function(t){const e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},n={style:{color:h(this,ae,D0),fontSize:h(this,ae,Fp)?`calc(${h(this,ae,Fp)}px * var(--scale-factor))`:""}};for(const s of t.split(`
`))e.push({name:"span",value:s,attributes:n});return i},R0=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&h(this,$s))&&C(this,ae,Yc).call(this)},I0=function(){if(h(this,Xs)!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:n,pageY:s}}}=h(this,Mu);let r=!!h(this,Sl),a=r?h(this,Sl):h(this,Bu);for(const b of h(this,Fu))if(!a||Et.intersect(b.data.rect,a)!==null){a=b.data.rect,r=!0;break}const l=Et.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),c=r?a[2]-a[0]+5:0,d=l[0]+c,f=l[1];_(this,Xs,[100*(d-n)/e,100*(f-s)/i]);const{style:p}=h(this,Ee);p.left=`${h(this,Xs)[0]}%`,p.top=`${h(this,Xs)[1]}%`},Yc=function(){_(this,$s,!h(this,$s)),h(this,$s)?(C(this,ae,Kc).call(this),h(this,Ee).addEventListener("click",h(this,El)),h(this,Ee).addEventListener("keydown",h(this,Al))):(C(this,ae,Mp).call(this),h(this,Ee).removeEventListener("click",h(this,El)),h(this,Ee).removeEventListener("keydown",h(this,Al)))},Kc=function(){h(this,zn)||this.render(),this.isVisible?h(this,$s)&&h(this,Ee).classList.add("focused"):(C(this,ae,I0).call(this),h(this,Ee).hidden=!1,h(this,Ee).style.zIndex=parseInt(h(this,Ee).style.zIndex)+1e3)},Mp=function(){h(this,Ee).classList.remove("focused"),!(h(this,$s)||!this.isVisible)&&(h(this,Ee).hidden=!0,h(this,Ee).style.zIndex=parseInt(h(this,Ee).style.zIndex)-1e3)};class L0 extends Ie{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=Nt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Uu;class P2 extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,Uu,null)}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:i,height:n}=Kr(e.rect),s=this.svgFactory.create(i,n,!0),r=_(this,Uu,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,Uu)}addHighlightArea(){this.container.classList.add("highlightArea")}}Uu=new WeakMap;var Hu;class N2 extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,Hu,null)}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:i,height:n}=Kr(e.rect),s=this.svgFactory.create(i,n,!0),r=e.borderStyle.width,a=_(this,Hu,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",i-r),a.setAttribute("height",n-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,Hu)}addHighlightArea(){this.container.classList.add("highlightArea")}}Hu=new WeakMap;var ju;class O2 extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,ju,null)}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:i,height:n}=Kr(e.rect),s=this.svgFactory.create(i,n,!0),r=e.borderStyle.width,a=_(this,ju,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",i/2),a.setAttribute("cy",n/2),a.setAttribute("rx",i/2-r/2),a.setAttribute("ry",n/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,ju)}addHighlightArea(){this.container.classList.add("highlightArea")}}ju=new WeakMap;var Wu;class P0 extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,Wu,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:i,borderStyle:n,popupRef:s}}=this;if(!i)return this.container;const{width:r,height:a}=Kr(e),l=this.svgFactory.create(r,a,!0);let u=[];for(let d=0,f=i.length;d<f;d+=2){const p=i[d]-e[0],b=e[3]-i[d+1];u.push(`${p},${b}`)}u=u.join(" ");const c=_(this,Wu,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",u),c.setAttribute("stroke-width",n.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),l.append(c),this.container.append(l),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,Wu)}addHighlightArea(){this.container.classList.add("highlightArea")}}Wu=new WeakMap;class F2 extends P0{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class M2 extends Ie{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var qu,Ga,Vu,Bp;class Og extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,Vu);x(this,qu,null);x(this,Ga,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Nt.HIGHLIGHT:Nt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:i,inkLists:n,borderStyle:s,popupRef:r}}=this,{transform:a,width:l,height:u}=C(this,Vu,Bp).call(this,i,e),c=this.svgFactory.create(l,u,!0),d=_(this,qu,this.svgFactory.createElement("svg:g"));c.append(d),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",a);for(let f=0,p=n.length;f<p;f++){const b=this.svgFactory.createElement(this.svgElementName);h(this,Ga).push(b),b.setAttribute("points",n[f].join(",")),d.append(b)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:i,points:n,rect:s}=e,r=h(this,qu);if(i>=0&&r.setAttribute("stroke-width",i||1),n)for(let a=0,l=h(this,Ga).length;a<l;a++)h(this,Ga)[a].setAttribute("points",n[a].join(","));if(s){const{transform:a,width:l,height:u}=C(this,Vu,Bp).call(this,this.data.rotation,s);r.parentElement.setAttribute("viewBox",`0 0 ${l} ${u}`),r.setAttribute("transform",a)}}getElementsToTriggerPopup(){return h(this,Ga)}addHighlightArea(){this.container.classList.add("highlightArea")}}qu=new WeakMap,Ga=new WeakMap,Vu=new WeakSet,Bp=function(e,i){switch(e){case 90:return{transform:`rotate(90) translate(${-i[0]},${i[1]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};case 180:return{transform:`rotate(180) translate(${-i[2]},${i[1]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]};case 270:return{transform:`rotate(270) translate(${-i[2]},${i[3]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};default:return{transform:`translate(${-i[0]},${i[3]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]}}};class N0 extends Ie{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Nt.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class B2 extends Ie{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class z2 extends Ie{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class U2 extends Ie{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class O0 extends Ie{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Nt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Gu,$u,zp;class H2 extends Ie{constructor(e){var n;super(e,{isRenderable:!0});x(this,$u);x(this,Gu,null);const{file:i}=this.data;this.filename=i.filename,this.content=i.content,(n=this.linkService.eventBus)==null||n.dispatch("fileattachmentannotation",{source:this,...i})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:i}=this;let n;i.hasAppearance||i.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(i.name)?"paperclip":"pushpin"}.svg`,i.fillAlpha&&i.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(i.fillAlpha*100)}%);`)),n.addEventListener("dblclick",C(this,$u,zp).bind(this)),_(this,Gu,n);const{isMac:s}=Di.platform;return e.addEventListener("keydown",r=>{r.key==="Enter"&&(s?r.metaKey:r.ctrlKey)&&C(this,$u,zp).call(this)}),!i.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),e.append(n),e}getElementsToTriggerPopup(){return h(this,Gu)}addHighlightArea(){this.container.classList.add("highlightArea")}}Gu=new WeakMap,$u=new WeakSet,zp=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var Xu,$a,Xa,Yu,bo,F0,Up;class j2{constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:n,page:s,viewport:r,structTreeLayer:a}){x(this,bo);x(this,Xu,null);x(this,$a,null);x(this,Xa,new Map);x(this,Yu,null);this.div=t,_(this,Xu,e),_(this,$a,i),_(this,Yu,a||null),this.page=s,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=n}hasEditableAnnotations(){return h(this,Xa).size>0}async render(t){var r;const{annotations:e}=t,i=this.div;po(i,this.viewport);const n=new Map,s={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Ng,annotationStorage:t.annotationStorage||new Lg,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const a of e){if(a.noHTML)continue;const l=a.annotationType===ze.POPUP;if(l){const d=n.get(a.id);if(!d)continue;s.elements=d}else{const{width:d,height:f}=Kr(a.rect);if(d<=0||f<=0)continue}s.data=a;const u=S2.create(s);if(!u.isRenderable)continue;if(!l&&a.popupRef){const d=n.get(a.popupRef);d?d.push(u):n.set(a.popupRef,[u])}const c=u.render();a.hidden&&(c.style.visibility="hidden"),await C(this,bo,F0).call(this,c,a.id),u._isEditable&&(h(this,Xa).set(u.data.id,u),(r=this._annotationEditorUIManager)==null||r.renderAnnotationElement(u))}C(this,bo,Up).call(this)}update({viewport:t}){const e=this.div;this.viewport=t,po(e,{rotation:t.rotation}),C(this,bo,Up).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(h(this,Xa).values())}getEditableAnnotation(t){return h(this,Xa).get(t)}}Xu=new WeakMap,$a=new WeakMap,Xa=new WeakMap,Yu=new WeakMap,bo=new WeakSet,F0=async function(t,e){var r,a;const i=t.firstChild||t,n=i.id=`${Tg}${e}`,s=await((r=h(this,Yu))==null?void 0:r.getAriaAttributes(n));if(s)for(const[l,u]of s)i.setAttribute(l,u);this.div.append(t),(a=h(this,Xu))==null||a.moveElementInDOM(this.div,t,i,!1)},Up=function(){if(!h(this,$a))return;const t=this.div;for(const[e,i]of h(this,$a)){const n=t.querySelector(`[data-annotation-id="${e}"]`);if(!n)continue;i.className="annotationContent";const{firstChild:s}=n;s?s.nodeName==="CANVAS"?s.replaceWith(i):s.classList.contains("annotationContent")?s.after(i):s.before(i):n.append(i)}h(this,$a).clear()};const Rc=/\r\n?|\n/g;var Un,Yi,Ku,Ya,Ki,Oe,M0,B0,z0,Zc,or,Qc,Jc,U0,jp,H0;const ue=class ue extends we{constructor(e){super({...e,name:"freeTextEditor"});x(this,Oe);x(this,Un);x(this,Yi,"");x(this,Ku,`${this.id}-editor`);x(this,Ya,null);x(this,Ki);_(this,Un,e.color||ue._defaultColor||we._defaultLineColor),_(this,Ki,e.fontSize||ue._defaultFontSize)}static get _keyboardManager(){const e=ue.prototype,i=r=>r.isEmpty(),n=go.TRANSLATE_SMALL,s=go.TRANSLATE_BIG;return Ht(this,"_keyboardManager",new vc([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:i}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[s,0],checker:i}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:i}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,s],checker:i}]]))}static initialize(e,i){we.initialize(e,i);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,i){switch(e){case Vt.FREETEXT_SIZE:ue._defaultFontSize=i;break;case Vt.FREETEXT_COLOR:ue._defaultColor=i;break}}updateParams(e,i){switch(e){case Vt.FREETEXT_SIZE:C(this,Oe,M0).call(this,i);break;case Vt.FREETEXT_COLOR:C(this,Oe,B0).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[Vt.FREETEXT_SIZE,ue._defaultFontSize],[Vt.FREETEXT_COLOR,ue._defaultColor||we._defaultLineColor]]}get propertiesToUpdate(){return[[Vt.FREETEXT_SIZE,h(this,Ki)],[Vt.FREETEXT_COLOR,h(this,Un)]]}_translateEmpty(e,i){this._uiManager.translateSelectedEditors(e,i,!0)}getInitialTranslation(){const e=this.parentScale;return[-ue._internalPadding*e,-(ue._internalPadding+h(this,Ki))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Nt.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),_(this,Ya,new AbortController);const e=this._uiManager.combinedSignal(h(this,Ya));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){var e;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",h(this,Ku)),this._isDraggable=!0,(e=h(this,Ya))==null||e.abort(),_(this,Ya,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){var i;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),(i=this._initialOptions)!=null&&i.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=h(this,Yi),i=_(this,Yi,C(this,Oe,z0).call(this).trimEnd());if(e===i)return;const n=s=>{if(_(this,Yi,s),!s){this.remove();return}C(this,Oe,Jc).call(this),this._uiManager.rebuild(this),C(this,Oe,Zc).call(this)};this.addCommands({cmd:()=>{n(i)},undo:()=>{n(e)},mustExec:!1}),C(this,Oe,Zc).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){ue._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,i;this.width&&(e=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",h(this,Ku)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${h(this,Ki)}px * var(--scale-factor))`,n.color=h(this,Un),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),gd(this,this.div,["dblclick","keydown"]),this.width){const[s,r]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[l,u]=this.getInitialTranslation();[l,u]=this.pageTranslationToScreen(l,u);const[c,d]=this.pageDimensions,[f,p]=this.pageTranslation;let b,y;switch(this.rotation){case 0:b=e+(a[0]-f)/c,y=i+this.height-(a[1]-p)/d;break;case 90:b=e+(a[0]-f)/c,y=i-(a[1]-p)/d,[l,u]=[u,-l];break;case 180:b=e-this.width+(a[0]-f)/c,y=i-(a[1]-p)/d,[l,u]=[-l,-u];break;case 270:b=e+(a[0]-f-this.height*d)/c,y=i+(a[1]-p-this.width*c)/d,[l,u]=[-u,l];break}this.setAt(b*s,y*r,l,u)}else this.setAt(e*s,i*r,this.width*s,this.height*r);C(this,Oe,Jc).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var b,y,g;const i=e.clipboardData||window.clipboardData,{types:n}=i;if(n.length===1&&n[0]==="text/plain")return;e.preventDefault();const s=C(b=ue,or,jp).call(b,i.getData("text")||"").replaceAll(Rc,`
`);if(!s)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const a=r.getRangeAt(0);if(!s.includes(`
`)){a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:l,startOffset:u}=a,c=[],d=[];if(l.nodeType===Node.TEXT_NODE){const m=l.parentElement;if(d.push(l.nodeValue.slice(u).replaceAll(Rc,"")),m!==this.editorDiv){let w=c;for(const E of this.editorDiv.childNodes){if(E===m){w=d;continue}w.push(C(y=ue,or,Qc).call(y,E))}}c.push(l.nodeValue.slice(0,u).replaceAll(Rc,""))}else if(l===this.editorDiv){let m=c,w=0;for(const E of this.editorDiv.childNodes)w++===u&&(m=d),m.push(C(g=ue,or,Qc).call(g,E))}_(this,Yi,`${c.join(`
`)}${s}${d.join(`
`)}`),C(this,Oe,Jc).call(this);const f=new Range;let p=c.reduce((m,w)=>m+w.length,0);for(const{firstChild:m}of this.editorDiv.childNodes)if(m.nodeType===Node.TEXT_NODE){const w=m.nodeValue.length;if(p<=w){f.setStart(m,p),f.setEnd(m,p);break}p-=w}r.removeAllRanges(),r.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(e,i,n){var a;let s=null;if(e instanceof L0){const{data:{defaultAppearanceData:{fontSize:l,fontColor:u},rect:c,rotation:d,id:f,popupRef:p},textContent:b,textPosition:y,parent:{page:{pageNumber:g}}}=e;if(!b||b.length===0)return null;s=e={annotationType:Nt.FREETEXT,color:Array.from(u),fontSize:l,value:b.join(`
`),position:y,pageIndex:g-1,rect:c.slice(0),rotation:d,id:f,deleted:!1,popupRef:p}}const r=await super.deserialize(e,i,n);return _(r,Ki,e.fontSize),_(r,Un,Et.makeHexColor(...e.color)),_(r,Yi,C(a=ue,or,jp).call(a,e.value)),r.annotationElementId=e.id||null,r._initialData=s,r}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=ue._internalPadding*this.parentScale,n=this.getRect(i,i),s=we._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:h(this,Un)),r={annotationType:Nt.FREETEXT,color:s,fontSize:h(this,Ki),value:C(this,Oe,U0).call(this),pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?r:this.annotationElementId&&!C(this,Oe,H0).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(e){const i=super.renderAnnotationElement(e);if(this.deleted)return i;const{style:n}=i;n.fontSize=`calc(${h(this,Ki)}px * var(--scale-factor))`,n.color=h(this,Un),i.replaceChildren();for(const r of h(this,Yi).split(`
`)){const a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),i.append(a)}const s=ue._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(s,s),popupContent:h(this,Yi)}),i}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};Un=new WeakMap,Yi=new WeakMap,Ku=new WeakMap,Ya=new WeakMap,Ki=new WeakMap,Oe=new WeakSet,M0=function(e){const i=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--scale-factor))`,this.translate(0,-(s-h(this,Ki))*this.parentScale),_(this,Ki,s),C(this,Oe,Zc).call(this)},n=h(this,Ki);this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Vt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},B0=function(e){const i=s=>{_(this,Un,this.editorDiv.style.color=s)},n=h(this,Un);this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Vt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},z0=function(){var n;const e=[];this.editorDiv.normalize();let i=null;for(const s of this.editorDiv.childNodes)(i==null?void 0:i.nodeType)===Node.TEXT_NODE&&s.nodeName==="BR"||(e.push(C(n=ue,or,Qc).call(n,s)),i=s);return e.join(`
`)},Zc=function(){const[e,i]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:s,div:r}=this,a=r.style.display,l=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",s.div.append(this.div),n=r.getBoundingClientRect(),r.remove(),r.style.display=a,r.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=n.width/e,this.height=n.height/i):(this.width=n.height/e,this.height=n.width/i),this.fixAndSetPosition()},or=new WeakSet,Qc=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Rc,"")},Jc=function(){if(this.editorDiv.replaceChildren(),!!h(this,Yi))for(const e of h(this,Yi).split(`
`)){const i=document.createElement("div");i.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(i)}},U0=function(){return h(this,Yi).replaceAll(" "," ")},jp=function(e){return e.replaceAll(" "," ")},H0=function(e){const{value:i,fontSize:n,color:s,pageIndex:r}=this._initialData;return this._hasBeenMoved||e.value!==i||e.fontSize!==n||e.color.some((a,l)=>a!==s[l])||e.pageIndex!==r},x(ue,or),Dt(ue,"_freeTextDefaultContent",""),Dt(ue,"_internalPadding",0),Dt(ue,"_defaultColor",null),Dt(ue,"_defaultFontSize",10),Dt(ue,"_type","freetext"),Dt(ue,"_editorType",Nt.FREETEXT);let Hp=ue;class mt{toSVGPath(){le("Abstract method `toSVGPath` must be implemented.")}get box(){le("Abstract getter `box` must be implemented.")}serialize(t,e){le("Abstract method `serialize` must be implemented.")}static _rescale(t,e,i,n,s,r){r||(r=new Float32Array(t.length));for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a]*n,r[a+1]=i+t[a+1]*s;return r}static _rescaleAndSwap(t,e,i,n,s,r){r||(r=new Float32Array(t.length));for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a+1]*n,r[a+1]=i+t[a]*s;return r}static _translate(t,e,i,n){n||(n=new Float32Array(t.length));for(let s=0,r=t.length;s<r;s+=2)n[s]=e+t[s],n[s+1]=i+t[s+1];return n}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,i,n,s){switch(s){case 90:return[1-e/i,t/n];case 180:return[1-t/i,1-e/n];case 270:return[e/i,1-t/n];default:return[t/i,e/n]}}static _normalizePagePoint(t,e,i){switch(i){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,i,n,s,r){return[(t+5*i)/6,(e+5*n)/6,(5*i+s)/6,(5*n+r)/6,(i+s)/2,(n+r)/2]}}Dt(mt,"PRECISION",1e-4);var Zi,Hn,Cl,Tl,ds,Ut,Ka,Za,Zu,Qu,Dl,kl,Mr,Ju,ef,nf,We,Eh,j0,W0,q0,V0,G0,$0;const Is=class Is{constructor({x:t,y:e},i,n,s,r,a=0){x(this,We);x(this,Zi);x(this,Hn,[]);x(this,Cl);x(this,Tl);x(this,ds,[]);x(this,Ut,new Float32Array(18));x(this,Ka);x(this,Za);x(this,Zu);x(this,Qu);x(this,Dl);x(this,kl);x(this,Mr,[]);_(this,Zi,i),_(this,kl,s*n),_(this,Tl,r),h(this,Ut).set([NaN,NaN,NaN,NaN,t,e],6),_(this,Cl,a),_(this,Qu,h(Is,Ju)*n),_(this,Zu,h(Is,nf)*n),_(this,Dl,n),h(this,Mr).push(t,e)}isEmpty(){return isNaN(h(this,Ut)[8])}add({x:t,y:e}){var F;_(this,Ka,t),_(this,Za,e);const[i,n,s,r]=h(this,Zi);let[a,l,u,c]=h(this,Ut).subarray(8,12);const d=t-u,f=e-c,p=Math.hypot(d,f);if(p<h(this,Zu))return!1;const b=p-h(this,Qu),y=b/p,g=y*d,m=y*f;let w=a,E=l;a=u,l=c,u+=g,c+=m,(F=h(this,Mr))==null||F.push(t,e);const R=-m/b,A=g/b,T=R*h(this,kl),k=A*h(this,kl);return h(this,Ut).set(h(this,Ut).subarray(2,8),0),h(this,Ut).set([u+T,c+k],4),h(this,Ut).set(h(this,Ut).subarray(14,18),12),h(this,Ut).set([u-T,c-k],16),isNaN(h(this,Ut)[6])?(h(this,ds).length===0&&(h(this,Ut).set([a+T,l+k],2),h(this,ds).push(NaN,NaN,NaN,NaN,(a+T-i)/s,(l+k-n)/r),h(this,Ut).set([a-T,l-k],14),h(this,Hn).push(NaN,NaN,NaN,NaN,(a-T-i)/s,(l-k-n)/r)),h(this,Ut).set([w,E,a,l,u,c],6),!this.isEmpty()):(h(this,Ut).set([w,E,a,l,u,c],6),Math.abs(Math.atan2(E-l,w-a)-Math.atan2(m,g))<Math.PI/2?([a,l,u,c]=h(this,Ut).subarray(2,6),h(this,ds).push(NaN,NaN,NaN,NaN,((a+u)/2-i)/s,((l+c)/2-n)/r),[a,l,w,E]=h(this,Ut).subarray(14,18),h(this,Hn).push(NaN,NaN,NaN,NaN,((w+a)/2-i)/s,((E+l)/2-n)/r),!0):([w,E,a,l,u,c]=h(this,Ut).subarray(0,6),h(this,ds).push(((w+5*a)/6-i)/s,((E+5*l)/6-n)/r,((5*a+u)/6-i)/s,((5*l+c)/6-n)/r,((a+u)/2-i)/s,((l+c)/2-n)/r),[u,c,a,l,w,E]=h(this,Ut).subarray(12,18),h(this,Hn).push(((w+5*a)/6-i)/s,((E+5*l)/6-n)/r,((5*a+u)/6-i)/s,((5*l+c)/6-n)/r,((a+u)/2-i)/s,((l+c)/2-n)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=h(this,ds),e=h(this,Hn);if(isNaN(h(this,Ut)[6])&&!this.isEmpty())return C(this,We,j0).call(this);const i=[];i.push(`M${t[4]} ${t[5]}`);for(let n=6;n<t.length;n+=6)isNaN(t[n])?i.push(`L${t[n+4]} ${t[n+5]}`):i.push(`C${t[n]} ${t[n+1]} ${t[n+2]} ${t[n+3]} ${t[n+4]} ${t[n+5]}`);C(this,We,q0).call(this,i);for(let n=e.length-6;n>=6;n-=6)isNaN(e[n])?i.push(`L${e[n+4]} ${e[n+5]}`):i.push(`C${e[n]} ${e[n+1]} ${e[n+2]} ${e[n+3]} ${e[n+4]} ${e[n+5]}`);return C(this,We,W0).call(this,i),i.join(" ")}newFreeDrawOutline(t,e,i,n,s,r){return new X0(t,e,i,n,s,r)}getOutlines(){var d;const t=h(this,ds),e=h(this,Hn),i=h(this,Ut),[n,s,r,a]=h(this,Zi),l=new Float32Array((((d=h(this,Mr))==null?void 0:d.length)??0)+2);for(let f=0,p=l.length-2;f<p;f+=2)l[f]=(h(this,Mr)[f]-n)/r,l[f+1]=(h(this,Mr)[f+1]-s)/a;if(l[l.length-2]=(h(this,Ka)-n)/r,l[l.length-1]=(h(this,Za)-s)/a,isNaN(i[6])&&!this.isEmpty())return C(this,We,V0).call(this,l);const u=new Float32Array(h(this,ds).length+24+h(this,Hn).length);let c=t.length;for(let f=0;f<c;f+=2){if(isNaN(t[f])){u[f]=u[f+1]=NaN;continue}u[f]=t[f],u[f+1]=t[f+1]}c=C(this,We,$0).call(this,u,c);for(let f=e.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(e[f+p])){u[c]=u[c+1]=NaN,c+=2;continue}u[c]=e[f+p],u[c+1]=e[f+p+1],c+=2}return C(this,We,G0).call(this,u,c),this.newFreeDrawOutline(u,l,h(this,Zi),h(this,Dl),h(this,Cl),h(this,Tl))}};Zi=new WeakMap,Hn=new WeakMap,Cl=new WeakMap,Tl=new WeakMap,ds=new WeakMap,Ut=new WeakMap,Ka=new WeakMap,Za=new WeakMap,Zu=new WeakMap,Qu=new WeakMap,Dl=new WeakMap,kl=new WeakMap,Mr=new WeakMap,Ju=new WeakMap,ef=new WeakMap,nf=new WeakMap,We=new WeakSet,Eh=function(){const t=h(this,Ut).subarray(4,6),e=h(this,Ut).subarray(16,18),[i,n,s,r]=h(this,Zi);return[(h(this,Ka)+(t[0]-e[0])/2-i)/s,(h(this,Za)+(t[1]-e[1])/2-n)/r,(h(this,Ka)+(e[0]-t[0])/2-i)/s,(h(this,Za)+(e[1]-t[1])/2-n)/r]},j0=function(){const[t,e,i,n]=h(this,Zi),[s,r,a,l]=C(this,We,Eh).call(this);return`M${(h(this,Ut)[2]-t)/i} ${(h(this,Ut)[3]-e)/n} L${(h(this,Ut)[4]-t)/i} ${(h(this,Ut)[5]-e)/n} L${s} ${r} L${a} ${l} L${(h(this,Ut)[16]-t)/i} ${(h(this,Ut)[17]-e)/n} L${(h(this,Ut)[14]-t)/i} ${(h(this,Ut)[15]-e)/n} Z`},W0=function(t){const e=h(this,Hn);t.push(`L${e[4]} ${e[5]} Z`)},q0=function(t){const[e,i,n,s]=h(this,Zi),r=h(this,Ut).subarray(4,6),a=h(this,Ut).subarray(16,18),[l,u,c,d]=C(this,We,Eh).call(this);t.push(`L${(r[0]-e)/n} ${(r[1]-i)/s} L${l} ${u} L${c} ${d} L${(a[0]-e)/n} ${(a[1]-i)/s}`)},V0=function(t){const e=h(this,Ut),[i,n,s,r]=h(this,Zi),[a,l,u,c]=C(this,We,Eh).call(this),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(e[2]-i)/s,(e[3]-n)/r,NaN,NaN,NaN,NaN,(e[4]-i)/s,(e[5]-n)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,(e[16]-i)/s,(e[17]-n)/r,NaN,NaN,NaN,NaN,(e[14]-i)/s,(e[15]-n)/r],0),this.newFreeDrawOutline(d,t,h(this,Zi),h(this,Dl),h(this,Cl),h(this,Tl))},G0=function(t,e){const i=h(this,Hn);return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6},$0=function(t,e){const i=h(this,Ut).subarray(4,6),n=h(this,Ut).subarray(16,18),[s,r,a,l]=h(this,Zi),[u,c,d,f]=C(this,We,Eh).call(this);return t.set([NaN,NaN,NaN,NaN,(i[0]-s)/a,(i[1]-r)/l,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(n[0]-s)/a,(n[1]-r)/l],e),e+=24},x(Is,Ju,8),x(Is,ef,2),x(Is,nf,h(Is,Ju)+h(Is,ef));let bd=Is;var Rl,Qa,Ks,tc,Qi,ec,ke,sf,Y0;class X0 extends mt{constructor(e,i,n,s,r,a){super();x(this,sf);x(this,Rl);x(this,Qa,new Float32Array(4));x(this,Ks);x(this,tc);x(this,Qi);x(this,ec);x(this,ke);_(this,ke,e),_(this,Qi,i),_(this,Rl,n),_(this,ec,s),_(this,Ks,r),_(this,tc,a),this.lastPoint=[NaN,NaN],C(this,sf,Y0).call(this,a);const[l,u,c,d]=h(this,Qa);for(let f=0,p=e.length;f<p;f+=2)e[f]=(e[f]-l)/c,e[f+1]=(e[f+1]-u)/d;for(let f=0,p=i.length;f<p;f+=2)i[f]=(i[f]-l)/c,i[f+1]=(i[f+1]-u)/d}toSVGPath(){const e=[`M${h(this,ke)[4]} ${h(this,ke)[5]}`];for(let i=6,n=h(this,ke).length;i<n;i+=6){if(isNaN(h(this,ke)[i])){e.push(`L${h(this,ke)[i+4]} ${h(this,ke)[i+5]}`);continue}e.push(`C${h(this,ke)[i]} ${h(this,ke)[i+1]} ${h(this,ke)[i+2]} ${h(this,ke)[i+3]} ${h(this,ke)[i+4]} ${h(this,ke)[i+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,i,n,s],r){const a=n-e,l=s-i;let u,c;switch(r){case 0:u=mt._rescale(h(this,ke),e,s,a,-l),c=mt._rescale(h(this,Qi),e,s,a,-l);break;case 90:u=mt._rescaleAndSwap(h(this,ke),e,i,a,l),c=mt._rescaleAndSwap(h(this,Qi),e,i,a,l);break;case 180:u=mt._rescale(h(this,ke),n,i,-a,l),c=mt._rescale(h(this,Qi),n,i,-a,l);break;case 270:u=mt._rescaleAndSwap(h(this,ke),n,s,-a,-l),c=mt._rescaleAndSwap(h(this,Qi),n,s,-a,-l);break}return{outline:Array.from(u),points:[Array.from(c)]}}get box(){return h(this,Qa)}newOutliner(e,i,n,s,r,a=0){return new bd(e,i,n,s,r,a)}getNewOutline(e,i){const[n,s,r,a]=h(this,Qa),[l,u,c,d]=h(this,Rl),f=r*c,p=a*d,b=n*c+l,y=s*d+u,g=this.newOutliner({x:h(this,Qi)[0]*f+b,y:h(this,Qi)[1]*p+y},h(this,Rl),h(this,ec),e,h(this,tc),i??h(this,Ks));for(let m=2;m<h(this,Qi).length;m+=2)g.add({x:h(this,Qi)[m]*f+b,y:h(this,Qi)[m+1]*p+y});return g.getOutlines()}}Rl=new WeakMap,Qa=new WeakMap,Ks=new WeakMap,tc=new WeakMap,Qi=new WeakMap,ec=new WeakMap,ke=new WeakMap,sf=new WeakSet,Y0=function(e){const i=h(this,ke);let n=i[4],s=i[5],r=n,a=s,l=n,u=s,c=n,d=s;const f=e?Math.max:Math.min;for(let b=6,y=i.length;b<y;b+=6){if(isNaN(i[b]))r=Math.min(r,i[b+4]),a=Math.min(a,i[b+5]),l=Math.max(l,i[b+4]),u=Math.max(u,i[b+5]),d<i[b+5]?(c=i[b+4],d=i[b+5]):d===i[b+5]&&(c=f(c,i[b+4]));else{const g=Et.bezierBoundingBox(n,s,...i.slice(b,b+6));r=Math.min(r,g[0]),a=Math.min(a,g[1]),l=Math.max(l,g[2]),u=Math.max(u,g[3]),d<g[3]?(c=g[2],d=g[3]):d===g[3]&&(c=f(c,g[2]))}n=i[b+4],s=i[b+5]}const p=h(this,Qa);p[0]=r-h(this,Ks),p[1]=a-h(this,Ks),p[2]=l-r+2*h(this,Ks),p[3]=u-a+2*h(this,Ks),this.lastPoint=[c,d]};var ic,nc,Br,jn,Ri,K0,td,Z0,Q0,qp;class Wp{constructor(t,e=0,i=0,n=!0){x(this,Ri);x(this,ic);x(this,nc);x(this,Br,[]);x(this,jn,[]);let s=1/0,r=-1/0,a=1/0,l=-1/0;const u=10**-4;for(const{x:g,y:m,width:w,height:E}of t){const R=Math.floor((g-e)/u)*u,A=Math.ceil((g+w+e)/u)*u,T=Math.floor((m-e)/u)*u,k=Math.ceil((m+E+e)/u)*u,P=[R,T,k,!0],F=[A,T,k,!1];h(this,Br).push(P,F),s=Math.min(s,R),r=Math.max(r,A),a=Math.min(a,T),l=Math.max(l,k)}const c=r-s+2*i,d=l-a+2*i,f=s-i,p=a-i,b=h(this,Br).at(n?-1:-2),y=[b[0],b[2]];for(const g of h(this,Br)){const[m,w,E]=g;g[0]=(m-f)/c,g[1]=(w-p)/d,g[2]=(E-p)/d}_(this,ic,new Float32Array([f,p,c,d])),_(this,nc,y)}getOutlines(){h(this,Br).sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);const t=[];for(const e of h(this,Br))e[3]?(t.push(...C(this,Ri,qp).call(this,e)),C(this,Ri,Z0).call(this,e)):(C(this,Ri,Q0).call(this,e),t.push(...C(this,Ri,qp).call(this,e)));return C(this,Ri,K0).call(this,t)}}ic=new WeakMap,nc=new WeakMap,Br=new WeakMap,jn=new WeakMap,Ri=new WeakSet,K0=function(t){const e=[],i=new Set;for(const r of t){const[a,l,u]=r;e.push([a,l,r],[a,u,r])}e.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=e.length;r<a;r+=2){const l=e[r][2],u=e[r+1][2];l.push(u),u.push(l),i.add(l),i.add(u)}const n=[];let s;for(;i.size>0;){const r=i.values().next().value;let[a,l,u,c,d]=r;i.delete(r);let f=a,p=l;for(s=[a,u],n.push(s);;){let b;if(i.has(c))b=c;else if(i.has(d))b=d;else break;i.delete(b),[a,l,u,c,d]=b,f!==a&&(s.push(f,p,a,p===l?l:u),f=a),p=p===l?u:l}s.push(f,p)}return new W2(n,h(this,ic),h(this,nc))},td=function(t){const e=h(this,jn);let i=0,n=e.length-1;for(;i<=n;){const s=i+n>>1,r=e[s][0];if(r===t)return s;r<t?i=s+1:n=s-1}return n+1},Z0=function([,t,e]){const i=C(this,Ri,td).call(this,t);h(this,jn).splice(i,0,[t,e])},Q0=function([,t,e]){const i=C(this,Ri,td).call(this,t);for(let n=i;n<h(this,jn).length;n++){const[s,r]=h(this,jn)[n];if(s!==t)break;if(s===t&&r===e){h(this,jn).splice(n,1);return}}for(let n=i-1;n>=0;n--){const[s,r]=h(this,jn)[n];if(s!==t)break;if(s===t&&r===e){h(this,jn).splice(n,1);return}}},qp=function(t){const[e,i,n]=t,s=[[e,i,n]],r=C(this,Ri,td).call(this,n);for(let a=0;a<r;a++){const[l,u]=h(this,jn)[a];for(let c=0,d=s.length;c<d;c++){const[,f,p]=s[c];if(!(u<=f||p<=l)){if(f>=l){if(p>u)s[c][1]=u;else{if(d===1)return[];s.splice(c,1),c--,d--}continue}s[c][2]=l,p>u&&s.push([e,u,p])}}}return s};var sc,Il;class W2 extends mt{constructor(e,i,n){super();x(this,sc);x(this,Il);_(this,Il,e),_(this,sc,i),this.lastPoint=n}toSVGPath(){const e=[];for(const i of h(this,Il)){let[n,s]=i;e.push(`M${n} ${s}`);for(let r=2;r<i.length;r+=2){const a=i[r],l=i[r+1];a===n?(e.push(`V${l}`),s=l):l===s&&(e.push(`H${a}`),n=a)}e.push("Z")}return e.join(" ")}serialize([e,i,n,s],r){const a=[],l=n-e,u=s-i;for(const c of h(this,Il)){const d=new Array(c.length);for(let f=0;f<c.length;f+=2)d[f]=e+c[f]*l,d[f+1]=s-c[f+1]*u;a.push(d)}return a}get box(){return h(this,sc)}get classNamesForOutlining(){return["highlightOutline"]}}sc=new WeakMap,Il=new WeakMap;class Vp extends bd{newFreeDrawOutline(t,e,i,n,s,r){return new q2(t,e,i,n,s,r)}}class q2 extends X0{newOutliner(t,e,i,n,s,r=0){return new Vp(t,e,i,n,s,r)}}var Wn,Ja,Ll,je,rc,Pl,ac,oc,zr,qn,Nl,lc,re,Gp,$p,Xp,ra,J0,mr;const Mi=class Mi{constructor({editor:t=null,uiManager:e=null}){x(this,re);x(this,Wn,null);x(this,Ja,null);x(this,Ll);x(this,je,null);x(this,rc,!1);x(this,Pl,!1);x(this,ac,null);x(this,oc);x(this,zr,null);x(this,qn,null);x(this,Nl);var i;t?(_(this,Pl,!1),_(this,Nl,Vt.HIGHLIGHT_COLOR),_(this,ac,t)):(_(this,Pl,!0),_(this,Nl,Vt.HIGHLIGHT_DEFAULT_COLOR)),_(this,qn,(t==null?void 0:t._uiManager)||e),_(this,oc,h(this,qn)._eventBus),_(this,Ll,(t==null?void 0:t.color)||((i=h(this,qn))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),h(Mi,lc)||_(Mi,lc,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Ht(this,"_keyboardManager",new vc([[["Escape","mac+Escape"],Mi.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Mi.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Mi.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Mi.prototype._moveToPrevious],[["Home","mac+Home"],Mi.prototype._moveToBeginning],[["End","mac+End"],Mi.prototype._moveToEnd]]))}renderButton(){const t=_(this,Wn,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);const e=h(this,qn)._signal;t.addEventListener("click",C(this,re,ra).bind(this),{signal:e}),t.addEventListener("keydown",C(this,re,Xp).bind(this),{signal:e});const i=_(this,Ja,document.createElement("span"));return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=h(this,Ll),t.append(i),t}renderMainDropdown(){const t=_(this,je,C(this,re,Gp).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}_colorSelectFromKeyboard(t){if(t.target===h(this,Wn)){C(this,re,ra).call(this,t);return}const e=t.target.getAttribute("data-color");e&&C(this,re,$p).call(this,e,t)}_moveToNext(t){var e,i;if(!h(this,re,mr)){C(this,re,ra).call(this,t);return}if(t.target===h(this,Wn)){(e=h(this,je).firstChild)==null||e.focus();return}(i=t.target.nextSibling)==null||i.focus()}_moveToPrevious(t){var e,i;if(t.target===((e=h(this,je))==null?void 0:e.firstChild)||t.target===h(this,Wn)){h(this,re,mr)&&this._hideDropdownFromKeyboard();return}h(this,re,mr)||C(this,re,ra).call(this,t),(i=t.target.previousSibling)==null||i.focus()}_moveToBeginning(t){var e;if(!h(this,re,mr)){C(this,re,ra).call(this,t);return}(e=h(this,je).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!h(this,re,mr)){C(this,re,ra).call(this,t);return}(e=h(this,je).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=h(this,je))==null||t.classList.add("hidden"),(e=h(this,zr))==null||e.abort(),_(this,zr,null)}_hideDropdownFromKeyboard(){var t;if(!h(this,Pl)){if(!h(this,re,mr)){(t=h(this,ac))==null||t.unselect();return}this.hideDropdown(),h(this,Wn).focus({preventScroll:!0,focusVisible:h(this,rc)})}}updateColor(t){if(h(this,Ja)&&(h(this,Ja).style.backgroundColor=t),!h(this,je))return;const e=h(this,qn).highlightColors.values();for(const i of h(this,je).children)i.setAttribute("aria-selected",e.next().value===t)}destroy(){var t,e;(t=h(this,Wn))==null||t.remove(),_(this,Wn,null),_(this,Ja,null),(e=h(this,je))==null||e.remove(),_(this,je,null)}};Wn=new WeakMap,Ja=new WeakMap,Ll=new WeakMap,je=new WeakMap,rc=new WeakMap,Pl=new WeakMap,ac=new WeakMap,oc=new WeakMap,zr=new WeakMap,qn=new WeakMap,Nl=new WeakMap,lc=new WeakMap,re=new WeakSet,Gp=function(){const t=document.createElement("div"),e=h(this,qn)._signal;t.addEventListener("contextmenu",Kn,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[i,n]of h(this,qn).highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",n),s.title=i,s.setAttribute("data-l10n-id",h(Mi,lc)[i]);const r=document.createElement("span");s.append(r),r.className="swatch",r.style.backgroundColor=n,s.setAttribute("aria-selected",n===h(this,Ll)),s.addEventListener("click",C(this,re,$p).bind(this,n),{signal:e}),t.append(s)}return t.addEventListener("keydown",C(this,re,Xp).bind(this),{signal:e}),t},$p=function(t,e){e.stopPropagation(),h(this,oc).dispatch("switchannotationeditorparams",{source:this,type:h(this,Nl),value:t})},Xp=function(t){Mi._keyboardManager.exec(this,t)},ra=function(t){if(h(this,re,mr)){this.hideDropdown();return}if(_(this,rc,t.detail===0),h(this,zr)||(_(this,zr,new AbortController),window.addEventListener("pointerdown",C(this,re,J0).bind(this),{signal:h(this,qn).combinedSignal(h(this,zr))})),h(this,je)){h(this,je).classList.remove("hidden");return}const e=_(this,je,C(this,re,Gp).call(this));h(this,Wn).append(e)},J0=function(t){var e;(e=h(this,je))!=null&&e.contains(t.target)||this.hideDropdown()},mr=function(){return h(this,je)&&!h(this,je).classList.contains("hidden")},x(Mi,lc,null);let yd=Mi;var Ol,hc,Zs,to,Fl,Ui,uc,cc,eo,gn,Ji,ii,Ml,Qs,gi,Bl,mn,dc,Pt,Yp,ed,tb,eb,ib,Kp,aa,wn,No,nb,id,xh,sb,rb,ab,ob,lb;const Qt=class Qt extends we{constructor(e){super({...e,name:"highlightEditor"});x(this,Pt);x(this,Ol,null);x(this,hc,0);x(this,Zs);x(this,to,null);x(this,Fl,null);x(this,Ui,null);x(this,uc,null);x(this,cc,0);x(this,eo,null);x(this,gn,null);x(this,Ji,null);x(this,ii,!1);x(this,Ml,null);x(this,Qs);x(this,gi,null);x(this,Bl,"");x(this,mn);x(this,dc,"");this.color=e.color||Qt._defaultColor,_(this,mn,e.thickness||Qt._defaultThickness),_(this,Qs,e.opacity||Qt._defaultOpacity),_(this,Zs,e.boxes||null),_(this,dc,e.methodOfCreation||""),_(this,Bl,e.text||""),this._isDraggable=!1,e.highlightId>-1?(_(this,ii,!0),C(this,Pt,ed).call(this,e),C(this,Pt,aa).call(this)):h(this,Zs)&&(_(this,Ol,e.anchorNode),_(this,hc,e.anchorOffset),_(this,uc,e.focusNode),_(this,cc,e.focusOffset),C(this,Pt,Yp).call(this),C(this,Pt,aa).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const e=Qt.prototype;return Ht(this,"_keyboardManager",new vc([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:h(this,ii)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:h(this,mn),methodOfCreation:h(this,dc)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,i){var n;we.initialize(e,i),Qt._defaultColor||(Qt._defaultColor=((n=i.highlightColors)==null?void 0:n.values().next().value)||"#fff066")}static updateDefaultParams(e,i){switch(e){case Vt.HIGHLIGHT_DEFAULT_COLOR:Qt._defaultColor=i;break;case Vt.HIGHLIGHT_THICKNESS:Qt._defaultThickness=i;break}}translateInPage(e,i){}get toolbarPosition(){return h(this,Ml)}updateParams(e,i){switch(e){case Vt.HIGHLIGHT_COLOR:C(this,Pt,tb).call(this,i);break;case Vt.HIGHLIGHT_THICKNESS:C(this,Pt,eb).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[Vt.HIGHLIGHT_DEFAULT_COLOR,Qt._defaultColor],[Vt.HIGHLIGHT_THICKNESS,Qt._defaultThickness]]}get propertiesToUpdate(){return[[Vt.HIGHLIGHT_COLOR,this.color||Qt._defaultColor],[Vt.HIGHLIGHT_THICKNESS,h(this,mn)||Qt._defaultThickness],[Vt.HIGHLIGHT_FREE,h(this,ii)]]}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(_(this,Fl,new yd({editor:this})),e.addColorPicker(h(this,Fl))),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(C(this,Pt,xh).call(this))}getBaseTranslation(){return[0,0]}getRect(e,i){return super.getRect(e,i,C(this,Pt,xh).call(this))}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){C(this,Pt,Kp).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(C(this,Pt,aa).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var n;let i=!1;this.parent&&!e?C(this,Pt,Kp).call(this):e&&(C(this,Pt,aa).call(this,e),i=!this.parent&&((n=this.div)==null?void 0:n.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),i&&this.select()}rotate(e){var s,r,a;const{drawLayer:i}=this.parent;let n;h(this,ii)?(e=(e-this.rotation+360)%360,n=C(s=Qt,wn,No).call(s,h(this,gn).box,e)):n=C(r=Qt,wn,No).call(r,[this.x,this.y,this.width,this.height],e),i.updateProperties(h(this,Ji),{bbox:n,root:{"data-main-rotation":e}}),i.updateProperties(h(this,gi),{bbox:C(a=Qt,wn,No).call(a,h(this,Ui).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();h(this,Bl)&&(e.setAttribute("aria-label",h(this,Bl)),e.setAttribute("role","mark")),h(this,ii)?e.classList.add("free"):this.div.addEventListener("keydown",C(this,Pt,nb).bind(this),{signal:this._uiManager._signal});const i=_(this,eo,document.createElement("div"));e.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=h(this,to);const[n,s]=this.parentDimensions;return this.setDims(this.width*n,this.height*s),gd(this,h(this,eo),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(h(this,gi),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(h(this,gi),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:C(this,Pt,id).call(this,!0);break;case 1:case 3:C(this,Pt,id).call(this,!1);break}}select(){var e;super.select(),h(this,gi)&&((e=this.parent)==null||e.drawLayer.updateProperties(h(this,gi),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),h(this,gi)&&((e=this.parent)==null||e.drawLayer.updateProperties(h(this,gi),{rootClass:{selected:!1}}),h(this,ii)||C(this,Pt,id).call(this,!1))}get _mustFixPosition(){return!h(this,ii)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(h(this,Ji),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(h(this,gi),{rootClass:{hidden:!e}}))}static startHighlighting(e,i,{target:n,x:s,y:r}){const{x:a,y:l,width:u,height:c}=n.getBoundingClientRect(),d=new AbortController,f=e.combinedSignal(d),p=b=>{d.abort(),C(this,wn,ob).call(this,e,b)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",an,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",Kn,{signal:f}),n.addEventListener("pointermove",C(this,wn,ab).bind(this,e),{signal:f}),this._freeHighlight=new Vp({x:s,y:r},[a,l,u,c],e.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,i,n){var y,g,m,w;let s=null;if(e instanceof N0){const{data:{quadPoints:E,rect:R,rotation:A,id:T,color:k,opacity:P,popupRef:F},parent:{page:{pageNumber:B}}}=e;s=e={annotationType:Nt.HIGHLIGHT,color:Array.from(k),opacity:P,quadPoints:E,boxes:null,pageIndex:B-1,rect:R.slice(0),rotation:A,id:T,deleted:!1,popupRef:F}}else if(e instanceof Og){const{data:{inkLists:E,rect:R,rotation:A,id:T,color:k,borderStyle:{rawWidth:P},popupRef:F},parent:{page:{pageNumber:B}}}=e;s=e={annotationType:Nt.HIGHLIGHT,color:Array.from(k),thickness:P,inkLists:E,boxes:null,pageIndex:B-1,rect:R.slice(0),rotation:A,id:T,deleted:!1,popupRef:F}}const{color:r,quadPoints:a,inkLists:l,opacity:u}=e,c=await super.deserialize(e,i,n);c.color=Et.makeHexColor(...r),_(c,Qs,u||1),l&&_(c,mn,e.thickness),c.annotationElementId=e.id||null,c._initialData=s;const[d,f]=c.pageDimensions,[p,b]=c.pageTranslation;if(a){const E=_(c,Zs,[]);for(let R=0;R<a.length;R+=8)E.push({x:(a[R]-p)/d,y:1-(a[R+1]-b)/f,width:(a[R+2]-a[R])/d,height:(a[R+1]-a[R+5])/f});C(y=c,Pt,Yp).call(y),C(g=c,Pt,aa).call(g),c.rotate(c.rotation)}else if(l){_(c,ii,!0);const E=l[0],R={x:E[0]-p,y:f-(E[1]-b)},A=new Vp(R,[0,0,d,f],1,h(c,mn)/2,!0,.001);for(let P=0,F=E.length;P<F;P+=2)R.x=E[P]-p,R.y=f-(E[P+1]-b),A.add(R);const{id:T,clipPathId:k}=i.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:A.toSVGPath()}},!0,!0);C(m=c,Pt,ed).call(m,{highlightOutlines:A.getOutlines(),highlightId:T,clipPathId:k}),C(w=c,Pt,aa).call(w)}return c}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const i=this.getRect(0,0),n=we._colorManager.convert(this.color),s={annotationType:Nt.HIGHLIGHT,color:n,opacity:h(this,Qs),thickness:h(this,mn),quadPoints:C(this,Pt,sb).call(this),outlines:C(this,Pt,rb).call(this,i),pageIndex:this.pageIndex,rect:i,rotation:C(this,Pt,xh).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!C(this,Pt,lb).call(this,s)?null:(s.id=this.annotationElementId,s)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Ol=new WeakMap,hc=new WeakMap,Zs=new WeakMap,to=new WeakMap,Fl=new WeakMap,Ui=new WeakMap,uc=new WeakMap,cc=new WeakMap,eo=new WeakMap,gn=new WeakMap,Ji=new WeakMap,ii=new WeakMap,Ml=new WeakMap,Qs=new WeakMap,gi=new WeakMap,Bl=new WeakMap,mn=new WeakMap,dc=new WeakMap,Pt=new WeakSet,Yp=function(){const e=new Wp(h(this,Zs),.001);_(this,gn,e.getOutlines()),[this.x,this.y,this.width,this.height]=h(this,gn).box;const i=new Wp(h(this,Zs),.0025,.001,this._uiManager.direction==="ltr");_(this,Ui,i.getOutlines());const{lastPoint:n}=h(this,Ui);_(this,Ml,[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height])},ed=function({highlightOutlines:e,highlightId:i,clipPathId:n}){var d,f;if(_(this,gn,e),_(this,Ui,e.getNewOutline(h(this,mn)/2+1.5,.0025)),i>=0)_(this,Ji,i),_(this,to,n),this.parent.drawLayer.finalizeDraw(i,{bbox:e.box,path:{d:e.toSVGPath()}}),_(this,gi,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:h(this,Ui).box,path:{d:h(this,Ui).toSVGPath()}},!0));else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(h(this,Ji),{bbox:C(d=Qt,wn,No).call(d,h(this,gn).box,(p-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(h(this,gi),{bbox:C(f=Qt,wn,No).call(f,h(this,Ui).box,p),path:{d:h(this,Ui).toSVGPath()}})}const[r,a,l,u]=e.box;switch(this.rotation){case 0:this.x=r,this.y=a,this.width=l,this.height=u;break;case 90:{const[p,b]=this.parentDimensions;this.x=a,this.y=1-r,this.width=l*b/p,this.height=u*p/b;break}case 180:this.x=1-r,this.y=1-a,this.width=l,this.height=u;break;case 270:{const[p,b]=this.parentDimensions;this.x=1-a,this.y=r,this.width=l*b/p,this.height=u*p/b;break}}const{lastPoint:c}=h(this,Ui);_(this,Ml,[(c[0]-r)/l,(c[1]-a)/u])},tb=function(e){const i=(r,a)=>{var l,u;this.color=r,_(this,Qs,a),(l=this.parent)==null||l.drawLayer.updateProperties(h(this,Ji),{root:{fill:r,"fill-opacity":a}}),(u=h(this,Fl))==null||u.updateColor(r)},n=this.color,s=h(this,Qs);this.addCommands({cmd:i.bind(this,e,Qt._defaultOpacity),undo:i.bind(this,n,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Vt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)},eb=function(e){const i=h(this,mn),n=s=>{_(this,mn,s),C(this,Pt,ib).call(this,s)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Vt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},ib=function(e){if(!h(this,ii))return;C(this,Pt,ed).call(this,{highlightOutlines:h(this,gn).getNewOutline(e/2)}),this.fixAndSetPosition();const[i,n]=this.parentDimensions;this.setDims(this.width*i,this.height*n)},Kp=function(){h(this,Ji)===null||!this.parent||(this.parent.drawLayer.remove(h(this,Ji)),_(this,Ji,null),this.parent.drawLayer.remove(h(this,gi)),_(this,gi,null))},aa=function(e=this.parent){h(this,Ji)===null&&({id:Ai(this,Ji)._,clipPathId:Ai(this,to)._}=e.drawLayer.draw({bbox:h(this,gn).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":h(this,Qs)},rootClass:{highlight:!0,free:h(this,ii)},path:{d:h(this,gn).toSVGPath()}},!1,!0),_(this,gi,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:h(this,ii)},bbox:h(this,Ui).box,path:{d:h(this,Ui).toSVGPath()}},h(this,ii))),h(this,eo)&&(h(this,eo).style.clipPath=h(this,to)))},wn=new WeakSet,No=function([e,i,n,s],r){switch(r){case 90:return[1-i-s,e,s,n];case 180:return[1-e-n,1-i-s,n,s];case 270:return[i,1-e-n,s,n]}return[e,i,n,s]},nb=function(e){Qt._keyboardManager.exec(this,e)},id=function(e){if(!h(this,Ol))return;const i=window.getSelection();e?i.setPosition(h(this,Ol),h(this,hc)):i.setPosition(h(this,uc),h(this,cc))},xh=function(){return h(this,ii)?this.rotation:0},sb=function(){if(h(this,ii))return null;const[e,i]=this.pageDimensions,[n,s]=this.pageTranslation,r=h(this,Zs),a=new Float32Array(r.length*8);let l=0;for(const{x:u,y:c,width:d,height:f}of r){const p=u*e+n,b=(1-c)*i+s;a[l]=a[l+4]=p,a[l+1]=a[l+3]=b,a[l+2]=a[l+6]=p+d*e,a[l+5]=a[l+7]=b-f*i,l+=8}return a},rb=function(e){return h(this,gn).serialize(e,C(this,Pt,xh).call(this))},ab=function(e,i){this._freeHighlight.add(i)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},ob=function(e,i){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},lb=function(e){const{color:i}=this._initialData;return e.color.some((n,s)=>n!==i[s])},x(Qt,wn),Dt(Qt,"_defaultColor",null),Dt(Qt,"_defaultOpacity",1),Dt(Qt,"_defaultThickness",12),Dt(Qt,"_type","highlight"),Dt(Qt,"_editorType",Nt.HIGHLIGHT),Dt(Qt,"_freeHighlightId",-1),Dt(Qt,"_freeHighlight",null),Dt(Qt,"_freeHighlightClipId","");let wd=Qt;var io;class V2{constructor(){x(this,io,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,i]of Object.entries(t))this.updateProperty(e,i)}updateSVGProperty(t,e){h(this,io)[t]=e}toSVGProperties(){const t=h(this,io);return _(this,io,Object.create(null)),{root:t}}reset(){_(this,io,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){le("Not implemented")}}io=new WeakMap;var tn,zl,Ye,no,so,Ur,Hr,jr,ro,Xt,Qp,Jp,tg,Sh,hb,nd,Ch,Oo;const vt=class vt extends we{constructor(e){super(e);x(this,Xt);x(this,tn,null);x(this,zl);Dt(this,"_drawId",null);_(this,zl,e.mustBeCommitted||!1),e.drawOutlines&&(C(this,Xt,Qp).call(this,e),C(this,Xt,Sh).call(this))}static _mergeSVGProperties(e,i){const n=new Set(Object.keys(e));for(const[s,r]of Object.entries(i))n.has(s)?Object.assign(e[s],r):e[s]=r;return e}static getDefaultDrawingOptions(e){le("Not implemented")}static get typesMap(){le("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,i){const n=this.typesMap.get(e);n&&this._defaultDrawingOptions.updateProperty(n,i),this._currentParent&&(h(vt,Ye).updateProperty(n,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,i){const n=this.constructor.typesMap.get(e);n&&this._updateProperty(e,n,i)}static get defaultPropertiesToUpdate(){const e=[],i=this._defaultDrawingOptions;for(const[n,s]of this.typesMap)e.push([n,i[s]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:i}=this;for(const[n,s]of this.constructor.typesMap)e.push([n,i[s]]);return e}_updateProperty(e,i,n){const s=this._drawingOptions,r=s[i],a=l=>{var c;s.updateProperty(i,l);const u=h(this,tn).updateProperty(i,l);u&&C(this,Xt,Ch).call(this,u),(c=this.parent)==null||c.drawLayer.updateProperties(this._drawId,s.toSVGProperties())};this.addCommands({cmd:a.bind(this,n),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,vt._mergeSVGProperties(h(this,tn).getPathResizingSVGProperties(C(this,Xt,nd).call(this)),{bbox:C(this,Xt,Oo).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,vt._mergeSVGProperties(h(this,tn).getPathResizedSVGProperties(C(this,Xt,nd).call(this)),{bbox:C(this,Xt,Oo).call(this)}))}_onTranslating(e,i){var n;(n=this.parent)==null||n.drawLayer.updateProperties(this._drawId,{bbox:C(this,Xt,Oo).call(this,e,i)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,vt._mergeSVGProperties(h(this,tn).getPathTranslatedSVGProperties(C(this,Xt,nd).call(this),this.parentDimensions),{bbox:C(this,Xt,Oo).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,h(this,zl)&&(_(this,zl,!1),this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){C(this,Xt,tg).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(C(this,Xt,Sh).call(this),C(this,Xt,Ch).call(this,h(this,tn).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var n;let i=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),C(this,Xt,tg).call(this)):e&&(this._uiManager.addShouldRescale(this),C(this,Xt,Sh).call(this,e),i=!this.parent&&((n=this.div)==null?void 0:n.classList.contains("selectedEditor"))),super.setParent(e),i&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,vt._mergeSVGProperties({bbox:C(this,Xt,Oo).call(this)},h(this,tn).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&C(this,Xt,Ch).call(this,h(this,tn).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const e=super.render();e.classList.add("draw");const i=document.createElement("div");e.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[n,s]=this.parentDimensions;return this.setDims(this.width*n,this.height*s),this._uiManager.addShouldRescale(this),this.disableEditing(),e}static createDrawerInstance(e,i,n,s,r){le("Not implemented")}static startDrawing(e,i,n,s){var g;const{target:r,offsetX:a,offsetY:l,pointerId:u,pointerType:c}=s;if(h(vt,Hr)&&h(vt,Hr)!==c)return;const{viewport:{rotation:d}}=e,{width:f,height:p}=r.getBoundingClientRect(),b=_(vt,no,new AbortController),y=e.combinedSignal(b);if(h(vt,Ur)||_(vt,Ur,u),h(vt,Hr)??_(vt,Hr,c),window.addEventListener("pointerup",m=>{var w;h(vt,Ur)===m.pointerId?this._endDraw(m):(w=h(vt,jr))==null||w.delete(m.pointerId)},{signal:y}),window.addEventListener("pointercancel",m=>{var w;h(vt,Ur)===m.pointerId?this._currentParent.endDrawingSession():(w=h(vt,jr))==null||w.delete(m.pointerId)},{signal:y}),window.addEventListener("pointerdown",m=>{h(vt,Hr)===m.pointerType&&((h(vt,jr)||_(vt,jr,new Set)).add(m.pointerId),h(vt,Ye).isCancellable()&&(h(vt,Ye).removeLastElement(),h(vt,Ye).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Kn,{signal:y}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),r.addEventListener("touchmove",m=>{m.timeStamp===h(vt,ro)&&an(m)},{signal:y}),e.toggleDrawing(),(g=i._editorUndoBar)==null||g.hide(),h(vt,Ye)){e.drawLayer.updateProperties(this._currentDrawId,h(vt,Ye).startNew(a,l,f,p,d));return}i.updateUIForDefaultProperties(this),_(vt,Ye,this.createDrawerInstance(a,l,f,p,d)),_(vt,so,this.getDefaultDrawingOptions()),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(h(vt,so).toSVGProperties(),h(vt,Ye).defaultSVGProperties),!0,!1)}static _drawMove(e){var r;if(_(vt,ro,-1),!h(vt,Ye))return;const{offsetX:i,offsetY:n,pointerId:s}=e;if(h(vt,Ur)===s){if(((r=h(vt,jr))==null?void 0:r.size)>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,h(vt,Ye).add(i,n)),_(vt,ro,e.timeStamp),an(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,_(vt,Ye,null),_(vt,so,null),_(vt,Hr,null),_(vt,ro,NaN)),h(vt,no)&&(h(vt,no).abort(),_(vt,no,null),_(vt,Ur,NaN),_(vt,jr,null))}static _endDraw(e){const i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),e&&i.drawLayer.updateProperties(this._currentDrawId,h(vt,Ye).end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const n=h(vt,Ye),s=this._currentDrawId,r=n.getLastElement();i.addCommands({cmd:()=>{i.drawLayer.updateProperties(s,n.setLastElement(r))},undo:()=>{i.drawLayer.updateProperties(s,n.removeLastElement())},mustExec:!1,type:Vt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(Vt.DRAW_STEP),!h(vt,Ye).isEmpty()){const{pageDimensions:[n,s],scale:r}=i,a=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:h(vt,Ye).getOutlines(n*r,s*r,r,this._INNER_MARGIN),drawingOptions:h(vt,so),mustBeCommitted:!e});return this._cleanup(!0),a}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,i,n,s,r,a){le("Not implemented")}static async deserialize(e,i,n){var d,f;const{rawDims:{pageWidth:s,pageHeight:r,pageX:a,pageY:l}}=i.viewport,u=this.deserializeDraw(a,l,s,r,this._INNER_MARGIN,e),c=await super.deserialize(e,i,n);return c.createDrawingOptions(e),C(d=c,Xt,Qp).call(d,{drawOutlines:u}),C(f=c,Xt,Sh).call(f),c.onScaleChanging(),c.rotate(),c}serializeDraw(e){const[i,n]=this.pageTranslation,[s,r]=this.pageDimensions;return h(this,tn).serialize([i,n,s,r],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};tn=new WeakMap,zl=new WeakMap,Ye=new WeakMap,no=new WeakMap,so=new WeakMap,Ur=new WeakMap,Hr=new WeakMap,jr=new WeakMap,ro=new WeakMap,Xt=new WeakSet,Qp=function({drawOutlines:e,drawId:i,drawingOptions:n}){_(this,tn,e),this._drawingOptions||(this._drawingOptions=n),i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,e.defaultProperties)):this._drawId=C(this,Xt,Jp).call(this,e,this.parent),C(this,Xt,Ch).call(this,e.box)},Jp=function(e,i){const{id:n}=i.drawLayer.draw(vt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return n},tg=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Sh=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=C(this,Xt,Jp).call(this,h(this,tn),e)}},hb=function([e,i,n,s]){const{parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[i,1-e,n*(a/r),s*(r/a)];case 180:return[1-e,1-i,n,s];case 270:return[1-i,e,n*(a/r),s*(r/a)];default:return[e,i,n,s]}},nd=function(){const{x:e,y:i,width:n,height:s,parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[1-i,e,n*(r/a),s*(a/r)];case 180:return[1-e,1-i,n,s];case 270:return[i,1-e,n*(r/a),s*(a/r)];default:return[e,i,n,s]}},Ch=function(e){if([this.x,this.y,this.width,this.height]=C(this,Xt,hb).call(this,e),this.div){this.fixAndSetPosition();const[i,n]=this.parentDimensions;this.setDims(this.width*i,this.height*n)}this._onResized()},Oo=function(){const{x:e,y:i,width:n,height:s,rotation:r,parentRotation:a,parentDimensions:[l,u]}=this;switch((r*4+a)/90){case 1:return[1-i-s,e,s,n];case 2:return[1-e-n,1-i-s,n,s];case 3:return[i,1-e-n,s,n];case 4:return[e,i-n*(l/u),s*(u/l),n*(l/u)];case 5:return[1-i,e,n*(l/u),s*(u/l)];case 6:return[1-e-s*(u/l),1-i,s*(u/l),n*(l/u)];case 7:return[i-n*(l/u),1-e-s*(u/l),n*(l/u),s*(u/l)];case 8:return[e-n,i-s,n,s];case 9:return[1-i,e-n,s,n];case 10:return[1-e,1-i,n,s];case 11:return[i-s,1-e,s,n];case 12:return[e-s*(u/l),i,s*(u/l),n*(l/u)];case 13:return[1-i-n*(l/u),e-s*(u/l),n*(l/u),s*(u/l)];case 14:return[1-e,1-i-n*(l/u),s*(u/l),n*(l/u)];case 15:return[i,1-e,n*(l/u),s*(u/l)];default:return[e,i,n,s]}},Dt(vt,"_currentDrawId",-1),Dt(vt,"_currentParent",null),x(vt,Ye,null),x(vt,no,null),x(vt,so,null),x(vt,Ur,NaN),x(vt,Hr,null),x(vt,jr,null),x(vt,ro,NaN),Dt(vt,"_INNER_MARGIN",3);let Zp=vt;var fs,Ke,Ze,ao,Ul,Si,ni,vn,oo,lo,ho,Hl,sd;class G2{constructor(t,e,i,n,s,r){x(this,Hl);x(this,fs,new Float64Array(6));x(this,Ke);x(this,Ze);x(this,ao);x(this,Ul);x(this,Si);x(this,ni,"");x(this,vn,0);x(this,oo,new _d);x(this,lo);x(this,ho);_(this,lo,i),_(this,ho,n),_(this,ao,s),_(this,Ul,r),[t,e]=C(this,Hl,sd).call(this,t,e);const a=_(this,Ke,[NaN,NaN,NaN,NaN,t,e]);_(this,Si,[t,e]),_(this,Ze,[{line:a,points:h(this,Si)}]),h(this,fs).set(a,0)}updateProperty(t,e){t==="stroke-width"&&_(this,Ul,e)}isEmpty(){return!h(this,Ze)||h(this,Ze).length===0}isCancellable(){return h(this,Si).length<=10}add(t,e){[t,e]=C(this,Hl,sd).call(this,t,e);const[i,n,s,r]=h(this,fs).subarray(2,6),a=t-s,l=e-r;return Math.hypot(h(this,lo)*a,h(this,ho)*l)<=2?null:(h(this,Si).push(t,e),isNaN(i)?(h(this,fs).set([s,r,t,e],2),h(this,Ke).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(h(this,fs)[0])&&h(this,Ke).splice(6,6),h(this,fs).set([i,n,s,r,t,e],0),h(this,Ke).push(...mt.createBezierPoints(i,n,s,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const i=this.add(t,e);return i||(h(this,Si).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,i,n,s){_(this,lo,i),_(this,ho,n),_(this,ao,s),[t,e]=C(this,Hl,sd).call(this,t,e);const r=_(this,Ke,[NaN,NaN,NaN,NaN,t,e]);_(this,Si,[t,e]);const a=h(this,Ze).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),h(this,Ze).push({line:r,points:h(this,Si)}),h(this,fs).set(r,0),_(this,vn,0),this.toSVGPath(),null}getLastElement(){return h(this,Ze).at(-1)}setLastElement(t){return h(this,Ze)?(h(this,Ze).push(t),_(this,Ke,t.line),_(this,Si,t.points),_(this,vn,0),{path:{d:this.toSVGPath()}}):h(this,oo).setLastElement(t)}removeLastElement(){if(!h(this,Ze))return h(this,oo).removeLastElement();h(this,Ze).pop(),_(this,ni,"");for(let t=0,e=h(this,Ze).length;t<e;t++){const{line:i,points:n}=h(this,Ze)[t];_(this,Ke,i),_(this,Si,n),_(this,vn,0),this.toSVGPath()}return{path:{d:h(this,ni)}}}toSVGPath(){const t=mt.svgRound(h(this,Ke)[4]),e=mt.svgRound(h(this,Ke)[5]);if(h(this,Si).length===2)return _(this,ni,`${h(this,ni)} M ${t} ${e} Z`),h(this,ni);if(h(this,Si).length<=6){const n=h(this,ni).lastIndexOf("M");_(this,ni,`${h(this,ni).slice(0,n)} M ${t} ${e}`),_(this,vn,6)}if(h(this,Si).length===4){const n=mt.svgRound(h(this,Ke)[10]),s=mt.svgRound(h(this,Ke)[11]);return _(this,ni,`${h(this,ni)} L ${n} ${s}`),_(this,vn,12),h(this,ni)}const i=[];h(this,vn)===0&&(i.push(`M ${t} ${e}`),_(this,vn,6));for(let n=h(this,vn),s=h(this,Ke).length;n<s;n+=6){const[r,a,l,u,c,d]=h(this,Ke).slice(n,n+6).map(mt.svgRound);i.push(`C${r} ${a} ${l} ${u} ${c} ${d}`)}return _(this,ni,h(this,ni)+i.join(" ")),_(this,vn,h(this,Ke).length),h(this,ni)}getOutlines(t,e,i,n){const s=h(this,Ze).at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),h(this,oo).build(h(this,Ze),t,e,i,h(this,ao),h(this,Ul),n),_(this,fs,null),_(this,Ke,null),_(this,Ze,null),_(this,ni,null),h(this,oo)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}fs=new WeakMap,Ke=new WeakMap,Ze=new WeakMap,ao=new WeakMap,Ul=new WeakMap,Si=new WeakMap,ni=new WeakMap,vn=new WeakMap,oo=new WeakMap,lo=new WeakMap,ho=new WeakMap,Hl=new WeakSet,sd=function(t,e){return mt._normalizePoint(t,e,h(this,lo),h(this,ho),h(this,ao))};var Ci,fc,pc,en,ps,gs,jl,Wl,ql,ri,ks,ub,cb,db;const hm=class hm extends mt{constructor(){super(...arguments);x(this,ri);x(this,Ci);x(this,fc,0);x(this,pc);x(this,en);x(this,ps);x(this,gs);x(this,jl);x(this,Wl);x(this,ql)}build(e,i,n,s,r,a,l){_(this,ps,i),_(this,gs,n),_(this,jl,s),_(this,Wl,r),_(this,ql,a),_(this,pc,l??0),_(this,en,e),C(this,ri,cb).call(this)}setLastElement(e){return h(this,en).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return h(this,en).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:i}of h(this,en)){if(e.push(`M${mt.svgRound(i[4])} ${mt.svgRound(i[5])}`),i.length===6){e.push("Z");continue}if(i.length===12){e.push(`L${mt.svgRound(i[10])} ${mt.svgRound(i[11])}`);continue}for(let n=6,s=i.length;n<s;n+=6){const[r,a,l,u,c,d]=i.subarray(n,n+6).map(mt.svgRound);e.push(`C${r} ${a} ${l} ${u} ${c} ${d}`)}}return e.join("")}serialize([e,i,n,s],r){const a=[],l=[],[u,c,d,f]=C(this,ri,ub).call(this);let p,b,y,g,m,w,E,R,A;switch(h(this,Wl)){case 0:A=mt._rescale,p=e,b=i+s,y=n,g=-s,m=e+u*n,w=i+(1-c-f)*s,E=e+(u+d)*n,R=i+(1-c)*s;break;case 90:A=mt._rescaleAndSwap,p=e,b=i,y=n,g=s,m=e+c*n,w=i+u*s,E=e+(c+f)*n,R=i+(u+d)*s;break;case 180:A=mt._rescale,p=e+n,b=i,y=-n,g=s,m=e+(1-u-d)*n,w=i+c*s,E=e+(1-u)*n,R=i+(c+f)*s;break;case 270:A=mt._rescaleAndSwap,p=e+n,b=i+s,y=-n,g=-s,m=e+(1-c-f)*n,w=i+(1-u-d)*s,E=e+(1-c)*n,R=i+(1-u)*s;break}for(const{line:T,points:k}of h(this,en))a.push(A(T,p,b,y,g,r?new Array(T.length):null)),l.push(A(k,p,b,y,g,r?new Array(k.length):null));return{lines:a,points:l,rect:[m,w,E,R]}}static deserialize(e,i,n,s,r,{paths:{lines:a,points:l},rotation:u,thickness:c}){const d=[];let f,p,b,y,g;switch(u){case 0:g=mt._rescale,f=-e/n,p=i/s+1,b=1/n,y=-1/s;break;case 90:g=mt._rescaleAndSwap,f=-i/s,p=-e/n,b=1/s,y=1/n;break;case 180:g=mt._rescale,f=e/n+1,p=-i/s,b=-1/n,y=1/s;break;case 270:g=mt._rescaleAndSwap,f=i/s+1,p=e/n+1,b=-1/s,y=-1/n;break}if(!a){a=[];for(const w of l){const E=w.length;if(E===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(E===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const R=new Float32Array(3*(E-2));a.push(R);let[A,T,k,P]=w.subarray(0,4);R.set([NaN,NaN,NaN,NaN,A,T],0);for(let F=4;F<E;F+=2){const B=w[F],W=w[F+1];R.set(mt.createBezierPoints(A,T,k,P,B,W),(F-2)*3),[A,T,k,P]=[k,P,B,W]}}}for(let w=0,E=a.length;w<E;w++)d.push({line:g(a[w].map(R=>R??NaN),f,p,b,y),points:g(l[w].map(R=>R??NaN),f,p,b,y)});const m=new hm;return m.build(d,n,s,1,u,c,r),m}get box(){return h(this,Ci)}updateProperty(e,i){return e==="stroke-width"?C(this,ri,db).call(this,i):null}updateParentDimensions([e,i],n){const[s,r]=C(this,ri,ks).call(this);_(this,ps,e),_(this,gs,i),_(this,jl,n);const[a,l]=C(this,ri,ks).call(this),u=a-s,c=l-r,d=h(this,Ci);return d[0]-=u,d[1]-=c,d[2]+=2*u,d[3]+=2*c,d}updateRotation(e){return _(this,fc,e),{path:{transform:this.rotationTransform}}}get viewBox(){return h(this,Ci).map(mt.svgRound).join(" ")}get defaultProperties(){const[e,i]=h(this,Ci);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${mt.svgRound(e)} ${mt.svgRound(i)}`}}}get rotationTransform(){const[,,e,i]=h(this,Ci);let n=0,s=0,r=0,a=0,l=0,u=0;switch(h(this,fc)){case 90:s=i/e,r=-e/i,l=e;break;case 180:n=-1,a=-1,l=e,u=i;break;case 270:s=-i/e,r=e/i,u=i;break;default:return""}return`matrix(${n} ${s} ${r} ${a} ${mt.svgRound(l)} ${mt.svgRound(u)})`}getPathResizingSVGProperties([e,i,n,s]){const[r,a]=C(this,ri,ks).call(this),[l,u,c,d]=h(this,Ci);if(Math.abs(c-r)<=mt.PRECISION||Math.abs(d-a)<=mt.PRECISION){const g=e+n/2-(l+c/2),m=i+s/2-(u+d/2);return{path:{"transform-origin":`${mt.svgRound(e)} ${mt.svgRound(i)}`,transform:`${this.rotationTransform} translate(${g} ${m})`}}}const f=(n-2*r)/(c-2*r),p=(s-2*a)/(d-2*a),b=c/n,y=d/s;return{path:{"transform-origin":`${mt.svgRound(l)} ${mt.svgRound(u)}`,transform:`${this.rotationTransform} scale(${b} ${y}) translate(${mt.svgRound(r)} ${mt.svgRound(a)}) scale(${f} ${p}) translate(${mt.svgRound(-r)} ${mt.svgRound(-a)})`}}}getPathResizedSVGProperties([e,i,n,s]){const[r,a]=C(this,ri,ks).call(this),l=h(this,Ci),[u,c,d,f]=l;if(l[0]=e,l[1]=i,l[2]=n,l[3]=s,Math.abs(d-r)<=mt.PRECISION||Math.abs(f-a)<=mt.PRECISION){const m=e+n/2-(u+d/2),w=i+s/2-(c+f/2);for(const{line:E,points:R}of h(this,en))mt._translate(E,m,w,E),mt._translate(R,m,w,R);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${mt.svgRound(e)} ${mt.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(n-2*r)/(d-2*r),b=(s-2*a)/(f-2*a),y=-p*(u+r)+e+r,g=-b*(c+a)+i+a;if(p!==1||b!==1||y!==0||g!==0)for(const{line:m,points:w}of h(this,en))mt._rescale(m,y,g,p,b,m),mt._rescale(w,y,g,p,b,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${mt.svgRound(e)} ${mt.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,i],n){const[s,r]=n,a=h(this,Ci),l=e-a[0],u=i-a[1];if(h(this,ps)===s&&h(this,gs)===r)for(const{line:c,points:d}of h(this,en))mt._translate(c,l,u,c),mt._translate(d,l,u,d);else{const c=h(this,ps)/s,d=h(this,gs)/r;_(this,ps,s),_(this,gs,r);for(const{line:f,points:p}of h(this,en))mt._rescale(f,l,u,c,d,f),mt._rescale(p,l,u,c,d,p);a[2]*=c,a[3]*=d}return a[0]=e,a[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${mt.svgRound(e)} ${mt.svgRound(i)}`}}}get defaultSVGProperties(){const e=h(this,Ci);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${mt.svgRound(e[0])} ${mt.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}};Ci=new WeakMap,fc=new WeakMap,pc=new WeakMap,en=new WeakMap,ps=new WeakMap,gs=new WeakMap,jl=new WeakMap,Wl=new WeakMap,ql=new WeakMap,ri=new WeakSet,ks=function(e=h(this,ql)){const i=h(this,pc)+e/2*h(this,jl);return h(this,Wl)%180===0?[i/h(this,ps),i/h(this,gs)]:[i/h(this,gs),i/h(this,ps)]},ub=function(){const[e,i,n,s]=h(this,Ci),[r,a]=C(this,ri,ks).call(this,0);return[e+r,i+a,n-2*r,s-2*a]},cb=function(){const e=_(this,Ci,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:s}of h(this,en)){if(s.length<=12){for(let l=4,u=s.length;l<u;l+=6){const[c,d]=s.subarray(l,l+2);e[0]=Math.min(e[0],c),e[1]=Math.min(e[1],d),e[2]=Math.max(e[2],c),e[3]=Math.max(e[3],d)}continue}let r=s[4],a=s[5];for(let l=6,u=s.length;l<u;l+=6){const[c,d,f,p,b,y]=s.subarray(l,l+6);Et.bezierBoundingBox(r,a,c,d,f,p,b,y,e),r=b,a=y}}const[i,n]=C(this,ri,ks).call(this);e[0]=Math.min(1,Math.max(0,e[0]-i)),e[1]=Math.min(1,Math.max(0,e[1]-n)),e[2]=Math.min(1,Math.max(0,e[2]+i)),e[3]=Math.min(1,Math.max(0,e[3]+n)),e[2]-=e[0],e[3]-=e[1]},db=function(e){const[i,n]=C(this,ri,ks).call(this);_(this,ql,e);const[s,r]=C(this,ri,ks).call(this),[a,l]=[s-i,r-n],u=h(this,Ci);return u[0]-=a,u[1]-=l,u[2]+=2*a,u[3]+=2*l,u};let _d=hm;var Vl;const um=class um extends V2{constructor(e){super();x(this,Vl);_(this,Vl,e),super.updateProperties({fill:"none",stroke:we._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,i){e==="stroke-width"&&(i??(i=this["stroke-width"]),i*=h(this,Vl).realScale),super.updateSVGProperty(e,i)}clone(){const e=new um(h(this,Vl));return e.updateAll(this),e}};Vl=new WeakMap;let eg=um;var rf,fb;const Ho=class Ho extends Zp{constructor(e){super({...e,name:"inkEditor"});x(this,rf);this._willKeepAspectRatio=!0}static initialize(e,i){we.initialize(e,i),this._defaultDrawingOptions=new eg(i.viewParameters)}static getDefaultDrawingOptions(e){const i=this._defaultDrawingOptions.clone();return i.updateProperties(e),i}static get supportMultipleDrawings(){return!0}static get typesMap(){return Ht(this,"typesMap",new Map([[Vt.INK_THICKNESS,"stroke-width"],[Vt.INK_COLOR,"stroke"],[Vt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,i,n,s,r){return new G2(e,i,n,s,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,i,n,s,r,a){return _d.deserialize(e,i,n,s,r,a)}static async deserialize(e,i,n){let s=null;if(e instanceof Og){const{data:{inkLists:a,rect:l,rotation:u,id:c,color:d,opacity:f,borderStyle:{rawWidth:p},popupRef:b},parent:{page:{pageNumber:y}}}=e;s=e={annotationType:Nt.INK,color:Array.from(d),thickness:p,opacity:f,paths:{points:a},boxes:null,pageIndex:y-1,rect:l.slice(0),rotation:u,id:c,deleted:!1,popupRef:b}}const r=await super.deserialize(e,i,n);return r.annotationElementId=e.id||null,r._initialData=s,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:i,parent:n}=this;i.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(e,i.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:i,opacity:n}){this._drawingOptions=Ho.getDefaultDrawingOptions({stroke:Et.makeHexColor(...e),"stroke-width":i,"stroke-opacity":n})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:i,points:n,rect:s}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":l}}=this,u={annotationType:Nt.INK,color:we._colorManager.convert(r),opacity:a,thickness:l,paths:{lines:i,points:n},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?u:this.annotationElementId&&!C(this,rf,fb).call(this,u)?null:(u.id=this.annotationElementId,u)}renderAnnotationElement(e){const{points:i,rect:n}=this.serializeDraw(!1);return e.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:i}),null}};rf=new WeakSet,fb=function(e){const{color:i,thickness:n,opacity:s,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((a,l)=>a!==i[l])||e.thickness!==n||e.opacity!==s||e.pageIndex!==r},Dt(Ho,"_type","ink"),Dt(Ho,"_editorType",Nt.INK),Dt(Ho,"_defaultDrawingOptions",null);let ig=Ho;var ye,si,Wr,Js,qr,Gl,ms,vs,nn,$l,Kt,Th,Dh,rd,sg,ad,rg,od,pb;const Nh=class Nh extends we{constructor(e){super({...e,name:"stampEditor"});x(this,Kt);x(this,ye,null);x(this,si,null);x(this,Wr,null);x(this,Js,null);x(this,qr,null);x(this,Gl,"");x(this,ms,null);x(this,vs,null);x(this,nn,!1);x(this,$l,!1);_(this,Js,e.bitmapUrl),_(this,qr,e.bitmapFile)}static initialize(e,i){we.initialize(e,i)}static get supportedTypes(){return Ht(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(i=>`image/${i}`))}static get supportedTypesStr(){return Ht(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,i){i.pasteEditor(Nt.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){const i=e.get("hasAltText");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}async mlGuessAltText(e=null,i=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:r,height:a}=e||this.copyCanvas(null,null,!0).imageData,l=await n.guess({name:"altText",request:{data:s,width:r,height:a,channels:s.length/(r*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const u=l.output;return await this.setGuessedAltText(u),i&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var e;h(this,si)&&(_(this,ye,null),this._uiManager.imageManager.deleteId(h(this,si)),(e=h(this,ms))==null||e.remove(),_(this,ms,null),h(this,vs)&&(clearTimeout(h(this,vs)),_(this,vs,null))),super.remove()}rebuild(){if(!this.parent){h(this,si)&&C(this,Kt,rd).call(this);return}super.rebuild(),this.div!==null&&(h(this,si)&&h(this,ms)===null&&C(this,Kt,rd).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(h(this,Wr)||h(this,ye)||h(this,Js)||h(this,qr)||h(this,si))}get isResizable(){return!0}render(){if(this.div)return this.div;let e,i;if(this.width&&(e=this.x,i=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),h(this,ye)?C(this,Kt,sg).call(this):C(this,Kt,rd).call(this),this.width&&!this.annotationElementId){const[n,s]=this.parentDimensions;this.setAt(e*n,i*s,this.width*n,this.height*s)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;h(this,vs)!==null&&clearTimeout(h(this,vs)),_(this,vs,setTimeout(()=>{_(this,vs,null),C(this,Kt,rg).call(this)},200))}copyCanvas(e,i,n=!1){var p;e||(e=224);const{width:s,height:r}=h(this,ye),a=new ep;let l=h(this,ye),u=s,c=r,d=null;if(i){if(s>i||r>i){const P=Math.min(i/s,i/r);u=Math.floor(s*P),c=Math.floor(r*P)}d=document.createElement("canvas");const b=d.width=Math.ceil(u*a.sx),y=d.height=Math.ceil(c*a.sy);h(this,nn)||(l=C(this,Kt,ad).call(this,b,y));const g=d.getContext("2d");g.filter=this._uiManager.hcmFilter;let m="white",w="#cfcfd8";this._uiManager.hcmFilter!=="none"?w="black":(p=window.matchMedia)!=null&&p.call(window,"(prefers-color-scheme: dark)").matches&&(m="#8f8f9d",w="#42414d");const E=15,R=E*a.sx,A=E*a.sy,T=new OffscreenCanvas(R*2,A*2),k=T.getContext("2d");k.fillStyle=m,k.fillRect(0,0,R*2,A*2),k.fillStyle=w,k.fillRect(0,0,R,A),k.fillRect(R,A,R,A),g.fillStyle=g.createPattern(T,"repeat"),g.fillRect(0,0,b,y),g.drawImage(l,0,0,l.width,l.height,0,0,b,y)}let f=null;if(n){let b,y;if(a.symmetric&&l.width<e&&l.height<e)b=l.width,y=l.height;else if(l=h(this,ye),s>e||r>e){const w=Math.min(e/s,e/r);b=Math.floor(s*w),y=Math.floor(r*w),h(this,nn)||(l=C(this,Kt,ad).call(this,b,y))}const m=new OffscreenCanvas(b,y).getContext("2d",{willReadFrequently:!0});m.drawImage(l,0,0,l.width,l.height,0,0,b,y),f={width:b,height:y,data:m.getImageData(0,0,b,y).data}}return{canvas:d,width:u,height:c,imageData:f}}getImageForAltText(){return h(this,ms)}static async deserialize(e,i,n){var y;let s=null;if(e instanceof O0){const{data:{rect:g,rotation:m,id:w,structParent:E,popupRef:R},container:A,parent:{page:{pageNumber:T}}}=e,k=A.querySelector("canvas"),P=n.imageManager.getFromCanvas(A.id,k);k.remove();const F=((y=await i._structTree.getAriaAttributes(`${Tg}${w}`))==null?void 0:y.get("aria-label"))||"";s=e={annotationType:Nt.STAMP,bitmapId:P.id,bitmap:P.bitmap,pageIndex:T-1,rect:g.slice(0),rotation:m,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:F},isSvg:!1,structParent:E,popupRef:R}}const r=await super.deserialize(e,i,n),{rect:a,bitmap:l,bitmapUrl:u,bitmapId:c,isSvg:d,accessibilityData:f}=e;c&&n.imageManager.isValidId(c)?(_(r,si,c),l&&_(r,ye,l)):_(r,Js,u),_(r,nn,d);const[p,b]=r.pageDimensions;return r.width=(a[2]-a[0])/p,r.height=(a[3]-a[1])/b,r.annotationElementId=e.id||null,f&&(r.altTextData=f),r._initialData=s,_(r,$l,!!s),r}serialize(e=!1,i=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n={annotationType:Nt.STAMP,bitmapId:h(this,si),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:h(this,nn),structTreeParentId:this._structTreeParentId};if(e)return n.bitmapUrl=C(this,Kt,od).call(this,!0),n.accessibilityData=this.serializeAltText(!0),n;const{decorative:s,altText:r}=this.serializeAltText(!1);if(!s&&r&&(n.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const l=C(this,Kt,pb).call(this,n);if(l.isSame)return null;l.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1}if(n.id=this.annotationElementId,i===null)return n;i.stamps||(i.stamps=new Map);const a=h(this,nn)?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!i.stamps.has(h(this,si)))i.stamps.set(h(this,si),{area:a,serialized:n}),n.bitmap=C(this,Kt,od).call(this,!1);else if(h(this,nn)){const l=i.stamps.get(h(this,si));a>l.area&&(l.area=a,l.serialized.bitmap.close(),l.serialized.bitmap=C(this,Kt,od).call(this,!1))}return n}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}};ye=new WeakMap,si=new WeakMap,Wr=new WeakMap,Js=new WeakMap,qr=new WeakMap,Gl=new WeakMap,ms=new WeakMap,vs=new WeakMap,nn=new WeakMap,$l=new WeakMap,Kt=new WeakSet,Th=function(e,i=!1){if(!e){this.remove();return}_(this,ye,e.bitmap),i||(_(this,si,e.id),_(this,nn,e.isSvg)),e.file&&_(this,Gl,e.file.name),C(this,Kt,sg).call(this)},Dh=function(){if(_(this,Wr,null),this._uiManager.enableWaiting(!1),!!h(this,ms)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&h(this,ye)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&h(this,ye)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},rd=function(){if(h(this,si)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(h(this,si)).then(n=>C(this,Kt,Th).call(this,n,!0)).finally(()=>C(this,Kt,Dh).call(this));return}if(h(this,Js)){const n=h(this,Js);_(this,Js,null),this._uiManager.enableWaiting(!0),_(this,Wr,this._uiManager.imageManager.getFromUrl(n).then(s=>C(this,Kt,Th).call(this,s)).finally(()=>C(this,Kt,Dh).call(this)));return}if(h(this,qr)){const n=h(this,qr);_(this,qr,null),this._uiManager.enableWaiting(!0),_(this,Wr,this._uiManager.imageManager.getFromFile(n).then(s=>C(this,Kt,Th).call(this,s)).finally(()=>C(this,Kt,Dh).call(this)));return}const e=document.createElement("input");e.type="file",e.accept=Nh.supportedTypesStr;const i=this._uiManager._signal;_(this,Wr,new Promise(n=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),C(this,Kt,Th).call(this,s)}n()},{signal:i}),e.addEventListener("cancel",()=>{this.remove(),n()},{signal:i})}).finally(()=>C(this,Kt,Dh).call(this))),e.click()},sg=function(){var d;const{div:e}=this;let{width:i,height:n}=h(this,ye);const[s,r]=this.pageDimensions,a=.75;if(this.width)i=this.width*s,n=this.height*r;else if(i>a*s||n>a*r){const f=Math.min(a*s/i,a*r/n);i*=f,n*=f}const[l,u]=this.parentDimensions;this.setDims(i*l/s,n*u/r),this._uiManager.enableWaiting(!1);const c=_(this,ms,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=i/s,this.height=n/r,(d=this._initialOptions)!=null&&d.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),C(this,Kt,rg).call(this),h(this,$l)||(this.parent.addUndoableEditor(this),_(this,$l,!0)),this._reportTelemetry({action:"inserted_image"}),h(this,Gl)&&c.setAttribute("aria-label",h(this,Gl))},ad=function(e,i){const{width:n,height:s}=h(this,ye);let r=n,a=s,l=h(this,ye);for(;r>2*e||a>2*i;){const u=r,c=a;r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),a>2*i&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const d=new OffscreenCanvas(r,a);d.getContext("2d").drawImage(l,0,0,u,c,0,0,r,a),l=d.transferToImageBitmap()}return l},rg=function(){const[e,i]=this.parentDimensions,{width:n,height:s}=this,r=new ep,a=Math.ceil(n*e*r.sx),l=Math.ceil(s*i*r.sy),u=h(this,ms);if(!u||u.width===a&&u.height===l)return;u.width=a,u.height=l;const c=h(this,nn)?h(this,ye):C(this,Kt,ad).call(this,a,l),d=u.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(c,0,0,c.width,c.height,0,0,a,l)},od=function(e){if(e){if(h(this,nn)){const s=this._uiManager.imageManager.getSvgUrl(h(this,si));if(s)return s}const i=document.createElement("canvas");return{width:i.width,height:i.height}=h(this,ye),i.getContext("2d").drawImage(h(this,ye),0,0),i.toDataURL()}if(h(this,nn)){const[i,n]=this.pageDimensions,s=Math.round(this.width*i*Jr.PDF_TO_CSS_UNITS),r=Math.round(this.height*n*Jr.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,r);return a.getContext("2d").drawImage(h(this,ye),0,0,h(this,ye).width,h(this,ye).height,0,0,s,r),a.transferToImageBitmap()}return structuredClone(h(this,ye))},pb=function(e){var a;const{pageIndex:i,accessibilityData:{altText:n}}=this._initialData,s=e.pageIndex===i,r=(((a=e.accessibilityData)==null?void 0:a.alt)||"")===n;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&r,isSameAltText:r}},Dt(Nh,"_type","stamp"),Dt(Nh,"_editorType",Nt.STAMP);let ng=Nh;var uo,Xl,bs,Vr,tr,bn,Gr,Yl,co,Vn,er,mi,ir,wt,$r,ve,gb,es,og,lg,ld;const Ln=class Ln{constructor({uiManager:t,pageIndex:e,div:i,structTreeLayer:n,accessibilityManager:s,annotationLayer:r,drawLayer:a,textLayer:l,viewport:u,l10n:c}){x(this,ve);x(this,uo);x(this,Xl,!1);x(this,bs,null);x(this,Vr,null);x(this,tr,null);x(this,bn,new Map);x(this,Gr,!1);x(this,Yl,!1);x(this,co,!1);x(this,Vn,null);x(this,er,null);x(this,mi,null);x(this,ir,null);x(this,wt);const d=[...h(Ln,$r).values()];if(!Ln._initialized){Ln._initialized=!0;for(const f of d)f.initialize(c,t)}t.registerEditorTypes(d),_(this,wt,t),this.pageIndex=e,this.div=i,_(this,uo,s),_(this,bs,r),this.viewport=u,_(this,mi,l),this.drawLayer=a,this._structTree=n,h(this,wt).addLayer(this)}get isEmpty(){return h(this,bn).size===0}get isInvisible(){return this.isEmpty&&h(this,wt).getMode()===Nt.NONE}updateToolbar(t){h(this,wt).updateToolbar(t)}updateMode(t=h(this,wt).getMode()){switch(C(this,ve,ld).call(this),t){case Nt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Nt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Nt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const i of h(Ln,$r).values())e.toggle(`${i._type}Editing`,t===i._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=h(this,mi))==null?void 0:e.div)}setEditingState(t){h(this,wt).setEditingState(t)}addCommands(t){h(this,wt).addCommands(t)}cleanUndoStack(t){h(this,wt).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=h(this,bs))==null||e.div.classList.toggle("disabled",!t)}async enable(){_(this,co,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const i of h(this,bn).values())i.enableEditing(),i.show(!0),i.annotationElementId&&(h(this,wt).removeChangedExistingAnnotation(i),t.add(i.annotationElementId));if(!h(this,bs)){_(this,co,!1);return}const e=h(this,bs).getEditableAnnotations();for(const i of e){if(i.hide(),h(this,wt).isDeletedAnnotationElement(i.data.id)||t.has(i.data.id))continue;const n=await this.deserialize(i);n&&(this.addOrRebuild(n),n.enableEditing())}_(this,co,!1)}disable(){var n;_(this,Yl,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,e=new Map;for(const s of h(this,bn).values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){t.set(s.annotationElementId,s);continue}else e.set(s.annotationElementId,s);(n=this.getEditableAnnotation(s.annotationElementId))==null||n.show(),s.remove()}if(h(this,bs)){const s=h(this,bs).getEditableAnnotations();for(const r of s){const{id:a}=r.data;if(h(this,wt).isDeletedAnnotationElement(a))continue;let l=e.get(a);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=t.get(a),l&&(h(this,wt).addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}C(this,ve,ld).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const s of h(Ln,$r).values())i.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),_(this,Yl,!1)}getEditableAnnotation(t){var e;return((e=h(this,bs))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){h(this,wt).getActive()!==t&&h(this,wt).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=h(this,mi))!=null&&t.div&&!h(this,ir)){_(this,ir,new AbortController);const e=h(this,wt).combinedSignal(h(this,ir));h(this,mi).div.addEventListener("pointerdown",C(this,ve,gb).bind(this),{signal:e}),h(this,mi).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=h(this,mi))!=null&&t.div&&h(this,ir)&&(h(this,ir).abort(),_(this,ir,null),h(this,mi).div.classList.remove("highlighting"))}enableClick(){if(h(this,Vr))return;_(this,Vr,new AbortController);const t=h(this,wt).combinedSignal(h(this,Vr));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=h(this,Vr))==null||t.abort(),_(this,Vr,null)}attach(t){h(this,bn).set(t.id,t);const{annotationElementId:e}=t;e&&h(this,wt).isDeletedAnnotationElement(e)&&h(this,wt).removeDeletedAnnotationElement(t)}detach(t){var e;h(this,bn).delete(t.id),(e=h(this,uo))==null||e.removePointerInTextLayer(t.contentDiv),!h(this,Yl)&&t.annotationElementId&&h(this,wt).addDeletedAnnotationElement(t)}remove(t){this.detach(t),h(this,wt).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(h(this,wt).addDeletedAnnotationElement(t.annotationElementId),we.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),h(this,wt).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!h(this,co)),h(this,wt).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var i;if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!h(this,tr)&&(t._focusEventsAllowed=!1,_(this,tr,setTimeout(()=>{_(this,tr,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:h(this,wt)._signal}),e.focus())},0))),t._structTreeParentId=(i=h(this,uo))==null?void 0:i.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:e,undo:i,mustExec:!1})}getNextId(){return h(this,wt).getId()}combinedSignal(t){return h(this,wt).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=h(this,ve,es))==null?void 0:t.canCreateNewEmptyEditor()}pasteEditor(t,e){h(this,wt).updateToolbar(t),h(this,wt).updateMode(t);const{offsetX:i,offsetY:n}=C(this,ve,lg).call(this),s=this.getNextId(),r=C(this,ve,og).call(this,{parent:this,id:s,x:i,y:n,uiManager:h(this,wt),isCentered:!0,...e});r&&this.add(r)}async deserialize(t){var e;return await((e=h(Ln,$r).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,h(this,wt)))||null}createAndAddNewEditor(t,e,i={}){const n=this.getNextId(),s=C(this,ve,og).call(this,{parent:this,id:n,x:t.offsetX,y:t.offsetY,uiManager:h(this,wt),isCentered:e,...i});return s&&this.add(s),s}addNewEditor(){this.createAndAddNewEditor(C(this,ve,lg).call(this),!0)}setSelected(t){h(this,wt).setSelected(t)}toggleSelected(t){h(this,wt).toggleSelected(t)}unselect(t){h(this,wt).unselect(t)}pointerup(t){var i;const{isMac:e}=Di.platform;if(!(t.button!==0||t.ctrlKey&&e)&&t.target===this.div&&h(this,Gr)&&(_(this,Gr,!1),!((i=h(this,ve,es))!=null&&i.isDrawer&&h(this,ve,es).supportMultipleDrawings))){if(!h(this,Xl)){_(this,Xl,!0);return}if(h(this,wt).getMode()===Nt.STAMP){h(this,wt).unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){var n;if(h(this,wt).getMode()===Nt.HIGHLIGHT&&this.enableTextSelection(),h(this,Gr)){_(this,Gr,!1);return}const{isMac:e}=Di.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(_(this,Gr,!0),(n=h(this,ve,es))!=null&&n.isDrawer){this.startDrawingSession(t);return}const i=h(this,wt).getActive();_(this,Xl,!i||i.isEmpty())}startDrawingSession(t){if(this.div.focus(),h(this,Vn)){h(this,ve,es).startDrawing(this,h(this,wt),!1,t);return}h(this,wt).setCurrentDrawingSession(this),_(this,Vn,new AbortController);const e=h(this,wt).combinedSignal(h(this,Vn));this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(_(this,er,null),this.commitOrRemove())},{signal:e}),h(this,ve,es).startDrawing(this,h(this,wt),!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&_(this,er,e);return}h(this,er)&&setTimeout(()=>{var e;(e=h(this,er))==null||e.focus(),_(this,er,null)},0)}endDrawingSession(t=!1){return h(this,Vn)?(h(this,wt).setCurrentDrawingSession(null),h(this,Vn).abort(),_(this,Vn,null),_(this,er,null),h(this,ve,es).endDrawing(t)):null}findNewParent(t,e,i){const n=h(this,wt).findParent(e,i);return n===null||n===this?!1:(n.changeParent(t),!0)}commitOrRemove(){return h(this,Vn)?(this.endDrawingSession(),!0):!1}onScaleChanging(){h(this,Vn)&&h(this,ve,es).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=h(this,wt).getActive())==null?void 0:t.parent)===this&&(h(this,wt).commitOrRemove(),h(this,wt).setActiveEditor(null)),h(this,tr)&&(clearTimeout(h(this,tr)),_(this,tr,null));for(const i of h(this,bn).values())(e=h(this,uo))==null||e.removePointerInTextLayer(i.contentDiv),i.setParent(null),i.isAttachedToDOM=!1,i.div.remove();this.div=null,h(this,bn).clear(),h(this,wt).removeLayer(this)}render({viewport:t}){this.viewport=t,po(this.div,t);for(const e of h(this,wt).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){h(this,wt).commitOrRemove(),C(this,ve,ld).call(this);const e=this.viewport.rotation,i=t.rotation;if(this.viewport=t,po(this.div,{rotation:i}),e!==i)for(const n of h(this,bn).values())n.rotate(i)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return h(this,wt).viewParameters.realScale}};uo=new WeakMap,Xl=new WeakMap,bs=new WeakMap,Vr=new WeakMap,tr=new WeakMap,bn=new WeakMap,Gr=new WeakMap,Yl=new WeakMap,co=new WeakMap,Vn=new WeakMap,er=new WeakMap,mi=new WeakMap,ir=new WeakMap,wt=new WeakMap,$r=new WeakMap,ve=new WeakSet,gb=function(t){h(this,wt).unselectAll();const{target:e}=t;if(e===h(this,mi).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&h(this,mi).div.contains(e)){const{isMac:i}=Di.platform;if(t.button!==0||t.ctrlKey&&i)return;h(this,wt).showAllEditors("highlight",!0,!0),h(this,mi).div.classList.add("free"),this.toggleDrawing(),wd.startHighlighting(this,h(this,wt).direction==="ltr",{target:h(this,mi).div,x:t.x,y:t.y}),h(this,mi).div.addEventListener("pointerup",()=>{h(this,mi).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:h(this,wt)._signal}),t.preventDefault()}},es=function(){return h(Ln,$r).get(h(this,wt).getMode())},og=function(t){const e=h(this,ve,es);return e?new e.prototype.constructor(t):null},lg=function(){const{x:t,y:e,width:i,height:n}=this.div.getBoundingClientRect(),s=Math.max(0,t),r=Math.max(0,e),a=Math.min(window.innerWidth,t+i),l=Math.min(window.innerHeight,e+n),u=(s+a)/2-t,c=(r+l)/2-e,[d,f]=this.viewport.rotation%180===0?[u,c]:[c,u];return{offsetX:d,offsetY:f}},ld=function(){for(const t of h(this,bn).values())t.isEmpty()&&t.remove()},Dt(Ln,"_initialized",!1),x(Ln,$r,new Map([Hp,ig,ng,wd].map(t=>[t._editorType,t])));let ag=Ln;var Gn,gc,Ti,fo,af,mb,As,ug,vb,cg;const di=class di{constructor({pageIndex:t}){x(this,As);x(this,Gn,null);x(this,gc,0);x(this,Ti,new Map);x(this,fo,new Map);this.pageIndex=t}setParent(t){if(!h(this,Gn)){_(this,Gn,t);return}if(h(this,Gn)!==t){if(h(this,Ti).size>0)for(const e of h(this,Ti).values())e.remove(),t.append(e);_(this,Gn,t)}}static get _svgFactory(){return Ht(this,"_svgFactory",new Ng)}draw(t,e=!1,i=!1){const n=Ai(this,gc)._++,s=C(this,As,ug).call(this),r=di._svgFactory.createElement("defs");s.append(r);const a=di._svgFactory.createElement("path");r.append(a);const l=`path_p${this.pageIndex}_${n}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),e&&h(this,fo).set(n,a);const u=i?C(this,As,vb).call(this,r,l):null,c=di._svgFactory.createElement("use");return s.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(s,t),h(this,Ti).set(n,s),{id:n,clipPathId:`url(#${u})`}}drawOutline(t,e){const i=Ai(this,gc)._++,n=C(this,As,ug).call(this),s=di._svgFactory.createElement("defs");n.append(s);const r=di._svgFactory.createElement("path");s.append(r);const a=`path_p${this.pageIndex}_${i}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const d=di._svgFactory.createElement("mask");s.append(d),l=`mask_p${this.pageIndex}_${i}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");const f=di._svgFactory.createElement("rect");d.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=di._svgFactory.createElement("use");d.append(p),p.setAttribute("href",`#${a}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const u=di._svgFactory.createElement("use");n.append(u),u.setAttribute("href",`#${a}`),l&&u.setAttribute("mask",`url(#${l})`);const c=u.cloneNode();return n.append(c),u.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(n,t),h(this,Ti).set(i,n),i}finalizeDraw(t,e){h(this,fo).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var l;if(!e)return;const{root:i,bbox:n,rootClass:s,path:r}=e,a=typeof t=="number"?h(this,Ti).get(t):t;if(a){if(i&&C(this,As,cg).call(this,a,i),n&&C(l=di,af,mb).call(l,a,n),s){const{classList:u}=a;for(const[c,d]of Object.entries(s))u.toggle(c,d)}if(r){const c=a.firstChild.firstChild;C(this,As,cg).call(this,c,r)}}}updateParent(t,e){if(e===this)return;const i=h(this,Ti).get(t);i&&(h(e,Gn).append(i),h(this,Ti).delete(t),h(e,Ti).set(t,i))}remove(t){h(this,fo).delete(t),h(this,Gn)!==null&&(h(this,Ti).get(t).remove(),h(this,Ti).delete(t))}destroy(){_(this,Gn,null);for(const t of h(this,Ti).values())t.remove();h(this,Ti).clear(),h(this,fo).clear()}};Gn=new WeakMap,gc=new WeakMap,Ti=new WeakMap,fo=new WeakMap,af=new WeakSet,mb=function(t,[e,i,n,s]){const{style:r}=t;r.top=`${100*i}%`,r.left=`${100*e}%`,r.width=`${100*n}%`,r.height=`${100*s}%`},As=new WeakSet,ug=function(){const t=di._svgFactory.create(1,1,!0);return h(this,Gn).append(t),t.setAttribute("aria-hidden",!0),t},vb=function(t,e){const i=di._svgFactory.createElement("clipPath");t.append(i);const n=`clip_${e}`;i.setAttribute("id",n),i.setAttribute("clipPathUnits","objectBoundingBox");const s=di._svgFactory.createElement("use");return i.append(s),s.setAttribute("href",`#${e}`),s.classList.add("clip"),n},cg=function(t,e){for(const[i,n]of Object.entries(e))n===null?t.removeAttribute(i):t.setAttribute(i,n)},x(di,af);let hg=di;globalThis.pdfjsTestingUtils={HighlightOutliner:Wp};It.AbortException;It.AnnotationEditorLayer;It.AnnotationEditorParamsType;It.AnnotationEditorType;It.AnnotationEditorUIManager;It.AnnotationLayer;It.AnnotationMode;It.ColorPicker;It.DOMSVGFactory;It.DrawLayer;It.FeatureTest;var $2=It.GlobalWorkerOptions;It.ImageKind;It.InvalidPDFException;It.MissingPDFException;It.OPS;It.OutputScale;It.PDFDataRangeTransport;It.PDFDateString;It.PDFWorker;It.PasswordResponses;It.PermissionFlag;It.PixelsPerInch;It.RenderingCancelledException;It.TextLayer;It.TouchManager;It.UnexpectedResponseException;It.Util;It.VerbosityLevel;It.XfaLayer;It.build;It.createValidAbsoluteUrl;It.fetchData;var X2=It.getDocument;It.getFilenameFromUrl;It.getPdfFilenameFromUrl;It.getXfaPageViewport;It.isDataScheme;It.isPdfFile;It.noContextMenu;It.normalizeUnicode;It.setLayerDimensions;It.shadow;It.stopEvent;var Y2=It.version,_n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eh(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var dg={exports:{}},bb={exports:{}},K2=void 0,yb=function(o){return o!==K2&&o!==null},Z2=yb,Q2={object:!0,function:!0,undefined:!0},J2=function(o){return Z2(o)?hasOwnProperty.call(Q2,typeof o):!1},t_=J2,e_=function(o){if(!t_(o))return!1;try{return o.constructor?o.constructor.prototype===o:!1}catch{return!1}},i_=e_,n_=function(o){if(typeof o!="function"||!hasOwnProperty.call(o,"length"))return!1;try{if(typeof o.length!="number"||typeof o.call!="function"||typeof o.apply!="function")return!1}catch{return!1}return!i_(o)},s_=n_,r_=/^\s*class[\s{/}]/,a_=Function.prototype.toString,o_=function(o){return!(!s_(o)||r_.test(a_.call(o)))},l_=function(){var o=Object.assign,t;return typeof o!="function"?!1:(t={foo:"raz"},o(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")},Of,Nm;function h_(){return Nm||(Nm=1,Of=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),Of}var u_=function(){},c_=u_(),Fg=function(o){return o!==c_&&o!==null},Ff,Om;function d_(){if(Om)return Ff;Om=1;var o=Fg,t=Object.keys;return Ff=function(e){return t(o(e)?Object(e):e)},Ff}var Mf,Fm;function f_(){return Fm||(Fm=1,Mf=h_()()?Object.keys:d_()),Mf}var Bf,Mm;function p_(){if(Mm)return Bf;Mm=1;var o=Fg;return Bf=function(t){if(!o(t))throw new TypeError("Cannot use null or undefined");return t},Bf}var zf,Bm;function g_(){if(Bm)return zf;Bm=1;var o=f_(),t=p_(),e=Math.max;return zf=function(i,n){var s,r,a=e(arguments.length,2),l;for(i=Object(t(i)),l=function(u){try{i[u]=n[u]}catch(c){s||(s=c)}},r=1;r<a;++r)n=arguments[r],o(n).forEach(l);if(s!==void 0)throw s;return i},zf}var m_=l_()?Object.assign:g_(),v_=Fg,b_=Array.prototype.forEach,y_=Object.create,w_=function(o,t){var e;for(e in o)t[e]=o[e]},__=function(o){var t=y_(null);return b_.call(arguments,function(e){v_(e)&&w_(Object(e),t)}),t},Uf="razdwatrzy",A_=function(){return typeof Uf.contains!="function"?!1:Uf.contains("dwa")===!0&&Uf.contains("foo")===!1},Hf,zm;function E_(){if(zm)return Hf;zm=1;var o=String.prototype.indexOf;return Hf=function(t){return o.call(this,t,arguments[1])>-1},Hf}var x_=A_()?String.prototype.contains:E_(),hd=yb,Um=o_,wb=m_,_b=__,Rh=x_,S_=bb.exports=function(o,t){var e,i,n,s,r;return arguments.length<2||typeof o!="string"?(s=t,t=o,o=null):s=arguments[2],hd(o)?(e=Rh.call(o,"c"),i=Rh.call(o,"e"),n=Rh.call(o,"w")):(e=n=!0,i=!1),r={value:t,configurable:e,enumerable:i,writable:n},s?wb(_b(s),r):r};S_.gs=function(o,t,e){var i,n,s,r;return typeof o!="string"?(s=e,e=t,t=o,o=null):s=arguments[3],hd(t)?Um(t)?hd(e)?Um(e)||(s=e,e=void 0):e=void 0:(s=t,t=e=void 0):t=void 0,hd(o)?(i=Rh.call(o,"c"),n=Rh.call(o,"e")):(i=!0,n=!1),r={get:t,set:e,configurable:i,enumerable:n},s?wb(_b(s),r):r};var C_=bb.exports,T_=function(o){if(typeof o!="function")throw new TypeError(o+" is not a function");return o};(function(o,t){var e=C_,i=T_,n=Function.prototype.apply,s=Function.prototype.call,r=Object.create,a=Object.defineProperty,l=Object.defineProperties,u=Object.prototype.hasOwnProperty,c={configurable:!0,enumerable:!1,writable:!0},d,f,p,b,y,g,m;d=function(w,E){var R;return i(E),u.call(this,"__ee__")?R=this.__ee__:(R=c.value=r(null),a(this,"__ee__",c),c.value=null),R[w]?typeof R[w]=="object"?R[w].push(E):R[w]=[R[w],E]:R[w]=E,this},f=function(w,E){var R,A;return i(E),A=this,d.call(this,w,R=function(){p.call(A,w,R),n.call(E,this,arguments)}),R.__eeOnceListener__=E,this},p=function(w,E){var R,A,T,k;if(i(E),!u.call(this,"__ee__"))return this;if(R=this.__ee__,!R[w])return this;if(A=R[w],typeof A=="object")for(k=0;T=A[k];++k)(T===E||T.__eeOnceListener__===E)&&(A.length===2?R[w]=A[k?0:1]:A.splice(k,1));else(A===E||A.__eeOnceListener__===E)&&delete R[w];return this},b=function(w){var E,R,A,T,k;if(u.call(this,"__ee__")&&(T=this.__ee__[w],!!T))if(typeof T=="object"){for(R=arguments.length,k=new Array(R-1),E=1;E<R;++E)k[E-1]=arguments[E];for(T=T.slice(),E=0;A=T[E];++E)n.call(A,this,k)}else switch(arguments.length){case 1:s.call(T,this);break;case 2:s.call(T,this,arguments[1]);break;case 3:s.call(T,this,arguments[1],arguments[2]);break;default:for(R=arguments.length,k=new Array(R-1),E=1;E<R;++E)k[E-1]=arguments[E];n.call(T,this,k)}},y={on:d,once:f,off:p,emit:b},g={on:e(d),once:e(f),off:e(p),emit:e(b)},m=l({},g),o.exports=t=function(w){return w==null?r(m):l(Object(w),g)},t.methods=y})(dg,dg.exports);var D_=dg.exports;const Es=eh(D_);var ia={},na={};function k_(o,t,e){if(e===void 0&&(e=Array.prototype),o&&typeof e.find=="function")return e.find.call(o,t);for(var i=0;i<o.length;i++)if(Object.prototype.hasOwnProperty.call(o,i)){var n=o[i];if(t.call(void 0,n,i,o))return n}}function Mg(o,t){return t===void 0&&(t=Object),t&&typeof t.freeze=="function"?t.freeze(o):o}var Ab=Mg({HTML:"text/html",isHTML:function(o){return o===Ab.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Eb=Mg({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(o){return o===Eb.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});na.find=k_;na.freeze=Mg;na.MIME_TYPE=Ab;na.NAMESPACE=Eb;var xb=na,ys=xb.find,Bh=xb.NAMESPACE;function R_(o){return o!==""}function I_(o){return o?o.split(/[\t\n\f\r ]+/).filter(R_):[]}function L_(o,t){return o.hasOwnProperty(t)||(o[t]=!0),o}function Hm(o){if(!o)return[];var t=I_(o);return Object.keys(t.reduce(L_,{}))}function P_(o){return function(t){return o&&o.indexOf(t)!==-1}}function yc(o,t){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])}function Wi(o,t){var e=o.prototype;if(!(e instanceof t)){let i=function(){};i.prototype=t.prototype,i=new i,yc(e,i),o.prototype=e=i}e.constructor!=o&&(typeof o!="function"&&console.error("unknown Class:"+o),e.constructor=o)}var qi={},Yn=qi.ELEMENT_NODE=1,Kl=qi.ATTRIBUTE_NODE=2,Ad=qi.TEXT_NODE=3,Sb=qi.CDATA_SECTION_NODE=4,Cb=qi.ENTITY_REFERENCE_NODE=5,N_=qi.ENTITY_NODE=6,Tb=qi.PROCESSING_INSTRUCTION_NODE=7,Db=qi.COMMENT_NODE=8,kb=qi.DOCUMENT_NODE=9,Rb=qi.DOCUMENT_TYPE_NODE=10,lr=qi.DOCUMENT_FRAGMENT_NODE=11,O_=qi.NOTATION_NODE=12,yi={},Qe={};yi.INDEX_SIZE_ERR=(Qe[1]="Index size error",1);yi.DOMSTRING_SIZE_ERR=(Qe[2]="DOMString size error",2);var ji=yi.HIERARCHY_REQUEST_ERR=(Qe[3]="Hierarchy request error",3);yi.WRONG_DOCUMENT_ERR=(Qe[4]="Wrong document",4);yi.INVALID_CHARACTER_ERR=(Qe[5]="Invalid character",5);yi.NO_DATA_ALLOWED_ERR=(Qe[6]="No data allowed",6);yi.NO_MODIFICATION_ALLOWED_ERR=(Qe[7]="No modification allowed",7);var Ib=yi.NOT_FOUND_ERR=(Qe[8]="Not found",8);yi.NOT_SUPPORTED_ERR=(Qe[9]="Not supported",9);var jm=yi.INUSE_ATTRIBUTE_ERR=(Qe[10]="Attribute in use",10);yi.INVALID_STATE_ERR=(Qe[11]="Invalid state",11);yi.SYNTAX_ERR=(Qe[12]="Syntax error",12);yi.INVALID_MODIFICATION_ERR=(Qe[13]="Invalid modification",13);yi.NAMESPACE_ERR=(Qe[14]="Invalid namespace",14);yi.INVALID_ACCESS_ERR=(Qe[15]="Invalid access",15);function Re(o,t){if(t instanceof Error)var e=t;else e=this,Error.call(this,Qe[o]),this.message=Qe[o],Error.captureStackTrace&&Error.captureStackTrace(this,Re);return e.code=o,t&&(this.message=this.message+": "+t),e}Re.prototype=Error.prototype;yc(yi,Re);function rr(){}rr.prototype={length:0,item:function(o){return o>=0&&o<this.length?this[o]:null},toString:function(o,t){for(var e=[],i=0;i<this.length;i++)zo(this[i],e,o,t);return e.join("")},filter:function(o){return Array.prototype.filter.call(this,o)},indexOf:function(o){return Array.prototype.indexOf.call(this,o)}};function Zl(o,t){this._node=o,this._refresh=t,Bg(this)}function Bg(o){var t=o._node._inc||o._node.ownerDocument._inc;if(o._inc!==t){var e=o._refresh(o._node);if(Wb(o,"length",e.length),!o.$$length||e.length<o.$$length)for(var i=e.length;i in o;i++)Object.prototype.hasOwnProperty.call(o,i)&&delete o[i];yc(e,o),o._inc=t}}Zl.prototype.item=function(o){return Bg(this),this[o]||null};Wi(Zl,rr);function Ed(){}function Lb(o,t){for(var e=o.length;e--;)if(o[e]===t)return e}function Wm(o,t,e,i){if(i?t[Lb(t,i)]=e:t[t.length++]=e,o){e.ownerElement=o;var n=o.ownerDocument;n&&(i&&Ob(n,o,i),F_(n,o,e))}}function qm(o,t,e){var i=Lb(t,e);if(i>=0){for(var n=t.length-1;i<n;)t[i]=t[++i];if(t.length=n,o){var s=o.ownerDocument;s&&(Ob(s,o,e),e.ownerElement=null)}}else throw new Re(Ib,new Error(o.tagName+"@"+e))}Ed.prototype={length:0,item:rr.prototype.item,getNamedItem:function(o){for(var t=this.length;t--;){var e=this[t];if(e.nodeName==o)return e}},setNamedItem:function(o){var t=o.ownerElement;if(t&&t!=this._ownerElement)throw new Re(jm);var e=this.getNamedItem(o.nodeName);return Wm(this._ownerElement,this,o,e),e},setNamedItemNS:function(o){var t=o.ownerElement,e;if(t&&t!=this._ownerElement)throw new Re(jm);return e=this.getNamedItemNS(o.namespaceURI,o.localName),Wm(this._ownerElement,this,o,e),e},removeNamedItem:function(o){var t=this.getNamedItem(o);return qm(this._ownerElement,this,t),t},removeNamedItemNS:function(o,t){var e=this.getNamedItemNS(o,t);return qm(this._ownerElement,this,e),e},getNamedItemNS:function(o,t){for(var e=this.length;e--;){var i=this[e];if(i.localName==t&&i.namespaceURI==o)return i}return null}};function Pb(){}Pb.prototype={hasFeature:function(o,t){return!0},createDocument:function(o,t,e){var i=new wc;if(i.implementation=this,i.childNodes=new rr,i.doctype=e||null,e&&i.appendChild(e),t){var n=i.createElementNS(o,t);i.appendChild(n)}return i},createDocumentType:function(o,t,e){var i=new gf;return i.name=o,i.nodeName=o,i.publicId=t||"",i.systemId=e||"",i}};function se(){}se.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(o,t){return xd(this,o,t)},replaceChild:function(o,t){xd(this,o,t,Mb),t&&this.removeChild(t)},removeChild:function(o){return Fb(this,o)},appendChild:function(o){return this.insertBefore(o,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(o){return fg(this.ownerDocument||this,this,o)},normalize:function(){for(var o=this.firstChild;o;){var t=o.nextSibling;t&&t.nodeType==Ad&&o.nodeType==Ad?(this.removeChild(t),o.appendData(t.data)):(o.normalize(),o=t)}},isSupported:function(o,t){return this.ownerDocument.implementation.hasFeature(o,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(o){for(var t=this;t;){var e=t._nsMap;if(e){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]===o)return i}t=t.nodeType==Kl?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(o){for(var t=this;t;){var e=t._nsMap;if(e&&o in e&&Object.prototype.hasOwnProperty.call(e,o))return e[o];t=t.nodeType==Kl?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(o){var t=this.lookupPrefix(o);return t==null}};function Nb(o){return o=="<"&&"&lt;"||o==">"&&"&gt;"||o=="&"&&"&amp;"||o=='"'&&"&quot;"||"&#"+o.charCodeAt()+";"}yc(qi,se);yc(qi,se.prototype);function zh(o,t){if(t(o))return!0;if(o=o.firstChild)do if(zh(o,t))return!0;while(o=o.nextSibling)}function wc(){this.ownerDocument=this}function F_(o,t,e){o&&o._inc++;var i=e.namespaceURI;i===Bh.XMLNS&&(t._nsMap[e.prefix?e.localName:""]=e.value)}function Ob(o,t,e,i){o&&o._inc++;var n=e.namespaceURI;n===Bh.XMLNS&&delete t._nsMap[e.prefix?e.localName:""]}function zg(o,t,e){if(o&&o._inc){o._inc++;var i=t.childNodes;if(e)i[i.length++]=e;else{for(var n=t.firstChild,s=0;n;)i[s++]=n,n=n.nextSibling;i.length=s,delete i[i.length]}}}function Fb(o,t){var e=t.previousSibling,i=t.nextSibling;return e?e.nextSibling=i:o.firstChild=i,i?i.previousSibling=e:o.lastChild=e,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,zg(o.ownerDocument,o),t}function M_(o){return o&&(o.nodeType===se.DOCUMENT_NODE||o.nodeType===se.DOCUMENT_FRAGMENT_NODE||o.nodeType===se.ELEMENT_NODE)}function B_(o){return o&&(ws(o)||Ug(o)||hr(o)||o.nodeType===se.DOCUMENT_FRAGMENT_NODE||o.nodeType===se.COMMENT_NODE||o.nodeType===se.PROCESSING_INSTRUCTION_NODE)}function hr(o){return o&&o.nodeType===se.DOCUMENT_TYPE_NODE}function ws(o){return o&&o.nodeType===se.ELEMENT_NODE}function Ug(o){return o&&o.nodeType===se.TEXT_NODE}function Vm(o,t){var e=o.childNodes||[];if(ys(e,ws)||hr(t))return!1;var i=ys(e,hr);return!(t&&i&&e.indexOf(i)>e.indexOf(t))}function Gm(o,t){var e=o.childNodes||[];function i(s){return ws(s)&&s!==t}if(ys(e,i))return!1;var n=ys(e,hr);return!(t&&n&&e.indexOf(n)>e.indexOf(t))}function z_(o,t,e){if(!M_(o))throw new Re(ji,"Unexpected parent node type "+o.nodeType);if(e&&e.parentNode!==o)throw new Re(Ib,"child not in parent");if(!B_(t)||hr(t)&&o.nodeType!==se.DOCUMENT_NODE)throw new Re(ji,"Unexpected node type "+t.nodeType+" for parent node type "+o.nodeType)}function U_(o,t,e){var i=o.childNodes||[],n=t.childNodes||[];if(t.nodeType===se.DOCUMENT_FRAGMENT_NODE){var s=n.filter(ws);if(s.length>1||ys(n,Ug))throw new Re(ji,"More than one element or text in fragment");if(s.length===1&&!Vm(o,e))throw new Re(ji,"Element in fragment can not be inserted before doctype")}if(ws(t)&&!Vm(o,e))throw new Re(ji,"Only one element can be added and only after doctype");if(hr(t)){if(ys(i,hr))throw new Re(ji,"Only one doctype is allowed");var r=ys(i,ws);if(e&&i.indexOf(r)<i.indexOf(e))throw new Re(ji,"Doctype can only be inserted before an element");if(!e&&r)throw new Re(ji,"Doctype can not be appended since element is present")}}function Mb(o,t,e){var i=o.childNodes||[],n=t.childNodes||[];if(t.nodeType===se.DOCUMENT_FRAGMENT_NODE){var s=n.filter(ws);if(s.length>1||ys(n,Ug))throw new Re(ji,"More than one element or text in fragment");if(s.length===1&&!Gm(o,e))throw new Re(ji,"Element in fragment can not be inserted before doctype")}if(ws(t)&&!Gm(o,e))throw new Re(ji,"Only one element can be added and only after doctype");if(hr(t)){if(ys(i,function(l){return hr(l)&&l!==e}))throw new Re(ji,"Only one doctype is allowed");var r=ys(i,ws);if(e&&i.indexOf(r)<i.indexOf(e))throw new Re(ji,"Doctype can only be inserted before an element")}}function xd(o,t,e,i){z_(o,t,e),o.nodeType===se.DOCUMENT_NODE&&(i||U_)(o,t,e);var n=t.parentNode;if(n&&n.removeChild(t),t.nodeType===lr){var s=t.firstChild;if(s==null)return t;var r=t.lastChild}else s=r=t;var a=e?e.previousSibling:o.lastChild;s.previousSibling=a,r.nextSibling=e,a?a.nextSibling=s:o.firstChild=s,e==null?o.lastChild=r:e.previousSibling=r;do s.parentNode=o;while(s!==r&&(s=s.nextSibling));return zg(o.ownerDocument||o,o),t.nodeType==lr&&(t.firstChild=t.lastChild=null),t}function H_(o,t){return t.parentNode&&t.parentNode.removeChild(t),t.parentNode=o,t.previousSibling=o.lastChild,t.nextSibling=null,t.previousSibling?t.previousSibling.nextSibling=t:o.firstChild=t,o.lastChild=t,zg(o.ownerDocument,o,t),t}wc.prototype={nodeName:"#document",nodeType:kb,doctype:null,documentElement:null,_inc:1,insertBefore:function(o,t){if(o.nodeType==lr){for(var e=o.firstChild;e;){var i=e.nextSibling;this.insertBefore(e,t),e=i}return o}return xd(this,o,t),o.ownerDocument=this,this.documentElement===null&&o.nodeType===Yn&&(this.documentElement=o),o},removeChild:function(o){return this.documentElement==o&&(this.documentElement=null),Fb(this,o)},replaceChild:function(o,t){xd(this,o,t,Mb),o.ownerDocument=this,t&&this.removeChild(t),ws(o)&&(this.documentElement=o)},importNode:function(o,t){return jb(this,o,t)},getElementById:function(o){var t=null;return zh(this.documentElement,function(e){if(e.nodeType==Yn&&e.getAttribute("id")==o)return t=e,!0}),t},getElementsByClassName:function(o){var t=Hm(o);return new Zl(this,function(e){var i=[];return t.length>0&&zh(e.documentElement,function(n){if(n!==e&&n.nodeType===Yn){var s=n.getAttribute("class");if(s){var r=o===s;if(!r){var a=Hm(s);r=t.every(P_(a))}r&&i.push(n)}}}),i})},createElement:function(o){var t=new vo;t.ownerDocument=this,t.nodeName=o,t.tagName=o,t.localName=o,t.childNodes=new rr;var e=t.attributes=new Ed;return e._ownerElement=t,t},createDocumentFragment:function(){var o=new mf;return o.ownerDocument=this,o.childNodes=new rr,o},createTextNode:function(o){var t=new Hg;return t.ownerDocument=this,t.appendData(o),t},createComment:function(o){var t=new jg;return t.ownerDocument=this,t.appendData(o),t},createCDATASection:function(o){var t=new Wg;return t.ownerDocument=this,t.appendData(o),t},createProcessingInstruction:function(o,t){var e=new Vg;return e.ownerDocument=this,e.tagName=e.nodeName=e.target=o,e.nodeValue=e.data=t,e},createAttribute:function(o){var t=new Sd;return t.ownerDocument=this,t.name=o,t.nodeName=o,t.localName=o,t.specified=!0,t},createEntityReference:function(o){var t=new qg;return t.ownerDocument=this,t.nodeName=o,t},createElementNS:function(o,t){var e=new vo,i=t.split(":"),n=e.attributes=new Ed;return e.childNodes=new rr,e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.namespaceURI=o,i.length==2?(e.prefix=i[0],e.localName=i[1]):e.localName=t,n._ownerElement=e,e},createAttributeNS:function(o,t){var e=new Sd,i=t.split(":");return e.ownerDocument=this,e.nodeName=t,e.name=t,e.namespaceURI=o,e.specified=!0,i.length==2?(e.prefix=i[0],e.localName=i[1]):e.localName=t,e}};Wi(wc,se);function vo(){this._nsMap={}}vo.prototype={nodeType:Yn,hasAttribute:function(o){return this.getAttributeNode(o)!=null},getAttribute:function(o){var t=this.getAttributeNode(o);return t&&t.value||""},getAttributeNode:function(o){return this.attributes.getNamedItem(o)},setAttribute:function(o,t){var e=this.ownerDocument.createAttribute(o);e.value=e.nodeValue=""+t,this.setAttributeNode(e)},removeAttribute:function(o){var t=this.getAttributeNode(o);t&&this.removeAttributeNode(t)},appendChild:function(o){return o.nodeType===lr?this.insertBefore(o,null):H_(this,o)},setAttributeNode:function(o){return this.attributes.setNamedItem(o)},setAttributeNodeNS:function(o){return this.attributes.setNamedItemNS(o)},removeAttributeNode:function(o){return this.attributes.removeNamedItem(o.nodeName)},removeAttributeNS:function(o,t){var e=this.getAttributeNodeNS(o,t);e&&this.removeAttributeNode(e)},hasAttributeNS:function(o,t){return this.getAttributeNodeNS(o,t)!=null},getAttributeNS:function(o,t){var e=this.getAttributeNodeNS(o,t);return e&&e.value||""},setAttributeNS:function(o,t,e){var i=this.ownerDocument.createAttributeNS(o,t);i.value=i.nodeValue=""+e,this.setAttributeNode(i)},getAttributeNodeNS:function(o,t){return this.attributes.getNamedItemNS(o,t)},getElementsByTagName:function(o){return new Zl(this,function(t){var e=[];return zh(t,function(i){i!==t&&i.nodeType==Yn&&(o==="*"||i.tagName==o)&&e.push(i)}),e})},getElementsByTagNameNS:function(o,t){return new Zl(this,function(e){var i=[];return zh(e,function(n){n!==e&&n.nodeType===Yn&&(o==="*"||n.namespaceURI===o)&&(t==="*"||n.localName==t)&&i.push(n)}),i})}};wc.prototype.getElementsByTagName=vo.prototype.getElementsByTagName;wc.prototype.getElementsByTagNameNS=vo.prototype.getElementsByTagNameNS;Wi(vo,se);function Sd(){}Sd.prototype.nodeType=Kl;Wi(Sd,se);function _c(){}_c.prototype={data:"",substringData:function(o,t){return this.data.substring(o,o+t)},appendData:function(o){o=this.data+o,this.nodeValue=this.data=o,this.length=o.length},insertData:function(o,t){this.replaceData(o,0,t)},appendChild:function(o){throw new Error(Qe[ji])},deleteData:function(o,t){this.replaceData(o,t,"")},replaceData:function(o,t,e){var i=this.data.substring(0,o),n=this.data.substring(o+t);e=i+e+n,this.nodeValue=this.data=e,this.length=e.length}};Wi(_c,se);function Hg(){}Hg.prototype={nodeName:"#text",nodeType:Ad,splitText:function(o){var t=this.data,e=t.substring(o);t=t.substring(0,o),this.data=this.nodeValue=t,this.length=t.length;var i=this.ownerDocument.createTextNode(e);return this.parentNode&&this.parentNode.insertBefore(i,this.nextSibling),i}};Wi(Hg,_c);function jg(){}jg.prototype={nodeName:"#comment",nodeType:Db};Wi(jg,_c);function Wg(){}Wg.prototype={nodeName:"#cdata-section",nodeType:Sb};Wi(Wg,_c);function gf(){}gf.prototype.nodeType=Rb;Wi(gf,se);function Bb(){}Bb.prototype.nodeType=O_;Wi(Bb,se);function zb(){}zb.prototype.nodeType=N_;Wi(zb,se);function qg(){}qg.prototype.nodeType=Cb;Wi(qg,se);function mf(){}mf.prototype.nodeName="#document-fragment";mf.prototype.nodeType=lr;Wi(mf,se);function Vg(){}Vg.prototype.nodeType=Tb;Wi(Vg,se);function Ub(){}Ub.prototype.serializeToString=function(o,t,e){return Hb.call(o,t,e)};se.prototype.toString=Hb;function Hb(o,t){var e=[],i=this.nodeType==9&&this.documentElement||this,n=i.prefix,s=i.namespaceURI;if(s&&n==null){var n=i.lookupPrefix(s);if(n==null)var r=[{namespace:s,prefix:null}]}return zo(this,e,o,t,r),e.join("")}function $m(o,t,e){var i=o.prefix||"",n=o.namespaceURI;if(!n||i==="xml"&&n===Bh.XML||n===Bh.XMLNS)return!1;for(var s=e.length;s--;){var r=e[s];if(r.prefix===i)return r.namespace!==n}return!0}function jf(o,t,e){o.push(" ",t,'="',e.replace(/[<&"]/g,Nb),'"')}function zo(o,t,e,i,n){if(n||(n=[]),i)if(o=i(o),o){if(typeof o=="string"){t.push(o);return}}else return;switch(o.nodeType){case Yn:var s=o.attributes,r=s.length,m=o.firstChild,a=o.tagName;e=Bh.isHTML(o.namespaceURI)||e;var l=a;if(!e&&!o.prefix&&o.namespaceURI){for(var u,c=0;c<s.length;c++)if(s.item(c).name==="xmlns"){u=s.item(c).value;break}if(!u)for(var d=n.length-1;d>=0;d--){var f=n[d];if(f.prefix===""&&f.namespace===o.namespaceURI){u=f.namespace;break}}if(u!==o.namespaceURI)for(var d=n.length-1;d>=0;d--){var f=n[d];if(f.namespace===o.namespaceURI){f.prefix&&(l=f.prefix+":"+a);break}}}t.push("<",l);for(var p=0;p<r;p++){var b=s.item(p);b.prefix=="xmlns"?n.push({prefix:b.localName,namespace:b.value}):b.nodeName=="xmlns"&&n.push({prefix:"",namespace:b.value})}for(var p=0;p<r;p++){var b=s.item(p);if($m(b,e,n)){var y=b.prefix||"",g=b.namespaceURI;jf(t,y?"xmlns:"+y:"xmlns",g),n.push({prefix:y,namespace:g})}zo(b,t,e,i,n)}if(a===l&&$m(o,e,n)){var y=o.prefix||"",g=o.namespaceURI;jf(t,y?"xmlns:"+y:"xmlns",g),n.push({prefix:y,namespace:g})}if(m||e&&!/^(?:meta|link|img|br|hr|input)$/i.test(a)){if(t.push(">"),e&&/^script$/i.test(a))for(;m;)m.data?t.push(m.data):zo(m,t,e,i,n.slice()),m=m.nextSibling;else for(;m;)zo(m,t,e,i,n.slice()),m=m.nextSibling;t.push("</",l,">")}else t.push("/>");return;case kb:case lr:for(var m=o.firstChild;m;)zo(m,t,e,i,n.slice()),m=m.nextSibling;return;case Kl:return jf(t,o.name,o.value);case Ad:return t.push(o.data.replace(/[<&]/g,Nb).replace(/]]>/g,"]]&gt;"));case Sb:return t.push("<![CDATA[",o.data,"]]>");case Db:return t.push("<!--",o.data,"-->");case Rb:var w=o.publicId,E=o.systemId;if(t.push("<!DOCTYPE ",o.name),w)t.push(" PUBLIC ",w),E&&E!="."&&t.push(" ",E),t.push(">");else if(E&&E!=".")t.push(" SYSTEM ",E,">");else{var R=o.internalSubset;R&&t.push(" [",R,"]"),t.push(">")}return;case Tb:return t.push("<?",o.target," ",o.data,"?>");case Cb:return t.push("&",o.nodeName,";");default:t.push("??",o.nodeName)}}function jb(o,t,e){var i;switch(t.nodeType){case Yn:i=t.cloneNode(!1),i.ownerDocument=o;case lr:break;case Kl:e=!0;break}if(i||(i=t.cloneNode(!1)),i.ownerDocument=o,i.parentNode=null,e)for(var n=t.firstChild;n;)i.appendChild(jb(o,n,e)),n=n.nextSibling;return i}function fg(o,t,e){var i=new t.constructor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var s=t[n];typeof s!="object"&&s!=i[n]&&(i[n]=s)}switch(t.childNodes&&(i.childNodes=new rr),i.ownerDocument=o,i.nodeType){case Yn:var r=t.attributes,a=i.attributes=new Ed,l=r.length;a._ownerElement=i;for(var u=0;u<l;u++)i.setAttributeNode(fg(o,r.item(u),!0));break;case Kl:e=!0}if(e)for(var c=t.firstChild;c;)i.appendChild(fg(o,c,e)),c=c.nextSibling;return i}function Wb(o,t,e){o[t]=e}try{if(Object.defineProperty){let o=function(t){switch(t.nodeType){case Yn:case lr:var e=[];for(t=t.firstChild;t;)t.nodeType!==7&&t.nodeType!==8&&e.push(o(t)),t=t.nextSibling;return e.join("");default:return t.nodeValue}};Object.defineProperty(Zl.prototype,"length",{get:function(){return Bg(this),this.$$length}}),Object.defineProperty(se.prototype,"textContent",{get:function(){return o(this)},set:function(t){switch(this.nodeType){case Yn:case lr:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),Wb=function(t,e,i){t["$$"+e]=i}}}catch{}ia.DocumentType=gf;ia.DOMException=Re;ia.DOMImplementation=Pb;ia.Element=vo;ia.Node=se;ia.NodeList=rr;ia.XMLSerializer=Ub;var Ac={},qb={};(function(o){var t=na.freeze;o.XML_ENTITIES=t({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),o.HTML_ENTITIES=t({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:`
`,nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"	",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),o.entityMap=o.HTML_ENTITIES})(qb);var Gg={},Uh=na.NAMESPACE,pg=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Xm=new RegExp("[\\-\\.0-9"+pg.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),Ym=new RegExp("^"+pg.source+Xm.source+"*(?::"+pg.source+Xm.source+"*)?$"),lh=0,gr=1,xo=2,hh=3,So=4,Co=5,uh=6,Ic=7;function Ql(o,t){this.message=o,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,Ql)}Ql.prototype=new Error;Ql.prototype.name=Ql.name;function Vb(){}Vb.prototype={parse:function(o,t,e){var i=this.domBuilder;i.startDocument(),Gb(t,t={}),j_(o,t,e,i,this.errorHandler),i.endDocument()}};function j_(o,t,e,i,n){function s(X){if(X>65535){X-=65536;var K=55296+(X>>10),lt=56320+(X&1023);return String.fromCharCode(K,lt)}else return String.fromCharCode(X)}function r(X){var K=X.slice(1,-1);return K in e?e[K]:K.charAt(0)==="#"?s(parseInt(K.substr(1).replace("x","0x"))):(n.error("entity not found:"+X),X)}function a(X){if(X>y){var K=o.substring(y,X).replace(/&#?\w+;/g,r);f&&l(y),i.characters(K,0,X-y),y=X}}function l(X,K){for(;X>=c&&(K=d.exec(o));)u=K.index,c=u+K[0].length,f.lineNumber++;f.columnNumber=X-u+1}for(var u=0,c=0,d=/.*(?:\r\n?|\n)|.*$/g,f=i.locator,p=[{currentNSMap:t}],b={},y=0;;){try{var g=o.indexOf("<",y);if(g<0){if(!o.substr(y).match(/^\s*$/)){var m=i.doc,w=m.createTextNode(o.substr(y));m.appendChild(w),i.currentElement=w}return}switch(g>y&&a(g),o.charAt(g+1)){case"/":var W=o.indexOf(">",g+3),E=o.substring(g+2,W).replace(/[ \t\n\r]+$/g,""),R=p.pop();W<0?(E=o.substring(g+2).replace(/[\s<].*/,""),n.error("end tag name: "+E+" is not complete:"+R.tagName),W=g+1+E.length):E.match(/\s</)&&(E=E.replace(/[\s<].*/,""),n.error("end tag name: "+E+" maybe not complete"),W=g+1+E.length);var A=R.localNSMap,T=R.tagName==E,k=T||R.tagName&&R.tagName.toLowerCase()==E.toLowerCase();if(k){if(i.endElement(R.uri,R.localName,E),A)for(var P in A)Object.prototype.hasOwnProperty.call(A,P)&&i.endPrefixMapping(P);T||n.fatalError("end tag name: "+E+" is not match the current start tagName:"+R.tagName)}else p.push(R);W++;break;case"?":f&&l(g),W=$_(o,g,i);break;case"!":f&&l(g),W=G_(o,g,i,n);break;default:f&&l(g);var F=new $b,B=p[p.length-1].currentNSMap,W=W_(o,g,F,B,r,n),G=F.length;if(!F.closed&&V_(o,W,F.tagName,b)&&(F.closed=!0,e.nbsp||n.warning("unclosed xml attribute")),f&&G){for(var et=Km(f,{}),ot=0;ot<G;ot++){var ct=F[ot];l(ct.offset),ct.locator=Km(f,{})}i.locator=et,Zm(F,i,B)&&p.push(F),i.locator=f}else Zm(F,i,B)&&p.push(F);Uh.isHTML(F.uri)&&!F.closed?W=q_(o,W,F.tagName,r,i):W++}}catch(X){if(X instanceof Ql)throw X;n.error("element parse error: "+X),W=-1}W>y?y=W:a(Math.max(g,y)+1)}}function Km(o,t){return t.lineNumber=o.lineNumber,t.columnNumber=o.columnNumber,t}function W_(o,t,e,i,n,s){function r(f,p,b){e.attributeNames.hasOwnProperty(f)&&s.fatalError("Attribute "+f+" redefined"),e.addValue(f,p,b)}for(var a,l,u=++t,c=lh;;){var d=o.charAt(u);switch(d){case"=":if(c===gr)a=o.slice(t,u),c=hh;else if(c===xo)c=hh;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(c===hh||c===gr)if(c===gr&&(s.warning('attribute value must after "="'),a=o.slice(t,u)),t=u+1,u=o.indexOf(d,t),u>0)l=o.slice(t,u).replace(/&#?\w+;/g,n),r(a,l,t-1),c=Co;else throw new Error("attribute value no end '"+d+"' match");else if(c==So)l=o.slice(t,u).replace(/&#?\w+;/g,n),r(a,l,t),s.warning('attribute "'+a+'" missed start quot('+d+")!!"),t=u+1,c=Co;else throw new Error('attribute value must after "="');break;case"/":switch(c){case lh:e.setTagName(o.slice(t,u));case Co:case uh:case Ic:c=Ic,e.closed=!0;case So:case gr:break;case xo:e.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),c==lh&&e.setTagName(o.slice(t,u)),u;case">":switch(c){case lh:e.setTagName(o.slice(t,u));case Co:case uh:case Ic:break;case So:case gr:l=o.slice(t,u),l.slice(-1)==="/"&&(e.closed=!0,l=l.slice(0,-1));case xo:c===xo&&(l=a),c==So?(s.warning('attribute "'+l+'" missed quot(")!'),r(a,l.replace(/&#?\w+;/g,n),t)):((!Uh.isHTML(i[""])||!l.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+l+'" missed value!! "'+l+'" instead!!'),r(l,l,t));break;case hh:throw new Error("attribute value missed!!")}return u;case"":d=" ";default:if(d<=" ")switch(c){case lh:e.setTagName(o.slice(t,u)),c=uh;break;case gr:a=o.slice(t,u),c=xo;break;case So:var l=o.slice(t,u).replace(/&#?\w+;/g,n);s.warning('attribute "'+l+'" missed quot(")!!'),r(a,l,t);case Co:c=uh;break}else switch(c){case xo:e.tagName,(!Uh.isHTML(i[""])||!a.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),r(a,a,t),t=u,c=gr;break;case Co:s.warning('attribute space is required"'+a+'"!!');case uh:c=gr,t=u;break;case hh:c=So,t=u;break;case Ic:throw new Error("elements closed character '/' and '>' must be connected to")}}u++}}function Zm(o,t,e){for(var i=o.tagName,n=null,d=o.length;d--;){var s=o[d],r=s.qName,a=s.value,f=r.indexOf(":");if(f>0)var l=s.prefix=r.slice(0,f),u=r.slice(f+1),c=l==="xmlns"&&u;else u=r,l=null,c=r==="xmlns"&&"";s.localName=u,c!==!1&&(n==null&&(n={},Gb(e,e={})),e[c]=n[c]=a,s.uri=Uh.XMLNS,t.startPrefixMapping(c,a))}for(var d=o.length;d--;){s=o[d];var l=s.prefix;l&&(l==="xml"&&(s.uri=Uh.XML),l!=="xmlns"&&(s.uri=e[l||""]))}var f=i.indexOf(":");f>0?(l=o.prefix=i.slice(0,f),u=o.localName=i.slice(f+1)):(l=null,u=o.localName=i);var p=o.uri=e[l||""];if(t.startElement(p,u,i,o),o.closed){if(t.endElement(p,u,i),n)for(l in n)Object.prototype.hasOwnProperty.call(n,l)&&t.endPrefixMapping(l)}else return o.currentNSMap=e,o.localNSMap=n,!0}function q_(o,t,e,i,n){if(/^(?:script|textarea)$/i.test(e)){var s=o.indexOf("</"+e+">",t),r=o.substring(t+1,s);if(/[&<]/.test(r))return/^script$/i.test(e)?(n.characters(r,0,r.length),s):(r=r.replace(/&#?\w+;/g,i),n.characters(r,0,r.length),s)}return t+1}function V_(o,t,e,i){var n=i[e];return n==null&&(n=o.lastIndexOf("</"+e+">"),n<t&&(n=o.lastIndexOf("</"+e)),i[e]=n),n<t}function Gb(o,t){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])}function G_(o,t,e,i){var n=o.charAt(t+2);switch(n){case"-":if(o.charAt(t+3)==="-"){var s=o.indexOf("-->",t+4);return s>t?(e.comment(o,t+4,s-t-4),s+3):(i.error("Unclosed comment"),-1)}else return-1;default:if(o.substr(t+3,6)=="CDATA["){var s=o.indexOf("]]>",t+9);return e.startCDATA(),e.characters(o,t+9,s-t-9),e.endCDATA(),s+3}var r=X_(o,t),a=r.length;if(a>1&&/!doctype/i.test(r[0][0])){var l=r[1][0],u=!1,c=!1;a>3&&(/^public$/i.test(r[2][0])?(u=r[3][0],c=a>4&&r[4][0]):/^system$/i.test(r[2][0])&&(c=r[3][0]));var d=r[a-1];return e.startDTD(l,u,c),e.endDTD(),d.index+d[0].length}}return-1}function $_(o,t,e){var i=o.indexOf("?>",t);if(i){var n=o.substring(t,i).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return n?(n[0].length,e.processingInstruction(n[1],n[2]),i+2):-1}return-1}function $b(){this.attributeNames={}}$b.prototype={setTagName:function(o){if(!Ym.test(o))throw new Error("invalid tagName:"+o);this.tagName=o},addValue:function(o,t,e){if(!Ym.test(o))throw new Error("invalid attribute:"+o);this.attributeNames[o]=this.length,this[this.length++]={qName:o,value:t,offset:e}},length:0,getLocalName:function(o){return this[o].localName},getLocator:function(o){return this[o].locator},getQName:function(o){return this[o].qName},getURI:function(o){return this[o].uri},getValue:function(o){return this[o].value}};function X_(o,t){var e,i=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=t,n.exec(o);e=n.exec(o);)if(i.push(e),e[1])return i}Gg.XMLReader=Vb;Gg.ParseError=Ql;var Y_=na,$g=ia,Qm=qb,Xb=Gg,K_=$g.DOMImplementation,Jm=Y_.NAMESPACE,Z_=Xb.ParseError,Q_=Xb.XMLReader;function Yb(o){this.options=o||{locator:{}}}Yb.prototype.parseFromString=function(o,t){var e=this.options,i=new Q_,n=e.domBuilder||new Ec,s=e.errorHandler,r=e.locator,a=e.xmlns||{},l=/\/x?html?$/.test(t),u=l?Qm.HTML_ENTITIES:Qm.XML_ENTITIES;return r&&n.setDocumentLocator(r),i.errorHandler=J_(s,n,r),i.domBuilder=e.domBuilder||n,l&&(a[""]=Jm.HTML),a.xml=a.xml||Jm.XML,o&&typeof o=="string"?i.parse(o,a,u):i.errorHandler.error("invalid doc source"),n.doc};function J_(o,t,e){if(!o){if(t instanceof Ec)return t;o=t}var i={},n=o instanceof Function;e=e||{};function s(r){var a=o[r];!a&&n&&(a=o.length==2?function(l){o(r,l)}:o),i[r]=a&&function(l){a("[xmldom "+r+"]	"+l+gg(e))}||function(){}}return s("warning"),s("error"),s("fatalError"),i}function Ec(){this.cdata=!1}function To(o,t){t.lineNumber=o.lineNumber,t.columnNumber=o.columnNumber}Ec.prototype={startDocument:function(){this.doc=new K_().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(o,t,e,i){var n=this.doc,s=n.createElementNS(o,e||t),r=i.length;Lc(this,s),this.currentElement=s,this.locator&&To(this.locator,s);for(var a=0;a<r;a++){var o=i.getURI(a),l=i.getValue(a),e=i.getQName(a),u=n.createAttributeNS(o,e);this.locator&&To(i.getLocator(a),u),u.value=u.nodeValue=l,s.setAttributeNode(u)}},endElement:function(o,t,e){var i=this.currentElement;i.tagName,this.currentElement=i.parentNode},startPrefixMapping:function(o,t){},endPrefixMapping:function(o){},processingInstruction:function(o,t){var e=this.doc.createProcessingInstruction(o,t);this.locator&&To(this.locator,e),Lc(this,e)},ignorableWhitespace:function(o,t,e){},characters:function(o,t,e){if(o=tv.apply(this,arguments),o){if(this.cdata)var i=this.doc.createCDATASection(o);else var i=this.doc.createTextNode(o);this.currentElement?this.currentElement.appendChild(i):/^\s*$/.test(o)&&this.doc.appendChild(i),this.locator&&To(this.locator,i)}},skippedEntity:function(o){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(o){(this.locator=o)&&(o.lineNumber=0)},comment:function(o,t,e){o=tv.apply(this,arguments);var i=this.doc.createComment(o);this.locator&&To(this.locator,i),Lc(this,i)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(o,t,e){var i=this.doc.implementation;if(i&&i.createDocumentType){var n=i.createDocumentType(o,t,e);this.locator&&To(this.locator,n),Lc(this,n),this.doc.doctype=n}},warning:function(o){console.warn("[xmldom warning]	"+o,gg(this.locator))},error:function(o){console.error("[xmldom error]	"+o,gg(this.locator))},fatalError:function(o){throw new Z_(o,this.locator)}};function gg(o){if(o)return`
@`+(o.systemId||"")+"#[line:"+o.lineNumber+",col:"+o.columnNumber+"]"}function tv(o,t,e){return typeof o=="string"?o.substr(t,e):o.length>=t+e||t?new java.lang.String(o,t,e)+"":o}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(o){Ec.prototype[o]=function(){return null}});function Lc(o,t){o.currentElement?o.currentElement.appendChild(t):o.doc.appendChild(t)}Ac.__DOMHandler=Ec;Ac.DOMParser=Yb;Ac.DOMImplementation=$g.DOMImplementation;Ac.XMLSerializer=$g.XMLSerializer;var Kb=Ac.DOMParser;const Xg=typeof window<"u"?window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame:!1,tA=1,eA=3,Zb=typeof URL<"u"?URL:typeof window<"u"?window.URL||window.webkitURL||window.mozURL:void 0;function vf(){var o=new Date().getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(e=="x"?i:i&7|8).toString(16)});return t}function iA(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)}function Qb(o){return!!(o&&o.nodeType==1)}function xe(o){return!isNaN(parseFloat(o))&&isFinite(o)}function Jb(o){let t=parseFloat(o);return xe(o)===!1?!1:typeof o=="string"&&o.indexOf(".")>-1?!0:Math.floor(t)!==t}function Fo(o){var t=["Webkit","webkit","Moz","O","ms"],e=["-webkit-","-webkit-","-moz-","-o-","-ms-"],i=o.toLowerCase(),n=t.length;if(typeof document>"u"||typeof document.body.style[i]<"u")return o;for(var s=0;s<n;s++)if(typeof document.body.style[e[s]+i]<"u")return e[s]+i;return o}function ty(o){for(var t=1,e=arguments.length;t<e;t++){var i=arguments[t];for(var n in i)o[n]===void 0&&(o[n]=i[n])}return o}function oi(o){var t=[].slice.call(arguments,1);return t.forEach(function(e){e&&Object.getOwnPropertyNames(e).forEach(function(i){Object.defineProperty(o,i,Object.getOwnPropertyDescriptor(e,i))})}),o}function nA(o,t,e){var i=Jl(o,t,e);return t.splice(i,0,o),i}function Jl(o,t,e,i,n){var s=i||0,r=n||t.length,a=parseInt(s+(r-s)/2),l;return e||(e=function(u,c){if(u>c)return 1;if(u<c)return-1;if(u==c)return 0}),r-s<=0?a:(l=e(t[a],o),r-s===1?l>=0?a:a+1:l===0?a:l===-1?Jl(o,t,e,a,r):Jl(o,t,e,s,a))}function Cd(o,t,e,i,n){var s=i||0,r=n||t.length,a=parseInt(s+(r-s)/2),l;return e||(e=function(u,c){if(u>c)return 1;if(u<c)return-1;if(u==c)return 0}),r-s<=0?-1:(l=e(t[a],o),r-s===1?l===0?a:-1:l===0?a:l===-1?Cd(o,t,e,a,r):Cd(o,t,e,s,a))}function ud(o){var t=window.getComputedStyle(o),e=["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],i=["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],n=0,s=0;return e.forEach(function(r){n+=parseFloat(t[r])||0}),i.forEach(function(r){s+=parseFloat(t[r])||0}),{height:s,width:n}}function Td(o){var t=window.getComputedStyle(o),e=["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],i=["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],n=0,s=0;return e.forEach(function(r){n+=parseFloat(t[r])||0}),i.forEach(function(r){s+=parseFloat(t[r])||0}),{height:s,width:n}}function mg(o){let t,e=o.ownerDocument;if(o.nodeType==Node.TEXT_NODE){let i=e.createRange();i.selectNodeContents(o),t=i.getBoundingClientRect()}else t=o.getBoundingClientRect();return t}function Dd(){var o=window.innerWidth,t=window.innerHeight;return{top:0,left:0,right:o,bottom:t,width:o,height:t}}function Yg(o,t){for(var e=o.parentNode,i=e.childNodes,n,s=-1,r=0;r<i.length&&(n=i[r],n.nodeType===t&&s++,n!=o);r++);return s}function sA(o){return Yg(o,eA)}function ey(o){return Yg(o,tA)}function Hh(o){return["xml","opf","ncx"].indexOf(o)>-1}function iy(o,t){return new Blob([o],{type:t})}function kd(o,t){var e,i=iy(o,t);return e=Zb.createObjectURL(i),e}function ny(o){return Zb.revokeObjectURL(o)}function vg(o,t){var e,i;if(typeof o=="string")return e=btoa(o),i="data:"+t+";base64,"+e,i}function sy(o){return Object.prototype.toString.call(o).slice(8,-1)}function _s(o,t,e){var i,n;return typeof DOMParser>"u"||e?n=Kb:n=DOMParser,o.charCodeAt(0)===65279&&(o=o.slice(1)),i=new n().parseFromString(o,t),i}function oe(o,t){var e;if(!o)throw new Error("No Element Provided");if(typeof o.querySelector<"u")return o.querySelector(t);if(e=o.getElementsByTagName(t),e.length)return e[0]}function ur(o,t){return typeof o.querySelector<"u"?o.querySelectorAll(t):o.getElementsByTagName(t)}function Mo(o,t,e){var i,n;if(typeof o.querySelector<"u"){t+="[";for(var s in e)t+=s+"~='"+e[s]+"'";return t+="]",o.querySelector(t)}else if(i=o.getElementsByTagName(t),n=Array.prototype.slice.call(i,0).filter(function(r){for(var a in e)if(r.getAttribute(a)===e[a])return!0;return!1}),n)return n[0]}function Rd(o,t){var e=o.ownerDocument||o;typeof e.createTreeWalker<"u"?ry(o,t,NodeFilter.SHOW_TEXT):Kg(o,function(i){i&&i.nodeType===3&&t(i)})}function ry(o,t,e){var i=document.createTreeWalker(o,e,null,!1);let n;for(;n=i.nextNode();)t(n)}function Kg(o,t){if(t(o))return!0;if(o=o.firstChild,o)do{if(Kg(o,t))return!0;o=o.nextSibling}while(o)}function ay(o){return new Promise(function(t,e){var i=new FileReader;i.readAsDataURL(o),i.onloadend=function(){t(i.result)}})}function Gt(){this.resolve=null,this.reject=null,this.id=vf(),this.promise=new Promise((o,t)=>{this.resolve=o,this.reject=t}),Object.freeze(this)}function Id(o,t,e){var i;if(typeof o.querySelector<"u"&&(i=o.querySelector(`${t}[*|type="${e}"]`)),!i||i.length===0){i=ur(o,t);for(var n=0;n<i.length;n++)if(i[n].getAttributeNS("http://www.idpf.org/2007/ops","type")===e||i[n].getAttribute("epub:type")===e)return i[n]}else return i}function bg(o){for(var t=[],e=o.childNodes,i=0;i<e.length;i++){let n=e[i];n.nodeType===1&&t.push(n)}return t}function yg(o){for(var t=[o];o;o=o.parentNode)t.unshift(o);return t}function Bo(o,t,e){for(var i=[],n=o.childNodes,s=0;s<n.length;s++){let r=n[s];if(r.nodeType===1&&r.nodeName.toLowerCase()===t){if(e)return r;i.push(r)}}if(!e)return i}function rA(o,t){let e;if(!(o===null||t===""))for(e=o.parentNode;e.nodeType===1;){if(e.tagName.toLowerCase()===t)return e;e=e.parentNode}}class oy{constructor(){this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}setStart(t,e){this.startContainer=t,this.startOffset=e,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}setEnd(t,e){this.endContainer=t,this.endOffset=e,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}collapse(t){this.collapsed=!0,t?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}selectNode(t){let e=t.parentNode,i=Array.prototype.indexOf.call(e.childNodes,t);this.setStart(e,i),this.setEnd(e,i+1)}selectNodeContents(t){t.childNodes[t.childNodes-1];let e=t.nodeType===3?t.textContent.length:parent.childNodes.length;this.setStart(t,0),this.setEnd(t,e)}_commonAncestorContainer(t,e){var i=yg(t||this.startContainer),n=yg(e||this.endContainer);if(i[0]==n[0]){for(var s=0;s<i.length;s++)if(i[s]!=n[s])return i[s-1]}}_checkCollapsed(){this.startContainer===this.endContainer&&this.startOffset===this.endOffset?this.collapsed=!0:this.collapsed=!1}toString(){}}const aA=Object.freeze(Object.defineProperty({__proto__:null,RangeObject:oy,blob2base64:ay,borders:Td,bounds:ud,createBase64Url:vg,createBlob:iy,createBlobUrl:kd,defaults:ty,defer:Gt,documentHeight:iA,extend:oi,filterChildren:Bo,findChildren:bg,getParentByTagName:rA,indexOfElementNode:ey,indexOfNode:Yg,indexOfSorted:Cd,indexOfTextNode:sA,insert:nA,isElement:Qb,isFloat:Jb,isNumber:xe,isXml:Hh,locationOf:Jl,nodeBounds:mg,parents:yg,parse:_s,prefixed:Fo,qs:oe,qsa:ur,qsp:Mo,querySelectorByType:Id,requestAnimationFrame:Xg,revokeBlobUrl:ny,sprint:Rd,treeWalker:ry,type:sy,uuid:vf,walk:Kg,windowBounds:Dd},Symbol.toStringTag,{value:"Module"}));if(!ly)var ly={cwd:function(){return"/"}};function ts(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+o)}function ev(o,t){for(var e="",i=-1,n=0,s,r=0;r<=o.length;++r){if(r<o.length)s=o.charCodeAt(r);else{if(s===47)break;s=47}if(s===47){if(!(i===r-1||n===1))if(i!==r-1&&n===2){if(e.length<2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){for(var a=e.length-1,l=a;l>=0&&e.charCodeAt(l)!==47;--l);if(l!==a){l===-1?e="":e=e.slice(0,l),i=r,n=0;continue}}else if(e.length===2||e.length===1){e="",i=r,n=0;continue}}t&&(e.length>0?e+="/..":e="..")}else e.length>0?e+="/"+o.slice(i+1,r):e=o.slice(i+1,r);i=r,n=0}else s===46&&n!==-1?++n:n=-1}return e}function oA(o,t){var e=t.dir||t.root,i=t.base||(t.name||"")+(t.ext||"");return e?e===t.root?e+i:e+o+i:i}var cd={resolve:function(){for(var t="",e=!1,i,n=arguments.length-1;n>=-1&&!e;n--){var s;n>=0?s=arguments[n]:(i===void 0&&(i=ly.cwd()),s=i),ts(s),s.length!==0&&(t=s+"/"+t,e=s.charCodeAt(0)===47)}return t=ev(t,!e),e?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(t){if(ts(t),t.length===0)return".";var e=t.charCodeAt(0)===47,i=t.charCodeAt(t.length-1)===47;return t=ev(t,!e),t.length===0&&!e&&(t="."),t.length>0&&i&&(t+="/"),e?"/"+t:t},isAbsolute:function(t){return ts(t),t.length>0&&t.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var t,e=0;e<arguments.length;++e){var i=arguments[e];ts(i),i.length>0&&(t===void 0?t=i:t+="/"+i)}return t===void 0?".":cd.normalize(t)},relative:function(t,e){if(ts(t),ts(e),t===e||(t=cd.resolve(t),e=cd.resolve(e),t===e))return"";for(var i=1;i<t.length&&t.charCodeAt(i)===47;++i);for(var n=t.length,s=n-i,r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var a=e.length,l=a-r,u=s<l?s:l,c=-1,d=0;d<=u;++d){if(d===u){if(l>u){if(e.charCodeAt(r+d)===47)return e.slice(r+d+1);if(d===0)return e.slice(r+d)}else s>u&&(t.charCodeAt(i+d)===47?c=d:d===0&&(c=0));break}var f=t.charCodeAt(i+d),p=e.charCodeAt(r+d);if(f!==p)break;f===47&&(c=d)}var b="";for(d=i+c+1;d<=n;++d)(d===n||t.charCodeAt(d)===47)&&(b.length===0?b+="..":b+="/..");return b.length>0?b+e.slice(r+c):(r+=c,e.charCodeAt(r)===47&&++r,e.slice(r))},_makeLong:function(t){return t},dirname:function(t){if(ts(t),t.length===0)return".";for(var e=t.charCodeAt(0),i=e===47,n=-1,s=!0,r=t.length-1;r>=1;--r)if(e=t.charCodeAt(r),e===47){if(!s){n=r;break}}else s=!1;return n===-1?i?"/":".":i&&n===1?"//":t.slice(0,n)},basename:function(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');ts(t);var i=0,n=-1,s=!0,r;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var a=e.length-1,l=-1;for(r=t.length-1;r>=0;--r){var u=t.charCodeAt(r);if(u===47){if(!s){i=r+1;break}}else l===-1&&(s=!1,l=r+1),a>=0&&(u===e.charCodeAt(a)?--a===-1&&(n=r):(a=-1,n=l))}return i===n?n=l:n===-1&&(n=t.length),t.slice(i,n)}else{for(r=t.length-1;r>=0;--r)if(t.charCodeAt(r)===47){if(!s){i=r+1;break}}else n===-1&&(s=!1,n=r+1);return n===-1?"":t.slice(i,n)}},extname:function(t){ts(t);for(var e=-1,i=0,n=-1,s=!0,r=0,a=t.length-1;a>=0;--a){var l=t.charCodeAt(a);if(l===47){if(!s){i=a+1;break}continue}n===-1&&(s=!1,n=a+1),l===46?e===-1?e=a:r!==1&&(r=1):e!==-1&&(r=-1)}return e===-1||n===-1||r===0||r===1&&e===n-1&&e===i+1?"":t.slice(e,n)},format:function(t){if(t===null||typeof t!="object")throw new TypeError('Parameter "pathObject" must be an object, not '+typeof t);return oA("/",t)},parse:function(t){ts(t);var e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;var i=t.charCodeAt(0),n=i===47,s;n?(e.root="/",s=1):s=0;for(var r=-1,a=0,l=-1,u=!0,c=t.length-1,d=0;c>=s;--c){if(i=t.charCodeAt(c),i===47){if(!u){a=c+1;break}continue}l===-1&&(u=!1,l=c+1),i===46?r===-1?r=c:d!==1&&(d=1):r!==-1&&(d=-1)}return r===-1||l===-1||d===0||d===1&&r===l-1&&r===a+1?l!==-1&&(a===0&&n?e.base=e.name=t.slice(1,l):e.base=e.name=t.slice(a,l)):(a===0&&n?(e.name=t.slice(1,r),e.base=t.slice(1,l)):(e.name=t.slice(a,r),e.base=t.slice(a,l)),e.ext=t.slice(r,l)),a>0?e.dir=t.slice(0,a-1):n&&(e.dir="/"),e},sep:"/",delimiter:":",posix:null},lA=cd;const Xr=eh(lA);class cr{constructor(t){var e,i;e=t.indexOf("://"),e>-1&&(t=new URL(t).pathname),i=this.parse(t),this.path=t,this.isDirectory(t)?this.directory=t:this.directory=i.dir+"/",this.filename=i.base,this.extension=i.ext.slice(1)}parse(t){return Xr.parse(t)}isAbsolute(t){return Xr.isAbsolute(t||this.path)}isDirectory(t){return t.charAt(t.length-1)==="/"}resolve(t){return Xr.resolve(this.directory,t)}relative(t){var e=t&&t.indexOf("://")>-1;return e?t:Xr.relative(this.directory,t)}splitPath(t){return this.splitPathRe.exec(t).slice(1)}toString(){return this.path}}class Nn{constructor(t,e){var i=t.indexOf("://")>-1,n=t,s;if(this.Url=void 0,this.href=t,this.protocol="",this.origin="",this.hash="",this.hash="",this.search="",this.base=e,!i&&e!==!1&&typeof e!="string"&&window&&window.location&&(this.base=window.location.href),i||this.base)try{this.base?this.Url=new URL(t,this.base):this.Url=new URL(t),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,n=this.Url.pathname+(this.Url.search?this.Url.search:"")}catch{this.Url=void 0,this.base&&(s=new cr(this.base),n=s.resolve(n))}this.Path=new cr(n),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}path(){return this.Path}resolve(t){var e=t.indexOf("://")>-1,i;return e?t:(i=Xr.resolve(this.directory,t),this.origin+i)}relative(t){return Xr.relative(t,this.directory)}toString(){return this.href}}const Do=1,cn=3,hA=9;class $t{constructor(t,e,i){var n;if(this.str="",this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof $t))return new $t(t,e,i);if(typeof e=="string"?this.base=this.parseComponent(e):typeof e=="object"&&e.steps&&(this.base=e),n=this.checkType(t),n==="string")return this.str=t,oi(this,this.parse(t));if(n==="range")return oi(this,this.fromRange(t,this.base,i));if(n==="node")return oi(this,this.fromNode(t,this.base,i));if(n==="EpubCFI"&&t.path)return t;if(t)throw new TypeError("not a valid argument for EpubCFI");return this}checkType(t){return this.isCfiString(t)?"string":t&&typeof t=="object"&&(sy(t)==="Range"||typeof t.startContainer<"u")?"range":t&&typeof t=="object"&&typeof t.nodeType<"u"?"node":t&&typeof t=="object"&&t instanceof $t?"EpubCFI":!1}parse(t){var e={spinePos:-1,range:!1,base:{},path:{},start:null,end:null},i,n,s;return typeof t!="string"?{spinePos:-1}:(t.indexOf("epubcfi(")===0&&t[t.length-1]===")"&&(t=t.slice(8,t.length-1)),i=this.getChapterComponent(t),i?(e.base=this.parseComponent(i),n=this.getPathComponent(t),e.path=this.parseComponent(n),s=this.getRange(t),s&&(e.range=!0,e.start=this.parseComponent(s[0]),e.end=this.parseComponent(s[1])),e.spinePos=e.base.steps[1].index,e):{spinePos:-1})}parseComponent(t){var e={steps:[],terminal:{offset:null,assertion:null}},i=t.split(":"),n=i[0].split("/"),s;return i.length>1&&(s=i[1],e.terminal=this.parseTerminal(s)),n[0]===""&&n.shift(),e.steps=n.map((function(r){return this.parseStep(r)}).bind(this)),e}parseStep(t){var e,i,n,s,r;if(s=t.match(/\[(.*)\]/),s&&s[1]&&(r=s[1]),i=parseInt(t),!isNaN(i))return i%2===0?(e="element",n=i/2-1):(e="text",n=(i-1)/2),{type:e,index:n,id:r||null}}parseTerminal(t){var e,i,n=t.match(/\[(.*)\]/);return n&&n[1]?(e=parseInt(t.split("[")[0]),i=n[1]):e=parseInt(t),xe(e)||(e=null),{offset:e,assertion:i}}getChapterComponent(t){var e=t.split("!");return e[0]}getPathComponent(t){var e=t.split("!");if(e[1])return e[1].split(",")[0]}getRange(t){var e=t.split(",");return e.length===3?[e[1],e[2]]:!1}getCharecterOffsetComponent(t){var e=t.split(":");return e[1]||""}joinSteps(t){return t?t.map(function(e){var i="";return e.type==="element"&&(i+=(e.index+1)*2),e.type==="text"&&(i+=1+2*e.index),e.id&&(i+="["+e.id+"]"),i}).join("/"):""}segmentString(t){var e="/";return e+=this.joinSteps(t.steps),t.terminal&&t.terminal.offset!=null&&(e+=":"+t.terminal.offset),t.terminal&&t.terminal.assertion!=null&&(e+="["+t.terminal.assertion+"]"),e}toString(){var t="epubcfi(";return t+=this.segmentString(this.base),t+="!",t+=this.segmentString(this.path),this.range&&this.start&&(t+=",",t+=this.segmentString(this.start)),this.range&&this.end&&(t+=",",t+=this.segmentString(this.end)),t+=")",t}compare(t,e){var i,n,s,r;if(typeof t=="string"&&(t=new $t(t)),typeof e=="string"&&(e=new $t(e)),t.spinePos>e.spinePos)return 1;if(t.spinePos<e.spinePos)return-1;t.range?(i=t.path.steps.concat(t.start.steps),s=t.start.terminal):(i=t.path.steps,s=t.path.terminal),e.range?(n=e.path.steps.concat(e.start.steps),r=e.start.terminal):(n=e.path.steps,r=e.path.terminal);for(var a=0;a<i.length;a++){if(!i[a])return-1;if(!n[a]||i[a].index>n[a].index)return 1;if(i[a].index<n[a].index)return-1}return i.length<n.length?-1:s.offset>r.offset?1:s.offset<r.offset?-1:0}step(t){var e=t.nodeType===cn?"text":"element";return{id:t.id,tagName:t.tagName,type:e,index:this.position(t)}}filteredStep(t,e){var i=this.filter(t,e),n;if(i)return n=i.nodeType===cn?"text":"element",{id:i.id,tagName:i.tagName,type:n,index:this.filteredPosition(i,e)}}pathTo(t,e,i){for(var n={steps:[],terminal:{offset:null,assertion:null}},s=t,r;s&&s.parentNode&&s.parentNode.nodeType!=hA;)i?r=this.filteredStep(s,i):r=this.step(s),r&&n.steps.unshift(r),s=s.parentNode;return e!=null&&e>=0&&(n.terminal.offset=e,n.steps[n.steps.length-1].type!="text"&&n.steps.push({type:"text",index:0})),n}equalStep(t,e){return!t||!e?!1:t.index===e.index&&t.id===e.id&&t.type===e.type}fromRange(t,e,i){var n={range:!1,base:{},path:{},start:null,end:null},s=t.startContainer,r=t.endContainer,a=t.startOffset,l=t.endOffset,u=!1;if(i&&(u=s.ownerDocument.querySelector("."+i)!=null),typeof e=="string"?(n.base=this.parseComponent(e),n.spinePos=n.base.steps[1].index):typeof e=="object"&&(n.base=e),t.collapsed)u&&(a=this.patchOffset(s,a,i)),n.path=this.pathTo(s,a,i);else{n.range=!0,u&&(a=this.patchOffset(s,a,i)),n.start=this.pathTo(s,a,i),u&&(l=this.patchOffset(r,l,i)),n.end=this.pathTo(r,l,i),n.path={steps:[],terminal:null};var c=n.start.steps.length,d;for(d=0;d<c&&this.equalStep(n.start.steps[d],n.end.steps[d]);d++)d===c-1?n.start.terminal===n.end.terminal&&(n.path.steps.push(n.start.steps[d]),n.range=!1):n.path.steps.push(n.start.steps[d]);n.start.steps=n.start.steps.slice(n.path.steps.length),n.end.steps=n.end.steps.slice(n.path.steps.length)}return n}fromNode(t,e,i){var n={range:!1,base:{},path:{},start:null,end:null};return typeof e=="string"?(n.base=this.parseComponent(e),n.spinePos=n.base.steps[1].index):typeof e=="object"&&(n.base=e),n.path=this.pathTo(t,null,i),n}filter(t,e){var i,n,s,r,a,l=!1;return t.nodeType===cn?(l=!0,s=t.parentNode,i=t.parentNode.classList.contains(e)):(l=!1,i=t.classList.contains(e)),i&&l?(r=s.previousSibling,a=s.nextSibling,r&&r.nodeType===cn?n=r:a&&a.nodeType===cn&&(n=a),n||t):i&&!l?!1:t}patchOffset(t,e,i){if(t.nodeType!=cn)throw new Error("Anchor must be a text node");var n=t,s=e;for(t.parentNode.classList.contains(i)&&(n=t.parentNode);n.previousSibling;){if(n.previousSibling.nodeType===Do)if(n.previousSibling.classList.contains(i))s+=n.previousSibling.textContent.length;else break;else s+=n.previousSibling.textContent.length;n=n.previousSibling}return s}normalizedMap(t,e,i){var n={},s=-1,r,a=t.length,l,u;for(r=0;r<a;r++)l=t[r].nodeType,l===Do&&t[r].classList.contains(i)&&(l=cn),r>0&&l===cn&&u===cn?n[r]=s:e===l&&(s=s+1,n[r]=s),u=l;return n}position(t){var e,i;return t.nodeType===Do?(e=t.parentNode.children,e||(e=bg(t.parentNode)),i=Array.prototype.indexOf.call(e,t)):(e=this.textNodes(t.parentNode),i=e.indexOf(t)),i}filteredPosition(t,e){var i,n,s;return t.nodeType===Do?(i=t.parentNode.children,s=this.normalizedMap(i,Do,e)):(i=t.parentNode.childNodes,t.parentNode.classList.contains(e)&&(t=t.parentNode,i=t.parentNode.childNodes),s=this.normalizedMap(i,cn,e)),n=Array.prototype.indexOf.call(i,t),s[n]}stepsToXpath(t){var e=[".","*"];return t.forEach(function(i){var n=i.index+1;i.id?e.push("*[position()="+n+" and @id='"+i.id+"']"):i.type==="text"?e.push("text()["+n+"]"):e.push("*["+n+"]")}),e.join("/")}stepsToQuerySelector(t){var e=["html"];return t.forEach(function(i){var n=i.index+1;i.id?e.push("#"+i.id):i.type==="text"||e.push("*:nth-child("+n+")")}),e.join(">")}textNodes(t,e){return Array.prototype.slice.call(t.childNodes).filter(function(i){return i.nodeType===cn?!0:!!(e&&i.classList.contains(e))})}walkToNode(t,e,i){var n=e||document,s=n.documentElement,r,a,l=t.length,u;for(u=0;u<l&&(a=t[u],a.type==="element"?a.id?s=n.getElementById(a.id):(r=s.children||bg(s),s=r[a.index]):a.type==="text"&&(s=this.textNodes(s,i)[a.index]),!!s);u++);return s}findNode(t,e,i){var n=e||document,s,r;return!i&&typeof n.evaluate<"u"?(r=this.stepsToXpath(t),s=n.evaluate(r,n,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue):i?s=this.walkToNode(t,n,i):s=this.walkToNode(t,n),s}fixMiss(t,e,i,n){var s=this.findNode(t.slice(0,-1),i,n),r=s.childNodes,a=this.normalizedMap(r,cn,n),l,u,c=t[t.length-1].index;for(let d in a){if(!a.hasOwnProperty(d))return;if(a[d]===c)if(l=r[d],u=l.textContent.length,e>u)e=e-u;else{l.nodeType===Do?s=l.childNodes[0]:s=l;break}}return{container:s,offset:e}}toRange(t,e){var i=t||document,n,s,r,a,l,u=this,c,d,f=e?i.querySelector("."+e)!=null:!1,p;if(typeof i.createRange<"u"?n=i.createRange():n=new oy,u.range?(s=u.start,c=u.path.steps.concat(s.steps),a=this.findNode(c,i,f?e:null),r=u.end,d=u.path.steps.concat(r.steps),l=this.findNode(d,i,f?e:null)):(s=u.path,c=u.path.steps,a=this.findNode(u.path.steps,i,f?e:null)),a)try{s.terminal.offset!=null?n.setStart(a,s.terminal.offset):n.setStart(a,0)}catch{p=this.fixMiss(c,s.terminal.offset,i,f?e:null),n.setStart(p.container,p.offset)}else return console.log("No startContainer found for",this.toString()),null;if(l)try{r.terminal.offset!=null?n.setEnd(l,r.terminal.offset):n.setEnd(l,0)}catch{p=this.fixMiss(d,u.end.terminal.offset,i,f?e:null),n.setEnd(p.container,p.offset)}return n}isCfiString(t){return typeof t=="string"&&t.indexOf("epubcfi(")===0&&t[t.length-1]===")"}generateChapterComponent(t,e,i){var n=parseInt(e),s=(t+1)*2,r="/"+s+"/";return r+=(n+1)*2,i&&(r+="["+i+"]"),r}collapse(t){this.range&&(this.range=!1,t?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}class $n{constructor(t){this.context=t||this,this.hooks=[]}register(){for(var t=0;t<arguments.length;++t)if(typeof arguments[t]=="function")this.hooks.push(arguments[t]);else for(var e=0;e<arguments[t].length;++e)this.hooks.push(arguments[t][e])}deregister(t){let e;for(let i=0;i<this.hooks.length;i++)if(e=this.hooks[i],e===t){this.hooks.splice(i,1);break}}trigger(){var t=arguments,e=this.context,i=[];return this.hooks.forEach(function(n){try{var s=n.apply(e,t)}catch(r){console.log(r)}s&&typeof s.then=="function"&&i.push(s)}),Promise.all(i)}list(){return this.hooks}clear(){return this.hooks=[]}}function hy(o,t){var e,i,n=t.url,s=n.indexOf("://")>-1;o&&(i=oe(o,"head"),e=oe(i,"base"),e||(e=o.createElement("base"),i.insertBefore(e,i.firstChild)),!s&&window&&window.location&&(n=window.location.origin+n),e.setAttribute("href",n))}function uA(o,t){var e,i,n=t.canonical;o&&(e=oe(o,"head"),i=oe(e,"link[rel='canonical']"),i?i.setAttribute("href",n):(i=o.createElement("link"),i.setAttribute("rel","canonical"),i.setAttribute("href",n),e.appendChild(i)))}function cA(o,t){var e,i,n=t.idref;o&&(e=oe(o,"head"),i=oe(e,"link[property='dc.identifier']"),i?i.setAttribute("content",n):(i=o.createElement("meta"),i.setAttribute("name","dc.identifier"),i.setAttribute("content",n),e.appendChild(i)))}function dA(o,t){var e=o.querySelectorAll("a[href]");if(e.length)for(var i=oe(o.ownerDocument,"base"),n=i?i.getAttribute("href"):void 0,s=(function(a){var l=a.getAttribute("href");if(l.indexOf("mailto:")!==0){var u=l.indexOf("://")>-1;if(u)a.setAttribute("target","_blank");else{var c;try{c=new Nn(l,n)}catch{}a.onclick=function(){return c&&c.hash?t(c.Path.path+c.hash):t(c?c.Path.path:l),!1}}}}).bind(this),r=0;r<e.length;r++)s(e[r])}function iv(o,t,e){return t.forEach(function(i,n){i&&e[n]&&(i=i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),o=o.replace(new RegExp(i,"g"),e[n]))}),o}function jh(o,t,e,i){var n=typeof window<"u"?window.URL:!1,s=n?"blob":"arraybuffer",r=new Gt,a=new XMLHttpRequest,l=XMLHttpRequest.prototype,u;"overrideMimeType"in l||Object.defineProperty(l,"overrideMimeType",{value:function(){}}),e&&(a.withCredentials=!0),a.onreadystatechange=d,a.onerror=c,a.open("GET",o,!0);for(u in i)a.setRequestHeader(u,i[u]);t=="json"&&a.setRequestHeader("Accept","application/json"),t||(t=new cr(o).extension),t=="blob"&&(a.responseType=s),Hh(t)&&a.overrideMimeType("text/xml"),t=="binary"&&(a.responseType="arraybuffer"),a.send();function c(f){r.reject(f)}function d(){if(this.readyState===XMLHttpRequest.DONE){var f=!1;if((this.responseType===""||this.responseType==="document")&&(f=this.responseXML),this.status===200||this.status===0||f){var p;if(!this.response&&!f)return r.reject({status:this.status,message:"Empty Response",stack:new Error().stack}),r.promise;if(this.status===403)return r.reject({status:this.status,response:this.response,message:"Forbidden",stack:new Error().stack}),r.promise;f?p=this.responseXML:Hh(t)?p=_s(this.response,"text/xml"):t=="xhtml"?p=_s(this.response,"application/xhtml+xml"):t=="html"||t=="htm"?p=_s(this.response,"text/html"):t=="json"?p=JSON.parse(this.response):t=="blob"?n?p=this.response:p=new Blob([this.response]):p=this.response,r.resolve(p)}else r.reject({status:this.status,message:this.response,stack:new Error().stack})}}return r.promise}class fA{constructor(t,e){this.idref=t.idref,this.linear=t.linear==="yes",this.properties=t.properties,this.index=t.index,this.href=t.href,this.url=t.url,this.canonical=t.canonical,this.next=t.next,this.prev=t.prev,this.cfiBase=t.cfiBase,e?this.hooks=e:(this.hooks={},this.hooks.serialize=new $n(this),this.hooks.content=new $n(this)),this.document=void 0,this.contents=void 0,this.output=void 0}load(t){var e=t||this.request||jh,i=new Gt,n=i.promise;return this.contents?i.resolve(this.contents):e(this.url).then((function(s){return this.document=s,this.contents=s.documentElement,this.hooks.content.trigger(this.document,this)}).bind(this)).then((function(){i.resolve(this.contents)}).bind(this)).catch(function(s){i.reject(s)}),n}base(){return hy(this.document,this)}render(t){var e=new Gt,i=e.promise;return this.output,this.load(t).then((function(n){var s=typeof navigator<"u"&&navigator.userAgent||"",r=s.indexOf("Trident")>=0,a;typeof XMLSerializer>"u"||r?a=Kb:a=XMLSerializer;var l=new a;return this.output=l.serializeToString(n),this.output}).bind(this)).then((function(){return this.hooks.serialize.trigger(this.output,this)}).bind(this)).then((function(){e.resolve(this.output)}).bind(this)).catch(function(n){e.reject(n)}),i}find(t){var e=this,i=[],n=t.toLowerCase(),s=function(r){for(var a=r.textContent.toLowerCase(),l=e.document.createRange(),u,c,d=-1,f,p=150;c!=-1;)c=a.indexOf(n,d+1),c!=-1&&(l=e.document.createRange(),l.setStart(r,c),l.setEnd(r,c+n.length),u=e.cfiFromRange(l),r.textContent.length<p?f=r.textContent:(f=r.textContent.substring(c-p/2,c+p/2),f="..."+f+"..."),i.push({cfi:u,excerpt:f})),d=c};return Rd(e.document,function(r){s(r)}),i}search(t,e=5){if(typeof document.createTreeWalker>"u")return this.find(t);let i=[];const n=150,s=this,r=t.toLowerCase(),a=function(d){const b=d.reduce((y,g)=>y+g.textContent,"").toLowerCase().indexOf(r);if(b!=-1){const g=b+r.length;let m=0,w=0;if(b<d[0].length){let E;for(;m<d.length-1&&(w+=d[m].length,!(g<=w));)m+=1;let R=d[0],A=d[m],T=s.document.createRange();T.setStart(R,b);let k=d.slice(0,m).reduce((F,B)=>F+B.textContent.length,0);T.setEnd(A,k>g?g:g-k),E=s.cfiFromRange(T);let P=d.slice(0,m+1).reduce((F,B)=>F+B.textContent,"");P.length>n&&(P=P.substring(b-n/2,b+n/2),P="..."+P+"..."),i.push({cfi:E,excerpt:P})}}},l=document.createTreeWalker(s.document,NodeFilter.SHOW_TEXT,null,!1);let u,c=[];for(;u=l.nextNode();)c.push(u),c.length==e&&(a(c.slice(0,e)),c=c.slice(1,e));return c.length>0&&a(c),i}reconcileLayoutSettings(t){var e={layout:t.layout,spread:t.spread,orientation:t.orientation};return this.properties.forEach(function(i){var n=i.replace("rendition:",""),s=n.indexOf("-"),r,a;s!=-1&&(r=n.slice(0,s),a=n.slice(s+1),e[r]=a)}),e}cfiFromRange(t){return new $t(t,this.cfiBase).toString()}cfiFromElement(t){return new $t(t,this.cfiBase).toString()}unload(){this.document=void 0,this.contents=void 0,this.output=void 0}destroy(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}class pA{constructor(){this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new $n,this.hooks.content=new $n,this.hooks.content.register(hy),this.hooks.content.register(uA),this.hooks.content.register(cA),this.epubcfi=new $t,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}unpack(t,e,i){this.items=t.spine,this.manifest=t.manifest,this.spineNodeIndex=t.spineNodeIndex,this.baseUrl=t.baseUrl||t.basePath||"",this.length=this.items.length,this.items.forEach((n,s)=>{var r=this.manifest[n.idref],a;n.index=s,n.cfiBase=this.epubcfi.generateChapterComponent(this.spineNodeIndex,n.index,n.id),n.href&&(n.url=e(n.href,!0),n.canonical=i(n.href)),r&&(n.href=r.href,n.url=e(n.href,!0),n.canonical=i(n.href),r.properties.length&&n.properties.push.apply(n.properties,r.properties)),n.linear==="yes"?(n.prev=(function(){let l=n.index;for(;l>0;){let u=this.get(l-1);if(u&&u.linear)return u;l-=1}}).bind(this),n.next=(function(){let l=n.index;for(;l<this.spineItems.length-1;){let u=this.get(l+1);if(u&&u.linear)return u;l+=1}}).bind(this)):(n.prev=function(){},n.next=function(){}),a=new fA(n,this.hooks),this.append(a)}),this.loaded=!0}get(t){var e=0;if(typeof t>"u")for(;e<this.spineItems.length;){let i=this.spineItems[e];if(i&&i.linear)break;e+=1}else this.epubcfi.isCfiString(t)?e=new $t(t).spinePos:typeof t=="number"||isNaN(t)===!1?e=t:typeof t=="string"&&t.indexOf("#")===0?e=this.spineById[t.substring(1)]:typeof t=="string"&&(t=t.split("#")[0],e=this.spineByHref[t]||this.spineByHref[encodeURI(t)]);return this.spineItems[e]||null}append(t){var e=this.spineItems.length;return t.index=e,this.spineItems.push(t),this.spineByHref[decodeURI(t.href)]=e,this.spineByHref[encodeURI(t.href)]=e,this.spineByHref[t.href]=e,this.spineById[t.idref]=e,e}prepend(t){return this.spineByHref[t.href]=0,this.spineById[t.idref]=0,this.spineItems.forEach(function(e,i){e.index=i}),0}remove(t){var e=this.spineItems.indexOf(t);if(e>-1)return delete this.spineByHref[t.href],delete this.spineById[t.idref],this.spineItems.splice(e,1)}each(){return this.spineItems.forEach.apply(this.spineItems,arguments)}first(){let t=0;do{let e=this.get(t);if(e&&e.linear)return e;t+=1}while(t<this.spineItems.length)}last(){let t=this.spineItems.length-1;do{let e=this.get(t);if(e&&e.linear)return e;t-=1}while(t>=0)}destroy(){this.each(t=>t.destroy()),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}}class Zg{constructor(t){this._q=[],this.context=t,this.tick=Xg,this.running=!1,this.paused=!1}enqueue(){var t,e,i,n=[].shift.call(arguments),s=arguments;if(!n)throw new Error("No Task Provided");return typeof n=="function"?(t=new Gt,e=t.promise,i={task:n,args:s,deferred:t,promise:e}):i={promise:n},this._q.push(i),this.paused==!1&&!this.running&&this.run(),i.promise}dequeue(){var t,e,i;if(this._q.length&&!this.paused){if(t=this._q.shift(),e=t.task,e)return i=e.apply(this.context,t.args),i&&typeof i.then=="function"?i.then((function(){t.deferred.resolve.apply(this.context,arguments)}).bind(this),(function(){t.deferred.reject.apply(this.context,arguments)}).bind(this)):(t.deferred.resolve.apply(this.context,i),t.promise);if(t.promise)return t.promise}else return t=new Gt,t.deferred.resolve(),t.promise}dump(){for(;this._q.length;)this.dequeue()}run(){return this.running||(this.running=!0,this.defered=new Gt),this.tick.call(window,()=>{this._q.length?this.dequeue().then((function(){this.run()}).bind(this)):(this.defered.resolve(),this.running=void 0)}),this.paused==!0&&(this.paused=!1),this.defered.promise}flush(){if(this.running)return this.running;if(this._q.length)return this.running=this.dequeue().then((function(){return this.running=void 0,this.flush()}).bind(this)),this.running}clear(){this._q=[]}length(){return this._q.length}pause(){this.paused=!0}stop(){this._q=[],this.running=!1,this.paused=!0}}const bf="0.3",dd=["keydown","keyup","keypressed","mouseup","mousedown","mousemove","click","touchend","touchstart","touchmove"],ut={BOOK:{OPEN_FAILED:"openFailed"},CONTENTS:{EXPAND:"expand",RESIZE:"resize",SELECTED:"selected",SELECTED_RANGE:"selectedRange",LINK_CLICKED:"linkClicked"},LOCATIONS:{CHANGED:"changed"},MANAGERS:{RESIZE:"resize",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",ADDED:"added",SCROLL:"scroll",SCROLLED:"scrolled",REMOVED:"removed"},VIEWS:{AXIS:"axis",WRITING_MODE:"writingMode",LOAD_ERROR:"loaderror",RENDERED:"rendered",RESIZED:"resized",DISPLAYED:"displayed",SHOWN:"shown",HIDDEN:"hidden",MARK_CLICKED:"markClicked"},RENDITION:{STARTED:"started",ATTACHED:"attached",DISPLAYED:"displayed",DISPLAY_ERROR:"displayerror",RENDERED:"rendered",REMOVED:"removed",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",LOCATION_CHANGED:"locationChanged",RELOCATED:"relocated",MARK_CLICKED:"markClicked",SELECTED:"selected",LAYOUT:"layout"},LAYOUT:{UPDATED:"updated"},ANNOTATION:{ATTACH:"attach",DETACH:"detach"}};class uy{constructor(t,e,i){this.spine=t,this.request=e,this.pause=i||100,this.q=new Zg(this),this.epubcfi=new $t,this._locations=[],this._locationsWords=[],this.total=0,this.break=150,this._current=0,this._wordCounter=0,this.currentLocation="",this._currentCfi="",this.processingTimeout=void 0}generate(t){return t&&(this.break=t),this.q.pause(),this.spine.each((function(e){e.linear&&this.q.enqueue(this.process.bind(this),e)}).bind(this)),this.q.run().then((function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}).bind(this))}createRange(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}process(t){return t.load(this.request).then((function(e){var i=new Gt,n=this.parse(e,t.cfiBase);return this._locations=this._locations.concat(n),t.unload(),this.processingTimeout=setTimeout(()=>i.resolve(n),this.pause),i.promise}).bind(this))}parse(t,e,i){var n=[],s,r=t.ownerDocument,a=oe(r,"body"),l=0,u,c=i||this.break,d=function(f){var p=f.length,b,y=0;if(f.textContent.trim().length===0)return!1;for(l==0&&(s=this.createRange(),s.startContainer=f,s.startOffset=0),b=c-l,b>p&&(l+=p,y=p);y<p;)if(b=c-l,l===0&&(y+=1,s=this.createRange(),s.startContainer=f,s.startOffset=y),y+b>=p)l+=p-y,y=p;else{y+=b,s.endContainer=f,s.endOffset=y;let g=new $t(s,e).toString();n.push(g),l=0}u=f};if(Rd(a,d.bind(this)),s&&s.startContainer&&u){s.endContainer=u,s.endOffset=u.length;let f=new $t(s,e).toString();n.push(f),l=0}return n}generateFromWords(t,e,i){var n=t?new $t(t):void 0;return this.q.pause(),this._locationsWords=[],this._wordCounter=0,this.spine.each((function(s){s.linear&&(n?s.index>=n.spinePos&&this.q.enqueue(this.processWords.bind(this),s,e,n,i):this.q.enqueue(this.processWords.bind(this),s,e,n,i))}).bind(this)),this.q.run().then((function(){return this._currentCfi&&(this.currentLocation=this._currentCfi),this._locationsWords}).bind(this))}processWords(t,e,i,n){return n&&this._locationsWords.length>=n?Promise.resolve():t.load(this.request).then((function(s){var r=new Gt,a=this.parseWords(s,t,e,i),l=n-this._locationsWords.length;return this._locationsWords=this._locationsWords.concat(a.length>=n?a.slice(0,l):a),t.unload(),this.processingTimeout=setTimeout(()=>r.resolve(a),this.pause),r.promise}).bind(this))}countWords(t){return t=t.replace(/(^\s*)|(\s*$)/gi,""),t=t.replace(/[ ]{2,}/gi," "),t=t.replace(/\n /,`
`),t.split(" ").length}parseWords(t,e,i,n){var s=e.cfiBase,r=[],a=t.ownerDocument,l=oe(a,"body"),u=i,c=n?n.spinePos!==e.index:!0,d;n&&e.index===n.spinePos&&(d=n.findNode(n.range?n.path.steps.concat(n.start.steps):n.path.steps,t.ownerDocument));var f=function(p){if(!c)if(p===d)c=!0;else return!1;if(p.textContent.length<10&&p.textContent.trim().length===0)return!1;var b=this.countWords(p.textContent),y,g=0;if(b===0)return!1;for(y=u-this._wordCounter,y>b&&(this._wordCounter+=b,g=b);g<b;)if(y=u-this._wordCounter,g+y>=b)this._wordCounter+=b-g,g=b;else{g+=y;let m=new $t(p,s);r.push({cfi:m.toString(),wordCount:this._wordCounter}),this._wordCounter=0}};return Rd(l,f.bind(this)),r}locationFromCfi(t){let e;return $t.prototype.isCfiString(t)&&(t=new $t(t)),this._locations.length===0?-1:(e=Jl(t,this._locations,this.epubcfi.compare),e>this.total?this.total:e)}percentageFromCfi(t){if(this._locations.length===0)return null;var e=this.locationFromCfi(t);return this.percentageFromLocation(e)}percentageFromLocation(t){return!t||!this.total?0:t/this.total}cfiFromLocation(t){var e=-1;return typeof t!="number"&&(t=parseInt(t)),t>=0&&t<this._locations.length&&(e=this._locations[t]),e}cfiFromPercentage(t){let e;if(t>1&&console.warn("Normalize cfiFromPercentage value to between 0 - 1"),t>=1){let i=new $t(this._locations[this.total]);return i.collapse(),i.toString()}return e=Math.ceil(this.total*t),this.cfiFromLocation(e)}load(t){return typeof t=="string"?this._locations=JSON.parse(t):this._locations=t,this.total=this._locations.length-1,this._locations}save(){return JSON.stringify(this._locations)}getCurrent(){return this._current}setCurrent(t){var e;if(typeof t=="string")this._currentCfi=t;else if(typeof t=="number")this._current=t;else return;this._locations.length!==0&&(typeof t=="string"?(e=this.locationFromCfi(t),this._current=e):e=t,this.emit(ut.LOCATIONS.CHANGED,{percentage:this.percentageFromLocation(e)}))}get currentLocation(){return this._current}set currentLocation(t){this.setCurrent(t)}length(){return this._locations.length}destroy(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.stop(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}}Es(uy.prototype);class gA{constructor(t){this.packagePath="",this.directory="",this.encoding="",t&&this.parse(t)}parse(t){var e;if(!t)throw new Error("Container File Not Found");if(e=oe(t,"rootfile"),!e)throw new Error("No RootFile Found");this.packagePath=e.getAttribute("full-path"),this.directory=Xr.dirname(this.packagePath),this.encoding=t.xmlEncoding}destroy(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}}class nv{constructor(t){this.manifest={},this.navPath="",this.ncxPath="",this.coverPath="",this.spineNodeIndex=0,this.spine=[],this.metadata={},t&&this.parse(t)}parse(t){var e,i,n;if(!t)throw new Error("Package File Not Found");if(e=oe(t,"metadata"),!e)throw new Error("No Metadata Found");if(i=oe(t,"manifest"),!i)throw new Error("No Manifest Found");if(n=oe(t,"spine"),!n)throw new Error("No Spine Found");return this.manifest=this.parseManifest(i),this.navPath=this.findNavPath(i),this.ncxPath=this.findNcxPath(i,n),this.coverPath=this.findCoverPath(t),this.spineNodeIndex=ey(n),this.spine=this.parseSpine(n,this.manifest),this.uniqueIdentifier=this.findUniqueIdentifier(t),this.metadata=this.parseMetadata(e),this.metadata.direction=n.getAttribute("page-progression-direction"),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}parseMetadata(t){var e={};return e.title=this.getElementText(t,"title"),e.creator=this.getElementText(t,"creator"),e.description=this.getElementText(t,"description"),e.pubdate=this.getElementText(t,"date"),e.publisher=this.getElementText(t,"publisher"),e.identifier=this.getElementText(t,"identifier"),e.language=this.getElementText(t,"language"),e.rights=this.getElementText(t,"rights"),e.modified_date=this.getPropertyText(t,"dcterms:modified"),e.layout=this.getPropertyText(t,"rendition:layout"),e.orientation=this.getPropertyText(t,"rendition:orientation"),e.flow=this.getPropertyText(t,"rendition:flow"),e.viewport=this.getPropertyText(t,"rendition:viewport"),e.media_active_class=this.getPropertyText(t,"media:active-class"),e.spread=this.getPropertyText(t,"rendition:spread"),e}parseManifest(t){var e={},i=ur(t,"item"),n=Array.prototype.slice.call(i);return n.forEach(function(s){var r=s.getAttribute("id"),a=s.getAttribute("href")||"",l=s.getAttribute("media-type")||"",u=s.getAttribute("media-overlay")||"",c=s.getAttribute("properties")||"";e[r]={href:a,type:l,overlay:u,properties:c.length?c.split(" "):[]}}),e}parseSpine(t,e){var i=[],n=ur(t,"itemref"),s=Array.prototype.slice.call(n);return s.forEach(function(r,a){var l=r.getAttribute("idref"),u=r.getAttribute("properties")||"",c=u.length?u.split(" "):[],d={id:r.getAttribute("id"),idref:l,linear:r.getAttribute("linear")||"yes",properties:c,index:a};i.push(d)}),i}findUniqueIdentifier(t){var e=t.documentElement.getAttribute("unique-identifier");if(!e)return"";var i=t.getElementById(e);return i&&i.localName==="identifier"&&i.namespaceURI==="http://purl.org/dc/elements/1.1/"&&i.childNodes.length>0?i.childNodes[0].nodeValue.trim():""}findNavPath(t){var e=Mo(t,"item",{properties:"nav"});return e?e.getAttribute("href"):!1}findNcxPath(t,e){var i=Mo(t,"item",{"media-type":"application/x-dtbncx+xml"}),n;return i||(n=e.getAttribute("toc"),n&&(i=t.querySelector(`#${n}`))),i?i.getAttribute("href"):!1}findCoverPath(t){var e=oe(t,"package");e.getAttribute("version");var i=Mo(t,"item",{properties:"cover-image"});if(i)return i.getAttribute("href");var n=Mo(t,"meta",{name:"cover"});if(n){var s=n.getAttribute("content"),r=t.getElementById(s);return r?r.getAttribute("href"):""}else return!1}getElementText(t,e){var i=t.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",e),n;return!i||i.length===0?"":(n=i[0],n.childNodes.length?n.childNodes[0].nodeValue:"")}getPropertyText(t,e){var i=Mo(t,"meta",{property:e});return i&&i.childNodes.length?i.childNodes[0].nodeValue:""}load(t){this.metadata=t.metadata;let e=t.readingOrder||t.spine;return this.spine=e.map((i,n)=>(i.index=n,i.linear=i.linear||"yes",i)),t.resources.forEach((i,n)=>{this.manifest[n]=i,i.rel&&i.rel[0]==="cover"&&(this.coverPath=i.href)}),this.spineNodeIndex=0,this.toc=t.toc.map((i,n)=>(i.label=i.title,i)),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}destroy(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}}class Wf{constructor(t){this.toc=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0,t&&this.parse(t)}parse(t){let e=t.nodeType,i,n;e&&(i=oe(t,"html"),n=oe(t,"ncx")),e?i?(this.toc=this.parseNav(t),this.landmarks=this.parseLandmarks(t)):n&&(this.toc=this.parseNcx(t)):this.toc=this.load(t),this.length=0,this.unpack(this.toc)}unpack(t){for(var e,i=0;i<t.length;i++)e=t[i],e.href&&(this.tocByHref[e.href]=i),e.id&&(this.tocById[e.id]=i),this.length++,e.subitems.length&&this.unpack(e.subitems)}get(t){var e;return t?(t.indexOf("#")===0?e=this.tocById[t.substring(1)]:t in this.tocByHref&&(e=this.tocByHref[t]),this.getByIndex(t,e,this.toc)):this.toc}getByIndex(t,e,i){if(i.length===0)return;const n=i[e];if(n&&(t===n.id||t===n.href))return n;{let s;for(let r=0;r<i.length&&(s=this.getByIndex(t,e,i[r].subitems),!s);++r);return s}}landmark(t){var e;return t?(e=this.landmarksByType[t],this.landmarks[e]):this.landmarks}parseNav(t){var e=Id(t,"nav","toc"),i=[];if(!e)return i;let n=Bo(e,"ol",!0);return n&&(i=this.parseNavList(n)),i}parseNavList(t,e){const i=[];if(!t||!t.children)return i;for(let n=0;n<t.children.length;n++){const s=this.navItem(t.children[n],e);s&&i.push(s)}return i}navItem(t,e){let i=t.getAttribute("id")||void 0,n=Bo(t,"a",!0)||Bo(t,"span",!0);if(!n)return;let s=n.getAttribute("href")||"";i||(i=s);let r=n.textContent||"",a=[],l=Bo(t,"ol",!0);return l&&(a=this.parseNavList(l,i)),{id:i,href:s,label:r,subitems:a,parent:e}}parseLandmarks(t){var e=Id(t,"nav","landmarks"),i=e?ur(e,"li"):[],n=i.length,s,r=[],a;if(!i||n===0)return r;for(s=0;s<n;++s)a=this.landmarkItem(i[s]),a&&(r.push(a),this.landmarksByType[a.type]=s);return r}landmarkItem(t){let e=Bo(t,"a",!0);if(!e)return;let i=e.getAttributeNS("http://www.idpf.org/2007/ops","type")||void 0,n=e.getAttribute("href")||"",s=e.textContent||"";return{href:n,label:s,type:i}}parseNcx(t){var e=ur(t,"navPoint"),i=e.length,n,s={},r=[],a,l;if(!e||i===0)return r;for(n=0;n<i;++n)a=this.ncxItem(e[n]),s[a.id]=a,a.parent?(l=s[a.parent],l.subitems.push(a)):r.push(a);return r}ncxItem(t){var e=t.getAttribute("id")||!1,i=oe(t,"content"),n=i.getAttribute("src"),s=oe(t,"navLabel"),r=s.textContent?s.textContent:"",a=[],l=t.parentNode,u;return l&&(l.nodeName==="navPoint"||l.nodeName.split(":").slice(-1)[0]==="navPoint")&&(u=l.getAttribute("id")),{id:e,href:n,label:r,subitems:a,parent:u}}load(t){return t.map(e=>(e.label=e.title,e.subitems=e.children?this.load(e.children):[],e))}forEach(t){return this.toc.forEach(t)}}var ch={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},mA=function(){var o,t,e,i,n={};for(o in ch)if(ch.hasOwnProperty(o)){for(t in ch[o])if(ch[o].hasOwnProperty(t))if(e=ch[o][t],typeof e=="string")n[e]=o+"/"+t;else for(i=0;i<e.length;i++)n[e[i]]=o+"/"+t}return n}(),vA="text/plain";function bA(o){return o&&mA[o.split(".").pop().toLowerCase()]||vA}const qo={lookup:bA};class yA{constructor(t,e){this.settings={replacements:e&&e.replacements||"base64",archive:e&&e.archive,resolver:e&&e.resolver,request:e&&e.request},this.process(t)}process(t){this.manifest=t,this.resources=Object.keys(t).map(function(e){return t[e]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}split(){this.html=this.resources.filter(function(t){if(t.type==="application/xhtml+xml"||t.type==="text/html")return!0}),this.assets=this.resources.filter(function(t){if(t.type!=="application/xhtml+xml"&&t.type!=="text/html")return!0}),this.css=this.resources.filter(function(t){if(t.type==="text/css")return!0})}splitUrls(){this.urls=this.assets.map((function(t){return t.href}).bind(this)),this.cssUrls=this.css.map(function(t){return t.href})}createUrl(t){var e=new Nn(t),i=qo.lookup(e.filename);return this.settings.archive?this.settings.archive.createUrl(t,{base64:this.settings.replacements==="base64"}):this.settings.replacements==="base64"?this.settings.request(t,"blob").then(n=>ay(n)).then(n=>vg(n,i)):this.settings.request(t,"blob").then(n=>kd(n,i))}replacements(){if(this.settings.replacements==="none")return new Promise((function(e){e(this.urls)}).bind(this));var t=this.urls.map(e=>{var i=this.settings.resolver(e);return this.createUrl(i).catch(n=>(console.error(n),null))});return Promise.all(t).then(e=>(this.replacementUrls=e.filter(i=>typeof i=="string"),e))}replaceCss(t,e){var i=[];return t=t||this.settings.archive,e=e||this.settings.resolver,this.cssUrls.forEach((function(n){var s=this.createCssFile(n,t,e).then((function(r){var a=this.urls.indexOf(n);a>-1&&(this.replacementUrls[a]=r)}).bind(this));i.push(s)}).bind(this)),Promise.all(i)}createCssFile(t){var e;if(Xr.isAbsolute(t))return new Promise(function(r){r()});var i=this.settings.resolver(t),n;this.settings.archive?n=this.settings.archive.getText(i):n=this.settings.request(i,"text");var s=this.urls.map(r=>{var a=this.settings.resolver(r),l=new cr(i).relative(a);return l});return n?n.then(r=>(r=iv(r,s,this.replacementUrls),this.settings.replacements==="base64"?e=vg(r,"text/css"):e=kd(r,"text/css"),e),r=>new Promise(function(a){a()})):new Promise(function(r){r()})}relativeTo(t,e){return e=e||this.settings.resolver,this.urls.map((function(i){var n=e(i),s=new cr(t).relative(n);return s}).bind(this))}get(t){var e=this.urls.indexOf(t);if(e!==-1)return this.replacementUrls.length?new Promise((function(i,n){i(this.replacementUrls[e])}).bind(this)):this.createUrl(t)}substitute(t,e){var i;return e?i=this.relativeTo(e):i=this.urls,iv(t,i,this.replacementUrls)}destroy(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}}class qf{constructor(t){this.pages=[],this.locations=[],this.epubcfi=new $t,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,t&&(this.pageList=this.parse(t)),this.pageList&&this.pageList.length&&this.process(this.pageList)}parse(t){var e=oe(t,"html"),i=oe(t,"ncx");if(e)return this.parseNav(t);if(i)return this.parseNcx(t)}parseNav(t){var e=Id(t,"nav","page-list"),i=e?ur(e,"li"):[],n=i.length,s,r=[],a;if(!i||n===0)return r;for(s=0;s<n;++s)a=this.item(i[s]),r.push(a);return r}parseNcx(t){var e=[],i=0,n,s,r,a=0;if(s=oe(t,"pageList"),!s||(r=ur(s,"pageTarget"),a=r.length,!r||r.length===0))return e;for(i=0;i<a;++i)n=this.ncxItem(r[i]),e.push(n);return e}ncxItem(t){var e=oe(t,"navLabel"),i=oe(e,"text"),n=i.textContent,s=oe(t,"content"),r=s.getAttribute("src"),a=parseInt(n,10);return{href:r,page:a}}item(t){var e=oe(t,"a"),i=e.getAttribute("href")||"",n=e.textContent||"",s=parseInt(n),r=i.indexOf("epubcfi"),a,l,u;return r!=-1?(a=i.split("#"),l=a[0],u=a.length>1?a[1]:!1,{cfi:u,href:i,packageUrl:l,page:s}):{href:i,page:s}}process(t){t.forEach(function(e){this.pages.push(e.page),e.cfi&&this.locations.push(e.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}pageFromCfi(t){var e=-1;if(this.locations.length===0)return-1;var i=Cd(t,this.locations,this.epubcfi.compare);return i!=-1?e=this.pages[i]:(i=Jl(t,this.locations,this.epubcfi.compare),e=i-1>=0?this.pages[i-1]:this.pages[0],e!==void 0||(e=-1)),e}cfiFromPage(t){var e=-1;typeof t!="number"&&(t=parseInt(t));var i=this.pages.indexOf(t);return i!=-1&&(e=this.locations[i]),e}pageFromPercentage(t){var e=Math.round(this.totalPages*t);return e}percentageFromPage(t){var e=(t-this.firstPage)/this.totalPages;return Math.round(e*1e3)/1e3}percentageFromCfi(t){var e=this.pageFromCfi(t),i=this.percentageFromPage(e);return i}destroy(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}class cy{constructor(t){this.settings=t,this.name=t.layout||"reflowable",this._spread=t.spread!=="none",this._minSpreadWidth=t.minSpreadWidth||800,this._evenSpreads=t.evenSpreads||!1,t.flow==="scrolled"||t.flow==="scrolled-continuous"||t.flow==="scrolled-doc"?this._flow="scrolled":this._flow="paginated",this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}flow(t){return typeof t<"u"&&(t==="scrolled"||t==="scrolled-continuous"||t==="scrolled-doc"?this._flow="scrolled":this._flow="paginated",this.update({flow:this._flow})),this._flow}spread(t,e){return t&&(this._spread=t!=="none",this.update({spread:this._spread})),e>=0&&(this._minSpreadWidth=e),this._spread}calculate(t,e,i){var n=1,s=i||0,r=t,a=e,l=Math.floor(r/12),u,c,d,f;this._spread&&r>=this._minSpreadWidth?n=2:n=1,this.name==="reflowable"&&this._flow==="paginated"&&!(i>=0)&&(s=l%2===0?l:l-1),this.name==="pre-paginated"&&(s=0),n>1?(u=r/n-s,d=u+s):(u=r,d=r),this.name==="pre-paginated"&&n>1&&(r=u),c=u*n+s,f=r,this.width=r,this.height=a,this.spreadWidth=c,this.pageWidth=d,this.delta=f,this.columnWidth=u,this.gap=s,this.divisor=n,this.update({width:r,height:a,spreadWidth:c,pageWidth:d,delta:f,columnWidth:u,gap:s,divisor:n})}format(t,e,i){var n;return this.name==="pre-paginated"?n=t.fit(this.columnWidth,this.height,e):this._flow==="paginated"?n=t.columns(this.width,this.height,this.columnWidth,this.gap,this.settings.direction):i&&i==="horizontal"?n=t.size(null,this.height):n=t.size(this.width,null),n}count(t,e){let i,n;return this.name==="pre-paginated"?(i=1,n=1):this._flow==="paginated"?(e=e||this.delta,i=Math.ceil(t/e),n=i*this.divisor):(e=e||this.height,i=Math.ceil(t/e),n=i),{spreads:i,pages:n}}update(t){if(Object.keys(t).forEach(e=>{this.props[e]===t[e]&&delete t[e]}),Object.keys(t).length>0){let e=oi(this.props,t);this.emit(ut.LAYOUT.UPDATED,e,t)}}}Es(cy.prototype);class wA{constructor(t){this.rendition=t,this._themes={default:{rules:{},url:"",serialized:""}},this._overrides={},this._current="default",this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}register(){if(arguments.length!==0){if(arguments.length===1&&typeof arguments[0]=="object")return this.registerThemes(arguments[0]);if(arguments.length===1&&typeof arguments[0]=="string")return this.default(arguments[0]);if(arguments.length===2&&typeof arguments[1]=="string")return this.registerUrl(arguments[0],arguments[1]);if(arguments.length===2&&typeof arguments[1]=="object")return this.registerRules(arguments[0],arguments[1])}}default(t){if(t){if(typeof t=="string")return this.registerUrl("default",t);if(typeof t=="object")return this.registerRules("default",t)}}registerThemes(t){for(var e in t)t.hasOwnProperty(e)&&(typeof t[e]=="string"?this.registerUrl(e,t[e]):this.registerRules(e,t[e]))}registerCss(t,e){this._themes[t]={serialized:e},(this._injected[t]||t=="default")&&this.update(t)}registerUrl(t,e){var i=new Nn(e);this._themes[t]={url:i.toString()},(this._injected[t]||t=="default")&&this.update(t)}registerRules(t,e){this._themes[t]={rules:e},(this._injected[t]||t=="default")&&this.update(t)}select(t){var e=this._current,i;this._current=t,this.update(t),i=this.rendition.getContents(),i.forEach(n=>{n.removeClass(e),n.addClass(t)})}update(t){var e=this.rendition.getContents();e.forEach(i=>{this.add(t,i)})}inject(t){var e=[],i=this._themes,n;for(var s in i)i.hasOwnProperty(s)&&(s===this._current||s==="default")&&(n=i[s],(n.rules&&Object.keys(n.rules).length>0||n.url&&e.indexOf(n.url)===-1)&&this.add(s,t),this._injected.push(s));this._current!="default"&&t.addClass(this._current)}add(t,e){var i=this._themes[t];!i||!e||(i.url?e.addStylesheet(i.url):i.serialized?(e.addStylesheetCss(i.serialized,t),i.injected=!0):i.rules&&(e.addStylesheetRules(i.rules,t),i.injected=!0))}override(t,e,i){var n=this.rendition.getContents();this._overrides[t]={value:e,priority:i===!0},n.forEach(s=>{s.css(t,this._overrides[t].value,this._overrides[t].priority)})}removeOverride(t){var e=this.rendition.getContents();delete this._overrides[t],e.forEach(i=>{i.css(t)})}overrides(t){var e=this._overrides;for(var i in e)e.hasOwnProperty(i)&&t.css(i,e[i].value,e[i].priority)}fontSize(t){this.override("font-size",t)}font(t){this.override("font-family",t,!0)}destroy(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}}class Ld{constructor(t,e,i,n=!1){this.layout=t,this.horizontal=i==="horizontal",this.direction=e||"ltr",this._dev=n}section(t){var e=this.findRanges(t),i=this.rangeListToCfiList(t.section.cfiBase,e);return i}page(t,e,i,n){var s=t&&t.document?t.document.body:!1,r;if(s){if(r=this.rangePairToCfiPair(e,{start:this.findStart(s,i,n),end:this.findEnd(s,i,n)}),this._dev===!0){let a=t.document,l=new $t(r.start).toRange(a),u=new $t(r.end).toRange(a),c=a.defaultView.getSelection(),d=a.createRange();c.removeAllRanges(),d.setStart(l.startContainer,l.startOffset),d.setEnd(u.endContainer,u.endOffset),c.addRange(d)}return r}}walk(t,e){if(!(t&&t.nodeType===Node.TEXT_NODE)){var i={acceptNode:function(l){return l.data.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},n=i.acceptNode;n.acceptNode=i.acceptNode;for(var s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,n,!1),r,a;(r=s.nextNode())&&(a=e(r),!a););return a}}findRanges(t){for(var e=[],i=t.contents.scrollWidth(),n=Math.ceil(i/this.layout.spreadWidth),s=n*this.layout.divisor,r=this.layout.columnWidth,a=this.layout.gap,l,u,c=0;c<s.pages;c++)l=(r+a)*c,u=r*(c+1)+a*c,e.push({start:this.findStart(t.document.body,l,u),end:this.findEnd(t.document.body,l,u)});return e}findStart(t,e,i){for(var n=[t],s,r,a=t;n.length;)if(s=n.shift(),r=this.walk(s,l=>{var u,c,d,f,p;if(p=mg(l),this.horizontal&&this.direction==="ltr"){if(u=this.horizontal?p.left:p.top,c=this.horizontal?p.right:p.bottom,u>=e&&u<=i)return l;if(c>e)return l;a=l,n.push(l)}else if(this.horizontal&&this.direction==="rtl"){if(u=p.left,c=p.right,c<=i&&c>=e)return l;if(u<i)return l;a=l,n.push(l)}else{if(d=p.top,f=p.bottom,d>=e&&d<=i)return l;if(f>e)return l;a=l,n.push(l)}}),r)return this.findTextStartRange(r,e,i);return this.findTextStartRange(a,e,i)}findEnd(t,e,i){for(var n=[t],s,r=t,a;n.length;)if(s=n.shift(),a=this.walk(s,l=>{var u,c,d,f,p;if(p=mg(l),this.horizontal&&this.direction==="ltr"){if(u=Math.round(p.left),c=Math.round(p.right),u>i&&r)return r;if(c>i)return l;r=l,n.push(l)}else if(this.horizontal&&this.direction==="rtl"){if(u=Math.round(this.horizontal?p.left:p.top),c=Math.round(this.horizontal?p.right:p.bottom),c<e&&r)return r;if(u<e)return l;r=l,n.push(l)}else{if(d=Math.round(p.top),f=Math.round(p.bottom),d>i&&r)return r;if(f>i)return l;r=l,n.push(l)}}),a)return this.findTextEndRange(a,e,i);return this.findTextEndRange(r,e,i)}findTextStartRange(t,e,i){for(var n=this.splitTextNodeIntoRanges(t),s,r,a,l,u,c=0;c<n.length;c++)if(s=n[c],r=s.getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(a=r.left,a>=e)return s}else if(this.horizontal&&this.direction==="rtl"){if(u=r.right,u<=i)return s}else if(l=r.top,l>=e)return s;return n[0]}findTextEndRange(t,e,i){for(var n=this.splitTextNodeIntoRanges(t),s,r,a,l,u,c,d,f=0;f<n.length;f++){if(r=n[f],a=r.getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(l=a.left,u=a.right,l>i&&s)return s;if(u>i)return r}else if(this.horizontal&&this.direction==="rtl"){if(l=a.left,u=a.right,u<e&&s)return s;if(l<e)return r}else{if(c=a.top,d=a.bottom,c>i&&s)return s;if(d>i)return r}s=r}return n[n.length-1]}splitTextNodeIntoRanges(t,e){var i=[],n=t.textContent||"",s=n.trim(),r,a=t.ownerDocument,l=e||" ",u=s.indexOf(l);if(u===-1||t.nodeType!=Node.TEXT_NODE)return r=a.createRange(),r.selectNodeContents(t),[r];for(r=a.createRange(),r.setStart(t,0),r.setEnd(t,u),i.push(r),r=!1;u!=-1;)u=s.indexOf(l,u+1),u>0&&(r&&(r.setEnd(t,u),i.push(r)),r=a.createRange(),r.setStart(t,u+1));return r&&(r.setEnd(t,s.length),i.push(r)),i}rangePairToCfiPair(t,e){var i=e.start,n=e.end;i.collapse(!0),n.collapse(!1);let s=new $t(i,t).toString(),r=new $t(n,t).toString();return{start:s,end:r}}rangeListToCfiList(t,e){for(var i=[],n,s=0;s<e.length;s++)n=this.rangePairToCfiPair(t,e[s]),i.push(n);return i}axis(t){return t&&(this.horizontal=t==="horizontal"),this.horizontal}}const dy=typeof navigator<"u",_A=dy&&/Chrome/.test(navigator.userAgent),sv=dy&&!_A&&/AppleWebKit/.test(navigator.userAgent),AA=1;class Qg{constructor(t,e,i,n){this.epubcfi=new $t,this.document=t,this.documentElement=this.document.documentElement,this.content=e||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=n||0,this.cfiBase=i||"",this.epubReadingSystem("epub.js",bf),this.called=0,this.active=!0,this.listeners()}static get listenedEvents(){return dd}width(t){var e=this.content;return t&&xe(t)&&(t=t+"px"),t&&(e.style.width=t),parseInt(this.window.getComputedStyle(e).width)}height(t){var e=this.content;return t&&xe(t)&&(t=t+"px"),t&&(e.style.height=t),parseInt(this.window.getComputedStyle(e).height)}contentWidth(t){var e=this.content||this.document.body;return t&&xe(t)&&(t=t+"px"),t&&(e.style.width=t),parseInt(this.window.getComputedStyle(e).width)}contentHeight(t){var e=this.content||this.document.body;return t&&xe(t)&&(t=t+"px"),t&&(e.style.height=t),parseInt(this.window.getComputedStyle(e).height)}textWidth(){let t,e,i=this.document.createRange(),n=this.content||this.document.body,s=Td(n);return i.selectNodeContents(n),t=i.getBoundingClientRect(),e=t.width,s&&s.width&&(e+=s.width),Math.round(e)}textHeight(){let t,e,i=this.document.createRange(),n=this.content||this.document.body;return i.selectNodeContents(n),t=i.getBoundingClientRect(),e=t.bottom,Math.round(e)}scrollWidth(){var t=this.documentElement.scrollWidth;return t}scrollHeight(){var t=this.documentElement.scrollHeight;return t}overflow(t){return t&&(this.documentElement.style.overflow=t),this.window.getComputedStyle(this.documentElement).overflow}overflowX(t){return t&&(this.documentElement.style.overflowX=t),this.window.getComputedStyle(this.documentElement).overflowX}overflowY(t){return t&&(this.documentElement.style.overflowY=t),this.window.getComputedStyle(this.documentElement).overflowY}css(t,e,i){var n=this.content||this.document.body;return e?n.style.setProperty(t,e,i?"important":""):n.style.removeProperty(t),this.window.getComputedStyle(n)[t]}viewport(t){var e=this.document.querySelector("meta[name='viewport']"),i={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},n=[],s={};if(e&&e.hasAttribute("content")){let r=e.getAttribute("content"),a=r.match(/width\s*=\s*([^,]*)/),l=r.match(/height\s*=\s*([^,]*)/),u=r.match(/initial-scale\s*=\s*([^,]*)/),c=r.match(/minimum-scale\s*=\s*([^,]*)/),d=r.match(/maximum-scale\s*=\s*([^,]*)/),f=r.match(/user-scalable\s*=\s*([^,]*)/);a&&a.length&&typeof a[1]<"u"&&(i.width=a[1]),l&&l.length&&typeof l[1]<"u"&&(i.height=l[1]),u&&u.length&&typeof u[1]<"u"&&(i.scale=u[1]),c&&c.length&&typeof c[1]<"u"&&(i.minimum=c[1]),d&&d.length&&typeof d[1]<"u"&&(i.maximum=d[1]),f&&f.length&&typeof f[1]<"u"&&(i.scalable=f[1])}return s=ty(t||{},i),t&&(s.width&&n.push("width="+s.width),s.height&&n.push("height="+s.height),s.scale&&n.push("initial-scale="+s.scale),s.scalable==="no"?(n.push("minimum-scale="+s.scale),n.push("maximum-scale="+s.scale),n.push("user-scalable="+s.scalable)):(s.scalable&&n.push("user-scalable="+s.scalable),s.minimum&&n.push("minimum-scale="+s.minimum),s.maximum&&n.push("minimum-scale="+s.maximum)),e||(e=this.document.createElement("meta"),e.setAttribute("name","viewport"),this.document.querySelector("head").appendChild(e)),e.setAttribute("content",n.join(", ")),this.window.scrollTo(0,0)),s}expand(){this.emit(ut.CONTENTS.EXPAND)}listeners(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),typeof ResizeObserver>"u"?(this.resizeListeners(),this.visibilityListeners()):this.resizeObservers(),this.linksHandler()}removeListeners(){this.removeEventListeners(),this.removeSelectionListeners(),this.observer&&this.observer.disconnect(),clearTimeout(this.expanding)}resizeCheck(){let t=this.textWidth(),e=this.textHeight();(t!=this._size.width||e!=this._size.height)&&(this._size={width:t,height:e},this.onResize&&this.onResize(this._size),this.emit(ut.CONTENTS.RESIZE,this._size))}resizeListeners(){clearTimeout(this.expanding),requestAnimationFrame(this.resizeCheck.bind(this)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}visibilityListeners(){document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.active===!1?(this.active=!0,this.resizeListeners()):(this.active=!1,clearTimeout(this.expanding))})}transitionListeners(){let t=this.content;t.style.transitionProperty="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height",t.style.transitionDuration="0.001ms",t.style.transitionTimingFunction="linear",t.style.transitionDelay="0",this._resizeCheck=this.resizeCheck.bind(this),this.document.addEventListener("transitionend",this._resizeCheck)}mediaQueryListeners(){for(var t=this.document.styleSheets,e=(function(a){a.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}).bind(this),i=0;i<t.length;i+=1){var n;try{n=t[i].cssRules}catch{return}if(!n)return;for(var s=0;s<n.length;s+=1)if(n[s].media){var r=this.window.matchMedia(n[s].media.mediaText);r.addListener(e)}}}resizeObservers(){this.observer=new ResizeObserver(t=>{requestAnimationFrame(this.resizeCheck.bind(this))}),this.observer.observe(this.document.documentElement)}mutationObservers(){this.observer=new MutationObserver(e=>{this.resizeCheck()});let t={attributes:!0,childList:!0,characterData:!0,subtree:!0};this.observer.observe(this.document,t)}imageLoadListeners(){for(var t=this.document.querySelectorAll("img"),e,i=0;i<t.length;i++)e=t[i],typeof e.naturalWidth<"u"&&e.naturalWidth===0&&(e.onload=this.expand.bind(this))}fontLoadListeners(){!this.document||!this.document.fonts||this.document.fonts.ready.then((function(){this.resizeCheck()}).bind(this))}root(){return this.document?this.document.documentElement:null}locationOf(t,e){var i,n={left:0,top:0};if(!this.document)return n;if(this.epubcfi.isCfiString(t)){let s=new $t(t).toRange(this.document,e);if(s){try{if(!s.endContainer||s.startContainer==s.endContainer&&s.startOffset==s.endOffset){let r=s.startContainer.textContent.indexOf(" ",s.startOffset);r==-1&&(r=s.startContainer.textContent.length),s.setEnd(s.startContainer,r)}}catch(r){console.error("setting end offset to start container length failed",r)}if(s.startContainer.nodeType===Node.ELEMENT_NODE)i=s.startContainer.getBoundingClientRect(),n.left=i.left,n.top=i.top;else if(sv){let r=s.startContainer,a=new Range;try{r.nodeType===AA?i=r.getBoundingClientRect():s.startOffset+2<r.length?(a.setStart(r,s.startOffset),a.setEnd(r,s.startOffset+2),i=a.getBoundingClientRect()):s.startOffset-2>0?(a.setStart(r,s.startOffset-2),a.setEnd(r,s.startOffset),i=a.getBoundingClientRect()):i=r.parentNode.getBoundingClientRect()}catch(l){console.error(l,l.stack)}}else i=s.getBoundingClientRect()}}else if(typeof t=="string"&&t.indexOf("#")>-1){let s=t.substring(t.indexOf("#")+1),r=this.document.getElementById(s);if(r)if(sv){let a=new Range;a.selectNode(r),i=a.getBoundingClientRect()}else i=r.getBoundingClientRect()}return i&&(n.left=i.left,n.top=i.top),n}addStylesheet(t){return new Promise((function(e,i){var n,s=!1;if(!this.document){e(!1);return}if(n=this.document.querySelector("link[href='"+t+"']"),n){e(!0);return}n=this.document.createElement("link"),n.type="text/css",n.rel="stylesheet",n.href=t,n.onload=n.onreadystatechange=function(){!s&&(!this.readyState||this.readyState=="complete")&&(s=!0,setTimeout(()=>{e(!0)},1))},this.document.head.appendChild(n)}).bind(this))}_getStylesheetNode(t){var e;return t="epubjs-inserted-css-"+(t||""),this.document?(e=this.document.getElementById(t),e||(e=this.document.createElement("style"),e.id=t,this.document.head.appendChild(e)),e):!1}addStylesheetCss(t,e){if(!this.document||!t)return!1;var i;return i=this._getStylesheetNode(e),i.innerHTML=t,!0}addStylesheetRules(t,e){var i;if(!(!this.document||!t||t.length===0))if(i=this._getStylesheetNode(e).sheet,Object.prototype.toString.call(t)==="[object Array]")for(var n=0,s=t.length;n<s;n++){var r=1,a=t[n],l=t[n][0],u="";Object.prototype.toString.call(a[1][0])==="[object Array]"&&(a=a[1],r=0);for(var c=a.length;r<c;r++){var d=a[r];u+=d[0]+":"+d[1]+(d[2]?" !important":"")+`;
`}i.insertRule(l+"{"+u+"}",i.cssRules.length)}else Object.keys(t).forEach(p=>{const b=t[p];if(Array.isArray(b))b.forEach(y=>{const m=Object.keys(y).map(w=>`${w}:${y[w]}`).join(";");i.insertRule(`${p}{${m}}`,i.cssRules.length)});else{const g=Object.keys(b).map(m=>`${m}:${b[m]}`).join(";");i.insertRule(`${p}{${g}}`,i.cssRules.length)}})}addScript(t){return new Promise((function(e,i){var n,s=!1;if(!this.document){e(!1);return}n=this.document.createElement("script"),n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){!s&&(!this.readyState||this.readyState=="complete")&&(s=!0,setTimeout(function(){e(!0)},1))},this.document.head.appendChild(n)}).bind(this))}addClass(t){var e;this.document&&(e=this.content||this.document.body,e&&e.classList.add(t))}removeClass(t){var e;this.document&&(e=this.content||this.document.body,e&&e.classList.remove(t))}addEventListeners(){this.document&&(this._triggerEvent=this.triggerEvent.bind(this),dd.forEach(function(t){this.document.addEventListener(t,this._triggerEvent,{passive:!0})},this))}removeEventListeners(){this.document&&(dd.forEach(function(t){this.document.removeEventListener(t,this._triggerEvent,{passive:!0})},this),this._triggerEvent=void 0)}triggerEvent(t){this.emit(t.type,t)}addSelectionListeners(){this.document&&(this._onSelectionChange=this.onSelectionChange.bind(this),this.document.addEventListener("selectionchange",this._onSelectionChange,{passive:!0}))}removeSelectionListeners(){this.document&&(this.document.removeEventListener("selectionchange",this._onSelectionChange,{passive:!0}),this._onSelectionChange=void 0)}onSelectionChange(t){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout((function(){var e=this.window.getSelection();this.triggerSelectedEvent(e)}).bind(this),250)}triggerSelectedEvent(t){var e,i;t&&t.rangeCount>0&&(e=t.getRangeAt(0),e.collapsed||(i=new $t(e,this.cfiBase).toString(),this.emit(ut.CONTENTS.SELECTED,i),this.emit(ut.CONTENTS.SELECTED_RANGE,e)))}range(t,e){var i=new $t(t);return i.toRange(this.document,e)}cfiFromRange(t,e){return new $t(t,this.cfiBase,e).toString()}cfiFromNode(t,e){return new $t(t,this.cfiBase,e).toString()}map(t){var e=new Ld(t);return e.section()}size(t,e){var i={scale:1,scalable:"no"};this.layoutStyle("scrolling"),t>=0&&(this.width(t),i.width=t,this.css("padding","0 "+t/12+"px")),e>=0&&(this.height(e),i.height=e),this.css("margin","0"),this.css("box-sizing","border-box"),this.viewport(i)}columns(t,e,i,n,s){let r=Fo("column-axis"),a=Fo("column-gap"),l=Fo("column-width"),u=Fo("column-fill"),d=this.writingMode().indexOf("vertical")===0?"vertical":"horizontal";this.layoutStyle("paginated"),s==="rtl"&&d==="horizontal"&&this.direction(s),this.width(t),this.height(e),this.viewport({width:t,height:e,scale:1,scalable:"no"}),this.css("overflow-y","hidden"),this.css("margin","0",!0),d==="vertical"?(this.css("padding-top",n/2+"px",!0),this.css("padding-bottom",n/2+"px",!0),this.css("padding-left","20px"),this.css("padding-right","20px"),this.css(r,"vertical")):(this.css("padding-top","20px"),this.css("padding-bottom","20px"),this.css("padding-left",n/2+"px",!0),this.css("padding-right",n/2+"px",!0),this.css(r,"horizontal")),this.css("box-sizing","border-box"),this.css("max-width","inherit"),this.css(u,"auto"),this.css(a,n+"px"),this.css(l,i+"px"),this.css("-webkit-line-box-contain","block glyphs replaced")}scaler(t,e,i){var n="scale("+t+")",s="";this.css("transform-origin","top left"),(e>=0||i>=0)&&(s=" translate("+(e||0)+"px, "+(i||0)+"px )"),this.css("transform",n+s)}fit(t,e,i){var n=this.viewport(),s=parseInt(n.width),r=parseInt(n.height),a=t/s,l=e/r,u=a<l?a:l;if(this.layoutStyle("paginated"),this.width(s),this.height(r),this.overflow("hidden"),this.scaler(u,0,0),this.css("background-size",s*u+"px "+r*u+"px"),this.css("background-color","transparent"),i&&i.properties.includes("page-spread-left")){var c=t-s*u;this.css("margin-left",c+"px")}}direction(t){this.documentElement&&(this.documentElement.style.direction=t)}mapPage(t,e,i,n,s){var r=new Ld(e,s);return r.page(this,t,i,n)}linksHandler(){dA(this.content,t=>{this.emit(ut.CONTENTS.LINK_CLICKED,t)})}writingMode(t){let e=Fo("writing-mode");return t&&this.documentElement&&(this.documentElement.style[e]=t),this.window.getComputedStyle(this.documentElement)[e]||""}layoutStyle(t){return t&&(this._layoutStyle=t,navigator.epubReadingSystem.layoutStyle=this._layoutStyle),this._layoutStyle||"paginated"}epubReadingSystem(t,e){return navigator.epubReadingSystem={name:t,version:e,layoutStyle:this.layoutStyle(),hasFeature:function(i){switch(i){case"dom-manipulation":return!0;case"layout-changes":return!0;case"touch-events":return!0;case"mouse-events":return!0;case"keyboard-events":return!0;case"spine-scripting":return!1;default:return!1}}},navigator.epubReadingSystem}destroy(){this.removeListeners()}}Es(Qg.prototype);class EA{constructor(t){this.rendition=t,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}add(t,e,i,n,s,r){let a=encodeURI(e+t),u=new $t(e).spinePos,c=new fy({type:t,cfiRange:e,data:i,sectionIndex:u,cb:n,className:s,styles:r});return this._annotations[a]=c,u in this._annotationsBySectionIndex?this._annotationsBySectionIndex[u].push(a):this._annotationsBySectionIndex[u]=[a],this.rendition.views().forEach(f=>{c.sectionIndex===f.index&&c.attach(f)}),c}remove(t,e){let i=encodeURI(t+e);if(i in this._annotations){let n=this._annotations[i];if(e&&n.type!==e)return;this.rendition.views().forEach(r=>{this._removeFromAnnotationBySectionIndex(n.sectionIndex,i),n.sectionIndex===r.index&&n.detach(r)}),delete this._annotations[i]}}_removeFromAnnotationBySectionIndex(t,e){this._annotationsBySectionIndex[t]=this._annotationsAt(t).filter(i=>i!==e)}_annotationsAt(t){return this._annotationsBySectionIndex[t]}highlight(t,e,i,n,s){return this.add("highlight",t,e,i,n,s)}underline(t,e,i,n,s){return this.add("underline",t,e,i,n,s)}mark(t,e,i){return this.add("mark",t,e,i)}each(){return this._annotations.forEach.apply(this._annotations,arguments)}inject(t){let e=t.index;e in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[e].forEach(n=>{this._annotations[n].attach(t)})}clear(t){let e=t.index;e in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[e].forEach(n=>{this._annotations[n].detach(t)})}show(){}hide(){}}class fy{constructor({type:t,cfiRange:e,data:i,sectionIndex:n,cb:s,className:r,styles:a}){this.type=t,this.cfiRange=e,this.data=i,this.sectionIndex=n,this.mark=void 0,this.cb=s,this.className=r,this.styles=a}update(t){this.data=t}attach(t){let{cfiRange:e,data:i,type:n,mark:s,cb:r,className:a,styles:l}=this,u;return n==="highlight"?u=t.highlight(e,i,r,a,l):n==="underline"?u=t.underline(e,i,r,a,l):n==="mark"&&(u=t.mark(e,i,r)),this.mark=u,this.emit(ut.ANNOTATION.ATTACH,u),u}detach(t){let{cfiRange:e,type:i}=this,n;return t&&(i==="highlight"?n=t.unhighlight(e):i==="underline"?n=t.ununderline(e):i==="mark"&&(n=t.unmark(e))),this.mark=void 0,this.emit(ut.ANNOTATION.DETACH,n),n}text(){}}Es(fy.prototype);var sr={},yf={};Object.defineProperty(yf,"__esModule",{value:!0});yf.createElement=py;function py(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}yf.default={createElement:py};var xc={};Object.defineProperty(xc,"__esModule",{value:!0});xc.proxyMouse=gy;xc.clone=my;xc.default={proxyMouse:gy};function gy(o,t){function e(r){for(var a=t.length-1;a>=0;a--){var l=t[a],u=r.clientX,c=r.clientY;if(r.touches&&r.touches.length&&(u=r.touches[0].clientX,c=r.touches[0].clientY),!!xA(l,o,u,c)){l.dispatchEvent(my(r));break}}}if(o.nodeName==="iframe"||o.nodeName==="IFRAME")try{this.target=o.contentDocument}catch{this.target=o}else this.target=o;for(var i=["mouseup","mousedown","click","touchstart"],n=0;n<i.length;n++){var s=i[n];this.target.addEventListener(s,function(r){return e(r)},!1)}}function my(o){var t=Object.assign({},o,{bubbles:!1});try{return new MouseEvent(o.type,t)}catch{var e=document.createEvent("MouseEvents");return e.initMouseEvent(o.type,!1,t.cancelable,t.view,t.detail,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget),e}}function xA(o,t,e,i){var n=t.getBoundingClientRect();function s(c,d,f){var p=c.top-n.top,b=c.left-n.left,y=p+c.height,g=b+c.width;return p<=f&&b<=d&&y>f&&g>d}var r=o.getBoundingClientRect();if(!s(r,e,i))return!1;for(var a=o.getClientRects(),l=0,u=a.length;l<u;l++)if(s(a[l],e,i))return!0;return!1}var Pd,Jg;Object.defineProperty(sr,"__esModule",{value:!0});var vy=sr.Underline=Jg=sr.Highlight=sr.Mark=Pd=sr.Pane=void 0,SA=function o(t,e,i){t===null&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===void 0){var s=Object.getPrototypeOf(t);return s===null?void 0:o(s,e,i)}else{if("value"in n)return n.value;var r=n.get;return r===void 0?void 0:r.call(i)}},wf=function(){function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}(),CA=yf,Wh=by(CA),TA=xc,DA=by(TA);function by(o){return o&&o.__esModule?o:{default:o}}function yy(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function wy(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}function _f(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}Pd=sr.Pane=function(){function o(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document.body;_f(this,o),this.target=t,this.element=Wh.default.createElement("svg"),this.marks=[],this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),DA.default.proxyMouse(this.target,this.marks),this.container=e,this.container.appendChild(this.element),this.render()}return wf(o,[{key:"addMark",value:function(e){var i=Wh.default.createElement("g");return this.element.appendChild(i),e.bind(i,this.container),this.marks.push(e),e.render(),e}},{key:"removeMark",value:function(e){var i=this.marks.indexOf(e);if(i!==-1){var n=e.unbind();this.element.removeChild(n),this.marks.splice(i,1)}}},{key:"render",value:function(){LA(this.element,IA(this.target,this.container));var e=!0,i=!1,n=void 0;try{for(var s=this.marks[Symbol.iterator](),r;!(e=(r=s.next()).done);e=!0){var a=r.value;a.render()}}catch(l){i=!0,n=l}finally{try{!e&&s.return&&s.return()}finally{if(i)throw n}}}}]),o}();var kA=sr.Mark=function(){function o(){_f(this,o),this.element=null}return wf(o,[{key:"bind",value:function(e,i){this.element=e,this.container=i}},{key:"unbind",value:function(){var e=this.element;return this.element=null,e}},{key:"render",value:function(){}},{key:"dispatchEvent",value:function(e){this.element&&this.element.dispatchEvent(e)}},{key:"getBoundingClientRect",value:function(){return this.element.getBoundingClientRect()}},{key:"getClientRects",value:function(){for(var e=[],i=this.element.firstChild;i;)e.push(i.getBoundingClientRect()),i=i.nextSibling;return e}},{key:"filteredRanges",value:function(){var e=Array.from(this.range.getClientRects());return e.filter(function(i){for(var n=0;n<e.length;n++){if(e[n]===i)return!0;var s=PA(e[n],i);if(s)return!1}return!0})}}]),o}(),RA=Jg=sr.Highlight=function(o){wy(t,o);function t(e,i,n,s){_f(this,t);var r=yy(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.range=e,r.className=i,r.data=n||{},r.attributes=s||{},r}return wf(t,[{key:"bind",value:function(i,n){SA(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"bind",this).call(this,i,n);for(var s in this.data)this.data.hasOwnProperty(s)&&(this.element.dataset[s]=this.data[s]);for(var s in this.attributes)this.attributes.hasOwnProperty(s)&&this.element.setAttribute(s,this.attributes[s]);this.className&&this.element.classList.add(this.className)}},{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var i=this.element.ownerDocument.createDocumentFragment(),n=this.filteredRanges(),s=this.element.getBoundingClientRect(),r=this.container.getBoundingClientRect(),a=0,l=n.length;a<l;a++){var u=n[a],c=Wh.default.createElement("rect");c.setAttribute("x",u.left-s.left+r.left),c.setAttribute("y",u.top-s.top+r.top),c.setAttribute("height",u.height),c.setAttribute("width",u.width),i.appendChild(c)}this.element.appendChild(i)}}]),t}(kA);vy=sr.Underline=function(o){wy(t,o);function t(e,i,n,s){return _f(this,t),yy(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,s))}return wf(t,[{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var i=this.element.ownerDocument.createDocumentFragment(),n=this.filteredRanges(),s=this.element.getBoundingClientRect(),r=this.container.getBoundingClientRect(),a=0,l=n.length;a<l;a++){var u=n[a],c=Wh.default.createElement("rect");c.setAttribute("x",u.left-s.left+r.left),c.setAttribute("y",u.top-s.top+r.top),c.setAttribute("height",u.height),c.setAttribute("width",u.width),c.setAttribute("fill","none");var d=Wh.default.createElement("line");d.setAttribute("x1",u.left-s.left+r.left),d.setAttribute("x2",u.left-s.left+r.left+u.width),d.setAttribute("y1",u.top-s.top+r.top+u.height-1),d.setAttribute("y2",u.top-s.top+r.top+u.height-1),d.setAttribute("stroke-width",1),d.setAttribute("stroke","black"),d.setAttribute("stroke-linecap","square"),i.appendChild(c),i.appendChild(d)}this.element.appendChild(i)}}]),t}(RA);function IA(o,t){var e=t.getBoundingClientRect(),i=o.getBoundingClientRect();return{top:i.top-e.top,left:i.left-e.left,height:o.scrollHeight,width:o.scrollWidth}}function LA(o,t){o.style.setProperty("top",t.top+"px","important"),o.style.setProperty("left",t.left+"px","important"),o.style.setProperty("height",t.height+"px","important"),o.style.setProperty("width",t.width+"px","important")}function PA(o,t){return t.right<=o.right&&t.left>=o.left&&t.top>=o.top&&t.bottom<=o.bottom}class _y{constructor(t,e){this.settings=oi({ignoreClass:"",axis:void 0,direction:void 0,width:0,height:0,layout:void 0,globalLayoutProperties:{},method:void 0,forceRight:!1,allowScriptedContent:!1,allowPopups:!1},e||{}),this.id="epubjs-view-"+vf(),this.section=t,this.index=t.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new $t,this.layout=this.settings.layout,this.pane=void 0,this.highlights={},this.underlines={},this.marks={}}container(t){var e=document.createElement("div");return e.classList.add("epub-view"),e.style.height="0px",e.style.width="0px",e.style.overflow="hidden",e.style.position="relative",e.style.display="block",t&&t=="horizontal"?e.style.flex="none":e.style.flex="initial",e}create(){return this.iframe?this.iframe:(this.element||(this.element=this.createContainer()),this.iframe=document.createElement("iframe"),this.iframe.id=this.id,this.iframe.scrolling="no",this.iframe.style.overflow="hidden",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.sandbox="allow-same-origin",this.settings.allowScriptedContent&&(this.iframe.sandbox+=" allow-scripts"),this.settings.allowPopups&&(this.iframe.sandbox+=" allow-popups"),this.iframe.setAttribute("enable-annotation","true"),this.resizing=!0,this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this.element.setAttribute("ref",this.index),this.added=!0,this.elementBounds=ud(this.element),"srcdoc"in this.iframe?this.supportsSrcdoc=!0:this.supportsSrcdoc=!1,this.settings.method||(this.settings.method=this.supportsSrcdoc?"srcdoc":"write"),this.iframe)}render(t,e){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(t)),this.sectionRender.then((function(i){return this.load(i)}).bind(this)).then((function(){let i=this.contents.writingMode(),n;return this.settings.flow==="scrolled"?n=i.indexOf("vertical")===0?"horizontal":"vertical":n=i.indexOf("vertical")===0?"vertical":"horizontal",i.indexOf("vertical")===0&&this.settings.flow==="paginated"&&(this.layout.delta=this.layout.height),this.setAxis(n),this.emit(ut.VIEWS.AXIS,n),this.setWritingMode(i),this.emit(ut.VIEWS.WRITING_MODE,i),this.layout.format(this.contents,this.section,this.axis),this.addListeners(),new Promise((s,r)=>{this.expand(),this.settings.forceRight&&(this.element.style.marginLeft=this.width()+"px"),s()})}).bind(this),(function(i){return this.emit(ut.VIEWS.LOAD_ERROR,i),new Promise((n,s)=>{s(i)})}).bind(this)).then((function(){this.emit(ut.VIEWS.RENDERED,this.section)}).bind(this))}reset(){this.iframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this._textWidth=void 0,this._contentWidth=void 0,this._textHeight=void 0,this._contentHeight=void 0),this._needsReframe=!0}size(t,e){var i=t||this.settings.width,n=e||this.settings.height;this.layout.name==="pre-paginated"?this.lock("both",i,n):this.settings.axis==="horizontal"?this.lock("height",i,n):this.lock("width",i,n),this.settings.width=i,this.settings.height=n}lock(t,e,i){var n=Td(this.element),s;this.iframe?s=Td(this.iframe):s={width:0,height:0},t=="width"&&xe(e)&&(this.lockedWidth=e-n.width-s.width),t=="height"&&xe(i)&&(this.lockedHeight=i-n.height-s.height),t==="both"&&xe(e)&&xe(i)&&(this.lockedWidth=e-n.width-s.width,this.lockedHeight=i-n.height-s.height),this.displayed&&this.iframe&&this.expand()}expand(t){var e=this.lockedWidth,i=this.lockedHeight,n;!this.iframe||this._expanding||(this._expanding=!0,this.layout.name==="pre-paginated"?(e=this.layout.columnWidth,i=this.layout.height):this.settings.axis==="horizontal"?(e=this.contents.textWidth(),e%this.layout.pageWidth>0&&(e=Math.ceil(e/this.layout.pageWidth)*this.layout.pageWidth),this.settings.forceEvenPages&&(n=e/this.layout.pageWidth,this.layout.divisor>1&&this.layout.name==="reflowable"&&n%2>0&&(e+=this.layout.pageWidth))):this.settings.axis==="vertical"&&(i=this.contents.textHeight(),this.settings.flow==="paginated"&&i%this.layout.height>0&&(i=Math.ceil(i/this.layout.height)*this.layout.height)),(this._needsReframe||e!=this._width||i!=this._height)&&this.reframe(e,i),this._expanding=!1)}reframe(t,e){var i;xe(t)&&(this.element.style.width=t+"px",this.iframe.style.width=t+"px",this._width=t),xe(e)&&(this.element.style.height=e+"px",this.iframe.style.height=e+"px",this._height=e);let n=this.prevBounds?t-this.prevBounds.width:t,s=this.prevBounds?e-this.prevBounds.height:e;i={width:t,height:e,widthDelta:n,heightDelta:s},this.pane&&this.pane.render(),requestAnimationFrame(()=>{let r;for(let a in this.marks)this.marks.hasOwnProperty(a)&&(r=this.marks[a],this.placeMark(r.element,r.range))}),this.onResize(this,i),this.emit(ut.VIEWS.RESIZED,i),this.prevBounds=i,this.elementBounds=ud(this.element)}load(t){var e=new Gt,i=e.promise;if(!this.iframe)return e.reject(new Error("No Iframe Available")),i;if(this.iframe.onload=(function(s){this.onLoad(s,e)}).bind(this),this.settings.method==="blobUrl")this.blobUrl=kd(t,"application/xhtml+xml"),this.iframe.src=this.blobUrl,this.element.appendChild(this.iframe);else if(this.settings.method==="srcdoc")this.iframe.srcdoc=t,this.element.appendChild(this.iframe);else{if(this.element.appendChild(this.iframe),this.document=this.iframe.contentDocument,!this.document)return e.reject(new Error("No Document Available")),i;if(this.iframe.contentDocument.open(),window.MSApp&&MSApp.execUnsafeLocalFunction){var n=this;MSApp.execUnsafeLocalFunction(function(){n.iframe.contentDocument.write(t)})}else this.iframe.contentDocument.write(t);this.iframe.contentDocument.close()}return i}onLoad(t,e){this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new Qg(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var i=this.document.querySelector("link[rel='canonical']");i?i.setAttribute("href",this.section.canonical):(i=this.document.createElement("link"),i.setAttribute("rel","canonical"),i.setAttribute("href",this.section.canonical),this.document.querySelector("head").appendChild(i)),this.contents.on(ut.CONTENTS.EXPAND,()=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),this.contents.on(ut.CONTENTS.RESIZE,n=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),e.resolve(this.contents)}setLayout(t){this.layout=t,this.contents&&(this.layout.format(this.contents),this.expand())}setAxis(t){this.settings.axis=t,t=="horizontal"?this.element.style.flex="none":this.element.style.flex="initial",this.size()}setWritingMode(t){this.writingMode=t}addListeners(){}removeListeners(t){}display(t){var e=new Gt;return this.displayed?e.resolve(this):this.render(t).then((function(){this.emit(ut.VIEWS.DISPLAYED,this),this.onDisplayed(this),this.displayed=!0,e.resolve(this)}).bind(this),function(i){e.reject(i,this)}),e.promise}show(){this.element.style.visibility="visible",this.iframe&&(this.iframe.style.visibility="visible",this.iframe.style.transform="translateZ(0)",this.iframe.offsetWidth,this.iframe.style.transform=null),this.emit(ut.VIEWS.SHOWN,this)}hide(){this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.stopExpanding=!0,this.emit(ut.VIEWS.HIDDEN,this)}offset(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}width(){return this._width}height(){return this._height}position(){return this.element.getBoundingClientRect()}locationOf(t){this.iframe.getBoundingClientRect();var e=this.contents.locationOf(t,this.settings.ignoreClass);return{left:e.left,top:e.top}}onDisplayed(t){}onResize(t,e){}bounds(t){return(t||!this.elementBounds)&&(this.elementBounds=ud(this.element)),this.elementBounds}highlight(t,e={},i,n="epubjs-hl",s={}){if(!this.contents)return;const r=Object.assign({fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"},s);let a=this.contents.range(t),l=()=>{this.emit(ut.VIEWS.MARK_CLICKED,t,e)};e.epubcfi=t,this.pane||(this.pane=new Pd(this.iframe,this.element));let u=new Jg(a,n,e,r),c=this.pane.addMark(u);return this.highlights[t]={mark:c,element:c.element,listeners:[l,i]},c.element.setAttribute("ref",n),c.element.addEventListener("click",l),c.element.addEventListener("touchstart",l),i&&(c.element.addEventListener("click",i),c.element.addEventListener("touchstart",i)),c}underline(t,e={},i,n="epubjs-ul",s={}){if(!this.contents)return;const r=Object.assign({stroke:"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"},s);let a=this.contents.range(t),l=()=>{this.emit(ut.VIEWS.MARK_CLICKED,t,e)};e.epubcfi=t,this.pane||(this.pane=new Pd(this.iframe,this.element));let u=new vy(a,n,e,r),c=this.pane.addMark(u);return this.underlines[t]={mark:c,element:c.element,listeners:[l,i]},c.element.setAttribute("ref",n),c.element.addEventListener("click",l),c.element.addEventListener("touchstart",l),i&&(c.element.addEventListener("click",i),c.element.addEventListener("touchstart",i)),c}mark(t,e={},i){if(!this.contents)return;if(t in this.marks)return this.marks[t];let n=this.contents.range(t);if(!n)return;let s=n.commonAncestorContainer,r=s.nodeType===1?s:s.parentNode,a=u=>{this.emit(ut.VIEWS.MARK_CLICKED,t,e)};n.collapsed&&s.nodeType===1?(n=new Range,n.selectNodeContents(s)):n.collapsed&&(n=new Range,n.selectNodeContents(r));let l=this.document.createElement("a");return l.setAttribute("ref","epubjs-mk"),l.style.position="absolute",l.dataset.epubcfi=t,e&&Object.keys(e).forEach(u=>{l.dataset[u]=e[u]}),i&&(l.addEventListener("click",i),l.addEventListener("touchstart",i)),l.addEventListener("click",a),l.addEventListener("touchstart",a),this.placeMark(l,n),this.element.appendChild(l),this.marks[t]={element:l,range:n,listeners:[a,i]},r}placeMark(t,e){let i,n,s;if(this.layout.name==="pre-paginated"||this.settings.axis!=="horizontal"){let a=e.getBoundingClientRect();i=a.top,n=a.right}else{let a=e.getClientRects(),l;for(var r=0;r!=a.length;r++)l=a[r],(!s||l.left<s)&&(s=l.left,n=Math.ceil(s/this.layout.props.pageWidth)*this.layout.props.pageWidth-this.layout.gap/2,i=l.top)}t.style.top=`${i}px`,t.style.left=`${n}px`}unhighlight(t){let e;t in this.highlights&&(e=this.highlights[t],this.pane.removeMark(e.mark),e.listeners.forEach(i=>{i&&(e.element.removeEventListener("click",i),e.element.removeEventListener("touchstart",i))}),delete this.highlights[t])}ununderline(t){let e;t in this.underlines&&(e=this.underlines[t],this.pane.removeMark(e.mark),e.listeners.forEach(i=>{i&&(e.element.removeEventListener("click",i),e.element.removeEventListener("touchstart",i))}),delete this.underlines[t])}unmark(t){let e;t in this.marks&&(e=this.marks[t],this.element.removeChild(e.element),e.listeners.forEach(i=>{i&&(e.element.removeEventListener("click",i),e.element.removeEventListener("touchstart",i))}),delete this.marks[t])}destroy(){for(let t in this.highlights)this.unhighlight(t);for(let t in this.underlines)this.ununderline(t);for(let t in this.marks)this.unmark(t);this.blobUrl&&ny(this.blobUrl),this.displayed&&(this.displayed=!1,this.removeListeners(),this.contents.destroy(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.pane&&(this.pane.element.remove(),this.pane=void 0),this.iframe=void 0,this.contents=void 0,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}Es(_y.prototype);function NA(){var o="reverse",t=OA();return document.body.appendChild(t),t.scrollLeft>0?o="default":typeof Element<"u"&&Element.prototype.scrollIntoView?(t.children[0].children[1].scrollIntoView(),t.scrollLeft<0&&(o="negative")):(t.scrollLeft=1,t.scrollLeft===0&&(o="negative")),document.body.removeChild(t),o}function OA(){var o=document.createElement("div");o.dir="rtl",o.style.position="fixed",o.style.width="1px",o.style.height="1px",o.style.top="0px",o.style.left="0px",o.style.overflow="hidden";var t=document.createElement("div");t.style.width="2px";var e=document.createElement("span");e.style.width="1px",e.style.display="inline-block";var i=document.createElement("span");return i.style.width="1px",i.style.display="inline-block",t.appendChild(e),t.appendChild(i),o.appendChild(t),o}function FA(o){var t=typeof o;return o!=null&&(t=="object"||t=="function")}var tm=FA,MA=typeof _n=="object"&&_n&&_n.Object===Object&&_n,BA=MA,zA=BA,UA=typeof self=="object"&&self&&self.Object===Object&&self,HA=zA||UA||Function("return this")(),Ay=HA,jA=Ay,WA=function(){return jA.Date.now()},qA=WA,VA=/\s/;function GA(o){for(var t=o.length;t--&&VA.test(o.charAt(t)););return t}var $A=GA,XA=$A,YA=/^\s+/;function KA(o){return o&&o.slice(0,XA(o)+1).replace(YA,"")}var ZA=KA,QA=Ay,JA=QA.Symbol,Ey=JA,rv=Ey,xy=Object.prototype,tE=xy.hasOwnProperty,eE=xy.toString,dh=rv?rv.toStringTag:void 0;function iE(o){var t=tE.call(o,dh),e=o[dh];try{o[dh]=void 0;var i=!0}catch{}var n=eE.call(o);return i&&(t?o[dh]=e:delete o[dh]),n}var nE=iE,sE=Object.prototype,rE=sE.toString;function aE(o){return rE.call(o)}var oE=aE,av=Ey,lE=nE,hE=oE,uE="[object Null]",cE="[object Undefined]",ov=av?av.toStringTag:void 0;function dE(o){return o==null?o===void 0?cE:uE:ov&&ov in Object(o)?lE(o):hE(o)}var fE=dE;function pE(o){return o!=null&&typeof o=="object"}var gE=pE,mE=fE,vE=gE,bE="[object Symbol]";function yE(o){return typeof o=="symbol"||vE(o)&&mE(o)==bE}var wE=yE,_E=ZA,lv=tm,AE=wE,hv=NaN,EE=/^[-+]0x[0-9a-f]+$/i,xE=/^0b[01]+$/i,SE=/^0o[0-7]+$/i,CE=parseInt;function TE(o){if(typeof o=="number")return o;if(AE(o))return hv;if(lv(o)){var t=typeof o.valueOf=="function"?o.valueOf():o;o=lv(t)?t+"":t}if(typeof o!="string")return o===0?o:+o;o=_E(o);var e=xE.test(o);return e||SE.test(o)?CE(o.slice(2),e?2:8):EE.test(o)?hv:+o}var DE=TE,kE=tm,Vf=qA,uv=DE,RE="Expected a function",IE=Math.max,LE=Math.min;function PE(o,t,e){var i,n,s,r,a,l,u=0,c=!1,d=!1,f=!0;if(typeof o!="function")throw new TypeError(RE);t=uv(t)||0,kE(e)&&(c=!!e.leading,d="maxWait"in e,s=d?IE(uv(e.maxWait)||0,t):s,f="trailing"in e?!!e.trailing:f);function p(T){var k=i,P=n;return i=n=void 0,u=T,r=o.apply(P,k),r}function b(T){return u=T,a=setTimeout(m,t),c?p(T):r}function y(T){var k=T-l,P=T-u,F=t-k;return d?LE(F,s-P):F}function g(T){var k=T-l,P=T-u;return l===void 0||k>=t||k<0||d&&P>=s}function m(){var T=Vf();if(g(T))return w(T);a=setTimeout(m,y(T))}function w(T){return a=void 0,f&&i?p(T):(i=n=void 0,r)}function E(){a!==void 0&&clearTimeout(a),u=0,i=l=n=a=void 0}function R(){return a===void 0?r:w(Vf())}function A(){var T=Vf(),k=g(T);if(i=arguments,n=this,l=T,k){if(a===void 0)return b(l);if(d)return clearTimeout(a),a=setTimeout(m,t),p(l)}return a===void 0&&(a=setTimeout(m,t)),r}return A.cancel=E,A.flush=R,A}var Sy=PE;const NE=eh(Sy);var OE=Sy,FE=tm,ME="Expected a function";function BE(o,t,e){var i=!0,n=!0;if(typeof o!="function")throw new TypeError(ME);return FE(e)&&(i="leading"in e?!!e.leading:i,n="trailing"in e?!!e.trailing:n),OE(o,t,{leading:i,maxWait:t,trailing:n})}var zE=BE;const UE=eh(zE);class HE{constructor(t){this.settings=t||{},this.id="epubjs-container-"+vf(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}create(t){let e=t.height,i=t.width,n=t.overflow||!1,s=t.axis||"vertical",r=t.direction;oi(this.settings,t),t.height&&xe(t.height)&&(e=t.height+"px"),t.width&&xe(t.width)&&(i=t.width+"px");let a=document.createElement("div");return a.id=this.id,a.classList.add("epub-container"),a.style.wordSpacing="0",a.style.lineHeight="0",a.style.verticalAlign="top",a.style.position="relative",s==="horizontal"&&(a.style.display="flex",a.style.flexDirection="row",a.style.flexWrap="nowrap"),i&&(a.style.width=i),e&&(a.style.height=e),n&&(n==="scroll"&&s==="vertical"?(a.style["overflow-y"]=n,a.style["overflow-x"]="hidden"):n==="scroll"&&s==="horizontal"?(a.style["overflow-y"]="hidden",a.style["overflow-x"]=n):a.style.overflow=n),r&&(a.dir=r,a.style.direction=r),r&&this.settings.fullsize&&(document.body.style.direction=r),a}wrap(t){var e=document.createElement("div");return e.style.visibility="hidden",e.style.overflow="hidden",e.style.width="0",e.style.height="0",e.appendChild(t),e}getElement(t){var e;if(Qb(t)?e=t:typeof t=="string"&&(e=document.getElementById(t)),!e)throw new Error("Not an Element");return e}attachTo(t){var e=this.getElement(t),i;if(e)return this.settings.hidden?i=this.wrapper:i=this.container,e.appendChild(i),this.element=e,e}getContainer(){return this.container}onResize(t){(!xe(this.settings.width)||!xe(this.settings.height))&&(this.resizeFunc=UE(t,50),window.addEventListener("resize",this.resizeFunc,!1))}onOrientationChange(t){this.orientationChangeFunc=t,window.addEventListener("orientationchange",this.orientationChangeFunc,!1)}size(t,e){var i;let n=t||this.settings.width,s=e||this.settings.height;t===null?(i=this.element.getBoundingClientRect(),i.width&&(t=Math.floor(i.width),this.container.style.width=t+"px")):xe(t)?this.container.style.width=t+"px":this.container.style.width=t,e===null?(i=i||this.element.getBoundingClientRect(),i.height&&(e=i.height,this.container.style.height=e+"px")):xe(e)?this.container.style.height=e+"px":this.container.style.height=e,xe(t)||(t=this.container.clientWidth),xe(e)||(e=this.container.clientHeight),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0};let r=Dd(),a=window.getComputedStyle(document.body),l={left:parseFloat(a["padding-left"])||0,right:parseFloat(a["padding-right"])||0,top:parseFloat(a["padding-top"])||0,bottom:parseFloat(a["padding-bottom"])||0};return n||(t=r.width-l.left-l.right),(this.settings.fullsize&&!s||!s)&&(e=r.height-l.top-l.bottom),{width:t-this.containerPadding.left-this.containerPadding.right,height:e-this.containerPadding.top-this.containerPadding.bottom}}bounds(){let t;return this.container.style.overflow!=="visible"&&(t=this.container&&this.container.getBoundingClientRect()),!t||!t.width||!t.height?Dd():t}getSheet(){var t=document.createElement("style");return t.appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet}addStyleRules(t,e){var i="#"+this.id+" ",n="";this.sheet||(this.sheet=this.getSheet()),e.forEach(function(s){for(var r in s)s.hasOwnProperty(r)&&(n+=r+":"+s[r]+";")}),this.sheet.insertRule(i+t+" {"+n+"}",0)}axis(t){t==="horizontal"?(this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.flexWrap="nowrap"):this.container.style.display="block",this.settings.axis=t}direction(t){this.container&&(this.container.dir=t,this.container.style.direction=t),this.settings.fullsize&&(document.body.style.direction=t),this.settings.dir=t}overflow(t){this.container&&(t==="scroll"&&this.settings.axis==="vertical"?(this.container.style["overflow-y"]=t,this.container.style["overflow-x"]="hidden"):t==="scroll"&&this.settings.axis==="horizontal"?(this.container.style["overflow-y"]="hidden",this.container.style["overflow-x"]=t):this.container.style.overflow=t),this.settings.overflow=t}destroy(){this.element&&(this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container),window.removeEventListener("resize",this.resizeFunc),window.removeEventListener("orientationChange",this.orientationChangeFunc))}}class jE{constructor(t){this.container=t,this._views=[],this.length=0,this.hidden=!1}all(){return this._views}first(){return this._views[0]}last(){return this._views[this._views.length-1]}indexOf(t){return this._views.indexOf(t)}slice(){return this._views.slice.apply(this._views,arguments)}get(t){return this._views[t]}append(t){return this._views.push(t),this.container&&this.container.appendChild(t.element),this.length++,t}prepend(t){return this._views.unshift(t),this.container&&this.container.insertBefore(t.element,this.container.firstChild),this.length++,t}insert(t,e){return this._views.splice(e,0,t),this.container&&(e<this.container.children.length?this.container.insertBefore(t.element,this.container.children[e]):this.container.appendChild(t.element)),this.length++,t}remove(t){var e=this._views.indexOf(t);e>-1&&this._views.splice(e,1),this.destroy(t),this.length--}destroy(t){t.displayed&&t.destroy(),this.container&&this.container.removeChild(t.element),t=null}forEach(){return this._views.forEach.apply(this._views,arguments)}clear(){var t,e=this.length;if(this.length){for(var i=0;i<e;i++)t=this._views[i],this.destroy(t);this._views=[],this.length=0}}find(t){for(var e,i=this.length,n=0;n<i;n++)if(e=this._views[n],e.displayed&&e.section.index==t.index)return e}displayed(){for(var t=[],e,i=this.length,n=0;n<i;n++)e=this._views[n],e.displayed&&t.push(e);return t}show(){for(var t,e=this.length,i=0;i<e;i++)t=this._views[i],t.displayed&&t.show();this.hidden=!1}hide(){for(var t,e=this.length,i=0;i<e;i++)t=this._views[i],t.displayed&&t.hide();this.hidden=!0}}class Nd{constructor(t){this.name="default",this.optsSettings=t.settings,this.View=t.view,this.request=t.request,this.renditionQueue=t.queue,this.q=new Zg(this),this.settings=oi(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:void 0,writingMode:void 0,flow:"scrolled",ignoreClass:"",fullsize:void 0,allowScriptedContent:!1,allowPopups:!1}),oi(this.settings,t.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,method:this.settings.method,width:0,height:0,forceEvenPages:!0,allowScriptedContent:this.settings.allowScriptedContent,allowPopups:this.settings.allowPopups},this.rendered=!1}render(t,e){let i=t.tagName;typeof this.settings.fullsize>"u"&&i&&(i.toLowerCase()=="body"||i.toLowerCase()=="html")&&(this.settings.fullsize=!0),this.settings.fullsize&&(this.settings.overflow="visible",this.overflow=this.settings.overflow),this.settings.size=e,this.settings.rtlScrollType=NA(),this.stage=new HE({width:e.width,height:e.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.settings.fullsize,direction:this.settings.direction}),this.stage.attachTo(t),this.container=this.stage.getContainer(),this.views=new jE(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.stage.onOrientationChange(this.onOrientationChange.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout(),this.rendered=!0}addEventListeners(){var t;window.addEventListener("unload",(function(e){this.destroy()}).bind(this)),this.settings.fullsize?t=window:t=this.container,this._onScroll=this.onScroll.bind(this),t.addEventListener("scroll",this._onScroll)}removeEventListeners(){var t;this.settings.fullsize?t=window:t=this.container,t.removeEventListener("scroll",this._onScroll),this._onScroll=void 0}destroy(){clearTimeout(this.orientationTimeout),clearTimeout(this.resizeTimeout),clearTimeout(this.afterScrolled),this.clear(),this.removeEventListeners(),this.stage.destroy(),this.rendered=!1}onOrientationChange(t){let{orientation:e}=window;this.optsSettings.resizeOnOrientationChange&&this.resize(),clearTimeout(this.orientationTimeout),this.orientationTimeout=setTimeout((function(){this.orientationTimeout=void 0,this.optsSettings.resizeOnOrientationChange&&this.resize(),this.emit(ut.MANAGERS.ORIENTATION_CHANGE,e)}).bind(this),500)}onResized(t){this.resize()}resize(t,e,i){let n=this.stage.size(t,e);if(this.winBounds=Dd(),this.orientationTimeout&&this.winBounds.width===this.winBounds.height){this._stageSize=void 0;return}this._stageSize&&this._stageSize.width===n.width&&this._stageSize.height===n.height||(this._stageSize=n,this._bounds=this.bounds(),this.clear(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.emit(ut.MANAGERS.RESIZED,{width:this._stageSize.width,height:this._stageSize.height},i))}createView(t,e){return new this.View(t,oi(this.viewSettings,{forceRight:e}))}handleNextPrePaginated(t,e,i){let n;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1){if(t||e.index===0)return;if(n=e.next(),n&&!n.properties.includes("page-spread-left"))return i.call(this,n)}}display(t,e){var i=new Gt,n=i.promise;(e===t.href||xe(e))&&(e=void 0);var s=this.views.find(t);if(s&&t&&this.layout.name!=="pre-paginated"){let a=s.offset();if(this.settings.direction==="ltr")this.scrollTo(a.left,a.top,!0);else{let l=s.width();this.scrollTo(a.left+l,a.top,!0)}if(e){let l=s.locationOf(e),u=s.width();this.moveTo(l,u)}return i.resolve(),n}this.clear();let r=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&t.properties.includes("page-spread-right")&&(r=!0),this.add(t,r).then((function(a){if(e){let l=a.locationOf(e),u=a.width();this.moveTo(l,u)}}).bind(this),a=>{i.reject(a)}).then((function(){return this.handleNextPrePaginated(r,t,this.add)}).bind(this)).then((function(){this.views.show(),i.resolve()}).bind(this)),n}afterDisplayed(t){this.emit(ut.MANAGERS.ADDED,t)}afterResized(t){this.emit(ut.MANAGERS.RESIZE,t.section)}moveTo(t,e){var i=0,n=0;this.isPaginated?(i=Math.floor(t.left/this.layout.delta)*this.layout.delta,i+this.layout.delta>this.container.scrollWidth&&(i=this.container.scrollWidth-this.layout.delta),n=Math.floor(t.top/this.layout.delta)*this.layout.delta,n+this.layout.delta>this.container.scrollHeight&&(n=this.container.scrollHeight-this.layout.delta)):n=t.top,this.settings.direction==="rtl"&&(i=i+this.layout.delta,i=i-e),this.scrollTo(i,n,!0)}add(t,e){var i=this.createView(t,e);return this.views.append(i),i.onDisplayed=this.afterDisplayed.bind(this),i.onResize=this.afterResized.bind(this),i.on(ut.VIEWS.AXIS,n=>{this.updateAxis(n)}),i.on(ut.VIEWS.WRITING_MODE,n=>{this.updateWritingMode(n)}),i.display(this.request)}append(t,e){var i=this.createView(t,e);return this.views.append(i),i.onDisplayed=this.afterDisplayed.bind(this),i.onResize=this.afterResized.bind(this),i.on(ut.VIEWS.AXIS,n=>{this.updateAxis(n)}),i.on(ut.VIEWS.WRITING_MODE,n=>{this.updateWritingMode(n)}),i.display(this.request)}prepend(t,e){var i=this.createView(t,e);return i.on(ut.VIEWS.RESIZED,n=>{this.counter(n)}),this.views.prepend(i),i.onDisplayed=this.afterDisplayed.bind(this),i.onResize=this.afterResized.bind(this),i.on(ut.VIEWS.AXIS,n=>{this.updateAxis(n)}),i.on(ut.VIEWS.WRITING_MODE,n=>{this.updateWritingMode(n)}),i.display(this.request)}counter(t){this.settings.axis==="vertical"?this.scrollBy(0,t.heightDelta,!0):this.scrollBy(t.widthDelta,0,!0)}next(){var t,e;let i=this.settings.direction;if(this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"&&(!i||i==="ltr")?(this.scrollLeft=this.container.scrollLeft,e=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,e<=this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):t=this.views.last().section.next()):this.isPaginated&&this.settings.axis==="horizontal"&&i==="rtl"?(this.scrollLeft=this.container.scrollLeft,this.settings.rtlScrollType==="default"?(e=this.container.scrollLeft,e>0?this.scrollBy(this.layout.delta,0,!0):t=this.views.last().section.next()):(e=this.container.scrollLeft+this.layout.delta*-1,e>this.container.scrollWidth*-1?this.scrollBy(this.layout.delta,0,!0):t=this.views.last().section.next())):this.isPaginated&&this.settings.axis==="vertical"?(this.scrollTop=this.container.scrollTop,this.container.scrollTop+this.container.offsetHeight<this.container.scrollHeight?this.scrollBy(0,this.layout.height,!0):t=this.views.last().section.next()):t=this.views.last().section.next(),t)){this.clear(),this.updateLayout();let n=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&t.properties.includes("page-spread-right")&&(n=!0),this.append(t,n).then((function(){return this.handleNextPrePaginated(n,t,this.append)}).bind(this),s=>s).then((function(){!this.isPaginated&&this.settings.axis==="horizontal"&&this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"&&this.scrollTo(this.container.scrollWidth,0,!0),this.views.show()}).bind(this))}}prev(){var t,e;let i=this.settings.direction;if(this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"&&(!i||i==="ltr")?(this.scrollLeft=this.container.scrollLeft,e=this.container.scrollLeft,e>0?this.scrollBy(-this.layout.delta,0,!0):t=this.views.first().section.prev()):this.isPaginated&&this.settings.axis==="horizontal"&&i==="rtl"?(this.scrollLeft=this.container.scrollLeft,this.settings.rtlScrollType==="default"?(e=this.container.scrollLeft+this.container.offsetWidth,e<this.container.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):t=this.views.first().section.prev()):(e=this.container.scrollLeft,e<0?this.scrollBy(-this.layout.delta,0,!0):t=this.views.first().section.prev())):this.isPaginated&&this.settings.axis==="vertical"?(this.scrollTop=this.container.scrollTop,this.container.scrollTop>0?this.scrollBy(0,-this.layout.height,!0):t=this.views.first().section.prev()):t=this.views.first().section.prev(),t)){this.clear(),this.updateLayout();let n=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&typeof t.prev()!="object"&&(n=!0),this.prepend(t,n).then((function(){var s;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1&&(s=t.prev(),s))return this.prepend(s)}).bind(this),s=>s).then((function(){this.isPaginated&&this.settings.axis==="horizontal"&&(this.settings.direction==="rtl"?this.settings.rtlScrollType==="default"?this.scrollTo(0,0,!0):this.scrollTo(this.container.scrollWidth*-1+this.layout.delta,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)),this.views.show()}).bind(this))}}current(){var t=this.visible();return t.length?t[t.length-1]:null}clear(){this.views&&(this.views.hide(),this.scrollTo(0,0,!0),this.views.clear())}currentLocation(){return this.updateLayout(),this.isPaginated&&this.settings.axis==="horizontal"?this.location=this.paginatedLocation():this.location=this.scrolledLocation(),this.location}scrolledLocation(){let t=this.visible(),e=this.container.getBoundingClientRect(),i=e.height<window.innerHeight?e.height:window.innerHeight,n=e.width<window.innerWidth?e.width:window.innerWidth,s=this.settings.axis==="vertical";this.settings.direction;let r=0,a=0;return this.settings.fullsize&&(r=s?window.scrollY:window.scrollX),t.map(u=>{let{index:c,href:d}=u.section,f=u.position(),p=u.width(),b=u.height(),y,g,m,w;s?(y=r+e.top-f.top+a,g=y+i-a,w=this.layout.count(b,i).pages,m=i):(y=r+e.left-f.left+a,g=y+n-a,w=this.layout.count(p,n).pages,m=n);let E=Math.ceil(y/m),R=[],A=Math.ceil(g/m);if(this.settings.direction==="rtl"&&!s){let P=E;E=w-A,A=w-P}R=[];for(var T=E;T<=A;T++){let P=T+1;R.push(P)}let k=this.mapping.page(u.contents,u.section.cfiBase,y,g);return{index:c,href:d,pages:R,totalPages:w,mapping:k}})}paginatedLocation(){let t=this.visible(),e=this.container.getBoundingClientRect(),i=0,n=0;return this.settings.fullsize&&(i=window.scrollX),t.map(r=>{let{index:a,href:l}=r.section,u,c=r.position(),d=r.width(),f,p,b;this.settings.direction==="rtl"?(u=e.right-i,b=Math.min(Math.abs(u-c.left),this.layout.width)-n,p=c.width-(c.right-u)-n,f=p-b):(u=e.left+i,b=Math.min(c.right-u,this.layout.width)-n,f=u-c.left+n,p=f+b),n+=b;let y=this.mapping.page(r.contents,r.section.cfiBase,f,p),g=this.layout.count(d).pages,m=Math.floor(f/this.layout.pageWidth),w=[],E=Math.floor(p/this.layout.pageWidth);if(m<0&&(m=0,E=E+1),this.settings.direction==="rtl"){let A=m;m=g-E,E=g-A}for(var R=m+1;R<=E;R++){let A=R;w.push(A)}return{index:a,href:l,pages:w,totalPages:g,mapping:y}})}isVisible(t,e,i,n){var s=t.position(),r=n||this.bounds();return this.settings.axis==="horizontal"&&s.right>r.left-e&&s.left<r.right+i?!0:this.settings.axis==="vertical"&&s.bottom>r.top-e&&s.top<r.bottom+i}visible(){for(var t=this.bounds(),e=this.views.displayed(),i=e.length,n=[],s,r,a=0;a<i;a++)r=e[a],s=this.isVisible(r,0,0,t),s===!0&&n.push(r);return n}scrollBy(t,e,i){let n=this.settings.direction==="rtl"?-1:1;i&&(this.ignore=!0),this.settings.fullsize?window.scrollBy(t*n,e*n):(t&&(this.container.scrollLeft+=t*n),e&&(this.container.scrollTop+=e)),this.scrolled=!0}scrollTo(t,e,i){i&&(this.ignore=!0),this.settings.fullsize?window.scrollTo(t,e):(this.container.scrollLeft=t,this.container.scrollTop=e),this.scrolled=!0}onScroll(){let t,e;this.settings.fullsize?(t=window.scrollY,e=window.scrollX):(t=this.container.scrollTop,e=this.container.scrollLeft),this.scrollTop=t,this.scrollLeft=e,this.ignore?this.ignore=!1:(this.emit(ut.MANAGERS.SCROLL,{top:t,left:e}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout((function(){this.emit(ut.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}).bind(this),20))}bounds(){var t;return t=this.stage.bounds(),t}applyLayout(t){this.layout=t,this.updateLayout(),this.views&&this.views.length>0&&this.layout.name==="pre-paginated"&&this.display(this.views.first().section)}updateLayout(){this.stage&&(this._stageSize=this.stage.size(),this.isPaginated?(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta/this.layout.divisor):this.layout.calculate(this._stageSize.width,this._stageSize.height),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}setLayout(t){this.viewSettings.layout=t,this.mapping=new Ld(t.props,this.settings.direction,this.settings.axis),this.views&&this.views.forEach(function(e){e&&e.setLayout(t)})}updateWritingMode(t){this.writingMode=t}updateAxis(t,e){!e&&t===this.settings.axis||(this.settings.axis=t,this.stage&&this.stage.axis(t),this.viewSettings.axis=t,this.mapping&&(this.mapping=new Ld(this.layout.props,this.settings.direction,this.settings.axis)),this.layout&&(t==="vertical"?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)))}updateFlow(t,e="auto"){let i=t==="paginated"||t==="auto";this.isPaginated=i,t==="scrolled-doc"||t==="scrolled-continuous"||t==="scrolled"?this.updateAxis("vertical"):this.updateAxis("horizontal"),this.viewSettings.flow=t,this.settings.overflow?this.overflow=this.settings.overflow:this.overflow=i?"hidden":e,this.stage&&this.stage.overflow(this.overflow),this.updateLayout()}getContents(){var t=[];return this.views&&this.views.forEach(function(e){const i=e&&e.contents;i&&t.push(i)}),t}direction(t="ltr"){this.settings.direction=t,this.stage&&this.stage.direction(t),this.viewSettings.direction=t,this.updateLayout()}isRendered(){return this.rendered}}Es(Nd.prototype);const WE={easeInCubic:function(o){return Math.pow(o,3)}};class wg{constructor(t,e){this.settings=oi({duration:80,minVelocity:.2,minDistance:10,easing:WE.easeInCubic},e||{}),this.supportsTouch=this.supportsTouch(),this.supportsTouch&&this.setup(t)}setup(t){this.manager=t,this.layout=this.manager.layout,this.fullsize=this.manager.settings.fullsize,this.fullsize?(this.element=this.manager.stage.element,this.scroller=window,this.disableScroll()):(this.element=this.manager.stage.container,this.scroller=this.element,this.element.style.WebkitOverflowScrolling="touch"),this.manager.settings.offset=this.layout.width,this.manager.settings.afterScrolledTimeout=this.settings.duration*2,this.isVertical=this.manager.settings.axis==="vertical",!(!this.manager.isPaginated||this.isVertical)&&(this.touchCanceler=!1,this.resizeCanceler=!1,this.snapping=!1,this.scrollLeft,this.scrollTop,this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0,this.addListeners())}supportsTouch(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}disableScroll(){this.element.style.overflow="hidden"}enableScroll(){this.element.style.overflow=""}addListeners(){this._onResize=this.onResize.bind(this),window.addEventListener("resize",this._onResize),this._onScroll=this.onScroll.bind(this),this.scroller.addEventListener("scroll",this._onScroll),this._onTouchStart=this.onTouchStart.bind(this),this.scroller.addEventListener("touchstart",this._onTouchStart,{passive:!0}),this.on("touchstart",this._onTouchStart),this._onTouchMove=this.onTouchMove.bind(this),this.scroller.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.on("touchmove",this._onTouchMove),this._onTouchEnd=this.onTouchEnd.bind(this),this.scroller.addEventListener("touchend",this._onTouchEnd,{passive:!0}),this.on("touchend",this._onTouchEnd),this._afterDisplayed=this.afterDisplayed.bind(this),this.manager.on(ut.MANAGERS.ADDED,this._afterDisplayed)}removeListeners(){window.removeEventListener("resize",this._onResize),this._onResize=void 0,this.scroller.removeEventListener("scroll",this._onScroll),this._onScroll=void 0,this.scroller.removeEventListener("touchstart",this._onTouchStart,{passive:!0}),this.off("touchstart",this._onTouchStart),this._onTouchStart=void 0,this.scroller.removeEventListener("touchmove",this._onTouchMove,{passive:!0}),this.off("touchmove",this._onTouchMove),this._onTouchMove=void 0,this.scroller.removeEventListener("touchend",this._onTouchEnd,{passive:!0}),this.off("touchend",this._onTouchEnd),this._onTouchEnd=void 0,this.manager.off(ut.MANAGERS.ADDED,this._afterDisplayed),this._afterDisplayed=void 0}afterDisplayed(t){let e=t.contents;["touchstart","touchmove","touchend"].forEach(i=>{e.on(i,n=>this.triggerViewEvent(n,e))})}triggerViewEvent(t,e){this.emit(t.type,t,e)}onScroll(t){this.scrollLeft=this.fullsize?window.scrollX:this.scroller.scrollLeft,this.scrollTop=this.fullsize?window.scrollY:this.scroller.scrollTop}onResize(t){this.resizeCanceler=!0}onTouchStart(t){let{screenX:e,screenY:i}=t.touches[0];this.fullsize&&this.enableScroll(),this.touchCanceler=!0,this.startTouchX||(this.startTouchX=e,this.startTouchY=i,this.startTime=this.now()),this.endTouchX=e,this.endTouchY=i,this.endTime=this.now()}onTouchMove(t){let{screenX:e,screenY:i}=t.touches[0],n=Math.abs(i-this.endTouchY);this.touchCanceler=!0,!this.fullsize&&n<10&&(this.element.scrollLeft-=e-this.endTouchX),this.endTouchX=e,this.endTouchY=i,this.endTime=this.now()}onTouchEnd(t){this.fullsize&&this.disableScroll(),this.touchCanceler=!1;let e=this.wasSwiped();e!==0?this.snap(e):this.snap(),this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0}wasSwiped(){let t=this.layout.pageWidth*this.layout.divisor,e=this.endTouchX-this.startTouchX,i=Math.abs(e),n=this.endTime-this.startTime,s=e/n,r=this.settings.minVelocity;if(i<=this.settings.minDistance||i>=t)return 0;if(s>r)return-1;if(s<-r)return 1}needsSnap(){let t=this.scrollLeft,e=this.layout.pageWidth*this.layout.divisor;return t%e!==0}snap(t=0){let e=this.scrollLeft,i=this.layout.pageWidth*this.layout.divisor,n=Math.round(e/i)*i;return t&&(n+=t*i),this.smoothScrollTo(n)}smoothScrollTo(t){const e=new Gt,i=this.scrollLeft,n=this.now(),s=this.settings.duration,r=this.settings.easing;this.snapping=!0;function a(){const l=this.now(),u=Math.min(1,(l-n)/s);if(r(u),this.touchCanceler||this.resizeCanceler){this.resizeCanceler=!1,this.snapping=!1,e.resolve();return}u<1?(window.requestAnimationFrame(a.bind(this)),this.scrollTo(i+(t-i)*u,0)):(this.scrollTo(t,0),this.snapping=!1,e.resolve())}return a.call(this),e.promise}scrollTo(t=0,e=0){this.fullsize?window.scroll(t,e):(this.scroller.scrollLeft=t,this.scroller.scrollTop=e)}now(){return"now"in window.performance?performance.now():new Date().getTime()}destroy(){this.scroller&&(this.fullsize&&this.enableScroll(),this.removeListeners(),this.scroller=void 0)}}Es(wg.prototype);class qE extends Nd{constructor(t){super(t),this.name="continuous",this.settings=oi(this.settings||{},{infinite:!0,overflow:void 0,axis:void 0,writingMode:void 0,flow:"scrolled",offset:500,offsetDelta:250,width:void 0,height:void 0,snap:!1,afterScrolledTimeout:10,allowScriptedContent:!1,allowPopups:!1}),oi(this.settings,t.settings||{}),t.settings.gap!="undefined"&&t.settings.gap===0&&(this.settings.gap=t.settings.gap),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,width:0,height:0,forceEvenPages:!1,allowScriptedContent:this.settings.allowScriptedContent,allowPopups:this.settings.allowPopups},this.scrollTop=0,this.scrollLeft=0}display(t,e){return Nd.prototype.display.call(this,t,e).then((function(){return this.fill()}).bind(this))}fill(t){var e=t||new Gt;return this.q.enqueue(()=>this.check()).then(i=>{i?this.fill(e):e.resolve()}),e.promise}moveTo(t){var e=0,i=0;this.isPaginated?(e=Math.floor(t.left/this.layout.delta)*this.layout.delta,e+this.settings.offsetDelta):(i=t.top,t.top+this.settings.offsetDelta),(e>0||i>0)&&this.scrollBy(e,i,!0)}afterResized(t){this.emit(ut.MANAGERS.RESIZE,t.section)}removeShownListeners(t){t.onDisplayed=function(){}}add(t){var e=this.createView(t);return this.views.append(e),e.on(ut.VIEWS.RESIZED,i=>{e.expanded=!0}),e.on(ut.VIEWS.AXIS,i=>{this.updateAxis(i)}),e.on(ut.VIEWS.WRITING_MODE,i=>{this.updateWritingMode(i)}),e.onDisplayed=this.afterDisplayed.bind(this),e.onResize=this.afterResized.bind(this),e.display(this.request)}append(t){var e=this.createView(t);return e.on(ut.VIEWS.RESIZED,i=>{e.expanded=!0}),e.on(ut.VIEWS.AXIS,i=>{this.updateAxis(i)}),e.on(ut.VIEWS.WRITING_MODE,i=>{this.updateWritingMode(i)}),this.views.append(e),e.onDisplayed=this.afterDisplayed.bind(this),e}prepend(t){var e=this.createView(t);return e.on(ut.VIEWS.RESIZED,i=>{this.counter(i),e.expanded=!0}),e.on(ut.VIEWS.AXIS,i=>{this.updateAxis(i)}),e.on(ut.VIEWS.WRITING_MODE,i=>{this.updateWritingMode(i)}),this.views.prepend(e),e.onDisplayed=this.afterDisplayed.bind(this),e}counter(t){this.settings.axis==="vertical"?this.scrollBy(0,t.heightDelta,!0):this.scrollBy(t.widthDelta,0,!0)}update(t){for(var e=this.bounds(),i=this.views.all(),n=i.length,s=typeof t<"u"?t:this.settings.offset||0,r,a,l=new Gt,u=[],c=0;c<n;c++)if(a=i[c],r=this.isVisible(a,s,s,e),r===!0)if(a.displayed)a.show();else{let d=a.display(this.request).then(function(f){f.show()},f=>{a.hide()});u.push(d)}else this.q.enqueue(a.destroy.bind(a)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout((function(){this.q.enqueue(this.trim.bind(this))}).bind(this),250);return u.length?Promise.all(u).catch(d=>{l.reject(d)}):(l.resolve(),l.promise)}check(t,e){var i=new Gt,n=[],s=this.settings.axis==="horizontal",r=this.settings.offset||0;t&&s&&(r=t),e&&!s&&(r=e);var a=this._bounds;let l=s?this.scrollLeft:this.scrollTop,u=s?Math.floor(a.width):a.height,c=s?this.container.scrollWidth:this.container.scrollHeight,d=this.writingMode&&this.writingMode.indexOf("vertical")===0?"vertical":"horizontal",f=this.settings.rtlScrollType,p=this.settings.direction==="rtl";this.settings.fullsize?(s&&p&&f==="negative"||!s&&p&&f==="default")&&(l=l*-1):(p&&f==="default"&&d==="horizontal"&&(l=c-u-l),p&&f==="negative"&&d==="horizontal"&&(l=l*-1));let b=()=>{let E=this.views.first(),R=E&&E.section.prev();R&&n.push(this.prepend(R))},y=()=>{let E=this.views.last(),R=E&&E.section.next();R&&n.push(this.append(R))},g=l+u+r,m=l-r;g>=c&&y(),m<0&&b();let w=n.map(E=>E.display(this.request));return n.length?Promise.all(w).then(()=>this.check()).then(()=>this.update(r),E=>E):(this.q.enqueue((function(){this.update()}).bind(this)),i.resolve(!1),i.promise)}trim(){for(var t=new Gt,e=this.views.displayed(),i=e[0],n=e[e.length-1],s=this.views.indexOf(i),r=this.views.indexOf(n),a=this.views.slice(0,s),l=this.views.slice(r+1),u=0;u<a.length-1;u++)this.erase(a[u],a);for(var c=1;c<l.length;c++)this.erase(l[c]);return t.resolve(),t.promise}erase(t,e){var i,n;this.settings.fullsize?(i=window.scrollY,n=window.scrollX):(i=this.container.scrollTop,n=this.container.scrollLeft);var s=t.bounds();this.views.remove(t),e&&(this.settings.axis==="vertical"?this.scrollTo(0,i-s.height,!0):this.settings.direction==="rtl"?this.settings.fullsize?this.scrollTo(n+Math.floor(s.width),0,!0):this.scrollTo(n,0,!0):this.scrollTo(n-Math.floor(s.width),0,!0))}addEventListeners(t){window.addEventListener("unload",(function(e){this.ignore=!0,this.destroy()}).bind(this)),this.addScrollListeners(),this.isPaginated&&this.settings.snap&&(this.snapper=new wg(this,this.settings.snap&&typeof this.settings.snap=="object"&&this.settings.snap))}addScrollListeners(){var t;this.tick=Xg;let e=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.fullsize?(t=window,this.scrollTop=window.scrollY*e,this.scrollLeft=window.scrollX*e):(t=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft),this._onScroll=this.onScroll.bind(this),t.addEventListener("scroll",this._onScroll),this._scrolled=NE(this.scrolled.bind(this),30),this.didScroll=!1}removeEventListeners(){var t;this.settings.fullsize?t=window:t=this.container,t.removeEventListener("scroll",this._onScroll),this._onScroll=void 0}onScroll(){let t,e,i=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;this.settings.fullsize?(t=window.scrollY*i,e=window.scrollX*i):(t=this.container.scrollTop,e=this.container.scrollLeft),this.scrollTop=t,this.scrollLeft=e,this.ignore?this.ignore=!1:this._scrolled(),this.scrollDeltaVert+=Math.abs(t-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(e-this.prevScrollLeft),this.prevScrollTop=t,this.prevScrollLeft=e,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout((function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}).bind(this),150),clearTimeout(this.afterScrolled),this.didScroll=!1}scrolled(){this.q.enqueue((function(){return this.check()}).bind(this)),this.emit(ut.MANAGERS.SCROLL,{top:this.scrollTop,left:this.scrollLeft}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout((function(){this.snapper&&this.snapper.supportsTouch&&this.snapper.needsSnap()||this.emit(ut.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}).bind(this),this.settings.afterScrolledTimeout)}next(){let t=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?this.layout.props.delta*2:this.layout.props.delta;this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(t,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue((function(){return this.check()}).bind(this)))}prev(){let t=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?this.layout.props.delta*2:this.layout.props.delta;this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(-t,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue((function(){return this.check()}).bind(this)))}updateFlow(t){this.rendered&&this.snapper&&(this.snapper.destroy(),this.snapper=void 0),super.updateFlow(t,"scroll"),this.rendered&&this.isPaginated&&this.settings.snap&&(this.snapper=new wg(this,this.settings.snap&&typeof this.settings.snap=="object"&&this.settings.snap))}destroy(){super.destroy(),this.snapper&&this.snapper.destroy()}}class em{constructor(t,e){this.settings=oi(this.settings||{},{width:null,height:null,ignoreClass:"",manager:"default",view:"iframe",flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,resizeOnOrientationChange:!0,script:null,snap:!1,defaultDirection:"ltr",allowScriptedContent:!1,allowPopups:!1}),oi(this.settings,e),typeof this.settings.manager=="object"&&(this.manager=this.settings.manager),this.book=t,this.hooks={},this.hooks.display=new $n(this),this.hooks.serialize=new $n(this),this.hooks.content=new $n(this),this.hooks.unloaded=new $n(this),this.hooks.layout=new $n(this),this.hooks.render=new $n(this),this.hooks.show=new $n(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new wA(this),this.annotations=new EA(this),this.epubcfi=new $t,this.q=new Zg(this),this.location=void 0,this.q.enqueue(this.book.opened),this.starting=new Gt,this.started=this.starting.promise,this.q.enqueue(this.start)}setManager(t){this.manager=t}requireManager(t){var e;return typeof t=="string"&&t==="default"?e=Nd:typeof t=="string"&&t==="continuous"?e=qE:e=t,e}requireView(t){var e;return typeof t=="string"&&t==="iframe"?e=_y:e=t,e}start(){switch(!this.settings.layout&&(this.book.package.metadata.layout==="pre-paginated"||this.book.displayOptions.fixedLayout==="true")&&(this.settings.layout="pre-paginated"),this.book.package.metadata.spread){case"none":this.settings.spread="none";break;case"both":this.settings.spread=!0;break}this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.direction(this.book.package.metadata.direction||this.settings.defaultDirection),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on(ut.MANAGERS.ADDED,this.afterDisplayed.bind(this)),this.manager.on(ut.MANAGERS.REMOVED,this.afterRemoved.bind(this)),this.manager.on(ut.MANAGERS.RESIZED,this.onResized.bind(this)),this.manager.on(ut.MANAGERS.ORIENTATION_CHANGE,this.onOrientationChange.bind(this)),this.manager.on(ut.MANAGERS.SCROLLED,this.reportLocation.bind(this)),this.emit(ut.RENDITION.STARTED),this.starting.resolve()}attachTo(t){return this.q.enqueue((function(){this.manager.render(t,{width:this.settings.width,height:this.settings.height}),this.emit(ut.RENDITION.ATTACHED)}).bind(this))}display(t){return this.displaying&&this.displaying.resolve(),this.q.enqueue(this._display,t)}_display(t){if(this.book){this.epubcfi.isCfiString(t);var e=new Gt,i=e.promise,n;return this.displaying=e,this.book.locations.length()&&Jb(t)&&(t=this.book.locations.cfiFromPercentage(parseFloat(t))),n=this.book.spine.get(t),n?(this.manager.display(n,t).then(()=>{e.resolve(n),this.displaying=void 0,this.emit(ut.RENDITION.DISPLAYED,n),this.reportLocation()},s=>{this.emit(ut.RENDITION.DISPLAY_ERROR,s)}),i):(e.reject(new Error("No Section Found")),i)}}afterDisplayed(t){t.on(ut.VIEWS.MARK_CLICKED,(e,i)=>this.triggerMarkEvent(e,i,t.contents)),this.hooks.render.trigger(t,this).then(()=>{t.contents?this.hooks.content.trigger(t.contents,this).then(()=>{this.emit(ut.RENDITION.RENDERED,t.section,t)}):this.emit(ut.RENDITION.RENDERED,t.section,t)})}afterRemoved(t){this.hooks.unloaded.trigger(t,this).then(()=>{this.emit(ut.RENDITION.REMOVED,t.section,t)})}onResized(t,e){this.emit(ut.RENDITION.RESIZED,{width:t.width,height:t.height},e),this.location&&this.location.start&&this.display(e||this.location.start.cfi)}onOrientationChange(t){this.emit(ut.RENDITION.ORIENTATION_CHANGE,t)}moveTo(t){this.manager.moveTo(t)}resize(t,e,i){t&&(this.settings.width=t),e&&(this.settings.height=e),this.manager.resize(t,e,i)}clear(){this.manager.clear()}next(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}prev(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}determineLayoutProperties(t){var e,i=this.settings.layout||t.layout||"reflowable",n=this.settings.spread||t.spread||"auto",s=this.settings.orientation||t.orientation||"auto",r=this.settings.flow||t.flow||"auto",a=t.viewport||"",l=this.settings.minSpreadWidth||t.minSpreadWidth||800,u=this.settings.direction||t.direction||"ltr";return(this.settings.width===0||this.settings.width>0)&&(this.settings.height===0||this.settings.height>0),e={layout:i,spread:n,orientation:s,flow:r,viewport:a,minSpreadWidth:l,direction:u},e}flow(t){var e=t;(t==="scrolled"||t==="scrolled-doc"||t==="scrolled-continuous")&&(e="scrolled"),(t==="auto"||t==="paginated")&&(e="paginated"),this.settings.flow=t,this._layout&&this._layout.flow(e),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this.manager&&this.manager.updateFlow(e),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}layout(t){return t&&(this._layout=new cy(t),this._layout.spread(t.spread,this.settings.minSpreadWidth),this._layout.on(ut.LAYOUT.UPDATED,(e,i)=>{this.emit(ut.RENDITION.LAYOUT,e,i)})),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}spread(t,e){this.settings.spread=t,e&&(this.settings.minSpreadWidth=e),this._layout&&this._layout.spread(t,e),this.manager&&this.manager.isRendered()&&this.manager.updateLayout()}direction(t){this.settings.direction=t||"ltr",this.manager&&this.manager.direction(this.settings.direction),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}reportLocation(){return this.q.enqueue((function(){requestAnimationFrame((function(){var i=this.manager.currentLocation();if(i&&i.then&&typeof i.then=="function")i.then((function(n){let s=this.located(n);!s||!s.start||!s.end||(this.location=s,this.emit(ut.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(ut.RENDITION.RELOCATED,this.location))}).bind(this));else if(i){let n=this.located(i);if(!n||!n.start||!n.end)return;this.location=n,this.emit(ut.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(ut.RENDITION.RELOCATED,this.location)}}).bind(this))}).bind(this))}currentLocation(){var t=this.manager.currentLocation();if(t&&t.then&&typeof t.then=="function")t.then((function(e){return this.located(e)}).bind(this));else if(t)return this.located(t)}located(t){if(!t.length)return{};let e=t[0],i=t[t.length-1],n={start:{index:e.index,href:e.href,cfi:e.mapping.start,displayed:{page:e.pages[0]||1,total:e.totalPages}},end:{index:i.index,href:i.href,cfi:i.mapping.end,displayed:{page:i.pages[i.pages.length-1]||1,total:i.totalPages}}},s=this.book.locations.locationFromCfi(e.mapping.start),r=this.book.locations.locationFromCfi(i.mapping.end);s!=null&&(n.start.location=s,n.start.percentage=this.book.locations.percentageFromLocation(s)),r!=null&&(n.end.location=r,n.end.percentage=this.book.locations.percentageFromLocation(r));let a=this.book.pageList.pageFromCfi(e.mapping.start),l=this.book.pageList.pageFromCfi(i.mapping.end);return a!=-1&&(n.start.page=a),l!=-1&&(n.end.page=l),i.index===this.book.spine.last().index&&n.end.displayed.page>=n.end.displayed.total&&(n.atEnd=!0),e.index===this.book.spine.first().index&&n.start.displayed.page===1&&(n.atStart=!0),n}destroy(){this.manager&&this.manager.destroy(),this.book=void 0}passEvents(t){dd.forEach(e=>{t.on(e,i=>this.triggerViewEvent(i,t))}),t.on(ut.CONTENTS.SELECTED,e=>this.triggerSelectedEvent(e,t))}triggerViewEvent(t,e){this.emit(t.type,t,e)}triggerSelectedEvent(t,e){this.emit(ut.RENDITION.SELECTED,t,e)}triggerMarkEvent(t,e,i){this.emit(ut.RENDITION.MARK_CLICKED,t,e,i)}getRange(t,e){var i=new $t(t),n=this.manager.visible().filter(function(s){if(i.spinePos===s.index)return!0});if(n.length)return n[0].contents.range(i,e)}adjustImages(t){if(this._layout.name==="pre-paginated")return new Promise(function(s){s()});let e=t.window.getComputedStyle(t.content,null),i=(t.content.offsetHeight-(parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)))*.95,n=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight);return t.addStylesheetRules({img:{"max-width":(this._layout.columnWidth?this._layout.columnWidth-n+"px":"100%")+"!important","max-height":i+"px!important","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"},svg:{"max-width":(this._layout.columnWidth?this._layout.columnWidth-n+"px":"100%")+"!important","max-height":i+"px!important","page-break-inside":"avoid","break-inside":"avoid"}}),new Promise(function(s,r){setTimeout(function(){s()},1)})}getContents(){return this.manager?this.manager.getContents():[]}views(){return(this.manager?this.manager.views:void 0)||[]}handleLinks(t){t&&t.on(ut.CONTENTS.LINK_CLICKED,e=>{let i=this.book.path.relative(e);this.display(i)})}injectStylesheet(t,e){let i=t.createElement("link");i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),i.setAttribute("href",this.settings.stylesheet),t.getElementsByTagName("head")[0].appendChild(i)}injectScript(t,e){let i=t.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",this.settings.script),i.textContent=" ",t.getElementsByTagName("head")[0].appendChild(i)}injectIdentifier(t,e){let i=this.book.packaging.metadata.identifier,n=t.createElement("meta");n.setAttribute("name","dc.relation.ispartof"),i&&n.setAttribute("content",i),t.getElementsByTagName("head")[0].appendChild(n)}}Es(em.prototype);function Yr(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Cy={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(o,t){(function(e){o.exports=e()})(function(){return function e(i,n,s){function r(u,c){if(!n[u]){if(!i[u]){var d=typeof Yr=="function"&&Yr;if(!c&&d)return d(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var p=n[u]={exports:{}};i[u][0].call(p.exports,function(b){var y=i[u][1][b];return r(y||b)},p,p.exports,e,i,n,s)}return n[u].exports}for(var a=typeof Yr=="function"&&Yr,l=0;l<s.length;l++)r(s[l]);return r}({1:[function(e,i,n){var s=e("./utils"),r=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var u=[],c,d,f,p,b,y,g,m=0,w=l.length,E=w,R=s.getTypeOf(l)!=="string";m<l.length;)E=w-m,R?(c=l[m++],d=m<w?l[m++]:0,f=m<w?l[m++]:0):(c=l.charCodeAt(m++),d=m<w?l.charCodeAt(m++):0,f=m<w?l.charCodeAt(m++):0),p=c>>2,b=(c&3)<<4|d>>4,y=E>1?(d&15)<<2|f>>6:64,g=E>2?f&63:64,u.push(a.charAt(p)+a.charAt(b)+a.charAt(y)+a.charAt(g));return u.join("")},n.decode=function(l){var u,c,d,f,p,b,y,g=0,m=0,w="data:";if(l.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");l=l.replace(/[^A-Za-z0-9+/=]/g,"");var E=l.length*3/4;if(l.charAt(l.length-1)===a.charAt(64)&&E--,l.charAt(l.length-2)===a.charAt(64)&&E--,E%1!==0)throw new Error("Invalid base64 input, bad content length.");var R;for(r.uint8array?R=new Uint8Array(E|0):R=new Array(E|0);g<l.length;)f=a.indexOf(l.charAt(g++)),p=a.indexOf(l.charAt(g++)),b=a.indexOf(l.charAt(g++)),y=a.indexOf(l.charAt(g++)),u=f<<2|p>>4,c=(p&15)<<4|b>>2,d=(b&3)<<6|y,R[m++]=u,b!==64&&(R[m++]=c),y!==64&&(R[m++]=d);return R}},{"./support":30,"./utils":32}],2:[function(e,i,n){var s=e("./external"),r=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function u(c,d,f,p,b){this.compressedSize=c,this.uncompressedSize=d,this.crc32=f,this.compression=p,this.compressedContent=b}u.prototype={getContentWorker:function(){var c=new r(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return c.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new r(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(c,d,f){return c.pipe(new a).pipe(new l("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},i.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,i,n){var s=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,i,n){var s=e("./utils");function r(){for(var c,d=[],f=0;f<256;f++){c=f;for(var p=0;p<8;p++)c=c&1?3988292384^c>>>1:c>>>1;d[f]=c}return d}var a=r();function l(c,d,f,p){var b=a,y=p+f;c=c^-1;for(var g=p;g<y;g++)c=c>>>8^b[(c^d[g])&255];return c^-1}function u(c,d,f,p){var b=a,y=p+f;c=c^-1;for(var g=p;g<y;g++)c=c>>>8^b[(c^d.charCodeAt(g))&255];return c^-1}i.exports=function(d,f){if(typeof d>"u"||!d.length)return 0;var p=s.getTypeOf(d)!=="string";return p?l(f|0,d,d.length,0):u(f|0,d,d.length,0)}},{"./utils":32}],5:[function(e,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,i,n){var s=null;typeof Promise<"u"?s=Promise:s=e("lie"),i.exports={Promise:s}},{lie:37}],7:[function(e,i,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=e("pako"),a=e("./utils"),l=e("./stream/GenericWorker"),u=s?"uint8array":"array";n.magic="\b\0";function c(d,f){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}a.inherits(c,l),c.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,d.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},n.compressWorker=function(d){return new c("Deflate",d)},n.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,i,n){var s=e("../utils"),r=e("../stream/GenericWorker"),a=e("../utf8"),l=e("../crc32"),u=e("../signature"),c=function(m,w){var E="",R;for(R=0;R<w;R++)E+=String.fromCharCode(m&255),m=m>>>8;return E},d=function(m,w){var E=m;return m||(E=w?16893:33204),(E&65535)<<16},f=function(m){return(m||0)&63},p=function(m,w,E,R,A,T){var k=m.file,P=m.compression,F=T!==a.utf8encode,B=s.transformTo("string",T(k.name)),W=s.transformTo("string",a.utf8encode(k.name)),G=k.comment,et=s.transformTo("string",T(G)),ot=s.transformTo("string",a.utf8encode(G)),ct=W.length!==k.name.length,X=ot.length!==G.length,K,lt,Ct="",xt="",_t="",at=k.dir,At=k.date,Rt={crc32:0,compressedSize:0,uncompressedSize:0};(!w||E)&&(Rt.crc32=m.crc32,Rt.compressedSize=m.compressedSize,Rt.uncompressedSize=m.uncompressedSize);var Wt=0;w&&(Wt|=8),!F&&(ct||X)&&(Wt|=2048);var Ft=0,St=0;at&&(Ft|=16),A==="UNIX"?(St=798,Ft|=d(k.unixPermissions,at)):(St=20,Ft|=f(k.dosPermissions)),K=At.getUTCHours(),K=K<<6,K=K|At.getUTCMinutes(),K=K<<5,K=K|At.getUTCSeconds()/2,lt=At.getUTCFullYear()-1980,lt=lt<<4,lt=lt|At.getUTCMonth()+1,lt=lt<<5,lt=lt|At.getUTCDate(),ct&&(xt=c(1,1)+c(l(B),4)+W,Ct+="up"+c(xt.length,2)+xt),X&&(_t=c(1,1)+c(l(et),4)+ot,Ct+="uc"+c(_t.length,2)+_t);var Lt="";Lt+=`
\0`,Lt+=c(Wt,2),Lt+=P.magic,Lt+=c(K,2),Lt+=c(lt,2),Lt+=c(Rt.crc32,4),Lt+=c(Rt.compressedSize,4),Lt+=c(Rt.uncompressedSize,4),Lt+=c(B.length,2),Lt+=c(Ct.length,2);var _e=u.LOCAL_FILE_HEADER+Lt+B+Ct,de=u.CENTRAL_FILE_HEADER+c(St,2)+Lt+c(et.length,2)+"\0\0\0\0"+c(Ft,4)+c(R,4)+B+Ct+et;return{fileRecord:_e,dirRecord:de}},b=function(m,w,E,R,A){var T="",k=s.transformTo("string",A(R));return T=u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(m,2)+c(m,2)+c(w,4)+c(E,4)+c(k.length,2)+k,T},y=function(m){var w="";return w=u.DATA_DESCRIPTOR+c(m.crc32,4)+c(m.compressedSize,4)+c(m.uncompressedSize,4),w};function g(m,w,E,R){r.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=E,this.encodeFileName=R,this.streamFiles=m,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(g,r),g.prototype.push=function(m){var w=m.meta.percent||0,E=this.entriesCount,R=this._sources.length;this.accumulate?this.contentBuffer.push(m):(this.bytesWritten+=m.data.length,r.prototype.push.call(this,{data:m.data,meta:{currentFile:this.currentFile,percent:E?(w+100*(E-R-1))/E:100}}))},g.prototype.openedSource=function(m){this.currentSourceOffset=this.bytesWritten,this.currentFile=m.file.name;var w=this.streamFiles&&!m.file.dir;if(w){var E=p(m,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:E.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(m){this.accumulate=!1;var w=this.streamFiles&&!m.file.dir,E=p(m,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(E.dirRecord),w)this.push({data:y(m),meta:{percent:100}});else for(this.push({data:E.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var m=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var E=this.bytesWritten-m,R=b(this.dirRecords.length,E,m,this.zipComment,this.encodeFileName);this.push({data:R,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(m){this._sources.push(m);var w=this;return m.on("data",function(E){w.processChunk(E)}),m.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),m.on("error",function(E){w.error(E)}),this},g.prototype.resume=function(){if(!r.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&!this._sources.length&&!this.generatedError)return this.end(),!0},g.prototype.error=function(m){var w=this._sources;if(!r.prototype.error.call(this,m))return!1;for(var E=0;E<w.length;E++)try{w[E].error(m)}catch{}return!0},g.prototype.lock=function(){r.prototype.lock.call(this);for(var m=this._sources,w=0;w<m.length;w++)m[w].lock()},i.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,i,n){var s=e("../compressions"),r=e("./ZipFileWorker"),a=function(l,u){var c=l||u,d=s[c];if(!d)throw new Error(c+" is not a valid compression method !");return d};n.generateWorker=function(l,u,c){var d=new r(u.streamFiles,c,u.platform,u.encodeFileName),f=0;try{l.forEach(function(p,b){f++;var y=a(b.options.compression,u.compression),g=b.options.compressionOptions||u.compressionOptions||{},m=b.dir,w=b.date;b._compressWorker(y,g).withStreamInfo("file",{name:p,dir:m,date:w,comment:b.comment||"",unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions}).pipe(d)}),d.entriesCount=f}catch(p){d.error(p)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,i,n){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new s;for(var a in this)typeof this[a]!="function"&&(r[a]=this[a]);return r}}s.prototype=e("./object"),s.prototype.loadAsync=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.version="3.10.1",s.loadAsync=function(r,a){return new s().loadAsync(r,a)},s.external=e("./external"),i.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,i,n){var s=e("./utils"),r=e("./external"),a=e("./utf8"),l=e("./zipEntries"),u=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function d(f){return new r.Promise(function(p,b){var y=f.decompressed.getContentWorker().pipe(new u);y.on("error",function(g){b(g)}).on("end",function(){y.streamInfo.crc32!==f.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}i.exports=function(f,p){var b=this;return p=s.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),c.isNode&&c.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,p.optimizedBinaryString,p.base64).then(function(y){var g=new l(p);return g.load(y),g}).then(function(g){var m=[r.Promise.resolve(g)],w=g.files;if(p.checkCRC32)for(var E=0;E<w.length;E++)m.push(d(w[E]));return r.Promise.all(m)}).then(function(g){for(var m=g.shift(),w=m.files,E=0;E<w.length;E++){var R=w[E],A=R.fileNameStr,T=s.resolve(R.fileNameStr);b.file(T,R.decompressed,{binary:!0,optimizedBinaryString:!0,date:R.date,dir:R.dir,comment:R.fileCommentStr.length?R.fileCommentStr:null,unixPermissions:R.unixPermissions,dosPermissions:R.dosPermissions,createFolders:p.createFolders}),R.dir||(b.file(T).unsafeOriginalName=A)}return m.zipComment.length&&(b.comment=m.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,i,n){var s=e("../utils"),r=e("../stream/GenericWorker");function a(l,u){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,r),a.prototype._bindStream=function(l){var u=this;this._stream=l,l.pause(),l.on("data",function(c){u.push({data:c,meta:{percent:0}})}).on("error",function(c){u.isPaused?this.generatedError=c:u.error(c)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return r.prototype.pause.call(this)?(this._stream.pause(),!0):!1},a.prototype.resume=function(){return r.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1},i.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,i,n){var s=e("readable-stream").Readable,r=e("../utils");r.inherits(a,s);function a(l,u,c){s.call(this,u),this._helper=l;var d=this;l.on("data",function(f,p){d.push(f)||d._helper.pause(),c&&c(p)}).on("error",function(f){d.emit("error",f)}).on("end",function(){d.push(null)})}a.prototype._read=function(){this._helper.resume()},i.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,r);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,r)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var r=new Buffer(s);return r.fill(0),r},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(e,i,n){var s=e("./utf8"),r=e("./utils"),a=e("./stream/GenericWorker"),l=e("./stream/StreamHelper"),u=e("./defaults"),c=e("./compressedObject"),d=e("./zipObject"),f=e("./generate"),p=e("./nodejsUtils"),b=e("./nodejs/NodejsStreamInputAdapter"),y=function(A,T,k){var P=r.getTypeOf(T),F,B=r.extend(k||{},u);B.date=B.date||new Date,B.compression!==null&&(B.compression=B.compression.toUpperCase()),typeof B.unixPermissions=="string"&&(B.unixPermissions=parseInt(B.unixPermissions,8)),B.unixPermissions&&B.unixPermissions&16384&&(B.dir=!0),B.dosPermissions&&B.dosPermissions&16&&(B.dir=!0),B.dir&&(A=m(A)),B.createFolders&&(F=g(A))&&w.call(this,F,!0);var W=P==="string"&&B.binary===!1&&B.base64===!1;(!k||typeof k.binary>"u")&&(B.binary=!W);var G=T instanceof c&&T.uncompressedSize===0;(G||B.dir||!T||T.length===0)&&(B.base64=!1,B.binary=!0,T="",B.compression="STORE",P="string");var et=null;T instanceof c||T instanceof a?et=T:p.isNode&&p.isStream(T)?et=new b(A,T):et=r.prepareContent(A,T,B.binary,B.optimizedBinaryString,B.base64);var ot=new d(A,et,B);this.files[A]=ot},g=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var T=A.lastIndexOf("/");return T>0?A.substring(0,T):""},m=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},w=function(A,T){return T=typeof T<"u"?T:u.createFolders,A=m(A),this.files[A]||y.call(this,A,null,{dir:!0,createFolders:T}),this.files[A]};function E(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var R={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var T,k,P;for(T in this.files)P=this.files[T],k=T.slice(this.root.length,T.length),k&&T.slice(0,this.root.length)===this.root&&A(k,P)},filter:function(A){var T=[];return this.forEach(function(k,P){A(k,P)&&T.push(P)}),T},file:function(A,T,k){if(arguments.length===1)if(E(A)){var P=A;return this.filter(function(B,W){return!W.dir&&P.test(B)})}else{var F=this.files[this.root+A];return F&&!F.dir?F:null}else A=this.root+A,y.call(this,A,T,k);return this},folder:function(A){if(!A)return this;if(E(A))return this.filter(function(F,B){return B.dir&&A.test(F)});var T=this.root+A,k=w.call(this,T),P=this.clone();return P.root=k.name,P},remove:function(A){A=this.root+A;var T=this.files[A];if(T||(A.slice(-1)!=="/"&&(A+="/"),T=this.files[A]),T&&!T.dir)delete this.files[A];else for(var k=this.filter(function(F,B){return B.name.slice(0,A.length)===A}),P=0;P<k.length;P++)delete this.files[k[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var T,k={};try{if(k=r.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode}),k.type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");r.checkSupport(k.type),(k.platform==="darwin"||k.platform==="freebsd"||k.platform==="linux"||k.platform==="sunos")&&(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var P=k.comment||this.comment||"";T=f.generateWorker(this,k,P)}catch(F){T=new a("error"),T.error(F)}return new l(T,k.type||"string",k.mimeType)},generateAsync:function(A,T){return this.generateInternalStream(A).accumulate(T)},generateNodeStream:function(A,T){return A=A||{},A.type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(T)}};i.exports=R},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,i,n){i.exports=e("stream")},{stream:void 0}],17:[function(e,i,n){var s=e("./DataReader"),r=e("../utils");function a(l){s.call(this,l);for(var u=0;u<this.data.length;u++)l[u]=l[u]&255}r.inherits(a,s),a.prototype.byteAt=function(l){return this.data[this.zero+l]},a.prototype.lastIndexOfSignature=function(l){for(var u=l.charCodeAt(0),c=l.charCodeAt(1),d=l.charCodeAt(2),f=l.charCodeAt(3),p=this.length-4;p>=0;--p)if(this.data[p]===u&&this.data[p+1]===c&&this.data[p+2]===d&&this.data[p+3]===f)return p-this.zero;return-1},a.prototype.readAndCheckSignature=function(l){var u=l.charCodeAt(0),c=l.charCodeAt(1),d=l.charCodeAt(2),f=l.charCodeAt(3),p=this.readData(4);return u===p[0]&&c===p[1]&&d===p[2]&&f===p[3]},a.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,i,n){var s=e("../utils");function r(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l=0,u;for(this.checkOffset(a),u=this.index+a-1;u>=this.index;u--)l=(l<<8)+this.byteAt(u);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(a&31)<<1))}},i.exports=r},{"../utils":32}],19:[function(e,i,n){var s=e("./Uint8ArrayReader"),r=e("../utils");function a(l){s.call(this,l)}r.inherits(a,s),a.prototype.readData=function(l){this.checkOffset(l);var u=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,i,n){var s=e("./DataReader"),r=e("../utils");function a(l){s.call(this,l)}r.inherits(a,s),a.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},a.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},a.prototype.readAndCheckSignature=function(l){var u=this.readData(4);return l===u},a.prototype.readData=function(l){this.checkOffset(l);var u=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,i,n){var s=e("./ArrayReader"),r=e("../utils");function a(l){s.call(this,l)}r.inherits(a,s),a.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,i,n){var s=e("../utils"),r=e("../support"),a=e("./ArrayReader"),l=e("./StringReader"),u=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");i.exports=function(d){var f=s.getTypeOf(d);return s.checkSupport(f),f==="string"&&!r.uint8array?new l(d):f==="nodebuffer"?new u(d):r.uint8array?new c(s.transformTo("uint8array",d)):new a(s.transformTo("array",d))}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,i,n){var s=e("./GenericWorker"),r=e("../utils");function a(l){s.call(this,"ConvertWorker to "+l),this.destType=l}r.inherits(a,s),a.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},i.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,i,n){var s=e("./GenericWorker"),r=e("../crc32"),a=e("../utils");function l(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}a.inherits(l,s),l.prototype.processChunk=function(u){this.streamInfo.crc32=r(u.data,this.streamInfo.crc32||0),this.push(u)},i.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,i,n){var s=e("../utils"),r=e("./GenericWorker");function a(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}s.inherits(a,r),a.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}r.prototype.processChunk.call(this,l)},i.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,i,n){var s=e("../utils"),r=e("./GenericWorker"),a=16*1024;function l(u){r.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(d){c.dataIsReady=!0,c.data=d,c.max=d&&d.length||0,c.type=s.getTypeOf(d),c.isPaused||c._tickAndRepeat()},function(d){c.error(d)})}s.inherits(l,r),l.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return r.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0):!1},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,!(this.isPaused||this.isFinished)&&(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=a,c=null,d=Math.min(this.max,this.index+u);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,d);break;case"uint8array":c=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":c=this.data.slice(this.index,d);break}return this.index=d,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(e,i,n){function s(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return this.isFinished?!1:(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,a){return this._listeners[r].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,a){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,a)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var a=this;return r.on("data",function(l){a.processChunk(l)}),r.on("end",function(){a.end()}),r.on("error",function(l){a.error(l)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var r=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,a){return this.extraStreamInfo[r]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},i.exports=s},{}],29:[function(e,i,n){var s=e("../utils"),r=e("./ConvertWorker"),a=e("./GenericWorker"),l=e("../base64"),u=e("../support"),c=e("../external"),d=null;if(u.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(g,m,w){switch(g){case"blob":return s.newBlob(s.transformTo("arraybuffer",m),w);case"base64":return l.encode(m);default:return s.transformTo(g,m)}}function p(g,m){var w,E=0,R=null,A=0;for(w=0;w<m.length;w++)A+=m[w].length;switch(g){case"string":return m.join("");case"array":return Array.prototype.concat.apply([],m);case"uint8array":for(R=new Uint8Array(A),w=0;w<m.length;w++)R.set(m[w],E),E+=m[w].length;return R;case"nodebuffer":return Buffer.concat(m);default:throw new Error("concat : unsupported type '"+g+"'")}}function b(g,m){return new c.Promise(function(w,E){var R=[],A=g._internalType,T=g._outputType,k=g._mimeType;g.on("data",function(P,F){R.push(P),m&&m(F)}).on("error",function(P){R=[],E(P)}).on("end",function(){try{var P=f(T,p(A,R),k);w(P)}catch(F){E(F)}R=[]}).resume()})}function y(g,m,w){var E=m;switch(m){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string";break}try{this._internalType=E,this._outputType=m,this._mimeType=w,s.checkSupport(E),this._worker=g.pipe(new r(E)),g.lock()}catch(R){this._worker=new a("error"),this._worker.error(R)}}y.prototype={accumulate:function(g){return b(this,g)},on:function(g,m){var w=this;return g==="data"?this._worker.on(g,function(E){m.call(w,E.data,E.meta)}):this._worker.on(g,function(){s.delay(m,arguments,w)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},g)}},i.exports=y},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var s=new ArrayBuffer(0);try{n.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var r=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,a=new r;a.append(s),n.blob=a.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(e,i,n){for(var s=e("./utils"),r=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),u=new Array(256),c=0;c<256;c++)u[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;u[254]=u[254]=1;var d=function(g){var m,w,E,R,A,T=g.length,k=0;for(R=0;R<T;R++)w=g.charCodeAt(R),(w&64512)===55296&&R+1<T&&(E=g.charCodeAt(R+1),(E&64512)===56320&&(w=65536+(w-55296<<10)+(E-56320),R++)),k+=w<128?1:w<2048?2:w<65536?3:4;for(r.uint8array?m=new Uint8Array(k):m=new Array(k),A=0,R=0;A<k;R++)w=g.charCodeAt(R),(w&64512)===55296&&R+1<T&&(E=g.charCodeAt(R+1),(E&64512)===56320&&(w=65536+(w-55296<<10)+(E-56320),R++)),w<128?m[A++]=w:w<2048?(m[A++]=192|w>>>6,m[A++]=128|w&63):w<65536?(m[A++]=224|w>>>12,m[A++]=128|w>>>6&63,m[A++]=128|w&63):(m[A++]=240|w>>>18,m[A++]=128|w>>>12&63,m[A++]=128|w>>>6&63,m[A++]=128|w&63);return m},f=function(g,m){var w;for(m=m||g.length,m>g.length&&(m=g.length),w=m-1;w>=0&&(g[w]&192)===128;)w--;return w<0||w===0?m:w+u[g[w]]>m?w:m},p=function(g){var m,w,E,R,A=g.length,T=new Array(A*2);for(w=0,m=0;m<A;){if(E=g[m++],E<128){T[w++]=E;continue}if(R=u[E],R>4){T[w++]=65533,m+=R-1;continue}for(E&=R===2?31:R===3?15:7;R>1&&m<A;)E=E<<6|g[m++]&63,R--;if(R>1){T[w++]=65533;continue}E<65536?T[w++]=E:(E-=65536,T[w++]=55296|E>>10&1023,T[w++]=56320|E&1023)}return T.length!==w&&(T.subarray?T=T.subarray(0,w):T.length=w),s.applyFromCharCode(T)};n.utf8encode=function(m){return r.nodebuffer?a.newBufferFrom(m,"utf-8"):d(m)},n.utf8decode=function(m){return r.nodebuffer?s.transformTo("nodebuffer",m).toString("utf-8"):(m=s.transformTo(r.uint8array?"uint8array":"array",m),p(m))};function b(){l.call(this,"utf-8 decode"),this.leftOver=null}s.inherits(b,l),b.prototype.processChunk=function(g){var m=s.transformTo(r.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var w=m;m=new Uint8Array(w.length+this.leftOver.length),m.set(this.leftOver,0),m.set(w,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var E=f(m),R=m;E!==m.length&&(r.uint8array?(R=m.subarray(0,E),this.leftOver=m.subarray(E,m.length)):(R=m.slice(0,E),this.leftOver=m.slice(E,m.length))),this.push({data:n.utf8decode(R),meta:g.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=b;function y(){l.call(this,"utf-8 encode")}s.inherits(y,l),y.prototype.processChunk=function(g){this.push({data:n.utf8encode(g.data),meta:g.meta})},n.Utf8EncodeWorker=y},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,i,n){var s=e("./support"),r=e("./base64"),a=e("./nodejsUtils"),l=e("./external");e("setimmediate");function u(g){var m=null;return s.uint8array?m=new Uint8Array(g.length):m=new Array(g.length),d(g,m)}n.newBlob=function(g,m){n.checkSupport("blob");try{return new Blob([g],{type:m})}catch{try{var w=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,E=new w;return E.append(g),E.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};function c(g){return g}function d(g,m){for(var w=0;w<g.length;++w)m[w]=g.charCodeAt(w)&255;return m}var f={stringifyByChunk:function(g,m,w){var E=[],R=0,A=g.length;if(A<=w)return String.fromCharCode.apply(null,g);for(;R<A;)m==="array"||m==="nodebuffer"?E.push(String.fromCharCode.apply(null,g.slice(R,Math.min(R+w,A)))):E.push(String.fromCharCode.apply(null,g.subarray(R,Math.min(R+w,A)))),R+=w;return E.join("")},stringifyByChar:function(g){for(var m="",w=0;w<g.length;w++)m+=String.fromCharCode(g[w]);return m},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function p(g){var m=65536,w=n.getTypeOf(g),E=!0;if(w==="uint8array"?E=f.applyCanBeUsed.uint8array:w==="nodebuffer"&&(E=f.applyCanBeUsed.nodebuffer),E)for(;m>1;)try{return f.stringifyByChunk(g,w,m)}catch{m=Math.floor(m/2)}return f.stringifyByChar(g)}n.applyFromCharCode=p;function b(g,m){for(var w=0;w<g.length;w++)m[w]=g[w];return m}var y={};y.string={string:c,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return y.string.uint8array(g).buffer},uint8array:function(g){return d(g,new Uint8Array(g.length))},nodebuffer:function(g){return d(g,a.allocBuffer(g.length))}},y.array={string:p,array:c,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},y.arraybuffer={string:function(g){return p(new Uint8Array(g))},array:function(g){return b(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:c,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},y.uint8array={string:p,array:function(g){return b(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:c,nodebuffer:function(g){return a.newBufferFrom(g)}},y.nodebuffer={string:p,array:function(g){return b(g,new Array(g.length))},arraybuffer:function(g){return y.nodebuffer.uint8array(g).buffer},uint8array:function(g){return b(g,new Uint8Array(g.length))},nodebuffer:c},n.transformTo=function(g,m){if(m||(m=""),!g)return m;n.checkSupport(g);var w=n.getTypeOf(m),E=y[w][g](m);return E},n.resolve=function(g){for(var m=g.split("/"),w=[],E=0;E<m.length;E++){var R=m[E];R==="."||R===""&&E!==0&&E!==m.length-1||(R===".."?w.pop():w.push(R))}return w.join("/")},n.getTypeOf=function(g){if(typeof g=="string")return"string";if(Object.prototype.toString.call(g)==="[object Array]")return"array";if(s.nodebuffer&&a.isBuffer(g))return"nodebuffer";if(s.uint8array&&g instanceof Uint8Array)return"uint8array";if(s.arraybuffer&&g instanceof ArrayBuffer)return"arraybuffer"},n.checkSupport=function(g){var m=s[g.toLowerCase()];if(!m)throw new Error(g+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(g){var m="",w,E;for(E=0;E<(g||"").length;E++)w=g.charCodeAt(E),m+="\\x"+(w<16?"0":"")+w.toString(16).toUpperCase();return m},n.delay=function(g,m,w){setImmediate(function(){g.apply(w||null,m||[])})},n.inherits=function(g,m){var w=function(){};w.prototype=m.prototype,g.prototype=new w},n.extend=function(){var g={},m,w;for(m=0;m<arguments.length;m++)for(w in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],w)&&typeof g[w]>"u"&&(g[w]=arguments[m][w]);return g},n.prepareContent=function(g,m,w,E,R){var A=l.Promise.resolve(m).then(function(T){var k=s.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1);return k&&typeof FileReader<"u"?new l.Promise(function(P,F){var B=new FileReader;B.onload=function(W){P(W.target.result)},B.onerror=function(W){F(W.target.error)},B.readAsArrayBuffer(T)}):T});return A.then(function(T){var k=n.getTypeOf(T);return k?(k==="arraybuffer"?T=n.transformTo("uint8array",T):k==="string"&&(R?T=r.decode(T):w&&E!==!0&&(T=u(T))),T):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,i,n){var s=e("./reader/readerFor"),r=e("./utils"),a=e("./signature"),l=e("./zipEntry"),u=e("./support");function c(d){this.files=[],this.loadOptions=d}c.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(d)+")")}},isSignature:function(d,f){var p=this.reader.index;this.reader.setIndex(d);var b=this.reader.readString(4),y=b===f;return this.reader.setIndex(p),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",p=r.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d=this.zip64EndOfCentralSize-44,f=0,p,b,y;f<d;)p=this.reader.readInt(2),b=this.reader.readInt(4),y=this.reader.readData(b),this.zip64ExtensibleData[p]={id:p,length:b,value:y}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)d=new l({zip64:this.zip64},this.loadOptions),d.readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0){var f=!this.isSignature(0,a.LOCAL_FILE_HEADER);throw f?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(d);var p=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),d<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var b=this.centralDirOffset+this.centralDirSize;this.zip64&&(b+=20,b+=12+this.zip64EndOfCentralSize);var y=p-b;if(y>0)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(d){this.reader=s(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,i,n){var s=e("./reader/readerFor"),r=e("./utils"),a=e("./compressedObject"),l=e("./crc32"),u=e("./utf8"),c=e("./compressions"),d=e("./support"),f=0,p=3,b=function(g){for(var m in c)if(Object.prototype.hasOwnProperty.call(c,m)&&c[m].magic===g)return c[m];return null};function y(g,m){this.options=g,this.loadOptions=m}y.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(g){var m,w;if(g.skip(22),this.fileNameLength=g.readInt(2),w=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(w),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(m=b(this.compressionMethod),m===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var m=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(m),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),g===f&&(this.dosPermissions=this.externalFileAttributes&63),g===p&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=s(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var m=g.index+this.extraFieldsLength,w,E,R;for(this.extraFields||(this.extraFields={});g.index+4<m;)w=g.readInt(2),E=g.readInt(2),R=g.readData(E),this.extraFields[w]={id:w,length:E,value:R};g.setIndex(m)},handleUTF8:function(){var g=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var w=r.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(w)}var E=this.findExtraFieldUnicodeComment();if(E!==null)this.fileCommentStr=E;else{var R=r.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(R)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var m=s(g.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:u.utf8decode(m.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var m=s(g.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:u.utf8decode(m.readData(g.length-5))}return null}},i.exports=y},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,i,n){var s=e("./stream/StreamHelper"),r=e("./stream/DataWorker"),a=e("./utf8"),l=e("./compressedObject"),u=e("./stream/GenericWorker"),c=function(b,y,g){this.name=b,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=y,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}};c.prototype={internalStream:function(b){var y=null,g="string";try{if(!b)throw new Error("No output type specified.");g=b.toLowerCase();var m=g==="string"||g==="text";(g==="binarystring"||g==="text")&&(g="string"),y=this._decompressWorker();var w=!this._dataBinary;w&&!m&&(y=y.pipe(new a.Utf8EncodeWorker)),!w&&m&&(y=y.pipe(new a.Utf8DecodeWorker))}catch(E){y=new u("error"),y.error(E)}return new s(y,g,"")},async:function(b,y){return this.internalStream(b).accumulate(y)},nodeStream:function(b,y){return this.internalStream(b||"nodebuffer").toNodejsStream(y)},_compressWorker:function(b,y){if(this._data instanceof l&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new a.Utf8EncodeWorker)),l.createWorkerFrom(g,b,y)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new r(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<d.length;p++)c.prototype[d[p]]=f;i.exports=c},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,i,n){(function(s){var r=s.MutationObserver||s.WebKitMutationObserver,a;if(r){var l=0,u=new r(b),c=s.document.createTextNode("");u.observe(c,{characterData:!0}),a=function(){c.data=l=++l%2}}else if(!s.setImmediate&&typeof s.MessageChannel<"u"){var d=new s.MessageChannel;d.port1.onmessage=b,a=function(){d.port2.postMessage(0)}}else"document"in s&&"onreadystatechange"in s.document.createElement("script")?a=function(){var g=s.document.createElement("script");g.onreadystatechange=function(){b(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:a=function(){setTimeout(b,0)};var f,p=[];function b(){f=!0;for(var g,m,w=p.length;w;){for(m=p,p=[],g=-1;++g<w;)m[g]();w=p.length}f=!1}i.exports=y;function y(g){p.push(g)===1&&!f&&a()}}).call(this,typeof _n<"u"?_n:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,i,n){var s=e("immediate");function r(){}var a={},l=["REJECTED"],u=["FULFILLED"],c=["PENDING"];i.exports=d;function d(A){if(typeof A!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,A!==r&&y(this,A)}d.prototype.finally=function(A){if(typeof A!="function")return this;var T=this.constructor;return this.then(k,P);function k(F){function B(){return F}return T.resolve(A()).then(B)}function P(F){function B(){throw F}return T.resolve(A()).then(B)}},d.prototype.catch=function(A){return this.then(null,A)},d.prototype.then=function(A,T){if(typeof A!="function"&&this.state===u||typeof T!="function"&&this.state===l)return this;var k=new this.constructor(r);if(this.state!==c){var P=this.state===u?A:T;p(k,P,this.outcome)}else this.queue.push(new f(k,A,T));return k};function f(A,T,k){this.promise=A,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}f.prototype.callFulfilled=function(A){a.resolve(this.promise,A)},f.prototype.otherCallFulfilled=function(A){p(this.promise,this.onFulfilled,A)},f.prototype.callRejected=function(A){a.reject(this.promise,A)},f.prototype.otherCallRejected=function(A){p(this.promise,this.onRejected,A)};function p(A,T,k){s(function(){var P;try{P=T(k)}catch(F){return a.reject(A,F)}P===A?a.reject(A,new TypeError("Cannot resolve promise with itself")):a.resolve(A,P)})}a.resolve=function(A,T){var k=g(b,T);if(k.status==="error")return a.reject(A,k.value);var P=k.value;if(P)y(A,P);else{A.state=u,A.outcome=T;for(var F=-1,B=A.queue.length;++F<B;)A.queue[F].callFulfilled(T)}return A},a.reject=function(A,T){A.state=l,A.outcome=T;for(var k=-1,P=A.queue.length;++k<P;)A.queue[k].callRejected(T);return A};function b(A){var T=A&&A.then;if(A&&(typeof A=="object"||typeof A=="function")&&typeof T=="function")return function(){T.apply(A,arguments)}}function y(A,T){var k=!1;function P(G){k||(k=!0,a.reject(A,G))}function F(G){k||(k=!0,a.resolve(A,G))}function B(){T(F,P)}var W=g(B);W.status==="error"&&P(W.value)}function g(A,T){var k={};try{k.value=A(T),k.status="success"}catch(P){k.status="error",k.value=P}return k}d.resolve=m;function m(A){return A instanceof this?A:a.resolve(new this(r),A)}d.reject=w;function w(A){var T=new this(r);return a.reject(T,A)}d.all=E;function E(A){var T=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=A.length,P=!1;if(!k)return this.resolve([]);for(var F=new Array(k),B=0,W=-1,G=new this(r);++W<k;)et(A[W],W);return G;function et(ot,ct){T.resolve(ot).then(X,function(K){P||(P=!0,a.reject(G,K))});function X(K){F[ct]=K,++B===k&&!P&&(P=!0,a.resolve(G,F))}}}d.race=R;function R(A){var T=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=A.length,P=!1;if(!k)return this.resolve([]);for(var F=-1,B=new this(r);++F<k;)W(A[F]);return B;function W(G){T.resolve(G).then(function(et){P||(P=!0,a.resolve(B,et))},function(et){P||(P=!0,a.reject(B,et))})}}},{immediate:36}],38:[function(e,i,n){var s=e("./lib/utils/common").assign,r=e("./lib/deflate"),a=e("./lib/inflate"),l=e("./lib/zlib/constants"),u={};s(u,r,a,l),i.exports=u},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,i,n){var s=e("./zlib/deflate"),r=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),u=e("./zlib/zstream"),c=Object.prototype.toString,d=0,f=4,p=0,b=1,y=2,g=-1,m=0,w=8;function E(k){if(!(this instanceof E))return new E(k);this.options=r.assign({level:g,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:m,to:""},k||{});var P=this.options;P.raw&&P.windowBits>0?P.windowBits=-P.windowBits:P.gzip&&P.windowBits>0&&P.windowBits<16&&(P.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var F=s.deflateInit2(this.strm,P.level,P.method,P.windowBits,P.memLevel,P.strategy);if(F!==p)throw new Error(l[F]);if(P.header&&s.deflateSetHeader(this.strm,P.header),P.dictionary){var B;if(typeof P.dictionary=="string"?B=a.string2buf(P.dictionary):c.call(P.dictionary)==="[object ArrayBuffer]"?B=new Uint8Array(P.dictionary):B=P.dictionary,F=s.deflateSetDictionary(this.strm,B),F!==p)throw new Error(l[F]);this._dict_set=!0}}E.prototype.push=function(k,P){var F=this.strm,B=this.options.chunkSize,W,G;if(this.ended)return!1;G=P===~~P?P:P===!0?f:d,typeof k=="string"?F.input=a.string2buf(k):c.call(k)==="[object ArrayBuffer]"?F.input=new Uint8Array(k):F.input=k,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new r.Buf8(B),F.next_out=0,F.avail_out=B),W=s.deflate(F,G),W!==b&&W!==p)return this.onEnd(W),this.ended=!0,!1;(F.avail_out===0||F.avail_in===0&&(G===f||G===y))&&(this.options.to==="string"?this.onData(a.buf2binstring(r.shrinkBuf(F.output,F.next_out))):this.onData(r.shrinkBuf(F.output,F.next_out)))}while((F.avail_in>0||F.avail_out===0)&&W!==b);return G===f?(W=s.deflateEnd(this.strm),this.onEnd(W),this.ended=!0,W===p):(G===y&&(this.onEnd(p),F.avail_out=0),!0)},E.prototype.onData=function(k){this.chunks.push(k)},E.prototype.onEnd=function(k){k===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.msg=this.strm.msg};function R(k,P){var F=new E(P);if(F.push(k,!0),F.err)throw F.msg||l[F.err];return F.result}function A(k,P){return P=P||{},P.raw=!0,R(k,P)}function T(k,P){return P=P||{},P.gzip=!0,R(k,P)}n.Deflate=E,n.deflate=R,n.deflateRaw=A,n.gzip=T},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,i,n){var s=e("./zlib/inflate"),r=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),u=e("./zlib/messages"),c=e("./zlib/zstream"),d=e("./zlib/gzheader"),f=Object.prototype.toString;function p(g){if(!(this instanceof p))return new p(g);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},g||{});var m=this.options;m.raw&&m.windowBits>=0&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),m.windowBits>=0&&m.windowBits<16&&!(g&&g.windowBits)&&(m.windowBits+=32),m.windowBits>15&&m.windowBits<48&&(m.windowBits&15||(m.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,m.windowBits);if(w!==l.Z_OK)throw new Error(u[w]);this.header=new d,s.inflateGetHeader(this.strm,this.header)}p.prototype.push=function(g,m){var w=this.strm,E=this.options.chunkSize,R=this.options.dictionary,A,T,k,P,F,B,W=!1;if(this.ended)return!1;T=m===~~m?m:m===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?w.input=a.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?w.input=new Uint8Array(g):w.input=g,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new r.Buf8(E),w.next_out=0,w.avail_out=E),A=s.inflate(w,l.Z_NO_FLUSH),A===l.Z_NEED_DICT&&R&&(typeof R=="string"?B=a.string2buf(R):f.call(R)==="[object ArrayBuffer]"?B=new Uint8Array(R):B=R,A=s.inflateSetDictionary(this.strm,B)),A===l.Z_BUF_ERROR&&W===!0&&(A=l.Z_OK,W=!1),A!==l.Z_STREAM_END&&A!==l.Z_OK)return this.onEnd(A),this.ended=!0,!1;w.next_out&&(w.avail_out===0||A===l.Z_STREAM_END||w.avail_in===0&&(T===l.Z_FINISH||T===l.Z_SYNC_FLUSH))&&(this.options.to==="string"?(k=a.utf8border(w.output,w.next_out),P=w.next_out-k,F=a.buf2string(w.output,k),w.next_out=P,w.avail_out=E-P,P&&r.arraySet(w.output,w.output,k,P,0),this.onData(F)):this.onData(r.shrinkBuf(w.output,w.next_out))),w.avail_in===0&&w.avail_out===0&&(W=!0)}while((w.avail_in>0||w.avail_out===0)&&A!==l.Z_STREAM_END);return A===l.Z_STREAM_END&&(T=l.Z_FINISH),T===l.Z_FINISH?(A=s.inflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===l.Z_OK):(T===l.Z_SYNC_FLUSH&&(this.onEnd(l.Z_OK),w.avail_out=0),!0)},p.prototype.onData=function(g){this.chunks.push(g)},p.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg};function b(g,m){var w=new p(m);if(w.push(g,!0),w.err)throw w.msg||u[w.err];return w.result}function y(g,m){return m=m||{},m.raw=!0,b(g,m)}n.Inflate=p,n.inflate=b,n.inflateRaw=y,n.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,i,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var c=u.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(l[d]=c[d])}}return l},n.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var r={arraySet:function(l,u,c,d,f){if(u.subarray&&l.subarray){l.set(u.subarray(c,c+d),f);return}for(var p=0;p<d;p++)l[f+p]=u[c+p]},flattenChunks:function(l){var u,c,d,f,p,b;for(d=0,u=0,c=l.length;u<c;u++)d+=l[u].length;for(b=new Uint8Array(d),f=0,u=0,c=l.length;u<c;u++)p=l[u],b.set(p,f),f+=p.length;return b}},a={arraySet:function(l,u,c,d,f){for(var p=0;p<d;p++)l[f+p]=u[c+p]},flattenChunks:function(l){return[].concat.apply([],l)}};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(s)},{}],42:[function(e,i,n){var s=e("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new s.Buf8(256),u=0;u<256;u++)l[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;l[254]=l[254]=1,n.string2buf=function(d){var f,p,b,y,g,m=d.length,w=0;for(y=0;y<m;y++)p=d.charCodeAt(y),(p&64512)===55296&&y+1<m&&(b=d.charCodeAt(y+1),(b&64512)===56320&&(p=65536+(p-55296<<10)+(b-56320),y++)),w+=p<128?1:p<2048?2:p<65536?3:4;for(f=new s.Buf8(w),g=0,y=0;g<w;y++)p=d.charCodeAt(y),(p&64512)===55296&&y+1<m&&(b=d.charCodeAt(y+1),(b&64512)===56320&&(p=65536+(p-55296<<10)+(b-56320),y++)),p<128?f[g++]=p:p<2048?(f[g++]=192|p>>>6,f[g++]=128|p&63):p<65536?(f[g++]=224|p>>>12,f[g++]=128|p>>>6&63,f[g++]=128|p&63):(f[g++]=240|p>>>18,f[g++]=128|p>>>12&63,f[g++]=128|p>>>6&63,f[g++]=128|p&63);return f};function c(d,f){if(f<65537&&(d.subarray&&a||!d.subarray&&r))return String.fromCharCode.apply(null,s.shrinkBuf(d,f));for(var p="",b=0;b<f;b++)p+=String.fromCharCode(d[b]);return p}n.buf2binstring=function(d){return c(d,d.length)},n.binstring2buf=function(d){for(var f=new s.Buf8(d.length),p=0,b=f.length;p<b;p++)f[p]=d.charCodeAt(p);return f},n.buf2string=function(d,f){var p,b,y,g,m=f||d.length,w=new Array(m*2);for(b=0,p=0;p<m;){if(y=d[p++],y<128){w[b++]=y;continue}if(g=l[y],g>4){w[b++]=65533,p+=g-1;continue}for(y&=g===2?31:g===3?15:7;g>1&&p<m;)y=y<<6|d[p++]&63,g--;if(g>1){w[b++]=65533;continue}y<65536?w[b++]=y:(y-=65536,w[b++]=55296|y>>10&1023,w[b++]=56320|y&1023)}return c(w,b)},n.utf8border=function(d,f){var p;for(f=f||d.length,f>d.length&&(f=d.length),p=f-1;p>=0&&(d[p]&192)===128;)p--;return p<0||p===0?f:p+l[d[p]]>f?p:f}},{"./common":41}],43:[function(e,i,n){function s(r,a,l,u){for(var c=r&65535|0,d=r>>>16&65535|0,f=0;l!==0;){f=l>2e3?2e3:l,l-=f;do c=c+a[u++]|0,d=d+c|0;while(--f);c%=65521,d%=65521}return c|d<<16|0}i.exports=s},{}],44:[function(e,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,i,n){function s(){for(var l,u=[],c=0;c<256;c++){l=c;for(var d=0;d<8;d++)l=l&1?3988292384^l>>>1:l>>>1;u[c]=l}return u}var r=s();function a(l,u,c,d){var f=r,p=d+c;l^=-1;for(var b=d;b<p;b++)l=l>>>8^f[(l^u[b])&255];return l^-1}i.exports=a},{}],46:[function(e,i,n){var s=e("../utils/common"),r=e("./trees"),a=e("./adler32"),l=e("./crc32"),u=e("./messages"),c=0,d=1,f=3,p=4,b=5,y=0,g=1,m=-2,w=-3,E=-5,R=-1,A=1,T=2,k=3,P=4,F=0,B=2,W=8,G=9,et=15,ot=8,ct=29,X=256,K=X+1+ct,lt=30,Ct=19,xt=2*K+1,_t=15,at=3,At=258,Rt=At+at+1,Wt=32,Ft=42,St=69,Lt=73,_e=91,de=103,Jt=113,fe=666,Yt=1,qe=2,Se=3,Ii=4,Zt=3;function Fe(v,V){return v.msg=u[V],V}function xn(v){return(v<<1)-(v>4?9:0)}function li(v){for(var V=v.length;--V>=0;)v[V]=0}function Je(v){var V=v.state,$=V.pending;$>v.avail_out&&($=v.avail_out),$!==0&&(s.arraySet(v.output,V.pending_buf,V.pending_out,$,v.next_out),v.next_out+=$,V.pending_out+=$,v.total_out+=$,v.avail_out-=$,V.pending-=$,V.pending===0&&(V.pending_out=0))}function he(v,V){r._tr_flush_block(v,v.block_start>=0?v.block_start:-1,v.strstart-v.block_start,V),v.block_start=v.strstart,Je(v.strm)}function Mt(v,V){v.pending_buf[v.pending++]=V}function wi(v,V){v.pending_buf[v.pending++]=V>>>8&255,v.pending_buf[v.pending++]=V&255}function xs(v,V,$,D){var M=v.avail_in;return M>D&&(M=D),M===0?0:(v.avail_in-=M,s.arraySet(V,v.input,v.next_in,M,$),v.state.wrap===1?v.adler=a(v.adler,V,M,$):v.state.wrap===2&&(v.adler=l(v.adler,V,M,$)),v.next_in+=M,v.total_in+=M,M)}function Sn(v,V){var $=v.max_chain_length,D=v.strstart,M,q,bt=v.prev_length,dt=v.nice_match,ft=v.strstart>v.w_size-Rt?v.strstart-(v.w_size-Rt):0,jt=v.window,Dn=v.w_mask,pe=v.prev,qt=v.strstart+At,Ce=jt[D+bt-1],Ve=jt[D+bt];v.prev_length>=v.good_match&&($>>=2),dt>v.lookahead&&(dt=v.lookahead);do if(M=V,!(jt[M+bt]!==Ve||jt[M+bt-1]!==Ce||jt[M]!==jt[D]||jt[++M]!==jt[D+1])){D+=2,M++;do;while(jt[++D]===jt[++M]&&jt[++D]===jt[++M]&&jt[++D]===jt[++M]&&jt[++D]===jt[++M]&&jt[++D]===jt[++M]&&jt[++D]===jt[++M]&&jt[++D]===jt[++M]&&jt[++D]===jt[++M]&&D<qt);if(q=At-(qt-D),D=qt-At,q>bt){if(v.match_start=V,bt=q,q>=dt)break;Ce=jt[D+bt-1],Ve=jt[D+bt]}}while((V=pe[V&Dn])>ft&&--$!==0);return bt<=v.lookahead?bt:v.lookahead}function _i(v){var V=v.w_size,$,D,M,q,bt;do{if(q=v.window_size-v.lookahead-v.strstart,v.strstart>=V+(V-Rt)){s.arraySet(v.window,v.window,V,V,0),v.match_start-=V,v.strstart-=V,v.block_start-=V,D=v.hash_size,$=D;do M=v.head[--$],v.head[$]=M>=V?M-V:0;while(--D);D=V,$=D;do M=v.prev[--$],v.prev[$]=M>=V?M-V:0;while(--D);q+=V}if(v.strm.avail_in===0)break;if(D=xs(v.strm,v.window,v.strstart+v.lookahead,q),v.lookahead+=D,v.lookahead+v.insert>=at)for(bt=v.strstart-v.insert,v.ins_h=v.window[bt],v.ins_h=(v.ins_h<<v.hash_shift^v.window[bt+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[bt+at-1])&v.hash_mask,v.prev[bt&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=bt,bt++,v.insert--,!(v.lookahead+v.insert<at)););}while(v.lookahead<Rt&&v.strm.avail_in!==0)}function Ss(v,V){var $=65535;for($>v.pending_buf_size-5&&($=v.pending_buf_size-5);;){if(v.lookahead<=1){if(_i(v),v.lookahead===0&&V===c)return Yt;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var D=v.block_start+$;if((v.strstart===0||v.strstart>=D)&&(v.lookahead=v.strstart-D,v.strstart=D,he(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-Rt&&(he(v,!1),v.strm.avail_out===0))return Yt}return v.insert=0,V===p?(he(v,!0),v.strm.avail_out===0?Se:Ii):(v.strstart>v.block_start&&(he(v,!1),v.strm.avail_out===0),Yt)}function Cn(v,V){for(var $,D;;){if(v.lookahead<Rt){if(_i(v),v.lookahead<Rt&&V===c)return Yt;if(v.lookahead===0)break}if($=0,v.lookahead>=at&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+at-1])&v.hash_mask,$=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),$!==0&&v.strstart-$<=v.w_size-Rt&&(v.match_length=Sn(v,$)),v.match_length>=at)if(D=r._tr_tally(v,v.strstart-v.match_start,v.match_length-at),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=at){v.match_length--;do v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+at-1])&v.hash_mask,$=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart;while(--v.match_length!==0);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else D=r._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(D&&(he(v,!1),v.strm.avail_out===0))return Yt}return v.insert=v.strstart<at-1?v.strstart:at-1,V===p?(he(v,!0),v.strm.avail_out===0?Se:Ii):v.last_lit&&(he(v,!1),v.strm.avail_out===0)?Yt:qe}function Li(v,V){for(var $,D,M;;){if(v.lookahead<Rt){if(_i(v),v.lookahead<Rt&&V===c)return Yt;if(v.lookahead===0)break}if($=0,v.lookahead>=at&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+at-1])&v.hash_mask,$=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=at-1,$!==0&&v.prev_length<v.max_lazy_match&&v.strstart-$<=v.w_size-Rt&&(v.match_length=Sn(v,$),v.match_length<=5&&(v.strategy===A||v.match_length===at&&v.strstart-v.match_start>4096)&&(v.match_length=at-1)),v.prev_length>=at&&v.match_length<=v.prev_length){M=v.strstart+v.lookahead-at,D=r._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-at),v.lookahead-=v.prev_length-1,v.prev_length-=2;do++v.strstart<=M&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+at-1])&v.hash_mask,$=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart);while(--v.prev_length!==0);if(v.match_available=0,v.match_length=at-1,v.strstart++,D&&(he(v,!1),v.strm.avail_out===0))return Yt}else if(v.match_available){if(D=r._tr_tally(v,0,v.window[v.strstart-1]),D&&he(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return Yt}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(D=r._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<at-1?v.strstart:at-1,V===p?(he(v,!0),v.strm.avail_out===0?Se:Ii):v.last_lit&&(he(v,!1),v.strm.avail_out===0)?Yt:qe}function Cs(v,V){for(var $,D,M,q,bt=v.window;;){if(v.lookahead<=At){if(_i(v),v.lookahead<=At&&V===c)return Yt;if(v.lookahead===0)break}if(v.match_length=0,v.lookahead>=at&&v.strstart>0&&(M=v.strstart-1,D=bt[M],D===bt[++M]&&D===bt[++M]&&D===bt[++M])){q=v.strstart+At;do;while(D===bt[++M]&&D===bt[++M]&&D===bt[++M]&&D===bt[++M]&&D===bt[++M]&&D===bt[++M]&&D===bt[++M]&&D===bt[++M]&&M<q);v.match_length=At-(q-M),v.match_length>v.lookahead&&(v.match_length=v.lookahead)}if(v.match_length>=at?($=r._tr_tally(v,1,v.match_length-at),v.lookahead-=v.match_length,v.strstart+=v.match_length,v.match_length=0):($=r._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++),$&&(he(v,!1),v.strm.avail_out===0))return Yt}return v.insert=0,V===p?(he(v,!0),v.strm.avail_out===0?Se:Ii):v.last_lit&&(he(v,!1),v.strm.avail_out===0)?Yt:qe}function Tn(v,V){for(var $;;){if(v.lookahead===0&&(_i(v),v.lookahead===0)){if(V===c)return Yt;break}if(v.match_length=0,$=r._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++,$&&(he(v,!1),v.strm.avail_out===0))return Yt}return v.insert=0,V===p?(he(v,!0),v.strm.avail_out===0?Se:Ii):v.last_lit&&(he(v,!1),v.strm.avail_out===0)?Yt:qe}function Me(v,V,$,D,M){this.good_length=v,this.max_lazy=V,this.nice_length=$,this.max_chain=D,this.func=M}var Pi;Pi=[new Me(0,0,0,0,Ss),new Me(4,4,8,4,Cn),new Me(4,5,16,8,Cn),new Me(4,6,32,32,Cn),new Me(4,4,16,16,Li),new Me(8,16,32,32,Li),new Me(8,16,128,128,Li),new Me(8,32,128,256,Li),new Me(32,128,258,1024,Li),new Me(32,258,258,4096,Li)];function pr(v){v.window_size=2*v.w_size,li(v.head),v.max_lazy_match=Pi[v.level].max_lazy,v.good_match=Pi[v.level].good_length,v.nice_match=Pi[v.level].nice_length,v.max_chain_length=Pi[v.level].max_chain,v.strstart=0,v.block_start=0,v.lookahead=0,v.insert=0,v.match_length=v.prev_length=at-1,v.match_available=0,v.ins_h=0}function L(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=W,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(xt*2),this.dyn_dtree=new s.Buf16((2*lt+1)*2),this.bl_tree=new s.Buf16((2*Ct+1)*2),li(this.dyn_ltree),li(this.dyn_dtree),li(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(_t+1),this.heap=new s.Buf16(2*K+1),li(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*K+1),li(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Q(v){var V;return!v||!v.state?Fe(v,m):(v.total_in=v.total_out=0,v.data_type=B,V=v.state,V.pending=0,V.pending_out=0,V.wrap<0&&(V.wrap=-V.wrap),V.status=V.wrap?Ft:Jt,v.adler=V.wrap===2?0:1,V.last_flush=c,r._tr_init(V),y)}function it(v){var V=Q(v);return V===y&&pr(v.state),V}function pt(v,V){return!v||!v.state||v.state.wrap!==2?m:(v.state.gzhead=V,y)}function z(v,V,$,D,M,q){if(!v)return m;var bt=1;if(V===R&&(V=6),D<0?(bt=0,D=-D):D>15&&(bt=2,D-=16),M<1||M>G||$!==W||D<8||D>15||V<0||V>9||q<0||q>P)return Fe(v,m);D===8&&(D=9);var dt=new L;return v.state=dt,dt.strm=v,dt.wrap=bt,dt.gzhead=null,dt.w_bits=D,dt.w_size=1<<dt.w_bits,dt.w_mask=dt.w_size-1,dt.hash_bits=M+7,dt.hash_size=1<<dt.hash_bits,dt.hash_mask=dt.hash_size-1,dt.hash_shift=~~((dt.hash_bits+at-1)/at),dt.window=new s.Buf8(dt.w_size*2),dt.head=new s.Buf16(dt.hash_size),dt.prev=new s.Buf16(dt.w_size),dt.lit_bufsize=1<<M+6,dt.pending_buf_size=dt.lit_bufsize*4,dt.pending_buf=new s.Buf8(dt.pending_buf_size),dt.d_buf=1*dt.lit_bufsize,dt.l_buf=3*dt.lit_bufsize,dt.level=V,dt.strategy=q,dt.method=$,it(v)}function Y(v,V){return z(v,V,W,et,ot,F)}function S(v,V){var $,D,M,q;if(!v||!v.state||V>b||V<0)return v?Fe(v,m):m;if(D=v.state,!v.output||!v.input&&v.avail_in!==0||D.status===fe&&V!==p)return Fe(v,v.avail_out===0?E:m);if(D.strm=v,$=D.last_flush,D.last_flush=V,D.status===Ft)if(D.wrap===2)v.adler=0,Mt(D,31),Mt(D,139),Mt(D,8),D.gzhead?(Mt(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),Mt(D,D.gzhead.time&255),Mt(D,D.gzhead.time>>8&255),Mt(D,D.gzhead.time>>16&255),Mt(D,D.gzhead.time>>24&255),Mt(D,D.level===9?2:D.strategy>=T||D.level<2?4:0),Mt(D,D.gzhead.os&255),D.gzhead.extra&&D.gzhead.extra.length&&(Mt(D,D.gzhead.extra.length&255),Mt(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(v.adler=l(v.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=St):(Mt(D,0),Mt(D,0),Mt(D,0),Mt(D,0),Mt(D,0),Mt(D,D.level===9?2:D.strategy>=T||D.level<2?4:0),Mt(D,Zt),D.status=Jt);else{var bt=W+(D.w_bits-8<<4)<<8,dt=-1;D.strategy>=T||D.level<2?dt=0:D.level<6?dt=1:D.level===6?dt=2:dt=3,bt|=dt<<6,D.strstart!==0&&(bt|=Wt),bt+=31-bt%31,D.status=Jt,wi(D,bt),D.strstart!==0&&(wi(D,v.adler>>>16),wi(D,v.adler&65535)),v.adler=1}if(D.status===St)if(D.gzhead.extra){for(M=D.pending;D.gzindex<(D.gzhead.extra.length&65535)&&!(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>M&&(v.adler=l(v.adler,D.pending_buf,D.pending-M,M)),Je(v),M=D.pending,D.pending===D.pending_buf_size));)Mt(D,D.gzhead.extra[D.gzindex]&255),D.gzindex++;D.gzhead.hcrc&&D.pending>M&&(v.adler=l(v.adler,D.pending_buf,D.pending-M,M)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=Lt)}else D.status=Lt;if(D.status===Lt)if(D.gzhead.name){M=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>M&&(v.adler=l(v.adler,D.pending_buf,D.pending-M,M)),Je(v),M=D.pending,D.pending===D.pending_buf_size)){q=1;break}D.gzindex<D.gzhead.name.length?q=D.gzhead.name.charCodeAt(D.gzindex++)&255:q=0,Mt(D,q)}while(q!==0);D.gzhead.hcrc&&D.pending>M&&(v.adler=l(v.adler,D.pending_buf,D.pending-M,M)),q===0&&(D.gzindex=0,D.status=_e)}else D.status=_e;if(D.status===_e)if(D.gzhead.comment){M=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>M&&(v.adler=l(v.adler,D.pending_buf,D.pending-M,M)),Je(v),M=D.pending,D.pending===D.pending_buf_size)){q=1;break}D.gzindex<D.gzhead.comment.length?q=D.gzhead.comment.charCodeAt(D.gzindex++)&255:q=0,Mt(D,q)}while(q!==0);D.gzhead.hcrc&&D.pending>M&&(v.adler=l(v.adler,D.pending_buf,D.pending-M,M)),q===0&&(D.status=de)}else D.status=de;if(D.status===de&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&Je(v),D.pending+2<=D.pending_buf_size&&(Mt(D,v.adler&255),Mt(D,v.adler>>8&255),v.adler=0,D.status=Jt)):D.status=Jt),D.pending!==0){if(Je(v),v.avail_out===0)return D.last_flush=-1,y}else if(v.avail_in===0&&xn(V)<=xn($)&&V!==p)return Fe(v,E);if(D.status===fe&&v.avail_in!==0)return Fe(v,E);if(v.avail_in!==0||D.lookahead!==0||V!==c&&D.status!==fe){var ft=D.strategy===T?Tn(D,V):D.strategy===k?Cs(D,V):Pi[D.level].func(D,V);if((ft===Se||ft===Ii)&&(D.status=fe),ft===Yt||ft===Se)return v.avail_out===0&&(D.last_flush=-1),y;if(ft===qe&&(V===d?r._tr_align(D):V!==b&&(r._tr_stored_block(D,0,0,!1),V===f&&(li(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),Je(v),v.avail_out===0))return D.last_flush=-1,y}return V!==p?y:D.wrap<=0?g:(D.wrap===2?(Mt(D,v.adler&255),Mt(D,v.adler>>8&255),Mt(D,v.adler>>16&255),Mt(D,v.adler>>24&255),Mt(D,v.total_in&255),Mt(D,v.total_in>>8&255),Mt(D,v.total_in>>16&255),Mt(D,v.total_in>>24&255)):(wi(D,v.adler>>>16),wi(D,v.adler&65535)),Je(v),D.wrap>0&&(D.wrap=-D.wrap),D.pending!==0?y:g)}function J(v){var V;return!v||!v.state?m:(V=v.state.status,V!==Ft&&V!==St&&V!==Lt&&V!==_e&&V!==de&&V!==Jt&&V!==fe?Fe(v,m):(v.state=null,V===Jt?Fe(v,w):y))}function Tt(v,V){var $=V.length,D,M,q,bt,dt,ft,jt,Dn;if(!v||!v.state||(D=v.state,bt=D.wrap,bt===2||bt===1&&D.status!==Ft||D.lookahead))return m;for(bt===1&&(v.adler=a(v.adler,V,$,0)),D.wrap=0,$>=D.w_size&&(bt===0&&(li(D.head),D.strstart=0,D.block_start=0,D.insert=0),Dn=new s.Buf8(D.w_size),s.arraySet(Dn,V,$-D.w_size,D.w_size,0),V=Dn,$=D.w_size),dt=v.avail_in,ft=v.next_in,jt=v.input,v.avail_in=$,v.next_in=0,v.input=V,_i(D);D.lookahead>=at;){M=D.strstart,q=D.lookahead-(at-1);do D.ins_h=(D.ins_h<<D.hash_shift^D.window[M+at-1])&D.hash_mask,D.prev[M&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=M,M++;while(--q);D.strstart=M,D.lookahead=at-1,_i(D)}return D.strstart+=D.lookahead,D.block_start=D.strstart,D.insert=D.lookahead,D.lookahead=0,D.match_length=D.prev_length=at-1,D.match_available=0,v.next_in=ft,v.input=jt,v.avail_in=dt,D.wrap=bt,y}n.deflateInit=Y,n.deflateInit2=z,n.deflateReset=it,n.deflateResetKeep=Q,n.deflateSetHeader=pt,n.deflate=S,n.deflateEnd=J,n.deflateSetDictionary=Tt,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,i,n){function s(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}i.exports=s},{}],48:[function(e,i,n){var s=30,r=12;i.exports=function(l,u){var c,d,f,p,b,y,g,m,w,E,R,A,T,k,P,F,B,W,G,et,ot,ct,X,K,lt;c=l.state,d=l.next_in,K=l.input,f=d+(l.avail_in-5),p=l.next_out,lt=l.output,b=p-(u-l.avail_out),y=p+(l.avail_out-257),g=c.dmax,m=c.wsize,w=c.whave,E=c.wnext,R=c.window,A=c.hold,T=c.bits,k=c.lencode,P=c.distcode,F=(1<<c.lenbits)-1,B=(1<<c.distbits)-1;t:do{T<15&&(A+=K[d++]<<T,T+=8,A+=K[d++]<<T,T+=8),W=k[A&F];e:for(;;){if(G=W>>>24,A>>>=G,T-=G,G=W>>>16&255,G===0)lt[p++]=W&65535;else if(G&16){et=W&65535,G&=15,G&&(T<G&&(A+=K[d++]<<T,T+=8),et+=A&(1<<G)-1,A>>>=G,T-=G),T<15&&(A+=K[d++]<<T,T+=8,A+=K[d++]<<T,T+=8),W=P[A&B];i:for(;;){if(G=W>>>24,A>>>=G,T-=G,G=W>>>16&255,G&16){if(ot=W&65535,G&=15,T<G&&(A+=K[d++]<<T,T+=8,T<G&&(A+=K[d++]<<T,T+=8)),ot+=A&(1<<G)-1,ot>g){l.msg="invalid distance too far back",c.mode=s;break t}if(A>>>=G,T-=G,G=p-b,ot>G){if(G=ot-G,G>w&&c.sane){l.msg="invalid distance too far back",c.mode=s;break t}if(ct=0,X=R,E===0){if(ct+=m-G,G<et){et-=G;do lt[p++]=R[ct++];while(--G);ct=p-ot,X=lt}}else if(E<G){if(ct+=m+E-G,G-=E,G<et){et-=G;do lt[p++]=R[ct++];while(--G);if(ct=0,E<et){G=E,et-=G;do lt[p++]=R[ct++];while(--G);ct=p-ot,X=lt}}}else if(ct+=E-G,G<et){et-=G;do lt[p++]=R[ct++];while(--G);ct=p-ot,X=lt}for(;et>2;)lt[p++]=X[ct++],lt[p++]=X[ct++],lt[p++]=X[ct++],et-=3;et&&(lt[p++]=X[ct++],et>1&&(lt[p++]=X[ct++]))}else{ct=p-ot;do lt[p++]=lt[ct++],lt[p++]=lt[ct++],lt[p++]=lt[ct++],et-=3;while(et>2);et&&(lt[p++]=lt[ct++],et>1&&(lt[p++]=lt[ct++]))}}else if(G&64){l.msg="invalid distance code",c.mode=s;break t}else{W=P[(W&65535)+(A&(1<<G)-1)];continue i}break}}else if(G&64)if(G&32){c.mode=r;break t}else{l.msg="invalid literal/length code",c.mode=s;break t}else{W=k[(W&65535)+(A&(1<<G)-1)];continue e}break}}while(d<f&&p<y);et=T>>3,d-=et,T-=et<<3,A&=(1<<T)-1,l.next_in=d,l.next_out=p,l.avail_in=d<f?5+(f-d):5-(d-f),l.avail_out=p<y?257+(y-p):257-(p-y),c.hold=A,c.bits=T}},{}],49:[function(e,i,n){var s=e("../utils/common"),r=e("./adler32"),a=e("./crc32"),l=e("./inffast"),u=e("./inftrees"),c=0,d=1,f=2,p=4,b=5,y=6,g=0,m=1,w=2,E=-2,R=-3,A=-4,T=-5,k=8,P=1,F=2,B=3,W=4,G=5,et=6,ot=7,ct=8,X=9,K=10,lt=11,Ct=12,xt=13,_t=14,at=15,At=16,Rt=17,Wt=18,Ft=19,St=20,Lt=21,_e=22,de=23,Jt=24,fe=25,Yt=26,qe=27,Se=28,Ii=29,Zt=30,Fe=31,xn=32,li=852,Je=592,he=15,Mt=he;function wi(z){return(z>>>24&255)+(z>>>8&65280)+((z&65280)<<8)+((z&255)<<24)}function xs(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Sn(z){var Y;return!z||!z.state?E:(Y=z.state,z.total_in=z.total_out=Y.total=0,z.msg="",Y.wrap&&(z.adler=Y.wrap&1),Y.mode=P,Y.last=0,Y.havedict=0,Y.dmax=32768,Y.head=null,Y.hold=0,Y.bits=0,Y.lencode=Y.lendyn=new s.Buf32(li),Y.distcode=Y.distdyn=new s.Buf32(Je),Y.sane=1,Y.back=-1,g)}function _i(z){var Y;return!z||!z.state?E:(Y=z.state,Y.wsize=0,Y.whave=0,Y.wnext=0,Sn(z))}function Ss(z,Y){var S,J;return!z||!z.state||(J=z.state,Y<0?(S=0,Y=-Y):(S=(Y>>4)+1,Y<48&&(Y&=15)),Y&&(Y<8||Y>15))?E:(J.window!==null&&J.wbits!==Y&&(J.window=null),J.wrap=S,J.wbits=Y,_i(z))}function Cn(z,Y){var S,J;return z?(J=new xs,z.state=J,J.window=null,S=Ss(z,Y),S!==g&&(z.state=null),S):E}function Li(z){return Cn(z,Mt)}var Cs=!0,Tn,Me;function Pi(z){if(Cs){var Y;for(Tn=new s.Buf32(512),Me=new s.Buf32(32),Y=0;Y<144;)z.lens[Y++]=8;for(;Y<256;)z.lens[Y++]=9;for(;Y<280;)z.lens[Y++]=7;for(;Y<288;)z.lens[Y++]=8;for(u(d,z.lens,0,288,Tn,0,z.work,{bits:9}),Y=0;Y<32;)z.lens[Y++]=5;u(f,z.lens,0,32,Me,0,z.work,{bits:5}),Cs=!1}z.lencode=Tn,z.lenbits=9,z.distcode=Me,z.distbits=5}function pr(z,Y,S,J){var Tt,v=z.state;return v.window===null&&(v.wsize=1<<v.wbits,v.wnext=0,v.whave=0,v.window=new s.Buf8(v.wsize)),J>=v.wsize?(s.arraySet(v.window,Y,S-v.wsize,v.wsize,0),v.wnext=0,v.whave=v.wsize):(Tt=v.wsize-v.wnext,Tt>J&&(Tt=J),s.arraySet(v.window,Y,S-J,Tt,v.wnext),J-=Tt,J?(s.arraySet(v.window,Y,S-J,J,0),v.wnext=J,v.whave=v.wsize):(v.wnext+=Tt,v.wnext===v.wsize&&(v.wnext=0),v.whave<v.wsize&&(v.whave+=Tt))),0}function L(z,Y){var S,J,Tt,v,V,$,D,M,q,bt,dt,ft,jt,Dn,pe=0,qt,Ce,Ve,hi,_o,Ao,Ae,Ni,Be=new s.Buf8(4),kn,ln,Sc=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!z||!z.state||!z.output||!z.input&&z.avail_in!==0)return E;S=z.state,S.mode===Ct&&(S.mode=xt),V=z.next_out,Tt=z.output,D=z.avail_out,v=z.next_in,J=z.input,$=z.avail_in,M=S.hold,q=S.bits,bt=$,dt=D,Ni=g;t:for(;;)switch(S.mode){case P:if(S.wrap===0){S.mode=xt;break}for(;q<16;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if(S.wrap&2&&M===35615){S.check=0,Be[0]=M&255,Be[1]=M>>>8&255,S.check=a(S.check,Be,2,0),M=0,q=0,S.mode=F;break}if(S.flags=0,S.head&&(S.head.done=!1),!(S.wrap&1)||(((M&255)<<8)+(M>>8))%31){z.msg="incorrect header check",S.mode=Zt;break}if((M&15)!==k){z.msg="unknown compression method",S.mode=Zt;break}if(M>>>=4,q-=4,Ae=(M&15)+8,S.wbits===0)S.wbits=Ae;else if(Ae>S.wbits){z.msg="invalid window size",S.mode=Zt;break}S.dmax=1<<Ae,z.adler=S.check=1,S.mode=M&512?K:Ct,M=0,q=0;break;case F:for(;q<16;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if(S.flags=M,(S.flags&255)!==k){z.msg="unknown compression method",S.mode=Zt;break}if(S.flags&57344){z.msg="unknown header flags set",S.mode=Zt;break}S.head&&(S.head.text=M>>8&1),S.flags&512&&(Be[0]=M&255,Be[1]=M>>>8&255,S.check=a(S.check,Be,2,0)),M=0,q=0,S.mode=B;case B:for(;q<32;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}S.head&&(S.head.time=M),S.flags&512&&(Be[0]=M&255,Be[1]=M>>>8&255,Be[2]=M>>>16&255,Be[3]=M>>>24&255,S.check=a(S.check,Be,4,0)),M=0,q=0,S.mode=W;case W:for(;q<16;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}S.head&&(S.head.xflags=M&255,S.head.os=M>>8),S.flags&512&&(Be[0]=M&255,Be[1]=M>>>8&255,S.check=a(S.check,Be,2,0)),M=0,q=0,S.mode=G;case G:if(S.flags&1024){for(;q<16;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}S.length=M,S.head&&(S.head.extra_len=M),S.flags&512&&(Be[0]=M&255,Be[1]=M>>>8&255,S.check=a(S.check,Be,2,0)),M=0,q=0}else S.head&&(S.head.extra=null);S.mode=et;case et:if(S.flags&1024&&(ft=S.length,ft>$&&(ft=$),ft&&(S.head&&(Ae=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),s.arraySet(S.head.extra,J,v,ft,Ae)),S.flags&512&&(S.check=a(S.check,J,ft,v)),$-=ft,v+=ft,S.length-=ft),S.length))break t;S.length=0,S.mode=ot;case ot:if(S.flags&2048){if($===0)break t;ft=0;do Ae=J[v+ft++],S.head&&Ae&&S.length<65536&&(S.head.name+=String.fromCharCode(Ae));while(Ae&&ft<$);if(S.flags&512&&(S.check=a(S.check,J,ft,v)),$-=ft,v+=ft,Ae)break t}else S.head&&(S.head.name=null);S.length=0,S.mode=ct;case ct:if(S.flags&4096){if($===0)break t;ft=0;do Ae=J[v+ft++],S.head&&Ae&&S.length<65536&&(S.head.comment+=String.fromCharCode(Ae));while(Ae&&ft<$);if(S.flags&512&&(S.check=a(S.check,J,ft,v)),$-=ft,v+=ft,Ae)break t}else S.head&&(S.head.comment=null);S.mode=X;case X:if(S.flags&512){for(;q<16;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if(M!==(S.check&65535)){z.msg="header crc mismatch",S.mode=Zt;break}M=0,q=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),z.adler=S.check=0,S.mode=Ct;break;case K:for(;q<32;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}z.adler=S.check=wi(M),M=0,q=0,S.mode=lt;case lt:if(S.havedict===0)return z.next_out=V,z.avail_out=D,z.next_in=v,z.avail_in=$,S.hold=M,S.bits=q,w;z.adler=S.check=1,S.mode=Ct;case Ct:if(Y===b||Y===y)break t;case xt:if(S.last){M>>>=q&7,q-=q&7,S.mode=qe;break}for(;q<3;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}switch(S.last=M&1,M>>>=1,q-=1,M&3){case 0:S.mode=_t;break;case 1:if(Pi(S),S.mode=St,Y===y){M>>>=2,q-=2;break t}break;case 2:S.mode=Rt;break;case 3:z.msg="invalid block type",S.mode=Zt}M>>>=2,q-=2;break;case _t:for(M>>>=q&7,q-=q&7;q<32;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if((M&65535)!==(M>>>16^65535)){z.msg="invalid stored block lengths",S.mode=Zt;break}if(S.length=M&65535,M=0,q=0,S.mode=at,Y===y)break t;case at:S.mode=At;case At:if(ft=S.length,ft){if(ft>$&&(ft=$),ft>D&&(ft=D),ft===0)break t;s.arraySet(Tt,J,v,ft,V),$-=ft,v+=ft,D-=ft,V+=ft,S.length-=ft;break}S.mode=Ct;break;case Rt:for(;q<14;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if(S.nlen=(M&31)+257,M>>>=5,q-=5,S.ndist=(M&31)+1,M>>>=5,q-=5,S.ncode=(M&15)+4,M>>>=4,q-=4,S.nlen>286||S.ndist>30){z.msg="too many length or distance symbols",S.mode=Zt;break}S.have=0,S.mode=Wt;case Wt:for(;S.have<S.ncode;){for(;q<3;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}S.lens[Sc[S.have++]]=M&7,M>>>=3,q-=3}for(;S.have<19;)S.lens[Sc[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,kn={bits:S.lenbits},Ni=u(c,S.lens,0,19,S.lencode,0,S.work,kn),S.lenbits=kn.bits,Ni){z.msg="invalid code lengths set",S.mode=Zt;break}S.have=0,S.mode=Ft;case Ft:for(;S.have<S.nlen+S.ndist;){for(;pe=S.lencode[M&(1<<S.lenbits)-1],qt=pe>>>24,Ce=pe>>>16&255,Ve=pe&65535,!(qt<=q);){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if(Ve<16)M>>>=qt,q-=qt,S.lens[S.have++]=Ve;else{if(Ve===16){for(ln=qt+2;q<ln;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if(M>>>=qt,q-=qt,S.have===0){z.msg="invalid bit length repeat",S.mode=Zt;break}Ae=S.lens[S.have-1],ft=3+(M&3),M>>>=2,q-=2}else if(Ve===17){for(ln=qt+3;q<ln;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}M>>>=qt,q-=qt,Ae=0,ft=3+(M&7),M>>>=3,q-=3}else{for(ln=qt+7;q<ln;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}M>>>=qt,q-=qt,Ae=0,ft=11+(M&127),M>>>=7,q-=7}if(S.have+ft>S.nlen+S.ndist){z.msg="invalid bit length repeat",S.mode=Zt;break}for(;ft--;)S.lens[S.have++]=Ae}}if(S.mode===Zt)break;if(S.lens[256]===0){z.msg="invalid code -- missing end-of-block",S.mode=Zt;break}if(S.lenbits=9,kn={bits:S.lenbits},Ni=u(d,S.lens,0,S.nlen,S.lencode,0,S.work,kn),S.lenbits=kn.bits,Ni){z.msg="invalid literal/lengths set",S.mode=Zt;break}if(S.distbits=6,S.distcode=S.distdyn,kn={bits:S.distbits},Ni=u(f,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,kn),S.distbits=kn.bits,Ni){z.msg="invalid distances set",S.mode=Zt;break}if(S.mode=St,Y===y)break t;case St:S.mode=Lt;case Lt:if($>=6&&D>=258){z.next_out=V,z.avail_out=D,z.next_in=v,z.avail_in=$,S.hold=M,S.bits=q,l(z,dt),V=z.next_out,Tt=z.output,D=z.avail_out,v=z.next_in,J=z.input,$=z.avail_in,M=S.hold,q=S.bits,S.mode===Ct&&(S.back=-1);break}for(S.back=0;pe=S.lencode[M&(1<<S.lenbits)-1],qt=pe>>>24,Ce=pe>>>16&255,Ve=pe&65535,!(qt<=q);){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if(Ce&&!(Ce&240)){for(hi=qt,_o=Ce,Ao=Ve;pe=S.lencode[Ao+((M&(1<<hi+_o)-1)>>hi)],qt=pe>>>24,Ce=pe>>>16&255,Ve=pe&65535,!(hi+qt<=q);){if($===0)break t;$--,M+=J[v++]<<q,q+=8}M>>>=hi,q-=hi,S.back+=hi}if(M>>>=qt,q-=qt,S.back+=qt,S.length=Ve,Ce===0){S.mode=Yt;break}if(Ce&32){S.back=-1,S.mode=Ct;break}if(Ce&64){z.msg="invalid literal/length code",S.mode=Zt;break}S.extra=Ce&15,S.mode=_e;case _e:if(S.extra){for(ln=S.extra;q<ln;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}S.length+=M&(1<<S.extra)-1,M>>>=S.extra,q-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=de;case de:for(;pe=S.distcode[M&(1<<S.distbits)-1],qt=pe>>>24,Ce=pe>>>16&255,Ve=pe&65535,!(qt<=q);){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if(!(Ce&240)){for(hi=qt,_o=Ce,Ao=Ve;pe=S.distcode[Ao+((M&(1<<hi+_o)-1)>>hi)],qt=pe>>>24,Ce=pe>>>16&255,Ve=pe&65535,!(hi+qt<=q);){if($===0)break t;$--,M+=J[v++]<<q,q+=8}M>>>=hi,q-=hi,S.back+=hi}if(M>>>=qt,q-=qt,S.back+=qt,Ce&64){z.msg="invalid distance code",S.mode=Zt;break}S.offset=Ve,S.extra=Ce&15,S.mode=Jt;case Jt:if(S.extra){for(ln=S.extra;q<ln;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}S.offset+=M&(1<<S.extra)-1,M>>>=S.extra,q-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){z.msg="invalid distance too far back",S.mode=Zt;break}S.mode=fe;case fe:if(D===0)break t;if(ft=dt-D,S.offset>ft){if(ft=S.offset-ft,ft>S.whave&&S.sane){z.msg="invalid distance too far back",S.mode=Zt;break}ft>S.wnext?(ft-=S.wnext,jt=S.wsize-ft):jt=S.wnext-ft,ft>S.length&&(ft=S.length),Dn=S.window}else Dn=Tt,jt=V-S.offset,ft=S.length;ft>D&&(ft=D),D-=ft,S.length-=ft;do Tt[V++]=Dn[jt++];while(--ft);S.length===0&&(S.mode=Lt);break;case Yt:if(D===0)break t;Tt[V++]=S.length,D--,S.mode=Lt;break;case qe:if(S.wrap){for(;q<32;){if($===0)break t;$--,M|=J[v++]<<q,q+=8}if(dt-=D,z.total_out+=dt,S.total+=dt,dt&&(z.adler=S.check=S.flags?a(S.check,Tt,dt,V-dt):r(S.check,Tt,dt,V-dt)),dt=D,(S.flags?M:wi(M))!==S.check){z.msg="incorrect data check",S.mode=Zt;break}M=0,q=0}S.mode=Se;case Se:if(S.wrap&&S.flags){for(;q<32;){if($===0)break t;$--,M+=J[v++]<<q,q+=8}if(M!==(S.total&4294967295)){z.msg="incorrect length check",S.mode=Zt;break}M=0,q=0}S.mode=Ii;case Ii:Ni=m;break t;case Zt:Ni=R;break t;case Fe:return A;case xn:default:return E}return z.next_out=V,z.avail_out=D,z.next_in=v,z.avail_in=$,S.hold=M,S.bits=q,(S.wsize||dt!==z.avail_out&&S.mode<Zt&&(S.mode<qe||Y!==p))&&pr(z,z.output,z.next_out,dt-z.avail_out),bt-=z.avail_in,dt-=z.avail_out,z.total_in+=bt,z.total_out+=dt,S.total+=dt,S.wrap&&dt&&(z.adler=S.check=S.flags?a(S.check,Tt,dt,z.next_out-dt):r(S.check,Tt,dt,z.next_out-dt)),z.data_type=S.bits+(S.last?64:0)+(S.mode===Ct?128:0)+(S.mode===St||S.mode===at?256:0),(bt===0&&dt===0||Y===p)&&Ni===g&&(Ni=T),Ni}function Q(z){if(!z||!z.state)return E;var Y=z.state;return Y.window&&(Y.window=null),z.state=null,g}function it(z,Y){var S;return!z||!z.state||(S=z.state,!(S.wrap&2))?E:(S.head=Y,Y.done=!1,g)}function pt(z,Y){var S=Y.length,J,Tt,v;return!z||!z.state||(J=z.state,J.wrap!==0&&J.mode!==lt)?E:J.mode===lt&&(Tt=1,Tt=r(Tt,Y,S,0),Tt!==J.check)?R:(v=pr(z,Y,S,S),v?(J.mode=Fe,A):(J.havedict=1,g))}n.inflateReset=_i,n.inflateReset2=Ss,n.inflateResetKeep=Sn,n.inflateInit=Li,n.inflateInit2=Cn,n.inflate=L,n.inflateEnd=Q,n.inflateGetHeader=it,n.inflateSetDictionary=pt,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,i,n){var s=e("../utils/common"),r=15,a=852,l=592,u=0,c=1,d=2,f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],b=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(m,w,E,R,A,T,k,P){var F=P.bits,B=0,W=0,G=0,et=0,ot=0,ct=0,X=0,K=0,lt=0,Ct=0,xt,_t,at,At,Rt,Wt=null,Ft=0,St,Lt=new s.Buf16(r+1),_e=new s.Buf16(r+1),de=null,Jt=0,fe,Yt,qe;for(B=0;B<=r;B++)Lt[B]=0;for(W=0;W<R;W++)Lt[w[E+W]]++;for(ot=F,et=r;et>=1&&Lt[et]===0;et--);if(ot>et&&(ot=et),et===0)return A[T++]=1<<24|64<<16|0,A[T++]=1<<24|64<<16|0,P.bits=1,0;for(G=1;G<et&&Lt[G]===0;G++);for(ot<G&&(ot=G),K=1,B=1;B<=r;B++)if(K<<=1,K-=Lt[B],K<0)return-1;if(K>0&&(m===u||et!==1))return-1;for(_e[1]=0,B=1;B<r;B++)_e[B+1]=_e[B]+Lt[B];for(W=0;W<R;W++)w[E+W]!==0&&(k[_e[w[E+W]]++]=W);if(m===u?(Wt=de=k,St=19):m===c?(Wt=f,Ft-=257,de=p,Jt-=257,St=256):(Wt=b,de=y,St=-1),Ct=0,W=0,B=G,Rt=T,ct=ot,X=0,at=-1,lt=1<<ot,At=lt-1,m===c&&lt>a||m===d&&lt>l)return 1;for(;;){fe=B-X,k[W]<St?(Yt=0,qe=k[W]):k[W]>St?(Yt=de[Jt+k[W]],qe=Wt[Ft+k[W]]):(Yt=96,qe=0),xt=1<<B-X,_t=1<<ct,G=_t;do _t-=xt,A[Rt+(Ct>>X)+_t]=fe<<24|Yt<<16|qe|0;while(_t!==0);for(xt=1<<B-1;Ct&xt;)xt>>=1;if(xt!==0?(Ct&=xt-1,Ct+=xt):Ct=0,W++,--Lt[B]===0){if(B===et)break;B=w[E+k[W]]}if(B>ot&&(Ct&At)!==at){for(X===0&&(X=ot),Rt+=G,ct=B-X,K=1<<ct;ct+X<et&&(K-=Lt[ct+X],!(K<=0));)ct++,K<<=1;if(lt+=1<<ct,m===c&&lt>a||m===d&&lt>l)return 1;at=Ct&At,A[at]=ot<<24|ct<<16|Rt-T|0}}return Ct!==0&&(A[Rt+Ct]=B-X<<24|64<<16|0),P.bits=ot,0}},{"../utils/common":41}],51:[function(e,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,i,n){var s=e("../utils/common"),r=4,a=0,l=1,u=2;function c(L){for(var Q=L.length;--Q>=0;)L[Q]=0}var d=0,f=1,p=2,b=3,y=258,g=29,m=256,w=m+1+g,E=30,R=19,A=2*w+1,T=15,k=16,P=7,F=256,B=16,W=17,G=18,et=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ot=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ct=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=512,lt=new Array((w+2)*2);c(lt);var Ct=new Array(E*2);c(Ct);var xt=new Array(K);c(xt);var _t=new Array(y-b+1);c(_t);var at=new Array(g);c(at);var At=new Array(E);c(At);function Rt(L,Q,it,pt,z){this.static_tree=L,this.extra_bits=Q,this.extra_base=it,this.elems=pt,this.max_length=z,this.has_stree=L&&L.length}var Wt,Ft,St;function Lt(L,Q){this.dyn_tree=L,this.max_code=0,this.stat_desc=Q}function _e(L){return L<256?xt[L]:xt[256+(L>>>7)]}function de(L,Q){L.pending_buf[L.pending++]=Q&255,L.pending_buf[L.pending++]=Q>>>8&255}function Jt(L,Q,it){L.bi_valid>k-it?(L.bi_buf|=Q<<L.bi_valid&65535,de(L,L.bi_buf),L.bi_buf=Q>>k-L.bi_valid,L.bi_valid+=it-k):(L.bi_buf|=Q<<L.bi_valid&65535,L.bi_valid+=it)}function fe(L,Q,it){Jt(L,it[Q*2],it[Q*2+1])}function Yt(L,Q){var it=0;do it|=L&1,L>>>=1,it<<=1;while(--Q>0);return it>>>1}function qe(L){L.bi_valid===16?(de(L,L.bi_buf),L.bi_buf=0,L.bi_valid=0):L.bi_valid>=8&&(L.pending_buf[L.pending++]=L.bi_buf&255,L.bi_buf>>=8,L.bi_valid-=8)}function Se(L,Q){var it=Q.dyn_tree,pt=Q.max_code,z=Q.stat_desc.static_tree,Y=Q.stat_desc.has_stree,S=Q.stat_desc.extra_bits,J=Q.stat_desc.extra_base,Tt=Q.stat_desc.max_length,v,V,$,D,M,q,bt=0;for(D=0;D<=T;D++)L.bl_count[D]=0;for(it[L.heap[L.heap_max]*2+1]=0,v=L.heap_max+1;v<A;v++)V=L.heap[v],D=it[it[V*2+1]*2+1]+1,D>Tt&&(D=Tt,bt++),it[V*2+1]=D,!(V>pt)&&(L.bl_count[D]++,M=0,V>=J&&(M=S[V-J]),q=it[V*2],L.opt_len+=q*(D+M),Y&&(L.static_len+=q*(z[V*2+1]+M)));if(bt!==0){do{for(D=Tt-1;L.bl_count[D]===0;)D--;L.bl_count[D]--,L.bl_count[D+1]+=2,L.bl_count[Tt]--,bt-=2}while(bt>0);for(D=Tt;D!==0;D--)for(V=L.bl_count[D];V!==0;)$=L.heap[--v],!($>pt)&&(it[$*2+1]!==D&&(L.opt_len+=(D-it[$*2+1])*it[$*2],it[$*2+1]=D),V--)}}function Ii(L,Q,it){var pt=new Array(T+1),z=0,Y,S;for(Y=1;Y<=T;Y++)pt[Y]=z=z+it[Y-1]<<1;for(S=0;S<=Q;S++){var J=L[S*2+1];J!==0&&(L[S*2]=Yt(pt[J]++,J))}}function Zt(){var L,Q,it,pt,z,Y=new Array(T+1);for(it=0,pt=0;pt<g-1;pt++)for(at[pt]=it,L=0;L<1<<et[pt];L++)_t[it++]=pt;for(_t[it-1]=pt,z=0,pt=0;pt<16;pt++)for(At[pt]=z,L=0;L<1<<ot[pt];L++)xt[z++]=pt;for(z>>=7;pt<E;pt++)for(At[pt]=z<<7,L=0;L<1<<ot[pt]-7;L++)xt[256+z++]=pt;for(Q=0;Q<=T;Q++)Y[Q]=0;for(L=0;L<=143;)lt[L*2+1]=8,L++,Y[8]++;for(;L<=255;)lt[L*2+1]=9,L++,Y[9]++;for(;L<=279;)lt[L*2+1]=7,L++,Y[7]++;for(;L<=287;)lt[L*2+1]=8,L++,Y[8]++;for(Ii(lt,w+1,Y),L=0;L<E;L++)Ct[L*2+1]=5,Ct[L*2]=Yt(L,5);Wt=new Rt(lt,et,m+1,w,T),Ft=new Rt(Ct,ot,0,E,T),St=new Rt(new Array(0),ct,0,R,P)}function Fe(L){var Q;for(Q=0;Q<w;Q++)L.dyn_ltree[Q*2]=0;for(Q=0;Q<E;Q++)L.dyn_dtree[Q*2]=0;for(Q=0;Q<R;Q++)L.bl_tree[Q*2]=0;L.dyn_ltree[F*2]=1,L.opt_len=L.static_len=0,L.last_lit=L.matches=0}function xn(L){L.bi_valid>8?de(L,L.bi_buf):L.bi_valid>0&&(L.pending_buf[L.pending++]=L.bi_buf),L.bi_buf=0,L.bi_valid=0}function li(L,Q,it,pt){xn(L),de(L,it),de(L,~it),s.arraySet(L.pending_buf,L.window,Q,it,L.pending),L.pending+=it}function Je(L,Q,it,pt){var z=Q*2,Y=it*2;return L[z]<L[Y]||L[z]===L[Y]&&pt[Q]<=pt[it]}function he(L,Q,it){for(var pt=L.heap[it],z=it<<1;z<=L.heap_len&&(z<L.heap_len&&Je(Q,L.heap[z+1],L.heap[z],L.depth)&&z++,!Je(Q,pt,L.heap[z],L.depth));)L.heap[it]=L.heap[z],it=z,z<<=1;L.heap[it]=pt}function Mt(L,Q,it){var pt,z,Y=0,S,J;if(L.last_lit!==0)do pt=L.pending_buf[L.d_buf+Y*2]<<8|L.pending_buf[L.d_buf+Y*2+1],z=L.pending_buf[L.l_buf+Y],Y++,pt===0?fe(L,z,Q):(S=_t[z],fe(L,S+m+1,Q),J=et[S],J!==0&&(z-=at[S],Jt(L,z,J)),pt--,S=_e(pt),fe(L,S,it),J=ot[S],J!==0&&(pt-=At[S],Jt(L,pt,J)));while(Y<L.last_lit);fe(L,F,Q)}function wi(L,Q){var it=Q.dyn_tree,pt=Q.stat_desc.static_tree,z=Q.stat_desc.has_stree,Y=Q.stat_desc.elems,S,J,Tt=-1,v;for(L.heap_len=0,L.heap_max=A,S=0;S<Y;S++)it[S*2]!==0?(L.heap[++L.heap_len]=Tt=S,L.depth[S]=0):it[S*2+1]=0;for(;L.heap_len<2;)v=L.heap[++L.heap_len]=Tt<2?++Tt:0,it[v*2]=1,L.depth[v]=0,L.opt_len--,z&&(L.static_len-=pt[v*2+1]);for(Q.max_code=Tt,S=L.heap_len>>1;S>=1;S--)he(L,it,S);v=Y;do S=L.heap[1],L.heap[1]=L.heap[L.heap_len--],he(L,it,1),J=L.heap[1],L.heap[--L.heap_max]=S,L.heap[--L.heap_max]=J,it[v*2]=it[S*2]+it[J*2],L.depth[v]=(L.depth[S]>=L.depth[J]?L.depth[S]:L.depth[J])+1,it[S*2+1]=it[J*2+1]=v,L.heap[1]=v++,he(L,it,1);while(L.heap_len>=2);L.heap[--L.heap_max]=L.heap[1],Se(L,Q),Ii(it,Tt,L.bl_count)}function xs(L,Q,it){var pt,z=-1,Y,S=Q[0*2+1],J=0,Tt=7,v=4;for(S===0&&(Tt=138,v=3),Q[(it+1)*2+1]=65535,pt=0;pt<=it;pt++)Y=S,S=Q[(pt+1)*2+1],!(++J<Tt&&Y===S)&&(J<v?L.bl_tree[Y*2]+=J:Y!==0?(Y!==z&&L.bl_tree[Y*2]++,L.bl_tree[B*2]++):J<=10?L.bl_tree[W*2]++:L.bl_tree[G*2]++,J=0,z=Y,S===0?(Tt=138,v=3):Y===S?(Tt=6,v=3):(Tt=7,v=4))}function Sn(L,Q,it){var pt,z=-1,Y,S=Q[0*2+1],J=0,Tt=7,v=4;for(S===0&&(Tt=138,v=3),pt=0;pt<=it;pt++)if(Y=S,S=Q[(pt+1)*2+1],!(++J<Tt&&Y===S)){if(J<v)do fe(L,Y,L.bl_tree);while(--J!==0);else Y!==0?(Y!==z&&(fe(L,Y,L.bl_tree),J--),fe(L,B,L.bl_tree),Jt(L,J-3,2)):J<=10?(fe(L,W,L.bl_tree),Jt(L,J-3,3)):(fe(L,G,L.bl_tree),Jt(L,J-11,7));J=0,z=Y,S===0?(Tt=138,v=3):Y===S?(Tt=6,v=3):(Tt=7,v=4)}}function _i(L){var Q;for(xs(L,L.dyn_ltree,L.l_desc.max_code),xs(L,L.dyn_dtree,L.d_desc.max_code),wi(L,L.bl_desc),Q=R-1;Q>=3&&L.bl_tree[X[Q]*2+1]===0;Q--);return L.opt_len+=3*(Q+1)+5+5+4,Q}function Ss(L,Q,it,pt){var z;for(Jt(L,Q-257,5),Jt(L,it-1,5),Jt(L,pt-4,4),z=0;z<pt;z++)Jt(L,L.bl_tree[X[z]*2+1],3);Sn(L,L.dyn_ltree,Q-1),Sn(L,L.dyn_dtree,it-1)}function Cn(L){var Q=4093624447,it;for(it=0;it<=31;it++,Q>>>=1)if(Q&1&&L.dyn_ltree[it*2]!==0)return a;if(L.dyn_ltree[9*2]!==0||L.dyn_ltree[10*2]!==0||L.dyn_ltree[13*2]!==0)return l;for(it=32;it<m;it++)if(L.dyn_ltree[it*2]!==0)return l;return a}var Li=!1;function Cs(L){Li||(Zt(),Li=!0),L.l_desc=new Lt(L.dyn_ltree,Wt),L.d_desc=new Lt(L.dyn_dtree,Ft),L.bl_desc=new Lt(L.bl_tree,St),L.bi_buf=0,L.bi_valid=0,Fe(L)}function Tn(L,Q,it,pt){Jt(L,(d<<1)+(pt?1:0),3),li(L,Q,it)}function Me(L){Jt(L,f<<1,3),fe(L,F,lt),qe(L)}function Pi(L,Q,it,pt){var z,Y,S=0;L.level>0?(L.strm.data_type===u&&(L.strm.data_type=Cn(L)),wi(L,L.l_desc),wi(L,L.d_desc),S=_i(L),z=L.opt_len+3+7>>>3,Y=L.static_len+3+7>>>3,Y<=z&&(z=Y)):z=Y=it+5,it+4<=z&&Q!==-1?Tn(L,Q,it,pt):L.strategy===r||Y===z?(Jt(L,(f<<1)+(pt?1:0),3),Mt(L,lt,Ct)):(Jt(L,(p<<1)+(pt?1:0),3),Ss(L,L.l_desc.max_code+1,L.d_desc.max_code+1,S+1),Mt(L,L.dyn_ltree,L.dyn_dtree)),Fe(L),pt&&xn(L)}function pr(L,Q,it){return L.pending_buf[L.d_buf+L.last_lit*2]=Q>>>8&255,L.pending_buf[L.d_buf+L.last_lit*2+1]=Q&255,L.pending_buf[L.l_buf+L.last_lit]=it&255,L.last_lit++,Q===0?L.dyn_ltree[it*2]++:(L.matches++,Q--,L.dyn_ltree[(_t[it]+m+1)*2]++,L.dyn_dtree[_e(Q)*2]++),L.last_lit===L.lit_bufsize-1}n._tr_init=Cs,n._tr_stored_block=Tn,n._tr_flush_block=Pi,n._tr_tally=pr,n._tr_align=Me},{"../utils/common":41}],53:[function(e,i,n){function s(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}i.exports=s},{}],54:[function(e,i,n){(function(s){(function(r,a){if(r.setImmediate)return;var l=1,u={},c=!1,d=r.document,f;function p(P){typeof P!="function"&&(P=new Function(""+P));for(var F=new Array(arguments.length-1),B=0;B<F.length;B++)F[B]=arguments[B+1];var W={callback:P,args:F};return u[l]=W,f(l),l++}function b(P){delete u[P]}function y(P){var F=P.callback,B=P.args;switch(B.length){case 0:F();break;case 1:F(B[0]);break;case 2:F(B[0],B[1]);break;case 3:F(B[0],B[1],B[2]);break;default:F.apply(a,B);break}}function g(P){if(c)setTimeout(g,0,P);else{var F=u[P];if(F){c=!0;try{y(F)}finally{b(P),c=!1}}}}function m(){f=function(P){process.nextTick(function(){g(P)})}}function w(){if(r.postMessage&&!r.importScripts){var P=!0,F=r.onmessage;return r.onmessage=function(){P=!1},r.postMessage("","*"),r.onmessage=F,P}}function E(){var P="setImmediate$"+Math.random()+"$",F=function(B){B.source===r&&typeof B.data=="string"&&B.data.indexOf(P)===0&&g(+B.data.slice(P.length))};r.addEventListener?r.addEventListener("message",F,!1):r.attachEvent("onmessage",F),f=function(B){r.postMessage(P+B,"*")}}function R(){var P=new MessageChannel;P.port1.onmessage=function(F){var B=F.data;g(B)},f=function(F){P.port2.postMessage(F)}}function A(){var P=d.documentElement;f=function(F){var B=d.createElement("script");B.onreadystatechange=function(){g(F),B.onreadystatechange=null,P.removeChild(B),B=null},P.appendChild(B)}}function T(){f=function(P){setTimeout(g,0,P)}}var k=Object.getPrototypeOf&&Object.getPrototypeOf(r);k=k&&k.setTimeout?k:r,{}.toString.call(r.process)==="[object process]"?m():w()?E():r.MessageChannel?R():d&&"onreadystatechange"in d.createElement("script")?A():T(),k.setImmediate=p,k.clearImmediate=b})(typeof self>"u"?typeof s>"u"?this:s:self)}).call(this,typeof _n<"u"?_n:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Cy);var VE=Cy.exports;const GE=eh(VE);class $E{constructor(){this.zip=void 0,this.urlCache={},this.checkRequirements()}checkRequirements(){try{this.zip=new GE}catch{throw new Error("JSZip lib not loaded")}}open(t,e){return this.zip.loadAsync(t,{base64:e})}openUrl(t,e){return jh(t,"binary").then((function(i){return this.zip.loadAsync(i,{base64:e})}).bind(this))}request(t,e){var i=new Gt,n,s=new cr(t);return e||(e=s.extension),e=="blob"?n=this.getBlob(t):n=this.getText(t),n?n.then((function(r){let a=this.handleResponse(r,e);i.resolve(a)}).bind(this)):i.reject({message:"File not found in the epub: "+t,stack:new Error().stack}),i.promise}handleResponse(t,e){var i;return e=="json"?i=JSON.parse(t):Hh(e)?i=_s(t,"text/xml"):e=="xhtml"?i=_s(t,"application/xhtml+xml"):e=="html"||e=="htm"?i=_s(t,"text/html"):i=t,i}getBlob(t,e){var i=window.decodeURIComponent(t.substr(1)),n=this.zip.file(i);if(n)return e=e||qo.lookup(n.name),n.async("uint8array").then(function(s){return new Blob([s],{type:e})})}getText(t,e){var i=window.decodeURIComponent(t.substr(1)),n=this.zip.file(i);if(n)return n.async("string").then(function(s){return s})}getBase64(t,e){var i=window.decodeURIComponent(t.substr(1)),n=this.zip.file(i);if(n)return e=e||qo.lookup(n.name),n.async("base64").then(function(s){return"data:"+e+";base64,"+s})}createUrl(t,e){var i=new Gt,n=window.URL||window.webkitURL||window.mozURL,s,r,a=e&&e.base64;return t in this.urlCache?(i.resolve(this.urlCache[t]),i.promise):(a?(r=this.getBase64(t),r&&r.then((function(l){this.urlCache[t]=l,i.resolve(l)}).bind(this))):(r=this.getBlob(t),r&&r.then((function(l){s=n.createObjectURL(l),this.urlCache[t]=s,i.resolve(s)}).bind(this))),r||i.reject({message:"File not found in the epub: "+t,stack:new Error().stack}),i.promise)}revokeUrl(t){var e=window.URL||window.webkitURL||window.mozURL,i=this.urlCache[t];i&&e.revokeObjectURL(i)}destroy(){var t=window.URL||window.webkitURL||window.mozURL;for(let e in this.urlCache)t.revokeObjectURL(e);this.zip=void 0,this.urlCache={}}}var Ty={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(o,t){(function(e){o.exports=e()})(function(){return function e(i,n,s){function r(u,c){if(!n[u]){if(!i[u]){var d=typeof Yr=="function"&&Yr;if(!c&&d)return d(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var p=n[u]={exports:{}};i[u][0].call(p.exports,function(b){var y=i[u][1][b];return r(y||b)},p,p.exports,e,i,n,s)}return n[u].exports}for(var a=typeof Yr=="function"&&Yr,l=0;l<s.length;l++)r(s[l]);return r}({1:[function(e,i,n){(function(s){var r=s.MutationObserver||s.WebKitMutationObserver,a;if(r){var l=0,u=new r(b),c=s.document.createTextNode("");u.observe(c,{characterData:!0}),a=function(){c.data=l=++l%2}}else if(!s.setImmediate&&typeof s.MessageChannel<"u"){var d=new s.MessageChannel;d.port1.onmessage=b,a=function(){d.port2.postMessage(0)}}else"document"in s&&"onreadystatechange"in s.document.createElement("script")?a=function(){var g=s.document.createElement("script");g.onreadystatechange=function(){b(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:a=function(){setTimeout(b,0)};var f,p=[];function b(){f=!0;for(var g,m,w=p.length;w;){for(m=p,p=[],g=-1;++g<w;)m[g]();w=p.length}f=!1}i.exports=y;function y(g){p.push(g)===1&&!f&&a()}}).call(this,typeof _n<"u"?_n:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(e,i,n){var s=e(1);function r(){}var a={},l=["REJECTED"],u=["FULFILLED"],c=["PENDING"];i.exports=d;function d(A){if(typeof A!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,A!==r&&y(this,A)}d.prototype.catch=function(A){return this.then(null,A)},d.prototype.then=function(A,T){if(typeof A!="function"&&this.state===u||typeof T!="function"&&this.state===l)return this;var k=new this.constructor(r);if(this.state!==c){var P=this.state===u?A:T;p(k,P,this.outcome)}else this.queue.push(new f(k,A,T));return k};function f(A,T,k){this.promise=A,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}f.prototype.callFulfilled=function(A){a.resolve(this.promise,A)},f.prototype.otherCallFulfilled=function(A){p(this.promise,this.onFulfilled,A)},f.prototype.callRejected=function(A){a.reject(this.promise,A)},f.prototype.otherCallRejected=function(A){p(this.promise,this.onRejected,A)};function p(A,T,k){s(function(){var P;try{P=T(k)}catch(F){return a.reject(A,F)}P===A?a.reject(A,new TypeError("Cannot resolve promise with itself")):a.resolve(A,P)})}a.resolve=function(A,T){var k=g(b,T);if(k.status==="error")return a.reject(A,k.value);var P=k.value;if(P)y(A,P);else{A.state=u,A.outcome=T;for(var F=-1,B=A.queue.length;++F<B;)A.queue[F].callFulfilled(T)}return A},a.reject=function(A,T){A.state=l,A.outcome=T;for(var k=-1,P=A.queue.length;++k<P;)A.queue[k].callRejected(T);return A};function b(A){var T=A&&A.then;if(A&&(typeof A=="object"||typeof A=="function")&&typeof T=="function")return function(){T.apply(A,arguments)}}function y(A,T){var k=!1;function P(G){k||(k=!0,a.reject(A,G))}function F(G){k||(k=!0,a.resolve(A,G))}function B(){T(F,P)}var W=g(B);W.status==="error"&&P(W.value)}function g(A,T){var k={};try{k.value=A(T),k.status="success"}catch(P){k.status="error",k.value=P}return k}d.resolve=m;function m(A){return A instanceof this?A:a.resolve(new this(r),A)}d.reject=w;function w(A){var T=new this(r);return a.reject(T,A)}d.all=E;function E(A){var T=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=A.length,P=!1;if(!k)return this.resolve([]);for(var F=new Array(k),B=0,W=-1,G=new this(r);++W<k;)et(A[W],W);return G;function et(ot,ct){T.resolve(ot).then(X,function(K){P||(P=!0,a.reject(G,K))});function X(K){F[ct]=K,++B===k&&!P&&(P=!0,a.resolve(G,F))}}}d.race=R;function R(A){var T=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=A.length,P=!1;if(!k)return this.resolve([]);for(var F=-1,B=new this(r);++F<k;)W(A[F]);return B;function W(G){T.resolve(G).then(function(et){P||(P=!0,a.resolve(B,et))},function(et){P||(P=!0,a.reject(B,et))})}}},{1:1}],3:[function(e,i,n){(function(s){typeof s.Promise!="function"&&(s.Promise=e(2))}).call(this,typeof _n<"u"?_n:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(e,i,n){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I};function r(I,O){if(!(I instanceof O))throw new TypeError("Cannot call a class as a function")}function a(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var l=a();function u(){try{if(!l||!l.open)return!1;var I=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),O=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!I||O)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function c(I,O){I=I||[],O=O||{};try{return new Blob(I,O)}catch(U){if(U.name!=="TypeError")throw U;for(var N=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,H=new N,j=0;j<I.length;j+=1)H.append(I[j]);return H.getBlob(O.type)}}typeof Promise>"u"&&e(3);var d=Promise;function f(I,O){O&&I.then(function(N){O(null,N)},function(N){O(N)})}function p(I,O,N){typeof O=="function"&&I.then(O),typeof N=="function"&&I.catch(N)}function b(I){return typeof I!="string"&&(console.warn(I+" used as a key, but it is not a string."),I=String(I)),I}function y(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var g="local-forage-detect-blob-support",m=void 0,w={},E=Object.prototype.toString,R="readonly",A="readwrite";function T(I){for(var O=I.length,N=new ArrayBuffer(O),H=new Uint8Array(N),j=0;j<O;j++)H[j]=I.charCodeAt(j);return N}function k(I){return new d(function(O){var N=I.transaction(g,A),H=c([""]);N.objectStore(g).put(H,"key"),N.onabort=function(j){j.preventDefault(),j.stopPropagation(),O(!1)},N.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),U=navigator.userAgent.match(/Edge\//);O(U||!j||parseInt(j[1],10)>=43)}}).catch(function(){return!1})}function P(I){return typeof m=="boolean"?d.resolve(m):k(I).then(function(O){return m=O,m})}function F(I){var O=w[I.name],N={};N.promise=new d(function(H,j){N.resolve=H,N.reject=j}),O.deferredOperations.push(N),O.dbReady?O.dbReady=O.dbReady.then(function(){return N.promise}):O.dbReady=N.promise}function B(I){var O=w[I.name],N=O.deferredOperations.pop();if(N)return N.resolve(),N.promise}function W(I,O){var N=w[I.name],H=N.deferredOperations.pop();if(H)return H.reject(O),H.promise}function G(I,O){return new d(function(N,H){if(w[I.name]=w[I.name]||at(),I.db)if(O)F(I),I.db.close();else return N(I.db);var j=[I.name];O&&j.push(I.version);var U=l.open.apply(l,j);O&&(U.onupgradeneeded=function(Z){var tt=U.result;try{tt.createObjectStore(I.storeName),Z.oldVersion<=1&&tt.createObjectStore(g)}catch(nt){if(nt.name==="ConstraintError")console.warn('The database "'+I.name+'" has been upgraded from version '+Z.oldVersion+" to version "+Z.newVersion+', but the storage "'+I.storeName+'" already exists.');else throw nt}}),U.onerror=function(Z){Z.preventDefault(),H(U.error)},U.onsuccess=function(){var Z=U.result;Z.onversionchange=function(tt){tt.target.close()},N(Z),B(I)}})}function et(I){return G(I,!1)}function ot(I){return G(I,!0)}function ct(I,O){if(!I.db)return!0;var N=!I.db.objectStoreNames.contains(I.storeName),H=I.version<I.db.version,j=I.version>I.db.version;if(H&&(I.version!==O&&console.warn('The database "'+I.name+`" can't be downgraded from version `+I.db.version+" to version "+I.version+"."),I.version=I.db.version),j||N){if(N){var U=I.db.version+1;U>I.version&&(I.version=U)}return!0}return!1}function X(I){return new d(function(O,N){var H=new FileReader;H.onerror=N,H.onloadend=function(j){var U=btoa(j.target.result||"");O({__local_forage_encoded_blob:!0,data:U,type:I.type})},H.readAsBinaryString(I)})}function K(I){var O=T(atob(I.data));return c([O],{type:I.type})}function lt(I){return I&&I.__local_forage_encoded_blob}function Ct(I){var O=this,N=O._initReady().then(function(){var H=w[O._dbInfo.name];if(H&&H.dbReady)return H.dbReady});return p(N,I,I),N}function xt(I){F(I);for(var O=w[I.name],N=O.forages,H=0;H<N.length;H++){var j=N[H];j._dbInfo.db&&(j._dbInfo.db.close(),j._dbInfo.db=null)}return I.db=null,et(I).then(function(U){return I.db=U,ct(I)?ot(I):U}).then(function(U){I.db=O.db=U;for(var Z=0;Z<N.length;Z++)N[Z]._dbInfo.db=U}).catch(function(U){throw W(I,U),U})}function _t(I,O,N,H){H===void 0&&(H=1);try{var j=I.db.transaction(I.storeName,O);N(null,j)}catch(U){if(H>0&&(!I.db||U.name==="InvalidStateError"||U.name==="NotFoundError"))return d.resolve().then(function(){if(!I.db||U.name==="NotFoundError"&&!I.db.objectStoreNames.contains(I.storeName)&&I.version<=I.db.version)return I.db&&(I.version=I.db.version+1),ot(I)}).then(function(){return xt(I).then(function(){_t(I,O,N,H-1)})}).catch(N);N(U)}}function at(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function At(I){var O=this,N={db:null};if(I)for(var H in I)N[H]=I[H];var j=w[N.name];j||(j=at(),w[N.name]=j),j.forages.push(O),O._initReady||(O._initReady=O.ready,O.ready=Ct);var U=[];function Z(){return d.resolve()}for(var tt=0;tt<j.forages.length;tt++){var nt=j.forages[tt];nt!==O&&U.push(nt._initReady().catch(Z))}var st=j.forages.slice(0);return d.all(U).then(function(){return N.db=j.db,et(N)}).then(function(rt){return N.db=rt,ct(N,O._defaultConfig.version)?ot(N):rt}).then(function(rt){N.db=j.db=rt,O._dbInfo=N;for(var yt=0;yt<st.length;yt++){var zt=st[yt];zt!==O&&(zt._dbInfo.db=N.db,zt._dbInfo.version=N.version)}})}function Rt(I,O){var N=this;I=b(I);var H=new d(function(j,U){N.ready().then(function(){_t(N._dbInfo,R,function(Z,tt){if(Z)return U(Z);try{var nt=tt.objectStore(N._dbInfo.storeName),st=nt.get(I);st.onsuccess=function(){var rt=st.result;rt===void 0&&(rt=null),lt(rt)&&(rt=K(rt)),j(rt)},st.onerror=function(){U(st.error)}}catch(rt){U(rt)}})}).catch(U)});return f(H,O),H}function Wt(I,O){var N=this,H=new d(function(j,U){N.ready().then(function(){_t(N._dbInfo,R,function(Z,tt){if(Z)return U(Z);try{var nt=tt.objectStore(N._dbInfo.storeName),st=nt.openCursor(),rt=1;st.onsuccess=function(){var yt=st.result;if(yt){var zt=yt.value;lt(zt)&&(zt=K(zt));var te=I(zt,yt.key,rt++);te!==void 0?j(te):yt.continue()}else j()},st.onerror=function(){U(st.error)}}catch(yt){U(yt)}})}).catch(U)});return f(H,O),H}function Ft(I,O,N){var H=this;I=b(I);var j=new d(function(U,Z){var tt;H.ready().then(function(){return tt=H._dbInfo,E.call(O)==="[object Blob]"?P(tt.db).then(function(nt){return nt?O:X(O)}):O}).then(function(nt){_t(H._dbInfo,A,function(st,rt){if(st)return Z(st);try{var yt=rt.objectStore(H._dbInfo.storeName);nt===null&&(nt=void 0);var zt=yt.put(nt,I);rt.oncomplete=function(){nt===void 0&&(nt=null),U(nt)},rt.onabort=rt.onerror=function(){var te=zt.error?zt.error:zt.transaction.error;Z(te)}}catch(te){Z(te)}})}).catch(Z)});return f(j,N),j}function St(I,O){var N=this;I=b(I);var H=new d(function(j,U){N.ready().then(function(){_t(N._dbInfo,A,function(Z,tt){if(Z)return U(Z);try{var nt=tt.objectStore(N._dbInfo.storeName),st=nt.delete(I);tt.oncomplete=function(){j()},tt.onerror=function(){U(st.error)},tt.onabort=function(){var rt=st.error?st.error:st.transaction.error;U(rt)}}catch(rt){U(rt)}})}).catch(U)});return f(H,O),H}function Lt(I){var O=this,N=new d(function(H,j){O.ready().then(function(){_t(O._dbInfo,A,function(U,Z){if(U)return j(U);try{var tt=Z.objectStore(O._dbInfo.storeName),nt=tt.clear();Z.oncomplete=function(){H()},Z.onabort=Z.onerror=function(){var st=nt.error?nt.error:nt.transaction.error;j(st)}}catch(st){j(st)}})}).catch(j)});return f(N,I),N}function _e(I){var O=this,N=new d(function(H,j){O.ready().then(function(){_t(O._dbInfo,R,function(U,Z){if(U)return j(U);try{var tt=Z.objectStore(O._dbInfo.storeName),nt=tt.count();nt.onsuccess=function(){H(nt.result)},nt.onerror=function(){j(nt.error)}}catch(st){j(st)}})}).catch(j)});return f(N,I),N}function de(I,O){var N=this,H=new d(function(j,U){if(I<0){j(null);return}N.ready().then(function(){_t(N._dbInfo,R,function(Z,tt){if(Z)return U(Z);try{var nt=tt.objectStore(N._dbInfo.storeName),st=!1,rt=nt.openKeyCursor();rt.onsuccess=function(){var yt=rt.result;if(!yt){j(null);return}I===0||st?j(yt.key):(st=!0,yt.advance(I))},rt.onerror=function(){U(rt.error)}}catch(yt){U(yt)}})}).catch(U)});return f(H,O),H}function Jt(I){var O=this,N=new d(function(H,j){O.ready().then(function(){_t(O._dbInfo,R,function(U,Z){if(U)return j(U);try{var tt=Z.objectStore(O._dbInfo.storeName),nt=tt.openKeyCursor(),st=[];nt.onsuccess=function(){var rt=nt.result;if(!rt){H(st);return}st.push(rt.key),rt.continue()},nt.onerror=function(){j(nt.error)}}catch(rt){j(rt)}})}).catch(j)});return f(N,I),N}function fe(I,O){O=y.apply(this,arguments);var N=this.config();I=typeof I!="function"&&I||{},I.name||(I.name=I.name||N.name,I.storeName=I.storeName||N.storeName);var H=this,j;if(!I.name)j=d.reject("Invalid arguments");else{var U=I.name===N.name&&H._dbInfo.db,Z=U?d.resolve(H._dbInfo.db):et(I).then(function(tt){var nt=w[I.name],st=nt.forages;nt.db=tt;for(var rt=0;rt<st.length;rt++)st[rt]._dbInfo.db=tt;return tt});I.storeName?j=Z.then(function(tt){if(tt.objectStoreNames.contains(I.storeName)){var nt=tt.version+1;F(I);var st=w[I.name],rt=st.forages;tt.close();for(var yt=0;yt<rt.length;yt++){var zt=rt[yt];zt._dbInfo.db=null,zt._dbInfo.version=nt}var te=new d(function(ee,Le){var Te=l.open(I.name,nt);Te.onerror=function(hn){var nh=Te.result;nh.close(),Le(hn)},Te.onupgradeneeded=function(){var hn=Te.result;hn.deleteObjectStore(I.storeName)},Te.onsuccess=function(){var hn=Te.result;hn.close(),ee(hn)}});return te.then(function(ee){st.db=ee;for(var Le=0;Le<rt.length;Le++){var Te=rt[Le];Te._dbInfo.db=ee,B(Te._dbInfo)}}).catch(function(ee){throw(W(I,ee)||d.resolve()).catch(function(){}),ee})}}):j=Z.then(function(tt){F(I);var nt=w[I.name],st=nt.forages;tt.close();for(var rt=0;rt<st.length;rt++){var yt=st[rt];yt._dbInfo.db=null}var zt=new d(function(te,ee){var Le=l.deleteDatabase(I.name);Le.onerror=function(){var Te=Le.result;Te&&Te.close(),ee(Le.error)},Le.onblocked=function(){console.warn('dropInstance blocked for database "'+I.name+'" until all open connections are closed')},Le.onsuccess=function(){var Te=Le.result;Te&&Te.close(),te(Te)}});return zt.then(function(te){nt.db=te;for(var ee=0;ee<st.length;ee++){var Le=st[ee];B(Le._dbInfo)}}).catch(function(te){throw(W(I,te)||d.resolve()).catch(function(){}),te})})}return f(j,O),j}var Yt={_driver:"asyncStorage",_initStorage:At,_support:u(),iterate:Wt,getItem:Rt,setItem:Ft,removeItem:St,clear:Lt,length:_e,key:de,keys:Jt,dropInstance:fe};function qe(){return typeof openDatabase=="function"}var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ii="~~local_forage_type~",Zt=/^~~local_forage_type~([^~]+)~/,Fe="__lfsc__:",xn=Fe.length,li="arbf",Je="blob",he="si08",Mt="ui08",wi="uic8",xs="si16",Sn="si32",_i="ur16",Ss="ui32",Cn="fl32",Li="fl64",Cs=xn+li.length,Tn=Object.prototype.toString;function Me(I){var O=I.length*.75,N=I.length,H,j=0,U,Z,tt,nt;I[I.length-1]==="="&&(O--,I[I.length-2]==="="&&O--);var st=new ArrayBuffer(O),rt=new Uint8Array(st);for(H=0;H<N;H+=4)U=Se.indexOf(I[H]),Z=Se.indexOf(I[H+1]),tt=Se.indexOf(I[H+2]),nt=Se.indexOf(I[H+3]),rt[j++]=U<<2|Z>>4,rt[j++]=(Z&15)<<4|tt>>2,rt[j++]=(tt&3)<<6|nt&63;return st}function Pi(I){var O=new Uint8Array(I),N="",H;for(H=0;H<O.length;H+=3)N+=Se[O[H]>>2],N+=Se[(O[H]&3)<<4|O[H+1]>>4],N+=Se[(O[H+1]&15)<<2|O[H+2]>>6],N+=Se[O[H+2]&63];return O.length%3===2?N=N.substring(0,N.length-1)+"=":O.length%3===1&&(N=N.substring(0,N.length-2)+"=="),N}function pr(I,O){var N="";if(I&&(N=Tn.call(I)),I&&(N==="[object ArrayBuffer]"||I.buffer&&Tn.call(I.buffer)==="[object ArrayBuffer]")){var H,j=Fe;I instanceof ArrayBuffer?(H=I,j+=li):(H=I.buffer,N==="[object Int8Array]"?j+=he:N==="[object Uint8Array]"?j+=Mt:N==="[object Uint8ClampedArray]"?j+=wi:N==="[object Int16Array]"?j+=xs:N==="[object Uint16Array]"?j+=_i:N==="[object Int32Array]"?j+=Sn:N==="[object Uint32Array]"?j+=Ss:N==="[object Float32Array]"?j+=Cn:N==="[object Float64Array]"?j+=Li:O(new Error("Failed to get type for BinaryArray"))),O(j+Pi(H))}else if(N==="[object Blob]"){var U=new FileReader;U.onload=function(){var Z=Ii+I.type+"~"+Pi(this.result);O(Fe+Je+Z)},U.readAsArrayBuffer(I)}else try{O(JSON.stringify(I))}catch(Z){console.error("Couldn't convert value into a JSON string: ",I),O(null,Z)}}function L(I){if(I.substring(0,xn)!==Fe)return JSON.parse(I);var O=I.substring(Cs),N=I.substring(xn,Cs),H;if(N===Je&&Zt.test(O)){var j=O.match(Zt);H=j[1],O=O.substring(j[0].length)}var U=Me(O);switch(N){case li:return U;case Je:return c([U],{type:H});case he:return new Int8Array(U);case Mt:return new Uint8Array(U);case wi:return new Uint8ClampedArray(U);case xs:return new Int16Array(U);case _i:return new Uint16Array(U);case Sn:return new Int32Array(U);case Ss:return new Uint32Array(U);case Cn:return new Float32Array(U);case Li:return new Float64Array(U);default:throw new Error("Unkown type: "+N)}}var Q={serialize:pr,deserialize:L,stringToBuffer:Me,bufferToString:Pi};function it(I,O,N,H){I.executeSql("CREATE TABLE IF NOT EXISTS "+O.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],N,H)}function pt(I){var O=this,N={db:null};if(I)for(var H in I)N[H]=typeof I[H]!="string"?I[H].toString():I[H];var j=new d(function(U,Z){try{N.db=openDatabase(N.name,String(N.version),N.description,N.size)}catch(tt){return Z(tt)}N.db.transaction(function(tt){it(tt,N,function(){O._dbInfo=N,U()},function(nt,st){Z(st)})},Z)});return N.serializer=Q,j}function z(I,O,N,H,j,U){I.executeSql(N,H,j,function(Z,tt){tt.code===tt.SYNTAX_ERR?Z.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[O.storeName],function(nt,st){st.rows.length?U(nt,tt):it(nt,O,function(){nt.executeSql(N,H,j,U)},U)},U):U(Z,tt)},U)}function Y(I,O){var N=this;I=b(I);var H=new d(function(j,U){N.ready().then(function(){var Z=N._dbInfo;Z.db.transaction(function(tt){z(tt,Z,"SELECT * FROM "+Z.storeName+" WHERE key = ? LIMIT 1",[I],function(nt,st){var rt=st.rows.length?st.rows.item(0).value:null;rt&&(rt=Z.serializer.deserialize(rt)),j(rt)},function(nt,st){U(st)})})}).catch(U)});return f(H,O),H}function S(I,O){var N=this,H=new d(function(j,U){N.ready().then(function(){var Z=N._dbInfo;Z.db.transaction(function(tt){z(tt,Z,"SELECT * FROM "+Z.storeName,[],function(nt,st){for(var rt=st.rows,yt=rt.length,zt=0;zt<yt;zt++){var te=rt.item(zt),ee=te.value;if(ee&&(ee=Z.serializer.deserialize(ee)),ee=I(ee,te.key,zt+1),ee!==void 0){j(ee);return}}j()},function(nt,st){U(st)})})}).catch(U)});return f(H,O),H}function J(I,O,N,H){var j=this;I=b(I);var U=new d(function(Z,tt){j.ready().then(function(){O===void 0&&(O=null);var nt=O,st=j._dbInfo;st.serializer.serialize(O,function(rt,yt){yt?tt(yt):st.db.transaction(function(zt){z(zt,st,"INSERT OR REPLACE INTO "+st.storeName+" (key, value) VALUES (?, ?)",[I,rt],function(){Z(nt)},function(te,ee){tt(ee)})},function(zt){if(zt.code===zt.QUOTA_ERR){if(H>0){Z(J.apply(j,[I,nt,N,H-1]));return}tt(zt)}})})}).catch(tt)});return f(U,N),U}function Tt(I,O,N){return J.apply(this,[I,O,N,1])}function v(I,O){var N=this;I=b(I);var H=new d(function(j,U){N.ready().then(function(){var Z=N._dbInfo;Z.db.transaction(function(tt){z(tt,Z,"DELETE FROM "+Z.storeName+" WHERE key = ?",[I],function(){j()},function(nt,st){U(st)})})}).catch(U)});return f(H,O),H}function V(I){var O=this,N=new d(function(H,j){O.ready().then(function(){var U=O._dbInfo;U.db.transaction(function(Z){z(Z,U,"DELETE FROM "+U.storeName,[],function(){H()},function(tt,nt){j(nt)})})}).catch(j)});return f(N,I),N}function $(I){var O=this,N=new d(function(H,j){O.ready().then(function(){var U=O._dbInfo;U.db.transaction(function(Z){z(Z,U,"SELECT COUNT(key) as c FROM "+U.storeName,[],function(tt,nt){var st=nt.rows.item(0).c;H(st)},function(tt,nt){j(nt)})})}).catch(j)});return f(N,I),N}function D(I,O){var N=this,H=new d(function(j,U){N.ready().then(function(){var Z=N._dbInfo;Z.db.transaction(function(tt){z(tt,Z,"SELECT key FROM "+Z.storeName+" WHERE id = ? LIMIT 1",[I+1],function(nt,st){var rt=st.rows.length?st.rows.item(0).key:null;j(rt)},function(nt,st){U(st)})})}).catch(U)});return f(H,O),H}function M(I){var O=this,N=new d(function(H,j){O.ready().then(function(){var U=O._dbInfo;U.db.transaction(function(Z){z(Z,U,"SELECT key FROM "+U.storeName,[],function(tt,nt){for(var st=[],rt=0;rt<nt.rows.length;rt++)st.push(nt.rows.item(rt).key);H(st)},function(tt,nt){j(nt)})})}).catch(j)});return f(N,I),N}function q(I){return new d(function(O,N){I.transaction(function(H){H.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(j,U){for(var Z=[],tt=0;tt<U.rows.length;tt++)Z.push(U.rows.item(tt).name);O({db:I,storeNames:Z})},function(j,U){N(U)})},function(H){N(H)})})}function bt(I,O){O=y.apply(this,arguments);var N=this.config();I=typeof I!="function"&&I||{},I.name||(I.name=I.name||N.name,I.storeName=I.storeName||N.storeName);var H=this,j;return I.name?j=new d(function(U){var Z;I.name===N.name?Z=H._dbInfo.db:Z=openDatabase(I.name,"","",0),I.storeName?U({db:Z,storeNames:[I.storeName]}):U(q(Z))}).then(function(U){return new d(function(Z,tt){U.db.transaction(function(nt){function st(te){return new d(function(ee,Le){nt.executeSql("DROP TABLE IF EXISTS "+te,[],function(){ee()},function(Te,hn){Le(hn)})})}for(var rt=[],yt=0,zt=U.storeNames.length;yt<zt;yt++)rt.push(st(U.storeNames[yt]));d.all(rt).then(function(){Z()}).catch(function(te){tt(te)})},function(nt){tt(nt)})})}):j=d.reject("Invalid arguments"),f(j,O),j}var dt={_driver:"webSQLStorage",_initStorage:pt,_support:qe(),iterate:S,getItem:Y,setItem:Tt,removeItem:v,clear:V,length:$,key:D,keys:M,dropInstance:bt};function ft(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function jt(I,O){var N=I.name+"/";return I.storeName!==O.storeName&&(N+=I.storeName+"/"),N}function Dn(){var I="_localforage_support_test";try{return localStorage.setItem(I,!0),localStorage.removeItem(I),!1}catch{return!0}}function pe(){return!Dn()||localStorage.length>0}function qt(I){var O=this,N={};if(I)for(var H in I)N[H]=I[H];return N.keyPrefix=jt(I,O._defaultConfig),pe()?(O._dbInfo=N,N.serializer=Q,d.resolve()):d.reject()}function Ce(I){var O=this,N=O.ready().then(function(){for(var H=O._dbInfo.keyPrefix,j=localStorage.length-1;j>=0;j--){var U=localStorage.key(j);U.indexOf(H)===0&&localStorage.removeItem(U)}});return f(N,I),N}function Ve(I,O){var N=this;I=b(I);var H=N.ready().then(function(){var j=N._dbInfo,U=localStorage.getItem(j.keyPrefix+I);return U&&(U=j.serializer.deserialize(U)),U});return f(H,O),H}function hi(I,O){var N=this,H=N.ready().then(function(){for(var j=N._dbInfo,U=j.keyPrefix,Z=U.length,tt=localStorage.length,nt=1,st=0;st<tt;st++){var rt=localStorage.key(st);if(rt.indexOf(U)===0){var yt=localStorage.getItem(rt);if(yt&&(yt=j.serializer.deserialize(yt)),yt=I(yt,rt.substring(Z),nt++),yt!==void 0)return yt}}});return f(H,O),H}function _o(I,O){var N=this,H=N.ready().then(function(){var j=N._dbInfo,U;try{U=localStorage.key(I)}catch{U=null}return U&&(U=U.substring(j.keyPrefix.length)),U});return f(H,O),H}function Ao(I){var O=this,N=O.ready().then(function(){for(var H=O._dbInfo,j=localStorage.length,U=[],Z=0;Z<j;Z++){var tt=localStorage.key(Z);tt.indexOf(H.keyPrefix)===0&&U.push(tt.substring(H.keyPrefix.length))}return U});return f(N,I),N}function Ae(I){var O=this,N=O.keys().then(function(H){return H.length});return f(N,I),N}function Ni(I,O){var N=this;I=b(I);var H=N.ready().then(function(){var j=N._dbInfo;localStorage.removeItem(j.keyPrefix+I)});return f(H,O),H}function Be(I,O,N){var H=this;I=b(I);var j=H.ready().then(function(){O===void 0&&(O=null);var U=O;return new d(function(Z,tt){var nt=H._dbInfo;nt.serializer.serialize(O,function(st,rt){if(rt)tt(rt);else try{localStorage.setItem(nt.keyPrefix+I,st),Z(U)}catch(yt){(yt.name==="QuotaExceededError"||yt.name==="NS_ERROR_DOM_QUOTA_REACHED")&&tt(yt),tt(yt)}})})});return f(j,N),j}function kn(I,O){if(O=y.apply(this,arguments),I=typeof I!="function"&&I||{},!I.name){var N=this.config();I.name=I.name||N.name,I.storeName=I.storeName||N.storeName}var H=this,j;return I.name?j=new d(function(U){I.storeName?U(jt(I,H._defaultConfig)):U(I.name+"/")}).then(function(U){for(var Z=localStorage.length-1;Z>=0;Z--){var tt=localStorage.key(Z);tt.indexOf(U)===0&&localStorage.removeItem(tt)}}):j=d.reject("Invalid arguments"),f(j,O),j}var ln={_driver:"localStorageWrapper",_initStorage:qt,_support:ft(),iterate:hi,getItem:Ve,setItem:Be,removeItem:Ni,clear:Ce,length:Ae,key:_o,keys:Ao,dropInstance:kn},Sc=function(O,N){return O===N||typeof O=="number"&&typeof N=="number"&&isNaN(O)&&isNaN(N)},My=function(O,N){for(var H=O.length,j=0;j<H;){if(Sc(O[j],N))return!0;j++}return!1},cm=Array.isArray||function(I){return Object.prototype.toString.call(I)==="[object Array]"},ih={},dm={},Eo={INDEXEDDB:Yt,WEBSQL:dt,LOCALSTORAGE:ln},By=[Eo.INDEXEDDB._driver,Eo.WEBSQL._driver,Eo.LOCALSTORAGE._driver],Cc=["dropInstance"],Ef=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Cc),zy={description:"",driver:By.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Uy(I,O){I[O]=function(){var N=arguments;return I.ready().then(function(){return I[O].apply(I,N)})}}function xf(){for(var I=1;I<arguments.length;I++){var O=arguments[I];if(O)for(var N in O)O.hasOwnProperty(N)&&(cm(O[N])?arguments[0][N]=O[N].slice():arguments[0][N]=O[N])}return arguments[0]}var Hy=function(){function I(O){r(this,I);for(var N in Eo)if(Eo.hasOwnProperty(N)){var H=Eo[N],j=H._driver;this[N]=j,ih[j]||this.defineDriver(H)}this._defaultConfig=xf({},zy),this._config=xf({},this._defaultConfig,O),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return I.prototype.config=function(N){if((typeof N>"u"?"undefined":s(N))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var H in N){if(H==="storeName"&&(N[H]=N[H].replace(/\W/g,"_")),H==="version"&&typeof N[H]!="number")return new Error("Database version must be a number.");this._config[H]=N[H]}return"driver"in N&&N.driver?this.setDriver(this._config.driver):!0}else return typeof N=="string"?this._config[N]:this._config},I.prototype.defineDriver=function(N,H,j){var U=new d(function(Z,tt){try{var nt=N._driver,st=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!N._driver){tt(st);return}for(var rt=Ef.concat("_initStorage"),yt=0,zt=rt.length;yt<zt;yt++){var te=rt[yt],ee=!My(Cc,te);if((ee||N[te])&&typeof N[te]!="function"){tt(st);return}}var Le=function(){for(var nh=function(qy){return function(){var Vy=new Error("Method "+qy+" is not implemented by the current driver"),fm=d.reject(Vy);return f(fm,arguments[arguments.length-1]),fm}},Sf=0,Wy=Cc.length;Sf<Wy;Sf++){var Cf=Cc[Sf];N[Cf]||(N[Cf]=nh(Cf))}};Le();var Te=function(nh){ih[nt]&&console.info("Redefining LocalForage driver: "+nt),ih[nt]=N,dm[nt]=nh,Z()};"_support"in N?N._support&&typeof N._support=="function"?N._support().then(Te,tt):Te(!!N._support):Te(!0)}catch(hn){tt(hn)}});return p(U,H,j),U},I.prototype.driver=function(){return this._driver||null},I.prototype.getDriver=function(N,H,j){var U=ih[N]?d.resolve(ih[N]):d.reject(new Error("Driver not found."));return p(U,H,j),U},I.prototype.getSerializer=function(N){var H=d.resolve(Q);return p(H,N),H},I.prototype.ready=function(N){var H=this,j=H._driverSet.then(function(){return H._ready===null&&(H._ready=H._initDriver()),H._ready});return p(j,N,N),j},I.prototype.setDriver=function(N,H,j){var U=this;cm(N)||(N=[N]);var Z=this._getSupportedDrivers(N);function tt(){U._config.driver=U.driver()}function nt(yt){return U._extend(yt),tt(),U._ready=U._initStorage(U._config),U._ready}function st(yt){return function(){var zt=0;function te(){for(;zt<yt.length;){var ee=yt[zt];return zt++,U._dbInfo=null,U._ready=null,U.getDriver(ee).then(nt).catch(te)}tt();var Le=new Error("No available storage method found.");return U._driverSet=d.reject(Le),U._driverSet}return te()}}var rt=this._driverSet!==null?this._driverSet.catch(function(){return d.resolve()}):d.resolve();return this._driverSet=rt.then(function(){var yt=Z[0];return U._dbInfo=null,U._ready=null,U.getDriver(yt).then(function(zt){U._driver=zt._driver,tt(),U._wrapLibraryMethodsWithReady(),U._initDriver=st(Z)})}).catch(function(){tt();var yt=new Error("No available storage method found.");return U._driverSet=d.reject(yt),U._driverSet}),p(this._driverSet,H,j),this._driverSet},I.prototype.supports=function(N){return!!dm[N]},I.prototype._extend=function(N){xf(this,N)},I.prototype._getSupportedDrivers=function(N){for(var H=[],j=0,U=N.length;j<U;j++){var Z=N[j];this.supports(Z)&&H.push(Z)}return H},I.prototype._wrapLibraryMethodsWithReady=function(){for(var N=0,H=Ef.length;N<H;N++)Uy(this,Ef[N])},I.prototype.createInstance=function(N){return new I(N)},I}(),jy=new Hy;i.exports=jy},{3:3}]},{},[4])(4)})})(Ty);var XE=Ty.exports;const cv=eh(XE);class Dy{constructor(t,e,i){this.urlCache={},this.storage=void 0,this.name=t,this.requester=e||jh,this.resolver=i,this.online=!0,this.checkRequirements(),this.addListeners()}checkRequirements(){try{let t;typeof cv>"u"&&(t=cv),this.storage=t.createInstance({name:this.name})}catch{throw new Error("localForage lib not loaded")}}addListeners(){this._status=this.status.bind(this),window.addEventListener("online",this._status),window.addEventListener("offline",this._status)}removeListeners(){window.removeEventListener("online",this._status),window.removeEventListener("offline",this._status),this._status=void 0}status(t){let e=navigator.onLine;this.online=e,e?this.emit("online",this):this.emit("offline",this)}add(t,e){let i=t.resources.map(n=>{let{href:s}=n,r=this.resolver(s),a=window.encodeURIComponent(r);return this.storage.getItem(a).then(l=>!l||e?this.requester(r,"binary").then(u=>this.storage.setItem(a,u)):l)});return Promise.all(i)}put(t,e,i){let n=window.encodeURIComponent(t);return this.storage.getItem(n).then(s=>s||this.requester(t,"binary",e,i).then(r=>this.storage.setItem(n,r)))}request(t,e,i,n){return this.online?this.requester(t,e,i,n).then(s=>(this.put(t),s)):this.retrieve(t,e)}retrieve(t,e){new Gt;var i,n=new cr(t);return e||(e=n.extension),e=="blob"?i=this.getBlob(t):i=this.getText(t),i.then(s=>{var r=new Gt,a;return s?(a=this.handleResponse(s,e),r.resolve(a)):r.reject({message:"File not found in storage: "+t,stack:new Error().stack}),r.promise})}handleResponse(t,e){var i;return e=="json"?i=JSON.parse(t):Hh(e)?i=_s(t,"text/xml"):e=="xhtml"?i=_s(t,"application/xhtml+xml"):e=="html"||e=="htm"?i=_s(t,"text/html"):i=t,i}getBlob(t,e){let i=window.encodeURIComponent(t);return this.storage.getItem(i).then(function(n){if(n)return e=e||qo.lookup(t),new Blob([n],{type:e})})}getText(t,e){let i=window.encodeURIComponent(t);return e=e||qo.lookup(t),this.storage.getItem(i).then(function(n){var s=new Gt,r=new FileReader,a;if(n)return a=new Blob([n],{type:e}),r.addEventListener("loadend",()=>{s.resolve(r.result)}),r.readAsText(a,e),s.promise})}getBase64(t,e){let i=window.encodeURIComponent(t);return e=e||qo.lookup(t),this.storage.getItem(i).then(n=>{var s=new Gt,r=new FileReader,a;if(n)return a=new Blob([n],{type:e}),r.addEventListener("loadend",()=>{s.resolve(r.result)}),r.readAsDataURL(a,e),s.promise})}createUrl(t,e){var i=new Gt,n=window.URL||window.webkitURL||window.mozURL,s,r,a=e&&e.base64;return t in this.urlCache?(i.resolve(this.urlCache[t]),i.promise):(a?(r=this.getBase64(t),r&&r.then((function(l){this.urlCache[t]=l,i.resolve(l)}).bind(this))):(r=this.getBlob(t),r&&r.then((function(l){s=n.createObjectURL(l),this.urlCache[t]=s,i.resolve(s)}).bind(this))),r||i.reject({message:"File not found in storage: "+t,stack:new Error().stack}),i.promise)}revokeUrl(t){var e=window.URL||window.webkitURL||window.mozURL,i=this.urlCache[t];i&&e.revokeObjectURL(i)}destroy(){var t=window.URL||window.webkitURL||window.mozURL;for(let e in this.urlCache)t.revokeObjectURL(e);this.urlCache={},this.removeListeners()}}Es(Dy.prototype);class Gf{constructor(t){this.interactive="",this.fixedLayout="",this.openToSpread="",this.orientationLock="",t&&this.parse(t)}parse(t){if(!t)return this;const e=oe(t,"display_options");return e?(ur(e,"option").forEach(n=>{let s="";switch(n.childNodes.length&&(s=n.childNodes[0].nodeValue),n.attributes.name.value){case"interactive":this.interactive=s;break;case"fixed-layout":this.fixedLayout=s;break;case"open-to-spread":this.openToSpread=s;break;case"orientation-lock":this.orientationLock=s;break}}),this):this}destroy(){this.interactive=void 0,this.fixedLayout=void 0,this.openToSpread=void 0,this.orientationLock=void 0}}const dv="META-INF/container.xml",YE="META-INF/com.apple.ibooks.display-options.xml",Rn={BINARY:"binary",BASE64:"base64",EPUB:"epub",OPF:"opf",MANIFEST:"json",DIRECTORY:"directory"};class im{constructor(t,e){typeof e>"u"&&typeof t!="string"&&!(t instanceof Blob)&&!(t instanceof ArrayBuffer)&&(e=t,t=void 0),this.settings=oi(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0,canonical:void 0,openAs:void 0,store:void 0}),oi(this.settings,e),this.opening=new Gt,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new Gt,spine:new Gt,metadata:new Gt,cover:new Gt,navigation:new Gt,pageList:new Gt,resources:new Gt,displayOptions:new Gt},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise,displayOptions:this.loading.displayOptions.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources,this.loaded.displayOptions]),this.isRendered=!1,this.request=this.settings.requestMethod||jh,this.spine=new pA,this.locations=new uy(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.storage=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,this.displayOptions=void 0,this.settings.store&&this.store(this.settings.store),t&&this.open(t,this.settings.openAs).catch(i=>{var n=new Error("Cannot load book at "+t);this.emit(ut.BOOK.OPEN_FAILED,n)})}open(t,e){var i,n=e||this.determineType(t);return n===Rn.BINARY?(this.archived=!0,this.url=new Nn("/",""),i=this.openEpub(t)):n===Rn.BASE64?(this.archived=!0,this.url=new Nn("/",""),i=this.openEpub(t,n)):n===Rn.EPUB?(this.archived=!0,this.url=new Nn("/",""),i=this.request(t,"binary",this.settings.requestCredentials,this.settings.requestHeaders).then(this.openEpub.bind(this))):n==Rn.OPF?(this.url=new Nn(t),i=this.openPackaging(this.url.Path.toString())):n==Rn.MANIFEST?(this.url=new Nn(t),i=this.openManifest(this.url.Path.toString())):(this.url=new Nn(t),i=this.openContainer(dv).then(this.openPackaging.bind(this))),i}openEpub(t,e){return this.unarchive(t,e||this.settings.encoding).then(()=>this.openContainer(dv)).then(i=>this.openPackaging(i))}openContainer(t){return this.load(t).then(e=>(this.container=new gA(e),this.resolve(this.container.packagePath)))}openPackaging(t){return this.path=new cr(t),this.load(t).then(e=>(this.packaging=new nv(e),this.unpack(this.packaging)))}openManifest(t){return this.path=new cr(t),this.load(t).then(e=>(this.packaging=new nv,this.packaging.load(e),this.unpack(this.packaging)))}load(t){var e=this.resolve(t);return this.archived?this.archive.request(e):this.request(e,null,this.settings.requestCredentials,this.settings.requestHeaders)}resolve(t,e){if(t){var i=t,n=t.indexOf("://")>-1;return n?t:(this.path&&(i=this.path.resolve(t)),e!=!1&&this.url&&(i=this.url.resolve(i)),i)}}canonical(t){var e=t;return t?(this.settings.canonical?e=this.settings.canonical(t):e=this.resolve(t,!0),e):""}determineType(t){var e,i,n;if(this.settings.encoding==="base64")return Rn.BASE64;if(typeof t!="string")return Rn.BINARY;if(e=new Nn(t),i=e.path(),n=i.extension,n&&(n=n.replace(/\?.*$/,"")),!n)return Rn.DIRECTORY;if(n==="epub")return Rn.EPUB;if(n==="opf")return Rn.OPF;if(n==="json")return Rn.MANIFEST}unpack(t){this.package=t,this.packaging.metadata.layout===""?this.load(this.url.resolve(YE)).then(e=>{this.displayOptions=new Gf(e),this.loading.displayOptions.resolve(this.displayOptions)}).catch(e=>{this.displayOptions=new Gf,this.loading.displayOptions.resolve(this.displayOptions)}):(this.displayOptions=new Gf,this.loading.displayOptions.resolve(this.displayOptions)),this.spine.unpack(this.packaging,this.resolve.bind(this),this.canonical.bind(this)),this.resources=new yA(this.packaging.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||(this.archived?"blobUrl":"base64")}),this.loadNavigation(this.packaging).then(()=>{this.loading.navigation.resolve(this.navigation)}),this.packaging.coverPath&&(this.cover=this.resolve(this.packaging.coverPath)),this.loading.manifest.resolve(this.packaging.manifest),this.loading.metadata.resolve(this.packaging.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&this.settings.replacements!="none"?this.replacements().then(()=>{this.loaded.displayOptions.then(()=>{this.opening.resolve(this)})}).catch(e=>{console.error(e)}):this.loaded.displayOptions.then(()=>{this.opening.resolve(this)})}loadNavigation(t){let e=t.navPath||t.ncxPath,i=t.toc;return i?new Promise((n,s)=>{this.navigation=new Wf(i),t.pageList&&(this.pageList=new qf(t.pageList)),n(this.navigation)}):e?this.load(e,"xml").then(n=>(this.navigation=new Wf(n),this.pageList=new qf(n),this.navigation)):new Promise((n,s)=>{this.navigation=new Wf,this.pageList=new qf,n(this.navigation)})}section(t){return this.spine.get(t)}renderTo(t,e){return this.rendition=new em(this,e),this.rendition.attachTo(t),this.rendition}setRequestCredentials(t){this.settings.requestCredentials=t}setRequestHeaders(t){this.settings.requestHeaders=t}unarchive(t,e){return this.archive=new $E,this.archive.open(t,e)}store(t){let e=this.settings.replacements&&this.settings.replacements!=="none",i=this.url,n=this.settings.requestMethod||jh.bind(this);return this.storage=new Dy(t,n,this.resolve.bind(this)),this.request=this.storage.request.bind(this.storage),this.opened.then(()=>{this.archived&&(this.storage.requester=this.archive.request.bind(this.archive));let s=(r,a)=>{a.output=this.resources.substitute(r,a.url)};this.resources.settings.replacements=e||"blobUrl",this.resources.replacements().then(()=>this.resources.replaceCss()),this.storage.on("offline",()=>{this.url=new Nn("/",""),this.spine.hooks.serialize.register(s)}),this.storage.on("online",()=>{this.url=i,this.spine.hooks.serialize.deregister(s)})}),this.storage}coverUrl(){return this.loaded.cover.then(()=>this.cover?this.archived?this.archive.createUrl(this.cover):this.cover:null)}replacements(){return this.spine.hooks.serialize.register((t,e)=>{e.output=this.resources.substitute(t,e.url)}),this.resources.replacements().then(()=>this.resources.replaceCss())}getRange(t){var e=new $t(t),i=this.spine.get(e.spinePos),n=this.load.bind(this);return i?i.load(n).then(function(s){var r=e.toRange(i.document);return r}):new Promise((s,r)=>{r("CFI could not be found")})}key(t){var e=t||this.packaging.metadata.identifier||this.url.filename;return`epubjs:${bf}:${e}`}destroy(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.displayOptions&&this.displayOptions.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1}}Es(im.prototype);function wo(o,t){return new im(o,t)}wo.VERSION=bf;typeof global<"u"&&(global.EPUBJS_VERSION=bf);wo.Book=im;wo.Rendition=em;wo.Contents=Qg;wo.CFI=$t;wo.utils=aA;$2.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${Y2}/pdf.worker.min.js`;class KE{async parseFile(t){const e=t.name.split(".").pop().toLowerCase();if(e==="txt")return await this.readText(t);if(e==="pdf")return await this.readPdf(t);if(e==="epub")return await this.readEpub(t);throw new Error("Formato no soportado. Use TXT, PDF o EPUB.")}readText(t){return new Promise((e,i)=>{const n=new FileReader;n.onload=s=>e(s.target.result),n.onerror=s=>i(s),n.readAsText(t)})}async readPdf(t){const e=await t.arrayBuffer(),i=await X2({data:e}).promise;let n="";for(let s=1;s<=i.numPages;s++){const l=(await(await i.getPage(s)).getTextContent()).items.map(u=>u.str).join(" ");n+=l+`

`}return n}async readEpub(t){return new Promise((e,i)=>{const n=new FileReader;n.onload=s=>{const r=wo(s.target.result);let a="";r.loaded.spine.then(async()=>{const l=r.spine;for(const u of l.spineItems)try{const c=await u.load(r.load.bind(r)),d=c.body.textContent||c.body.innerText;a+=d+`

`}catch(c){console.warn("Could not load section",u,c)}e(a)}).catch(i)},n.onerror=i,n.readAsArrayBuffer(t)})}}class ZE{constructor(){this.defaultPattern=/(CAP[IÍ]TULO\s+\d+|CHAPTER\s+\d+|PARTE\s+\d+|SECCI[OÓ]N\s+\d+|Cap[ií]tulo\s+\d+|Chapter\s+\d+|Parte\s+\d+)/i}split(t,e=null){let i=[];if(e&&e.trim()){const r=e.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=new RegExp(`(${r})`,"g");i=[...t.matchAll(a)]}else i=[...t.matchAll(new RegExp(this.defaultPattern,"g"))];if(!i||i.length===0){const s=[],r=t.trim(),a=5e3;for(let l=0;l<r.length;l+=a)s.push({id:Math.floor(l/a),titulo:`Parte ${(Math.floor(l/a)+1).toString().padStart(3,"0")}`,contenido:r.substring(l,l+a),chars:Math.min(a,r.length-l)});return s.length>0?s:[{id:0,titulo:"Completo",contenido:t,chars:t.length}]}const n=[];for(let s=0;s<i.length;s++){const r=i[s],a=r[0].trim(),l=r.index+r[0].length,u=s+1<i.length?i[s+1].index:t.length,c=t.substring(l,u).trim();n.push({id:s,titulo:a,contenido:c,chars:c.length})}return n}}const QE="modulepreload",JE=function(o){return"/"+o},fv={},ky=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),a=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));n=Promise.allSettled(e.map(l=>{if(l=JE(l),l in fv)return;fv[l]=!0;const u=l.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":QE,u||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),u)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return n.then(r=>{for(const a of r||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const t1=o=>{const t=new Map;t.set("web",{name:"web"});const e=o.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t},i=(s,r)=>{e.platforms.set(s,r)},n=s=>{e.platforms.has(s)&&(e.currentPlatform=e.platforms.get(s))};return e.addPlatform=i,e.setPlatform=n,e},e1=o=>o.CapacitorPlatforms=t1(o),Ry=e1(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});Ry.addPlatform;Ry.setPlatform;var th;(function(o){o.Unimplemented="UNIMPLEMENTED",o.Unavailable="UNAVAILABLE"})(th||(th={}));class $f extends Error{constructor(t,e,i){super(t),this.message=t,this.code=e,this.data=i}}const i1=o=>{var t,e;return o!=null&&o.androidBridge?"android":!((e=(t=o==null?void 0:o.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||e===void 0)&&e.bridge?"ios":"web"},n1=o=>{var t,e,i,n,s;const r=o.CapacitorCustomPlatform||null,a=o.Capacitor||{},l=a.Plugins=a.Plugins||{},u=o.CapacitorPlatforms,c=()=>r!==null?r.name:i1(o),d=((t=u==null?void 0:u.currentPlatform)===null||t===void 0?void 0:t.getPlatform)||c,f=()=>d()!=="web",p=((e=u==null?void 0:u.currentPlatform)===null||e===void 0?void 0:e.isNativePlatform)||f,b=k=>{const P=R.get(k);return!!(P!=null&&P.platforms.has(d())||m(k))},y=((i=u==null?void 0:u.currentPlatform)===null||i===void 0?void 0:i.isPluginAvailable)||b,g=k=>{var P;return(P=a.PluginHeaders)===null||P===void 0?void 0:P.find(F=>F.name===k)},m=((n=u==null?void 0:u.currentPlatform)===null||n===void 0?void 0:n.getPluginHeader)||g,w=k=>o.console.error(k),E=(k,P,F)=>Promise.reject(`${F} does not have an implementation of "${P}".`),R=new Map,A=(k,P={})=>{const F=R.get(k);if(F)return console.warn(`Capacitor plugin "${k}" already registered. Cannot register plugins twice.`),F.proxy;const B=d(),W=m(k);let G;const et=async()=>(!G&&B in P?G=typeof P[B]=="function"?G=await P[B]():G=P[B]:r!==null&&!G&&"web"in P&&(G=typeof P.web=="function"?G=await P.web():G=P.web),G),ot=(xt,_t)=>{var at,At;if(W){const Rt=W==null?void 0:W.methods.find(Wt=>_t===Wt.name);if(Rt)return Rt.rtype==="promise"?Wt=>a.nativePromise(k,_t.toString(),Wt):(Wt,Ft)=>a.nativeCallback(k,_t.toString(),Wt,Ft);if(xt)return(at=xt[_t])===null||at===void 0?void 0:at.bind(xt)}else{if(xt)return(At=xt[_t])===null||At===void 0?void 0:At.bind(xt);throw new $f(`"${k}" plugin is not implemented on ${B}`,th.Unimplemented)}},ct=xt=>{let _t;const at=(...At)=>{const Rt=et().then(Wt=>{const Ft=ot(Wt,xt);if(Ft){const St=Ft(...At);return _t=St==null?void 0:St.remove,St}else throw new $f(`"${k}.${xt}()" is not implemented on ${B}`,th.Unimplemented)});return xt==="addListener"&&(Rt.remove=async()=>_t()),Rt};return at.toString=()=>`${xt.toString()}() { [capacitor code] }`,Object.defineProperty(at,"name",{value:xt,writable:!1,configurable:!1}),at},X=ct("addListener"),K=ct("removeListener"),lt=(xt,_t)=>{const at=X({eventName:xt},_t),At=async()=>{const Wt=await at;K({eventName:xt,callbackId:Wt},_t)},Rt=new Promise(Wt=>at.then(()=>Wt({remove:At})));return Rt.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await At()},Rt},Ct=new Proxy({},{get(xt,_t){switch(_t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return W?lt:X;case"removeListener":return K;default:return ct(_t)}}});return l[k]=Ct,R.set(k,{name:k,proxy:Ct,platforms:new Set([...Object.keys(P),...W?[B]:[]])}),Ct},T=((s=u==null?void 0:u.currentPlatform)===null||s===void 0?void 0:s.registerPlugin)||A;return a.convertFileSrc||(a.convertFileSrc=k=>k),a.getPlatform=d,a.handleError=w,a.isNativePlatform=p,a.isPluginAvailable=y,a.pluginMethodNoop=E,a.registerPlugin=T,a.Exception=$f,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a.platform=a.getPlatform(),a.isNative=a.isNativePlatform(),a},s1=o=>o.Capacitor=n1(o),Od=s1(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Af=Od.registerPlugin;Od.Plugins;class Iy{constructor(t){this.listeners={},this.retainedEventArguments={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,e){let i=!1;this.listeners[t]||(this.listeners[t]=[],i=!0),this.listeners[t].push(e);const s=this.windowListeners[t];s&&!s.registered&&this.addWindowListener(s),i&&this.sendRetainedArgumentsForEvent(t);const r=async()=>this.removeListener(t,e);return Promise.resolve({remove:r})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,e,i){const n=this.listeners[t];if(!n){if(i){let s=this.retainedEventArguments[t];s||(s=[]),s.push(e),this.retainedEventArguments[t]=s}return}n.forEach(s=>s(e))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,e){this.windowListeners[e]={registered:!1,windowEventName:t,pluginEventName:e,handler:i=>{this.notifyListeners(e,i)}}}unimplemented(t="not implemented"){return new Od.Exception(t,th.Unimplemented)}unavailable(t="not available"){return new Od.Exception(t,th.Unavailable)}async removeListener(t,e){const i=this.listeners[t];if(!i)return;const n=i.indexOf(e);this.listeners[t].splice(n,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const e=this.retainedEventArguments[t];e&&(delete this.retainedEventArguments[t],e.forEach(i=>{this.notifyListeners(t,i)}))}}const pv=o=>encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),gv=o=>o.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class r1 extends Iy{async getCookies(){const t=document.cookie,e={};return t.split(";").forEach(i=>{if(i.length<=0)return;let[n,s]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=gv(n).trim(),s=gv(s).trim(),e[n]=s}),e}async setCookie(t){try{const e=pv(t.key),i=pv(t.value),n=`; expires=${(t.expires||"").replace("expires=","")}`,s=(t.path||"/").replace("path=",""),r=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${e}=${i||""}${n}; path=${s}; ${r};`}catch(e){return Promise.reject(e)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const e of t)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}Af("CapacitorCookies",{web:()=>new r1});const a1=async o=>new Promise((t,e)=>{const i=new FileReader;i.onload=()=>{const n=i.result;t(n.indexOf(",")>=0?n.split(",")[1]:n)},i.onerror=n=>e(n),i.readAsDataURL(o)}),o1=(o={})=>{const t=Object.keys(o);return Object.keys(o).map(n=>n.toLocaleLowerCase()).reduce((n,s,r)=>(n[s]=o[t[r]],n),{})},l1=(o,t=!0)=>o?Object.entries(o).reduce((i,n)=>{const[s,r]=n;let a,l;return Array.isArray(r)?(l="",r.forEach(u=>{a=t?encodeURIComponent(u):u,l+=`${s}=${a}&`}),l.slice(0,-1)):(a=t?encodeURIComponent(r):r,l=`${s}=${a}`),`${i}&${l}`},"").substr(1):null,h1=(o,t={})=>{const e=Object.assign({method:o.method||"GET",headers:o.headers},t),n=o1(o.headers)["content-type"]||"";if(typeof o.data=="string")e.body=o.data;else if(n.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[r,a]of Object.entries(o.data||{}))s.set(r,a);e.body=s.toString()}else if(n.includes("multipart/form-data")||o.data instanceof FormData){const s=new FormData;if(o.data instanceof FormData)o.data.forEach((a,l)=>{s.append(l,a)});else for(const a of Object.keys(o.data))s.append(a,o.data[a]);e.body=s;const r=new Headers(e.headers);r.delete("content-type"),e.headers=r}else(n.includes("application/json")||typeof o.data=="object")&&(e.body=JSON.stringify(o.data));return e};class u1 extends Iy{async request(t){const e=h1(t,t.webFetchExtra),i=l1(t.params,t.shouldEncodeUrlParams),n=i?`${t.url}?${i}`:t.url,s=await fetch(n,e),r=s.headers.get("content-type")||"";let{responseType:a="text"}=s.ok?t:{};r.includes("application/json")&&(a="json");let l,u;switch(a){case"arraybuffer":case"blob":u=await s.blob(),l=await a1(u);break;case"json":l=await s.json();break;case"document":case"text":default:l=await s.text()}const c={};return s.headers.forEach((d,f)=>{c[f]=d}),{data:l,headers:c,status:s.status,url:s.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}Af("CapacitorHttp",{web:()=>new u1});var mv;(function(o){o[o.Flush=0]="Flush",o[o.Add=1]="Add"})(mv||(mv={}));const nm=Af("TextToSpeech",{web:()=>ky(()=>import("./web-JkzwxmpX.js"),[]).then(o=>new o.TextToSpeechWeb)});var _g;(function(o){o.Documents="DOCUMENTS",o.Data="DATA",o.Library="LIBRARY",o.Cache="CACHE",o.External="EXTERNAL",o.ExternalStorage="EXTERNAL_STORAGE"})(_g||(_g={}));var vv;(function(o){o.UTF8="utf8",o.ASCII="ascii",o.UTF16="utf16"})(vv||(vv={}));const c1=Af("Filesystem",{web:()=>ky(()=>import("./web-CVlGwd33.js"),[]).then(o=>new o.FilesystemWeb)});function bv(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(o){var t=Math.random()*16|0,e=o=="x"?t:t&3|8;return e.toString(16)})}class d1{constructor(){this.ws=null,this.voice="es-MX-DaliaNeural",this.rate="+0%",this.volume="+0%",this.pitch="+0Hz"}async getVoices(){try{const t=await fetch("https://speech.platform.bing.com/consumer/speech/synthesize/readaloud/voices/list?trustedclienttoken=6A5AA1D4EAFF4E9FB37E23D68491D6F4");if(!t.ok)throw new Error("Failed to fetch voices");return await t.json()}catch(t){return console.error("Error fetching Edge voices:",t),[]}}connect(){return new Promise((t,e)=>{const n=`wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1?TrustedClientToken=6A5AA1D4EAFF4E9FB37E23D68491D6F4&ConnectionId=${bv()}`;console.log("Connecting to Edge TTS..."),this.ws=new WebSocket(n),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{console.log("Edge TTS Connected"),t()},this.ws.onerror=s=>{console.error("Edge TTS Connection Error",s),e(new Error("WebSocket Connection Failed."))},this.ws.onclose=s=>{console.log("Edge TTS Disconnected",s.code,s.reason)}})}async synthesize(t,e,i="+0%",n){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)try{await this.connect()}catch(s){throw console.error(s),new Error("Could not connect to Edge Server. Check Internet.")}return new Promise((s,r)=>{const a=bv(),l=new Date().toString(),u=`X-Timestamp:${l}\r
Content-Type:application/json; charset=utf-8\r
Path:speech.config\r
\r
`+JSON.stringify({context:{synthesis:{audio:{metadataoptions:{sentenceBoundaryEnabled:!1,wordBoundaryEnabled:!1},outputFormat:"audio-24khz-48kbitrate-mono-mp3"}}}});try{this.ws.send(u);const d=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xml:lang='en-US'><voice name='${e}'><prosody pitch='${this.pitch}' rate='${i}' volume='${this.volume}'>${t}</prosody></voice></speak>`,f=`X-Timestamp:${l}\r
X-RequestId:${a}\r
Content-Type:application/ssml+xml\r
Path:ssml\r
\r
${d}`;this.ws.send(f)}catch{r(new Error("Failed to send message to server."));return}const c=[];this.ws.onmessage=async d=>{if(typeof d.data=="string"){if(d.data.includes("Path:turn.end")){this.ws.close();const f=new Blob(c,{type:"audio/mp3"});s(f)}}else if(d.data instanceof ArrayBuffer){const f=d.data,b=new DataView(f).getUint16(0);if(f.byteLength>b+2){const y=f.slice(b+2);c.push(y),n&&n(y)}}},this.ws.onclose=d=>{if(c.length>0){const f=new Blob(c,{type:"audio/mp3"});s(f)}else r(new Error(`Connection closed: ${d.code}`))},this.ws.onerror=d=>{r(new Error("WS Error during synthesis"))}})}}let Ag=null,Fd=[],Xf=!1,An="es",Zr=[],Yf=[],Md=[],ai=!1;const f1=new KE,p1=new ZE,sm=new d1,fd=document.getElementById("dropZone"),Kf=document.getElementById("fileInput"),Eg=document.getElementById("uploadSection"),Ly=document.getElementById("selectSection"),Py=document.getElementById("progressSection"),Ny=document.getElementById("resultsSection"),Oy=document.getElementById("fileName"),xg=document.getElementById("chapterList"),Fy=document.getElementById("btnConvert"),Ih=document.getElementById("voiceGrid"),g1=document.getElementById("splashOverlay"),Lh=document.getElementById("langSelect"),In=document.getElementById("localeSelect");document.addEventListener("DOMContentLoaded",()=>{m1(),y1()});function m1(){const o=document.getElementById("btnSourceNative"),t=document.getElementById("btnSourceCloud");o&&t&&(o.addEventListener("click",()=>{o.classList.add("active"),t.classList.remove("active"),Bd(!1)}),t.addEventListener("click",()=>{t.classList.add("active"),o.classList.remove("active"),Bd(!0)})),document.querySelectorAll(".splash-content .lang-option").forEach(e=>{e.addEventListener("click",()=>{const i=e.dataset.uiLang;zd(i),g1.style.display="none"})}),document.querySelectorAll(".settings-group .lang-option").forEach(e=>{e.addEventListener("click",()=>{const i=e.dataset.setLang;zd(i),document.querySelectorAll(".settings-group .lang-option").forEach(n=>n.style.border="1px solid #ddd"),e.style.border="2px solid var(--primary-color)"})}),fd.addEventListener("click",()=>Kf.click()),Kf.addEventListener("change",v1),document.getElementById("btnChangeFile").addEventListener("click",()=>{qh(Eg),Ag=null}),document.getElementById("btnNewConversion").addEventListener("click",()=>{qh(Eg),Ag=null,Fd=[],xg.innerHTML="",Kf.value=""}),document.getElementById("btnSelectAll").addEventListener("click",()=>{document.querySelectorAll(".chapter-checkbox").forEach(e=>e.checked=!0),Ud()}),document.getElementById("btnSelectNone").addEventListener("click",()=>{document.querySelectorAll(".chapter-checkbox").forEach(e=>e.checked=!1),Ud()}),Fy.addEventListener("click",x1),Lh.addEventListener("change",Sg),In.addEventListener("change",Sg),document.getElementById("btnSettings").addEventListener("click",()=>{document.getElementById("settingsModal").classList.add("active")}),document.getElementById("btnCloseSettings").addEventListener("click",()=>{document.getElementById("settingsModal").classList.remove("active")}),document.getElementById("btnSaveSettings").addEventListener("click",()=>{document.getElementById("settingsModal").classList.remove("active")})}async function Bd(o){if(!(ai===o&&Zr.length>0)){ai=o,console.log("Switched to",ai?"Cloud (Edge)":"Native"),Ih.innerHTML='<div style="grid-column: 1/-1; text-align:center; padding: 20px;"><div class="spinner"></div><p>Loading...</p></div>';try{ai?(Yf.length===0&&(Yf=await sm.getVoices()),Zr=Yf):Zr=(await nm.getSupportedVoices()).voices,w1(),Sg()}catch(t){console.error("Error loading source",t),Ih.innerHTML="<p>Error loading voices</p>"}}}function zd(o){if(!Zf[o])return;An=o,document.querySelectorAll("[data-i18n]").forEach(i=>{const n=i.dataset.i18n;Zf[o][n]&&(i.textContent=Zf[o][n])});const e=document.getElementById("customDivider");e&&(e.placeholder=o==="es"?"Ej: Chapter, ***, ---, Parte":"Ex: Chapter, ***, ---, Part"),console.log(`Language set to ${o}`)}function qh(o){[Eg,Ly,Py,Ny].forEach(t=>t.classList.remove("active")),o.classList.add("active")}async function v1(o){const t=o.target.files[0];if(t)try{Ag=t,Oy.textContent=t.name,fd.innerHTML="<p>Loading...</p>";const e=await f1.parseFile(t);fd.innerHTML='<div class="icon">📄</div><p data-i18n="drop_text">Arrastra tu libro aquí</p><p class="subtext" data-i18n="drop_hint">o haz clic para seleccionar</p>',zd(An),Fd=p1.split(e),b1(Fd),qh(Ly)}catch(e){alert("Error al leer archivo: "+e.message),console.error(e),fd.innerHTML='<div class="icon">📄</div><p>Error</p>',setTimeout(()=>zd(An),2e3)}}function b1(o){xg.innerHTML="",o.forEach(t=>{const e=document.createElement("div");e.className="chapter-item",e.innerHTML=`
            <label class="chapter-label" style="display: flex; align-items: center; width: 100%; cursor: pointer;">
                <input type="checkbox" class="chapter-checkbox" data-id="${t.id}" checked style="margin-right: 12px;">
                <div class="chapter-info">
                    <div class="chapter-title">${t.titulo}</div>
                    <div class="chapter-meta">${t.chars} ${An==="es"?"caracteres":"characters"}</div>
                </div>
            </label>
        `,xg.appendChild(e)}),document.querySelectorAll(".chapter-checkbox").forEach(t=>{t.addEventListener("change",Ud)}),Ud()}function Ud(){const o=document.querySelectorAll(".chapter-checkbox:checked");document.getElementById("selectedCount").textContent=`${o.length} ${An==="es"?"seleccionados":"selected"}`,Fy.disabled=o.length===0}async function y1(){await Bd(!1)}function w1(){let o=new Set;ai?Zr.forEach(e=>{e.Locale&&o.add(e.Locale.split("-")[0])}):Zr.forEach(e=>{e.lang&&o.add(e.lang.split("-")[0])});const t=[...o].sort();Lh.innerHTML=`<option value="">${An==="es"?"Todos los idiomas":"All languages"}</option>`,t.forEach(e=>{const i=document.createElement("option");i.value=e,i.textContent=e.toUpperCase(),Lh.appendChild(i)}),t.includes("es")&&(Lh.value="es")}function Sg(){const o=Lh.value,t=In.value;if(Md=Zr.filter(e=>{const i=ai?e.Locale:e.lang,n=i.split("-")[0];return!(o&&n!==o||t&&i!==t)}),o){const e=new Set;Md.forEach(n=>e.add(ai?n.Locale:n.lang));const i=[...e].sort();In.innerHTML=`<option value="">${An==="es"?"Todas las regiones":"All regions"}</option>`,i.forEach(n=>{const s=document.createElement("option");s.value=n,s.textContent=n,In.appendChild(s)}),In.style.display="block",i.includes(In.value)?In.value=In.value:In.value=""}else In.style.display="none",In.value="";_1()}let Ph=null;function _1(){if(Ih.innerHTML="",Md.length===0){Ih.innerHTML=`<p style="grid-column: 1/-1; text-align: center; padding: 20px;">${An==="es"?"No hay voces":"No voices"}</p>`;return}Md.forEach((o,t)=>{const e=ai?o.ShortName:Zr.indexOf(o),i=Ph===e,n=document.createElement("div");n.className=`voice-card ${i?"selected":""}`;const s=ai?o.LocalName||o.ShortName:o.name||o.lang,r=ai?o.Locale:o.lang,a=ai?o.Gender:"";n.innerHTML=`
            <div class="voice-header">
                <div class="voice-info">
                    <div class="voice-name">${s}</div> 
                    <div class="voice-meta">${r} ${a?`• ${a}`:""}</div>
                    ${ai?'<span style="font-size:0.7rem; color: #4ade80;">Cloud</span>':""}
                </div>
                <button class="btn-preview-voice" title="Preview">▶️</button>
            </div>
        `,n.onclick=l=>{if(l.target.classList.contains("btn-preview-voice")){l.stopPropagation(),E1(o);return}A1(e,n)},Ih.appendChild(n)})}function A1(o,t){document.querySelectorAll(".voice-card").forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),Ph=o}async function E1(o){const t=An==="es"?"Hola, soy una voz de prueba.":"Hello, I am a test voice.";if(ai)try{const e=await sm.synthesize(t,o.ShortName,"+0%"),i=URL.createObjectURL(e);new Audio(i).play()}catch(e){console.error(e),alert("Error: "+e.message)}else{const e=Zr.indexOf(o);try{await nm.speak({text:t,voice:e,rate:1,lang:o.lang})}catch(i){console.error(i)}}}async function x1(){if(Xf)return;if(Ph===null){alert(An==="es"?"Selecciona una voz primero":"Select a voice first");return}Xf=!0,qh(Py);const o=document.querySelectorAll(".chapter-checkbox:checked"),t=o.length;let e=0,i="";ai&&(i=Oy.textContent.replace(/\.[^/.]+$/,"").replace(/[^a-z0-9]/gi,"_"));for(const s of o){const r=parseInt(s.dataset.id),a=Fd.find(d=>d.id===r),l=a.titulo.replace(/[^a-z0-9]/gi,"_"),u=(An==="es"?"Convirtiendo: ":"Converting: ")+a.titulo;document.getElementById("progressStatus").textContent=u;try{if(ai){const d=await sm.synthesize(a.contenido,Ph),f=new FileReader;f.readAsDataURL(d),await new Promise(p=>{f.onloadend=async()=>{const b=f.result.split(",")[1],y=`${i}/${l}.mp3`;try{const g=await c1.writeFile({path:y,data:b,directory:_g.Documents,recursive:!0});console.log(`Saved ${y}`,g.uri)}catch(g){console.error("Save error",g),alert("Error saving file: "+g.message)}p()}})}else await nm.speak({text:a.contenido,voice:Ph,rate:1,lang:"es-ES"})}catch(d){console.error("Conversion error",d)}e++;const c=Math.round(e/t*100);document.getElementById("progressBar").style.width=`${c}%`,document.getElementById("progressPercent").textContent=`${c}%`}Xf=!1,qh(Ny);const n=An==="es"?ai?"Archivos guardados en Documentos":"Lectura finalizada":ai?"Files saved to Documents":"Reading finished";document.getElementById("results-header-text").textContent=n}window.setVoiceSource=Bd;const Zf={es:{title:"Conversor de Audiolibros",subtitle:"TXT • PDF • EPUB → MP3",step_upload:"Subir",step_select:"Seleccionar",step_convert:"Convertir",drop_text:"Arrastra tu libro aquí",drop_hint:"o haz clic para seleccionar • TXT, PDF, EPUB",btn_change:"Cambiar",voice_title:"🗣️ Voz del narrador",voice_lang:"🌐 Idioma",divider_title:"✂️ Separador de capítulos",chapters_title:"📖 Capítulos a convertir",btn_all:"✓ Todos",btn_none:"✗ Ninguno",btn_convert:"🎙️ Convertir seleccionados",results_done:"¡Conversión completada!",btn_new:"📚 Convertir otro libro",settings_title:"⚙️ Configuración",settings_lang:"🌐 Idioma",btn_cancel:"Cancelar",btn_save:"Aceptar"},en:{title:"Audiobook Converter",subtitle:"TXT • PDF • EPUB → MP3",step_upload:"Upload",step_select:"Select",step_convert:"Convert",drop_text:"Drag your book here",drop_hint:"or click to select • TXT, PDF, EPUB",btn_change:"Change",voice_title:"🗣️ Narrator Voice",voice_lang:"🌐 Language",divider_title:"✂️ Chapter Splitter",chapters_title:"📖 Chapters to convert",btn_all:"✓ All",btn_none:"✗ None",btn_convert:"🎙️ Convert selected",results_done:"Conversion complete!",btn_new:"📚 Convert another book",settings_title:"⚙️ Settings",settings_lang:"🌐 Language",btn_cancel:"Cancel",btn_save:"OK"}};export{vv as E,Iy as W,h1 as b};

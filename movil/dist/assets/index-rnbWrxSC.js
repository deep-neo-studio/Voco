(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();const b={baseUrl:localStorage.getItem("voco_server_url")||"http://localhost:5000",setBaseUrl(t){this.baseUrl=t.replace(/\/$/,""),localStorage.setItem("voco_server_url",this.baseUrl)},async ping(){try{const t=new AbortController,e=setTimeout(()=>t.abort(),2e3),r=await fetch(`${this.baseUrl}/ping`,{signal:t.signal});return clearTimeout(e),r.ok}catch{return!1}},async uploadFile(t){const e=new FormData;e.append("archivo",t);const r=await fetch(`${this.baseUrl}/analizar`,{method:"POST",body:e});if(!r.ok)throw new Error((await r.json()).error||"Error uploading");return await r.json()},async getLanguages(){return await(await fetch(`${this.baseUrl}/idiomas`)).json()},async getVoices(t){return await(await fetch(`${this.baseUrl}/voces/${t}`)).json()},async convert(t,e,r){const o=await fetch(`${this.baseUrl}/convertir`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_id:t,voz_id:e,capitulos:r})});if(!o.ok)throw new Error((await o.json()).error||"Error starting conversion");return await o.json()},async getJobStatus(t){return await(await fetch(`${this.baseUrl}/estado/${t}`)).json()},getDownloadUrl(t,e){return`${this.baseUrl}/descargar/${t}/${encodeURIComponent(e)}`}},ce="modulepreload",le=function(t){return"/"+t},W={},de=function(e,r,o){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(r.map(d=>{if(d=le(d),d in W)return;W[d]=!0;const l=d.endsWith(".css"),h=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${h}`))return;const m=document.createElement("link");if(m.rel=l?"stylesheet":ce,l||(m.as="script"),m.crossOrigin="",m.href=d,a&&m.setAttribute("nonce",a),document.head.appendChild(m),l)return new Promise((S,k)=>{m.addEventListener("load",S),m.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return s.then(i=>{for(const a of i||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const ue=t=>{const e=new Map;e.set("web",{name:"web"});const r=t.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},o=(n,i)=>{r.platforms.set(n,i)},s=n=>{r.platforms.has(n)&&(r.currentPlatform=r.platforms.get(n))};return r.addPlatform=o,r.setPlatform=s,r},fe=t=>t.CapacitorPlatforms=ue(t),X=fe(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});X.addPlatform;X.setPlatform;var U;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(U||(U={}));class j extends Error{constructor(e,r,o){super(e),this.message=e,this.code=r,this.data=o}}const ge=t=>{var e,r;return t!=null&&t.androidBridge?"android":!((r=(e=t==null?void 0:t.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},me=t=>{var e,r,o,s,n;const i=t.CapacitorCustomPlatform||null,a=t.Capacitor||{},d=a.Plugins=a.Plugins||{},l=t.CapacitorPlatforms,h=()=>i!==null?i.name:ge(t),m=((e=l==null?void 0:l.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||h,S=()=>m()!=="web",k=((r=l==null?void 0:l.currentPlatform)===null||r===void 0?void 0:r.isNativePlatform)||S,Q=u=>{const f=B.get(u);return!!(f!=null&&f.platforms.has(m())||q(u))},Z=((o=l==null?void 0:l.currentPlatform)===null||o===void 0?void 0:o.isPluginAvailable)||Q,ee=u=>{var f;return(f=a.PluginHeaders)===null||f===void 0?void 0:f.find($=>$.name===u)},q=((s=l==null?void 0:l.currentPlatform)===null||s===void 0?void 0:s.getPluginHeader)||ee,te=u=>t.console.error(u),re=(u,f,$)=>Promise.reject(`${$} does not have an implementation of "${f}".`),B=new Map,ne=(u,f={})=>{const $=B.get(u);if($)return console.warn(`Capacitor plugin "${u}" already registered. Cannot register plugins twice.`),$.proxy;const L=m(),x=q(u);let P;const se=async()=>(!P&&L in f?P=typeof f[L]=="function"?P=await f[L]():P=f[L]:i!==null&&!P&&"web"in f&&(P=typeof f.web=="function"?P=await f.web():P=f.web),P),ae=(g,v)=>{var y,E;if(x){const C=x==null?void 0:x.methods.find(p=>v===p.name);if(C)return C.rtype==="promise"?p=>a.nativePromise(u,v.toString(),p):(p,A)=>a.nativeCallback(u,v.toString(),p,A);if(g)return(y=g[v])===null||y===void 0?void 0:y.bind(g)}else{if(g)return(E=g[v])===null||E===void 0?void 0:E.bind(g);throw new j(`"${u}" plugin is not implemented on ${L}`,U.Unimplemented)}},I=g=>{let v;const y=(...E)=>{const C=se().then(p=>{const A=ae(p,g);if(A){const T=A(...E);return v=T==null?void 0:T.remove,T}else throw new j(`"${u}.${g}()" is not implemented on ${L}`,U.Unimplemented)});return g==="addListener"&&(C.remove=async()=>v()),C};return y.toString=()=>`${g.toString()}() { [capacitor code] }`,Object.defineProperty(y,"name",{value:g,writable:!1,configurable:!1}),y},G=I("addListener"),V=I("removeListener"),ie=(g,v)=>{const y=G({eventName:g},v),E=async()=>{const p=await y;V({eventName:g,callbackId:p},v)},C=new Promise(p=>y.then(()=>p({remove:E})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await E()},C},_=new Proxy({},{get(g,v){switch(v){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return x?ie:G;case"removeListener":return V;default:return I(v)}}});return d[u]=_,B.set(u,{name:u,proxy:_,platforms:new Set([...Object.keys(f),...x?[L]:[]])}),_},oe=((n=l==null?void 0:l.currentPlatform)===null||n===void 0?void 0:n.registerPlugin)||ne;return a.convertFileSrc||(a.convertFileSrc=u=>u),a.getPlatform=m,a.handleError=te,a.isNativePlatform=k,a.isPluginAvailable=Z,a.pluginMethodNoop=re,a.registerPlugin=oe,a.Exception=j,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a.platform=a.getPlatform(),a.isNative=a.isNativePlatform(),a},ve=t=>t.Capacitor=me(t),O=ve(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),D=O.registerPlugin;O.Plugins;class Y{constructor(e){this.listeners={},this.retainedEventArguments={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,r){let o=!1;this.listeners[e]||(this.listeners[e]=[],o=!0),this.listeners[e].push(r);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n),o&&this.sendRetainedArgumentsForEvent(e);const i=async()=>this.removeListener(e,r);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,r,o){const s=this.listeners[e];if(!s){if(o){let n=this.retainedEventArguments[e];n||(n=[]),n.push(r),this.retainedEventArguments[e]=n}return}s.forEach(n=>n(r))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,r){this.windowListeners[r]={registered:!1,windowEventName:e,pluginEventName:r,handler:o=>{this.notifyListeners(r,o)}}}unimplemented(e="not implemented"){return new O.Exception(e,U.Unimplemented)}unavailable(e="not available"){return new O.Exception(e,U.Unavailable)}async removeListener(e,r){const o=this.listeners[e];if(!o)return;const s=o.indexOf(r);this.listeners[e].splice(s,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const r=this.retainedEventArguments[e];r&&(delete this.retainedEventArguments[e],r.forEach(o=>{this.notifyListeners(e,o)}))}}const J=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),K=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class he extends Y{async getCookies(){const e=document.cookie,r={};return e.split(";").forEach(o=>{if(o.length<=0)return;let[s,n]=o.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=K(s).trim(),n=K(n).trim(),r[s]=n}),r}async setCookie(e){try{const r=J(e.key),o=J(e.value),s=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),i=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${r}=${o||""}${s}; path=${n}; ${i};`}catch(r){return Promise.reject(r)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const r of e)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}D("CapacitorCookies",{web:()=>new he});const pe=async t=>new Promise((e,r)=>{const o=new FileReader;o.onload=()=>{const s=o.result;e(s.indexOf(",")>=0?s.split(",")[1]:s)},o.onerror=s=>r(s),o.readAsDataURL(t)}),ye=(t={})=>{const e=Object.keys(t);return Object.keys(t).map(s=>s.toLocaleLowerCase()).reduce((s,n,i)=>(s[n]=t[e[i]],s),{})},we=(t,e=!0)=>t?Object.entries(t).reduce((o,s)=>{const[n,i]=s;let a,d;return Array.isArray(i)?(d="",i.forEach(l=>{a=e?encodeURIComponent(l):l,d+=`${n}=${a}&`}),d.slice(0,-1)):(a=e?encodeURIComponent(i):i,d=`${n}=${a}`),`${o}&${d}`},"").substr(1):null,be=(t,e={})=>{const r=Object.assign({method:t.method||"GET",headers:t.headers},e),s=ye(t.headers)["content-type"]||"";if(typeof t.data=="string")r.body=t.data;else if(s.includes("application/x-www-form-urlencoded")){const n=new URLSearchParams;for(const[i,a]of Object.entries(t.data||{}))n.set(i,a);r.body=n.toString()}else if(s.includes("multipart/form-data")||t.data instanceof FormData){const n=new FormData;if(t.data instanceof FormData)t.data.forEach((a,d)=>{n.append(d,a)});else for(const a of Object.keys(t.data))n.append(a,t.data[a]);r.body=n;const i=new Headers(r.headers);i.delete("content-type"),r.headers=i}else(s.includes("application/json")||typeof t.data=="object")&&(r.body=JSON.stringify(t.data));return r};class Pe extends Y{async request(e){const r=be(e,e.webFetchExtra),o=we(e.params,e.shouldEncodeUrlParams),s=o?`${e.url}?${o}`:e.url,n=await fetch(s,r),i=n.headers.get("content-type")||"";let{responseType:a="text"}=n.ok?e:{};i.includes("application/json")&&(a="json");let d,l;switch(a){case"arraybuffer":case"blob":l=await n.blob(),d=await pe(l);break;case"json":d=await n.json();break;case"document":case"text":default:d=await n.text()}const h={};return n.headers.forEach((m,S)=>{h[S]=m}),{data:d,headers:h,status:n.status,url:n.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}D("CapacitorHttp",{web:()=>new Pe});var R;(function(t){t.Documents="DOCUMENTS",t.Data="DATA",t.Library="LIBRARY",t.Cache="CACHE",t.External="EXTERNAL",t.ExternalStorage="EXTERNAL_STORAGE"})(R||(R={}));var z;(function(t){t.UTF8="utf8",t.ASCII="ascii",t.UTF16="utf16"})(z||(z={}));const Ee=D("Filesystem",{web:()=>de(()=>import("./web-B67gvwQn.js"),[]).then(t=>new t.FilesystemWeb)});let F=null,N=[],H=localStorage.getItem("selected_voice_id")||"es-MX-JorgeNeural";const Ce={connection:document.getElementById("connection-screen"),app:document.querySelector(".app-container")},w={serverUrl:document.getElementById("server-url"),connectBtn:document.getElementById("btn-connect"),connError:document.getElementById("connection-error")},c={fileInput:document.getElementById("file-upload"),fileName:document.getElementById("file-name"),changeFileBtn:document.getElementById("change-file-btn"),languageSelect:document.getElementById("language-select"),regionSelect:document.getElementById("region-select"),voiceGrid:document.querySelector(".voice-grid"),convertBtn:document.getElementById("convert-btn"),statusText:document.getElementById("status-text"),progressBar:document.querySelector(".progress-fill")};document.addEventListener("DOMContentLoaded",()=>{const t=localStorage.getItem("voco_server_url");t&&(w.serverUrl.value=t),w.connectBtn.addEventListener("click",Le),c.fileInput.addEventListener("change",Ue),c.changeFileBtn.addEventListener("click",()=>c.fileInput.click()),c.languageSelect.addEventListener("change",M),c.convertBtn.addEventListener("click",Se)});async function Le(){const t=w.serverUrl.value.trim();if(!t)return;w.connectBtn.disabled=!0,w.connectBtn.textContent="Conectando...",w.connError.style.display="none",b.setBaseUrl(t),await b.ping()?(Ce.connection.style.display="none",await $e()):(w.connError.textContent="No se pudo conectar. Verifica que server.py esté corriendo.",w.connError.style.display="block"),w.connectBtn.disabled=!1,w.connectBtn.textContent="Conectar"}async function $e(){try{const t=await b.getLanguages();c.languageSelect.innerHTML="";let e="es";t.forEach(r=>{const o=document.createElement("option");o.value=r.codigo,o.textContent=r.nombre,r.codigo==="es"&&(o.selected=!0),c.languageSelect.appendChild(o)}),await M()}catch(t){console.error(t),alert("Error cargando idiomas")}}async function M(){c.voiceGrid.innerHTML='<div class="spinner"></div>';const t=c.languageSelect.value;try{const e=await b.getVoices(t);xe(e)}catch{c.voiceGrid.innerHTML="<p>Error cargando voces</p>"}}function xe(t){if(c.voiceGrid.innerHTML="",t.length===0){c.voiceGrid.innerHTML="<p>No hay voces disponibles</p>";return}t.forEach(e=>{const r=document.createElement("div"),o=e.id===H;r.className=`voice-card ${o?"selected":""}`,r.innerHTML=`
            <div class="voice-header" onclick="selectVoice('${e.id}')">
                <div class="voice-info">
                    <div class="voice-name">${e.nombre}</div>
                    <div class="voice-meta">${e.region} • ${e.genero}</div>
                </div>
                <button class="btn-preview-voice" onclick="event.stopPropagation(); playPreview('${e.id}')">▶️</button>
            </div>
        `,c.voiceGrid.appendChild(r)})}window.selectVoice=t=>{H=t,localStorage.setItem("selected_voice_id",t),document.querySelectorAll(".voice-card").forEach(r=>r.classList.remove("selected")),M()};window.playPreview=async t=>{new Audio(`${b.baseUrl}/probar-voz/${t}`).play().catch(r=>alert("Error reproduciendo audio: "+r.message))};async function Ue(t){const e=t.target.files[0];if(e){c.statusText.textContent="Subiendo archivo...",c.fileName.textContent=e.name;try{const r=await b.uploadFile(e);F=r.file_id,N=r.capitulos,c.statusText.textContent=`Archivo listo. ${N.length} capítulos detectados.`,c.convertBtn.disabled=!1}catch(r){alert("Error al subir: "+r.message),c.statusText.textContent="Error al subir.",c.fileName.textContent="---"}}}async function Se(){if(F){c.convertBtn.disabled=!0,c.statusText.textContent="Iniciando conversión remota...";try{const{job_id:t}=await b.convert(F,H,[]);Ae(t)}catch(t){alert("Error iniciando: "+t.message),c.convertBtn.disabled=!1}}}async function Ae(t){const e=setInterval(async()=>{try{const r=await b.getJobStatus(t);if(r.estado==="convirtiendo"||r.estado==="iniciando"){const o=Math.round(r.actual/r.total*100);c.progressBar.style.width=`${o}%`,c.statusText.textContent=`Convirtiendo: ${o}% (${r.actual}/${r.total})`}else r.estado==="completado"?(clearInterval(e),c.progressBar.style.width="100%",c.statusText.textContent="¡Completado! Descargando a tu celular...",await Te(t),c.convertBtn.disabled=!1):r.estado==="error"&&(clearInterval(e),c.statusText.textContent="Error en el servidor: "+r.error,c.convertBtn.disabled=!1)}catch(r){console.error("Polling error",r)}},1e3)}async function Te(t){try{const r=await(await fetch(`${b.baseUrl}/descargas/${t}`)).json();for(const o of r.archivos){c.statusText.textContent=`Descargando ${o.nombre}...`;const n=await(await fetch(b.getDownloadUrl(t,o.nombre))).blob(),i=new FileReader;i.readAsDataURL(n),await new Promise((a,d)=>{i.onloadend=async()=>{const l=i.result.split(",")[1];try{const h=`Audiolibros_Voco/${o.nombre}`;await Ee.writeFile({path:h,data:l,directory:R.Documents,recursive:!0}),console.log(`Saved ${h}`),a()}catch(h){console.error("Save error",h),d(h)}},i.onerror=d})}c.statusText.textContent="¡Todo guardado en Documentos/Audiolibros_Voco!",alert("¡Listo! Archivos guardados en tu carpeta de Documentos.")}catch(e){console.error(e),alert("Error descargando resultados: "+e.message),c.statusText.textContent="Error en descarga final."}}export{z as E,Y as W,be as b};
